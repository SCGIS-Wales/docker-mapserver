

MapServer Documentation
Release 8.6.0




The MapServer Team







2025-12-03




CONTENTS








1Introduction21.1	An Introduction to MapServer . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .21.1.1	MapServer Overview . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .31.1.2	Anatomy of a MapServer Application . . . . . . . . . . . . . . . . . . . . . . . . . . . . .41.1.3	Installation and Requirements  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .6Hardware Requirements  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .6Software Requirements . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .7Skills . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .7Secure your installation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .7Windows Installation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .71.1.4	Introduction to the Mapfile . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .15MAP Object  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .17LAYER Object . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .17CLASS and STYLE Objects . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .18SYMBOLs  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .19LABEL . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .21CLASS Expressions  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .22INCLUDE  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .23Get MapServer Running . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .24Get Demo Running . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .241.1.5	Making the Site Your Own . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .24Adding Data to Your Site . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .25Vector Data . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .25Raster Data . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .25Projections  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .251.1.6	Enhancing your site . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .25Adding Query Capability . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .25Attribute queries . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .26Spatial queries  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .26Interfaces . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .26Data Optimization  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .261.1.7	How do I get Help? . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .27Documentation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .27Users Mailing List  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .27Matrix/IRC . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .27Reporting bugs . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .27Tutorial . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .27Test Suite (msautotest) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .27Books . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .27
2Tutorial282.1	MapServer Tutorial . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .282.1.1	Tutorial background . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .28Tutorial Timeframe . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .28Tutorial Data . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .29Before Using the Tutorial . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .29Windows, UNIX/Linux Issues . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .29Other Resources  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .302.1.2	Section 1: Static Maps and the MapFile  . . . . . . . . . . . . . . . . . . . . . . . . . . . .302.1.3	Section 2: CGI variables and the User Interface . . . . . . . . . . . . . . . . . . . . . . . .31HTML Templates . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .31Examples . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .312.1.4	Section 3: Query and more about HTML Templates . . . . . . . . . . . . . . . . . . . . . .322.1.5	Section 4: Advanced User Interfaces . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .323Installation333.1	Installation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .333.1.1	Compiling on Unix . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .33Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .34Compiler Requirements  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .34Obtaining the necessary software  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .34Secure your installation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .34Anti-Grain Geometry Support . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .36OGC Support . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .36Spatial Warehousing . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .38Compiling  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .38Installation  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .403.1.2	Compiling on Win32 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .42Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .42Compiler Requirements  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .43Compiling  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .43Set up a Project Directory  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .43Download MapServer Source Code and Supporting Libraries . . . . . . . . . . . . . . . . . .43The MapServer source code . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .44Set Compilation Options . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .45Compile the Libraries  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .46Compile MapServer  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .46Compiling MapServer with PostGIS support  . . . . . . . . . . . . . . . . . . . . . . . . . .47Common Compiling Errors  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .47Installation  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .48Other Helpful Information . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .48Acknowledgements . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .493.1.3	PHP MapScript Installation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .49Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .49Obtaining, Compiling, and Installing PHP and the PHP/MapScript Module . . . . . . . . . .50FAQ / Common Problems  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .533.1.4	.NET MapScript Compilation  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .56Compilation  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .56Installation  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .58Known issues . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .58Most frequent errors  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .60Bug reports . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .613.1.5	Running MapServer on IIS . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .61MapServer Set-up  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .62

Configuring with IIS . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .63MapServer Configuration File . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .66Setting up Applications . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .67Setting up Logging . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .69Further Configuration  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .69Securing MapServer in IIS . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .71Troubleshooting  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .723.1.6	Oracle Installation  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .73Preface  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .73System Assumptions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .74Compile MapServer  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .74Set Environment Variables . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .753.1.7	V8 MapScript Support . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .77Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .77Obtaining, Compiling, and Installing V8 and V8/MapScript . . . . . . . . . . . . . . . . . .774Mapfile794.1	Mapfile . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .794.1.1	Cartographical Symbol Construction with MapServer . . . . . . . . . . . . . . . . . . . . .80Abstract . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .81Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .81Using Cartographical Symbols in MapServer . . . . . . . . . . . . . . . . . . . . . . . . . .85Construction of Point Symbols . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .86Construction of Line Symbols . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .94Area Symbols . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .104Examples (MapServer 4) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .122Tricks . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .128Mapfile changes related to symbols  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .134Current Problems / Open Issues . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .134The End . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .1344.1.2	CLASS  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .1344.1.3	CLUSTER  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .138Description . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .138Supported Layer Types . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .138Mapfile Parameters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .138Supported Processing Options . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .139Mapfile Snippet . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .139Feature attributes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .140Handling GetFeatureInfo . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .140PHP MapScript Usage . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .141Example: Clustering Railway Stations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .1414.1.4	COMPOSITE . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .143Background . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .143Parameters  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .143Usage . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .1464.1.5	CONFIG  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .1474.1.6	Display of International Characters in MapServer . . . . . . . . . . . . . . . . . . . . . . .150Credit . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .150Related Links . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .150Requirements . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .150How to Enable in Your Mapfile (MapServer >= 7.0)  . . . . . . . . . . . . . . . . . . . . . .151How to Enable in Your Mapfile (MapServer < 7.0) . . . . . . . . . . . . . . . . . . . . . . .153Example Using PHP MapScript . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .154Notes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .155
4.1.7 Expressions	155
Introduction	156
Expression Types	157
String comparison (equality)	157
Regular expression comparison	158
List expressions	159
"MapServer expressions"	160
4.1.8 FEATURE	167
4.1.9 FONTSET	168
Format of the fontset file	168
4.1.10 GEOMTRANSFORM - Geometry Transformations	169
Transformations for simple styling (CLASS STYLE only)	171
Labels (LABEL STYLE only)	175
Expressions and advanced transformations (LAYER and CLASS STYLE)	177
Javascript transformation	189
4.1.11 GRID	192
Description	192
Mapfile Parameters:	192
Example1: Grid Displaying Degrees	193
Example2: Grid Displaying Degrees with Symbol	194
Example3: Grid Displayed in Other Projection (Google Mercator)	195
4.1.12 IDENTIFY	196
4.1.13 INCLUDE	198
Notes	198
Example	198
4.1.14 JOIN	199
Description	199
Supported Formats	199
Mapfile Parameters:	200
Example 1: Join from Shapefile to DBF file	200
Example 2: Join from Shapefile to PostgreSQL table	202
Example 3: Join from Shapefile to CSV file	203
Example 4: Join from Shapefile to MySQL	204
Example 5: One-to-many join	205
4.1.15 LABEL	206
4.1.16 LAYER	215
4.1.17 LEADER	240
Description	240
Supported Layer Types	240
Mapfile Parameters	240
Mapfile Snippet	240
Example: World Countries Labels	241
4.1.18 LEGEND	244
4.1.19 MAP	246
4.1.20 OUTPUTFORMAT	251
4.1.21 PROJECTION	257
Background	257
Projections with MapServer	257
"Web Mercator" or "Google Mercator"	258
PROJECTION AUTO	258
Setting the location of PROJ files	259
Important Notes	260
For More Information	260
4.1.22 QUERYMAP	261

4.1.23 REFERENCE	261
4.1.24 SCALEBAR	262
4.1.25 STYLE	265
4.1.26 STYLEITEM Javascript	275
Introduction	275
Usage	275
Example 1. Single STYLE definition	276
Example 2. CLASS with multiple STYLE definitions	277
Example 3. Printing logs in MapServer logs	277
4.1.27 SYMBOL	278
4.1.28 Symbology Examples	280
Example 1. Dashed Line	281
Example 2. TrueType font marker symbol	281
Example 3. Vector triangle marker symbol	282
Example 4. Non-contiguous vector marker symbol (Cross)	282
Example 5. Circle vector symbol	282
Example 6. Downward diagonal fill	282
Example 7. Using the Symbol Type HATCH (new in 4.6)	283
Example 8. Styled lines using GAP	283
4.1.29 Templating	284
Introduction	284
Format	285
Example Template	295
4.1.30 VALIDATION	296
Introduction	297
Default values if not provided in the URL	297
Test with Commandline	298
Filter example	298
Expression Example	299
4.1.31 Union Layer	300
Description	301
Requirements	301
Mapfile Configuration	301
Feature attributes	302
Classes and Styles	302
Projections	302
Supported Processing Options	302
Examples	303
4.1.32 WEB	305
4.1.33 XML Mapfile support	308
Enabling the support	308
Usage:	309
4.1.34 Notes	309
5 MapScript	311
5.1 MapScript	311
5.1.1 SWIG MapScript API Reference	311
Introduction	312
Appendices	312
MapScript Classes	312
MapScript Functions	360
MapScript Constants	361
5.1.2 PHP MapScript	370
PHP MapScript	371


PHP MapScript API  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .373PHP MapScript Migration Guide  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .414By Example . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .4185.1.3	Python MapScript Appendix . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .428Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .428Classes  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .428Exception Handling . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .4305.1.4	MapScript Image Generation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .430Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .430Imagery Overview  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .431The imageObj Class  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .431Image Output . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .431Images and Symbols . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .4325.1.5	Mapfile Manipulation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .432Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .433Mapfile Overview  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .433The mapObj Class  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .433Children of mapObj  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .434Metadata  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .4355.1.6	Querying  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .435Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .436Attribute Queries . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .437Spatial Queries . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .4376MapCache4396.1	MapCache 1.14.1 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .4396.1.1	Compilation & Installation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .439Getting the Source  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .440Linux Instructions  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .440Windows Instructions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .4496.1.2	Configuration File . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .453Source  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .453Cache . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .454Format  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .456Grid . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .457Tileset . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .460Services . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .465Ruleset  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .466Miscellaneous  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .467Metadata  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .4696.1.3	Supported Tile Services . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .471TMS Service . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .471KML Service . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .472OGC WMTS Service . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .473OGC WMS Service  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .473GoogleMaps XYZ Service . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .475Virtual Earth tile service . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .4776.1.4	Seeder . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .478Usage . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .4786.1.5	Cache Types . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .480Disk Caches  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .481Berkeley DB Caches . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .483Lightning Memory-Mapped Database Caches . . . . . . . . . . . . . . . . . . . . . . . . . .483SQLite Caches . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .484
MBTiles Caches	489
Memcache Caches	490
(Geo)TIFF Caches	490
REST Caches	493
Meta Caches	495
Riak Caches	497
6.1.6 Image Formats	497
JPEG Format	497
PNG Format	498
Mixed Format	498
RAW Format	498
6.1.7 Tileset Dimensions	499
Introduction	499
Enabling Dimension Support in MapCache	500
First Level Dimensions	500
Second Level Dimensions	501
Storing Dimensions	509
Accessing Tile Caches with Dimensions	510
Seeding Tile Caches with Dimensions	510
6.1.8 HTTP Requests	510
Specifying the URL	510
Timeouts	510
Headers	511
Authorization	511
6.1.9 FeatureInfo Requests	512
6.1.10 Proxying Unsupported Requests	512
Parameter Filtering	513
Proxy Destination	513
6.1.11 Data Sources	514
WMS Sources	514
MapFile Sources	514
WMTS Sources	514
6.1.12 Tile Assembling	515
6.1.13 Locking Mechanisms	515
Disk Locks	515
Memcache Locks	516
Fallback Locks	516
6.1.14 Coverage Analyzer	516
NAME	516
SYNOPSIS	517
DESCRIPTION	517
OPTIONS	517
COUNTING TILES	518
OUTPUT REPORT	520
EXAMPLES	521
6.1.15 Features	522
7 Migration Guide	523
7.1 MapServer Migration Guide	523
7.1.1 MapServer 8.4 to 8.6 Migration	523
7.1.2 MapServer 8.2 to 8.4 Migration	526
7.1.3 MapServer 8.0 to 8.2 Migration	527
7.1.4 MapServer 7.6 to 8.0 Migration	527
7.1.5 MapServer 7.4 to 7.6 Migration	529
7.1.6 MapServer 7.2 to 7.4 Migration	531
7.1.7 MapServer 7.0 to 7.2 Migration	532
7.1.8 MapServer 6.4 to 7.0 Migration	532
7.1.9 MapServer 6.2 to 6.4 Migration	533
7.1.10 MapServer 6.0 to 6.2 Migration	533
Build system changes	534
CGI Changes	534
Rendering changes	534
7.1.11 MapServer 5.6 to 6.0 Migration	534
Mapfile Changes - Expression Parsing	534
Mapfile Changes - Label Styles	535
Mapfile Changes - Label MAXOVERLAPANGLE	535
Core Changes - Rendering Overhaul	535
Mapfile Changes - line styling	536
CGI Changes	536
OGC Web Services	536
Mapfile Changes - WCS Metadata	537
Mapfile Changes - OGC requests - DUMP parameter removed	537
Mapfile Changes - Ability to escape single/double quotes	537
PHP MapScript Changes	537
MapScript (All Flavors)	539
OUTPUTFORMAT	539
Rasters	539
Deprecated features	540
7.1.12 MapServer 5.4 to 5.6 Migration	540
MapScript changes related to single pass queries	540
WFS 1.1 axis orientation	540
Change of mime-type for the imagemap outputformat	540
7.1.13 MapServer 5.2 to 5.4 Migration	540
New requirements for mapfiles, symbolsets and templates	540
7.1.14 MapServer 4.10 to 5.0 Migration	541
Mapfile changes	541
Symbol file changes	541
Styling/Symbology changes	542
AGG rendering changes	542
URL configuration changes	542
Validation patterns for mapserv attribute queries	542
SWIG MapScript (Python, Perl, CSharp, Java) changes	543
CSharp related changes	543
PHP/MapScript changes	543
OGC Web Map Service (WMS)	543
OGC Web Feature Service (WFS)	544
OGC Sensor Observation Service (SOS)	544
Build Changes	544
Features Heading for Deprecation	544
8 Input	546
8.1 Data Input	546
8.1.1 Vector Data	546
Data Format Types	547
ArcInfo	548
ArcSDE	549
Contour	552
DGN	557
ESRI File Geodatabase	558
ESRI Personal Geodatabase (MDB)	561
ESRI Shapefiles (SHP)	563
FlatGeobuf	565
GML	572
GeoJSON	574
GeoPackage	577
GPS Exchange Format (GPX)	581
Inline	583
KML - Keyhole Markup Language	585
MapInfo	592
MSSQL	594
MySQL	598
NTF	603
OGR Vector Layers Through MapServer	604
Oracle Spatial	620
PostGIS/PostgreSQL	626
SDTS	639
S57	641
SpatiaLite	643
USGS TIGER	647
Vector field rendering - UVraster	649
Virtual Spatial Data	652
WFS	657
8.1.2 Raster Data	659
Introduction	660
How are rasters added to a Map file?	660
Supported Formats	662
Rasters and Tile Indexing	663
Raster Warping	664
24bit RGB Rendering	664
Special Processing Directives	665
Raster Labelling	668
Raster Query	669
Raster Display Performance Tips	671
Preprocessing Rasters	671
Georeference with World Files	673
8.1.3 Virtual File System	673
Virtual File System	674
9 Output	679
9.1 Output Generation	679
9.1.1 AGG Rendering Specifics	679
Introduction	679
Setting the OutputFormat	679
New Features	680
Modified Behavior	681
9.1.2 AntiAliasing with MapServer	681
What needs to be done	682
9.1.3 Dynamic Charting	685
Setup	686
Adding a Chart Layer to a Mapfile	687
Pie Charts	689
Bar Graphs	691
9.1.4 Flash Output	692
Introduction	692
Installing MapServer with Flash Support	693
How to Output SWF Files from MapServer	694
What is Currently Supported and Not Supported	697
9.1.5 HTML Legends with MapServer	698
Introduction	698
Sample Site Using the HTML Legend	707
9.1.6 Inverse distance weighted interpolation	708
Introduction	709
Configuration	709
Advanced sample weighting and filtering	709
Raster Color Ramping	709
Example mapfiles	709
9.1.7 HTML Imagemaps	710
Introduction	711
Mapfile Layer Definition	711
Templates	712
Request URL	712
Additional Notes	713
More Information	713
9.1.8 Kernel Density Estimation (Dynamic Heatmap)	713
Introduction	713
Configuration	713
Advanced sample weighting and filtering	715
Raster Color Ramping	716
Example mapfiles	717
9.1.9 OGR Output	719
Introduction	720
OUTPUTFORMAT Declarations	720
LAYER Metadata	722
MAP / WEB Metadata	723
Geometry Types Supported	724
Attribute Field Definitions	724
Return Packaging	725
Test Suite Example	725
9.1.10 PDF Output	725
Introduction	726
What is currently supported and not supported	726
Implementing PDF Output	727
PHP/MapScript and PDF Output	728
9.1.11 SVG	730
Introduction	731
Feature Types and SVG Support Status	731
Setting up a Mapfile for SVG Output	732
Testing your SVG Output	733
goSVG	734
9.1.12 Tile Mode	738
Introduction	738
Configuration	738
Utilization	740
9.1.13 Template-Driven Output	745
Introduction	745
OUTPUTFORMAT Declarations	746


Template Substitution Tags . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .746Examples . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .7479.1.14  KML Output  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .752Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .752General Functionality . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .752Output format . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .752Build  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .753Limiting the number of features . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .753Map . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .753Layers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .754Styling  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .757Attributes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .758Coordinate system  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .758Warning and Error Messages . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .7589.1.15  UTFGrid Output  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .758Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .759Functionality . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .759Build  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .759Setting the OutputFormat . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .759Exposing Feature Properties . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .7609.1.16  Index Page . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .760Background . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .760Configuration . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .760MapServer Homepage  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .761Individual Mapfile Homepages . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .76210 OGC76410.1  OGC Support and Configuration . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .76410.1.1  MapServer OGC Specification support . . . . . . . . . . . . . . . . . . . . . . . . . . . . .76410.1.2  Accessing OGC services over HTTPS . . . . . . . . . . . . . . . . . . . . . . . . . . . . .764Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .765Requirements . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .765Verify Installation  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .765CA Bundle  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .766Mapfile Setup . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .766Remote Server with a Self-Signed SSL Certificate  . . . . . . . . . . . . . . . . . . . . . . .76710.1.3  WMS Server  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .768Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .769Setting Up a WMS Server Using MapServer  . . . . . . . . . . . . . . . . . . . . . . . . . .770Changing the Online Resource URL . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .777WMS 1.3.0 Support  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .780Reference Section . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .782FAQ / Common Problems  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .79710.1.4  OGC API : Features . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .798Background . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .799Requirements . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .800Setting Up an OGC API Server Using MapServer . . . . . . . . . . . . . . . . . . . . . . . .800Further Configuration  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .80910.1.5  INSPIRE View Service . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .810Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .810Activation of INSPIRE support  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .811Multi-language support for certain capabilities fields . . . . . . . . . . . . . . . . . . . . . .811Provision of INSPIRE specific metadata . . . . . . . . . . . . . . . . . . . . . . . . . . . . .812Named group layers  . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .814
Style section for root layer and possibly existing group layers	814
10.1.6 WMS Client	816
Introduction	817
Compilation / Installation	817
MapFile Configuration	818
Limitations/TODO	826
10.1.7 WMS Time	826
Introduction	826
Enabling Time Support in MapServer	827
Future Additions	831
Limitations and Known Bugs	831
10.1.8 WMS Dimension	831
Introduction	831
Enabling Dimension Support in MapServer	831
GetCapabilities Output	832
Supported Dimension Requests	833
Processing Dimension Requests	833
10.1.9 Map Context	833
Introduction	834
Implementing a Web Map Context	834
10.1.10 Layer Metadata	841
Introduction	842
How it Works	842
Supported Metadata Formats	842
The Layer Metadata API	842
Request Example	842
10.1.11 WFS Server	842
Introduction	843
Configuring your MapFile to Serve WFS layers	844
Stored queries (WFS 2.0)	850
Reference Section	853
To-do Items and Known Limitations	861
10.1.12 INSPIRE Download Service	861
Introduction	862
Activation of INSPIRE support	862
Multi-language support for certain capabilities fields	863
Provision of INSPIRE specific metadata	864
10.1.13 WFS Client	865
Introduction	866
Setting up a WFS-client Mapfile	867
TODO / Known Limitations	870
10.1.14 WFS-T Server	871
WFS-T	871
10.1.15 WFS Filter Encoding	871
Introduction	871
Currently Supported Features	872
Get and Post Requests	873
Use of Filter Encoding in MapServer	873
Limitations	875
Tests	875
10.1.16 SLD	879
Introduction	880
Server Side Support	880
Client Side Support	889

Named Styles support	891
Other Items Implemented	891
Issues Found During Implementation	891
10.1.17 WCS Server	892
Introduction	892
Configuring Your Mapfile to Serve WCS Layers	893
Test Your WCS 1.0 Server	895
WCS 1.1.0+ Issues	897
WCS 2.0	899
HTTP-POST support	904
INSPIRE download service support	907
Reference Section	907
Rules for handling SRS in a MapServer WCS	913
Spatio/Temporal Indexes	913
WCS 2.0 Application Profile - Earth Observation (EO-WCS)	914
To-do Items and Known Limitations	914
Credits	915
10.1.18 WCS Use Cases	915
Landsat	915
SPOT	916
DEM	917
NetCDF	918
GRIB2 output format	920
10.1.19 SOS Server	922
Introduction	922
Setting Up an SOS Server Using MapServer	923
Limitations / TODO	928
Reference Section	929
Use of sos_procedure and sos_procedure_item	934
10.1.20 MapScript Wrappers for WxS Services	935
Introduction	935
Python Examples	935
Perl Example	937
Java Example	939
PHP Example	941
Use in Non-CGI Environments (mod_php, etc)	942
Post Processing Capabilities	942
11 Basemaps	944
11.1 Basemaps	944
11.1.1 Installation	944
Data	945
Project configuration	946
11.1.2 Tweaking Map Styles	947
Generating a mapfile	948
11.1.3 Features	952
12 TinyOWS	953
12.1 TinyOWS	953
12.1.1 TinyOWS Installation	953
Requires	953
12.1.2 Configuring TinyOWS with an XML File	954
Configuration file simple Example	954
Testing your config.xml file	955

Structure of the config.xml file	955
12.1.3 Configuring TinyOWS with a standard Mapfile	960
Mapfile Config File support for TinyOWS	960
Mapfile path of each TinyOWS config element	961
12.1.4 Sample: WFS-T with TinyOWS and OpenLayers	962
12.1.5 Server Tuning: How to speed up your TinyOWS server	968
Tips and Tricks for PostgreSQL / PostGIS databases	968
Tips and Tricks for Apache	968
Using Fast-CGI	968
HTTP GZip compression	969
12.1.6 Working Around the LibXML2 XSD Schema GML Bug	969
Issue	969
Workaround and options	969
13 Optimization	972
13.1 Optimization	972
13.1.1 Debugging MapServer	972
Introduction	973
Steps to Enable MapServer Debugging	973
Debugging MapServer using Compiler Debugging Tools	984
Debugging Older Versions of MapServer (before 5.0)	985
13.1.2 Environment Variables	986
Background	986
List of all possible MapServer Environment Variables	987
13.1.3 FastCGI	992
Introduction	993
Obtaining the necessary software	993
mod_fcgid Configuration	993
Deprecated mod_fcgi Configuration	994
Common mod_fcgid/mod_fcgi Configuration	994
Common Problems	995
FastCGI on Win32	995
13.1.4 Limit Mapfile Access	996
Key Environment Variables	997
Setting Environment Variables	998
13.1.5 Mapfile Tuning & Management	999
Introduction	1000
Steps to Possibly Review	1000
13.1.6 Raster Management & Optimization	1007
Choose the right raster format for your needs	1008
Spend time to review GDAL's associated driver page for your chosen format	1008
Connect to your data through GDAL	1008
Overviews	1011
Tileindexes and Internal Tiling	1011
Learn & Review the various GDAL utilities to manage your rasters	1011
Handling your raster LAYERS in the mapfile	1011
Remote WMS	1011
13.1.7 Tile Indexes	1011
Introduction	1012
What is a tileindex and how do I make one?	1012
Using the tileindex in your mapfile	1013
Tileindexes may make your map faster	1013
Tileindexes with tiles in different projections	1014
Note for WCS layers	1014

Long ogrtindex example	1015
Long gdaltindex example	1019
13.1.8 Vector Data Management & Optimization	1023
Choose the right vector format for your needs	1024
Spend time to review GDAL's associated driver page for your chosen format	1025
Connect to your data through OGR/GDAL	1025
Learn & Review the various OGR utilities to manage your vectors	1026
Index your data	1027
Splitting your data	1027
Handling your vector LAYERS in the mapfile	1028
Shapefile Notes	1028
PostGIS Notes	1028
Databases in General (PostGIS, Oracle, SpatiaLite, GeoPackage, Microsoft SQL Server, MySQL)1031
14 Utilities	1034
14.1 Utilities	1034
14.1.1 coshp	1034
Purpose	1034
Description	1034
Syntax	1034
Example	1034
Result	1034
14.1.2 legend	1036
Purpose	1036
Syntax	1036
14.1.3 map2img	1036
Purpose	1037
Syntax	1037
14.1.4 msencrypt	1040
Purpose	1040
Syntax	1040
Use in Mapfile	1040
14.1.5 scalebar	1042
Purpose	1042
Syntax	1042
14.1.6 shptree	1042
Purpose	1042
Description	1043
Syntax	1043
Mapfile Notes	1043
14.1.7 shptreetst	1044
Purpose	1044
Syntax	1044
14.1.8 shptreevis	1045
Purpose	1045
Syntax	1045
14.1.9 sortshp	1046
Purpose	1046
Description	1046
Syntax	1046
Example	1046
Result	1046
14.1.10 sym2img	1047
Purpose	1047

Syntax	1047
14.1.11 tile4ms	1047
Purpose	1047
Description	1048
Syntax	1048
Short Example	1048
Long Example	1048
14.1.12 Batch Scripting	1051
Windows	1051
Linux	1051
14.1.13 File Management	1051
File Placement	1051
Temporary Files	1051
15 CGI	1053
15.1 CGI	1053
15.1.1 MapServer CGI Introduction	1053
Notes	1053
Changes	1053
15.1.2 mapserv	1054
15.1.3 Map Context Files	1054
Support for Local Map Context Files	1054
Support for Context Files Accessed Through a URL	1054
Default Map File	1055
15.1.4 MapServer CGI Controls	1055
Variables	1056
Changing mapfile parameters via a form or a URL	1060
15.1.5 Run-time Substitution	1061
Introduction	1061
Basic Example	1062
Parameters Supported	1062
Default values if not provided in the URL	1064
VALIDATION	1064
Magic values	1064
15.1.6 A Simple CGI Wrapper Script	1065
Introduction	1065
Script Information	1065
15.1.7 MapServer OpenLayers Viewer	1066
Using the OpenLayers viewer	1066
Location of the embedded OpenLayers.js file	1068
16 Glossary	1069
16.1 Glossary	1069
17 Errors	1074
17.1 Errors	1074
17.1.1 drawEPP(): EPPL7 support is not available	1074
Explanation	1075
17.1.2 loadLayer(): Unknown identifier. Maximum number of classes reached	1075
17.1.3 loadMapInternal(): Given map extent is invalid	1075
How to get a file's EXTENT values?	1075
17.1.4 msGetLabelSize(): Requested font not found	1076
17.1.5 msLoadFontset(): Error opening fontset	1077
17.1.6 msLoadMap(): Failed to open map file	1077

17.1.7 msProcessProjection(): no options found in 'init' file	1077
17.1.8 msProcessProjection(): No such file or directory	1077
17.1.9 msProcessProjection(): Projection library error. PROJ error "Cannot find proj.db" when in- stantiating "init=epsg:XXXX"	1078
Setting the location of PROJ files	1078
17.1.10 msProcessProjection(): Projection library error.major axis or radius = 0 not given	1079
Valid Examples	1079
17.1.11 msQueryByPoint: search returned no results	1079
17.1.12 msReturnPage(): Web application error. Malformed template name	1080
17.1.13 msSaveImageGD(): Unable to access file	1080
17.1.14 msWMSLoadGetMapParams(): WMS server error. Image Size out of range, WIDTH and HEIGHT must be between 1 and 2048 pixels	1081
17.1.15 Unable to load dll (MapScript)	1081
C#-specific information	1081
18 FAQ	1082
18.1 FAQ	1082
18.1.1 Where is the MapServer log file?	1082
18.1.2 What books are available about MapServer?	1082
18.1.3 How do I compile MapServer for Windows?	1082
18.1.4 What do MapServer version numbers mean?	1082
18.1.5 Is MapServer Thread-safe?	1082
18.1.6 What does STATUS mean in a LAYER?	1083
18.1.7 How can I make my maps run faster?	1084
18.1.8 What does Polyline mean in MapServer?	1084
18.1.9 What is MapScript?	1084
18.1.10 Does MapServer support reverse geocoding?	1085
18.1.11 Does MapServer support geocoding?	1085
18.1.12 How do I set line width in my maps?	1085
18.1.13 Which image format should I use?	1085
18.1.14 How do I add a copyright notice on the corner of my map?	1086
Example Layer	1086
Result	1087
18.1.15 How do I have a polygon that has both a fill and an outline with a width?	1087
18.1.16 Which OGC Specifications does MapServer support?	1088
18.1.17 Why does my requested WMS layer not align correctly?	1088
18.1.18 When I do a GetCapabilities, why does my browser want to download mapserv.exe/mapserv? 1089
18.1.19 Why do my WMS GetMap requests return exception using MapServer 5.0?	1089
18.1.20 Using MapServer 6.0, why don't my layers show up in GetCapabilities responses or are not
found anymore?	1090
18.1.21 Where do I find my EPSG code?	1090
18.1.22 How can I reproject my data using ogr2ogr?	1090
18.1.23 How can I help improve the documentation on this site?	1091
18.1.24 What's with MapServer's logo?	1091
18.1.25 Is MapServer free for commercial use?	1091
18.1.26 What versions of MapServer will be patched for security vulnerabilities?	1091
19 Copyright	1092
19.1 MapServer Licensing	1092
19.1.1 MapServer Documentation	1092
19.1.2 MapServer Source Code	1092
Index	1093

	MapServer Documentation, Release 8.6.0





CHAPTER
ONE



INTRODUCTION



1.1 An Introduction to MapServer
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Author
David Fawcett
Contact
david.fawcett at moea.state.mn.us
Author
Howard Butler
Contact
hobu.inc at gmail.com
Last Updated
2025-04-14

Contents• An Introduction to MapServer
- MapServer Overview
- Anatomy of a MapServer Application
- Installation and Requirements
* Hardware Requirements
* Software Requirements
* Skills
* Secure your installation
* Windows Installation
- Introduction to the Mapfile
* MAP Object




1.1.1 MapServer Overview
MapServer is a popular Open Source project whose purpose is to display dynamic spatial maps over the Internet. Some of its major features include:
• support for display and querying of hundreds of raster, vector, and database formats
• ability to run on various operating systems (Windows, Linux, Mac OS X, etc.)
• support for popular scripting languages and development environments (PHP, Python, Perl, Ruby, Java, .NET)
• on-the-fly projections
• high quality rendering



• fully customizable application output
• many ready-to-use Open Source application environments
In its most basic form, MapServer is a CGI program that sits inactive on your Web server. When a request is sent to MapServer, it uses information passed in the request URL and the Mapfile to create an image of the requested map. The request may also return images for legends, scale bars, reference maps, and values passed as CGI variables.

See alsoThe Glossary contains an overview of many of the jargon terms in this document.
MapServer can be extended and customized through MapScript or templating. It can be built to support many different vector and raster input data formats, and it can generate a multitude of output formats. Most pre-compiled MapServer distributions contain most all of its features.

See alsoCompiling on Unix and Compiling on Win32


1.1.2 Anatomy of a MapServer Application
A simple MapServer application consists of:
• Map File - a structured text configuration file for your MapServer application. It defines the area of your map, tells the MapServer program where your data is and where to output images. It also defines your map layers, including their data source, projections, and symbology. It must have a .map extension or MapServer will not
recognize it.

See alsoMapServer Mapfile Reference
• Geographic Data - MapServer can utilize many geographic data source types. The default format is the ESRI Shape format. Many other data formats can be supported, this is discussed further below in Adding data to your site.













Fig. 1: The basic architecture of MapServer applications.




See alsoVector Input Reference and Raster Input Reference
• HTML Pages - the interface between the user and MapServer . They normally sit in Web root. In it's simplest form, MapServer can be called to place a static map image on a HTML page. To make the map interactive, the image is placed in an HTML form on a page.
CGI programs are 'stateless', every request they get is new and they don't remember anything about the last time that they were hit by your application. For this reason, every time your application sends a request to MapServer, it needs to pass context information (what layers are on, where you are on the map, application mode, etc.) in hidden form variables or URL variables.
A simple MapServer CGI application may include two HTML pages:
- Initialization File - uses a form with hidden variables to send an initial query to the web server and MapServer. This form could be placed on another page or be replaced by passing the initialization in- formation as variables in a URL.
- Template File - controls how the maps and legends output by MapServer will appear in the browser. By referencing MapServer CGI variables in the template HTML, you allow MapServer to populate them with values related to the current state of your application (e.g. map image name, reference image name, map extent, etc.) as it creates the HTML page for the browser to read. The template also determines how the user can interact with the MapServer application (browse, zoom, pan, query).


• MapServer CGI - The binary or executable file that receives requests and returns images, data, etc. It sits in the cgi-bin or scripts directory of the web server. The Web server user must have execute rights for the directory that it sits in, and for security reasons, it should not be in the web root. By default, this program is called mapserv


• Web/HTTP Server - serves up the HTML pages when hit by the user's browser. You need a working Web (HTTP) server, such as Apache or Microsoft Internet Information Server, on the machine on which you are installing MapServer.

1.1.3 Installation and Requirements
Hardware Requirements
MapServer runs on Linux, Windows, Mac OS X, Solaris, and more. To compile or install some of the required pro- grams, you may need administrative rights to the machine. People commonly ask questions about minimum hardware specifications for MapServer applications, but the answers are really specific to the individual application. For devel- opment and learning purposes, a very minimal machine will work fine. For deployment, you will want to investigate Optimization of everything from your data to server configuration.



Software Requirements
You need a working and properly configured Web (HTTP) server, such as Apache or Microsoft Internet Information Server, on the machine on which you are installing MapServer.
If you are on a Windows machine, and you don't have a web server installed, it is recommended that you use MS4W, which will install a pre-configured web server, MapServer, MapCache, PHP, TinyOWS, and many more utilities. Win- dows users can optionally check out the OSGeo4W installer as well.
This introduction will assume you are using an MS4W installation to follow along. Obtaining MapServer on Linux or Mac OS X should be straightforward. Visit download for installing pre-compiled MapServer builds on Mac OS X and Linux.


You will also need a Web browser, and a text editor (vi, emacs, notepad++, textpad, homesite) to modify your HTML and mapfiles.


Skills
In addition to learning how the different components of a MapServer application work together and learning Map File syntax, building a basic application requires some conceptual understanding and proficiency in several skill areas.
You need to be able to create or at least modify HTML pages and understand how HTML forms work. Since the primary purpose of a MapServer application is to create maps, you will also need to understand the basics of geographic data and likely, map projections. As your applications get more complex, skills in SQL, DHTML/Javascript, Java, databases, expressions, compiling, and scripting may be very useful.

Secure your installation
During your installation and configuration, it is strongly recommended to review the security steps for the MAP= call to the MapServer executable, by setting MS_MAP_PATTERN or MS_MAP_NO_PATH or hiding the MAP= parameter on public servers, as recommended in the document Limit Mapfile Access. All possible environment variables to secure your server are listed in Environment Variables.

Windows Installation


MS4W (MapServer for Windows) is the long-time installer that contains the Apache Web server, MapServer, and all of its dependencies and tools; MS4W also contains several add-on packages, that contain over 60+ pre-configured MapServer configuration files (mapfiles) and data. The following steps illustrate how to install MS4W:
1) Download MS4W (this example will use the -setup.exe file) from https://ms4w.com/



2) Execute (double-click) the .exe
3) Click the "Agree" button, to accept the license.


4) Select packages to install. Be sure to also select the "MapServer Itasca Demo Application", as we will be using this demo later.






5) Click the "Next" button
6) Click the "Browse. . ." button, to choose an installation path. You can safely leave the default (C:/), and the installer will create C:/ms4w.






7) Click the "Next" button
8) Enter a port number to use for the Apache service. In most cases you can leave the port as 80, unless something is using that port such as an IIS service.






10) Click the "Install" button




11) Once you see a message of "Installer Complete", then click the "Close" button




12) On your desktop, click on the "MS4W-Localhost" shortcut, and your browser should open http://127.0.0.1 that loads an MS4W introduction page.




13) Verify that MapServer is working, by clicking on the /cgi-bin/mapserv.exe link in the "Features" section of the page.







1.1.4 Introduction to the Mapfile
The .map file is the basic configuration file for data access and styling for MapServer. The file is an ASCII text file, and is made up of different objects. Each object has a variety of parameters available for it. All .map file (or mapfile) parameters are documented in the mapfile reference. A simple mapfile example displaying only one layer follows, as well as the map image output:







(continues on next page)



(continued from previous page)


Fig. 2: Rendered Bluemarble Image








MAP Object

• EXTENT is the output extent in the units of the output map
• SIZE is the width and height of the map image in pixels
• IMAGECOLOR is the default image background color




LAYER Object
• starting with MapServer 5.0, there is no limit to the number of layers in a mapfile
• the DATA parameter is relative to the SHAPEPATH parameter of the MAP object
• if no DATA extension is provided in the filename, MapServer will assume it is ESRI Shape format (.shp)



Raster Layers



See alsoRaster Data
Vector Layers
Vector layers of TYPE point, line, or polygon can be displayed. The following example shows how to display only lines from a TYPE polygon layer, using the OUTLINECOLOR parameter:




See alsoVector Data
CLASS and STYLE Objects
• typical styling information is stored within the CLASS and STYLE objects of a LAYER
• starting with MapServer 5.0, there is no limit to the number of classes or styles in a mapfile
• the following example shows how to display a road line with two colors by using overlaid STYLE objects



(continues on next page)





Fig. 3: Rendered Bluemarble image with vector boundaries

(continued from previous page)


SYMBOLs
• can be defined directly in the mapfile, or in a separate file
• the separate file method must use the SYMBOLSET parameter in the MAP object:






Fig. 4: Rendered Bluemarble image with styled roads

where symbols.txt might contain:

and the mapfile would contain:






Fig. 5: Rendered Bluemarble image with skier symbol


See alsoCartographical Symbol Construction with MapServer, Symbology Examples, and SYMBOL
LABEL
• defined within a CLASS object
• the LABELITEM parameters in the LAYER object can be used to specify an attribute in the data to be used for labeling. The label is displayed by the FONT, declared in the FONTSET file (set in the MAP object). The
FONTSET file contains references to the available font names. ENCODING describes which encoding is used in the file (see Display of International Characters in MapServer).
An example LABEL object that references one of the above fonts might look like:






Fig. 6: Rendered Bluemarble image with skier symbol and a label


See alsoLABEL, FONTSET
CLASS Expressions
MapServer supports three types of CLASS Expressions in a LAYER (CLASSITEM in LAYER determines the attribute to be used for the two first types of expressions):
1) String comparisons

2) Regular expressions

3) Logical expressions






See alsoExpressions
INCLUDE
Added to MapServer 4.10, any part of the mapfile can now be stored in a separate file and added to the main mapfile using the INCLUDE parameter. The filename to be included can have any extension, and it is always relative to the main .map file. Here are some potential uses:
• LAYERs can be stored in files and included to any number of applications
• STYLEs can also be stored and included in multiple applications
The following is an example of using mapfile includes to include a layer definition in a separate file: If 'shadedrelief.lay' contains:
therefore the main mapfile would contain:

The following is an example of a mapfile where all LAYER s are in separate .lay files, and all other objects (WEB,
REFERENCE, SCALEBAR, etc.) are stored in a ".ref" file:





WarningMapfiles must have the .map extension or MapServer will not recognize them. Include files can have any extension you want, however.

See alsoINCLUDE
Get MapServer Running
You can test if MapServer is working by running the MapServer executable (mapserv) with the -v parameter on the command line (./mapserv -v).
MS4W users that installed through the -setup.exe installer, can use the MS4W-Shell shortcut on the desktop, and then run mapserv -v at the commandline. MS4W users who did not use the -setup.exe installer can open a Command Prompt window, cd to their installation folder, and then execute setenv.bat, before testing a mapserv -v command.
Depending on your configuration, the output could be something like this:

You can also send a HTTP request directly to the MapServer CGI program without passing any configuration vari- ables (e.g. http://127.0.0.1/cgi-bin/mapserv.exe). If you receive the message, 'No query information to decode. QUERY_STRING not set.', your installation is working.

Get Demo Running

WarningMS4W users do not have to do this step, as the above instructions already installed the demo. You should see a "MapServer Itasca Demo Application" section on the bottom of the page (after clicking the MS4W-Localhost shortcut).
Download the MapServer Demo. UnZip it and follow the directions in ReadMe.txt. You will need to move the demo files to their appropriate locations on your web server, and modify the Map File and HTML pages to reflect the paths and URLs of your server. Next, point your browser to init.html and hit the 'initialize button'. If you get errors, verify that you have correctly modified the demo files.

1.1.5 Making the Site Your Own
Now that you have a working MapServer demo, you can use the demo to display your own data. Add new LAYERs to your Map file that refer to your own geographic data layers (you will probably want to delete the existing layers or set their status to OFF).
Unless you are adding layers that fall within the same geographic area as the demo, modify MAP EXTENT to match the extent of your data. To determine the extent of your data, you can use ogrinfo. If you have access to a GIS, you could use that as well. The MAP EXTENT needs to be in the units of your output projection.



If you add geographic data layers with different geographical reference systems, you will need to modify your Map File to add a PROJECTION block to the MAP (defines the output projection / geographical reference system) and each of the LAYERs (defines the geographical reference system of the layer dataset).

Adding Data to Your Site
MapServer supports several data input formats 'natively', and many more if it is compiled with the Open Source libraries
GDAL and OGR.

Vector Data
Vector data includes features made up of points, lines, and polygons. MapServer support the ESRI Shape format by default, but it can be compiled to support spatially enabled databases such as PostgreSQL-PostGIS, and file formats such as Geography Markup Language (GML), MapInfo, delimited text files, and more formats with OGR Vector Layers Through MapServer.
See the Vector Data reference for examples on how to add different geographic data sources to your MapServer project.

Raster Data
Raster data is image or grid data. Through GDAL, MapServer supports most raster formats - see the GDAL format list. More specific information can be found in the Raster Data reference.


Projections
Because the earth is round and your monitor (or paper map) is flat, distortions will occur when you display geographic data in a two-dimensional image. Projections allow you to represent geographic data on a flat surface. In doing so, some of the original properties (e.g. area, direction, distance, scale or conformity) of the data will be distorted. Different projections excel at accurately portraying different properties.
With MapServer, if you keep all of your spatial data sets in the same projection (or unprojected Latitude and Longitude), you do not need to include any projection info in your Map File. In building your first MapServer application, this simplification is recommended.
On-the-fly projection can be accomplished when MapServer is compiled with PROJ support. Instructions on how to enable PROJ support on Windows can be found on the Wiki.

1.1.6 Enhancing your site
Adding Query Capability
There are two primary ways to query spatial data. Both methods return data through the use of templates and CGI variable replacement. A QUERYMAP can be used to map the results of the query.
To be queryable, each mapfile LAYER must have a TEMPLATE defined, or each CLASS within the LAYER must have a TEMPLATE defined. More information about the CGI variables used to define queries can be found in the MapServer CGI Reference.



Attribute queries
The user selects features based on data associated with that feature. 'Show me all of the lakes where depth is greater than 100 feet', with 'depth' being a field in the Shape dataset or the spatial database. Attribute queries are accomplished by passing query definition information to MapServer in the URL (or form post). Mode=itemquery returns a single result, and mode=itemnquery returns multiple result sets.
The request must also include a QLAYER, which identifies the layer to be queried, and a QSTRING which contains the query string. Optionally, QITEM, can be used in conjunction with QSTRING to define the field to be queried. Attribute queries only apply within the EXTENT set in the map file.

Spatial queries
The user selects features based on a click on the map or a user-defined selection box. Again the request is passed through a URL or form post. By setting mode=QUERY, a user click will return the one closest feature. In mode=NQUERY, all features found by a map click or user-defined selection box are returned. Additional query options can be found in the CGI documentation.

Interfaces
See: OpenLayers https://openlayers.org, GeoMOOSE https://geomoose.org


Data Optimization
Data organization is at least as important as hardware configuration in optimizing a MapServer application for perfor- mance. MapServer is quite efficient at what it does, but by reducing the amount of processing that it needs to do at the time of a user request, you can greatly increase performance. Here are a few rules:
• Index Your data - By creating spatial indexes for your Shape datasets using shptree. Spatial indexes should also be created for spatially aware databases such as PostGIS and Oracle Spatial.
• Tile Your Data - Ideally, your data will be 'sliced up' into pieces about the size in which it will be displayed. There is unnecessary overhead when searching through a large vector dataset or image of which you are only going to display a small area. By breaking the data up into tiles and creating a tile index, MapServer only
needs to open up and search the data files of interest. The GDAL commandline utilities ogrtindex (for vectors) and gdaltindex (for rasters) allow indexing of any supported GDAL driver/format. For more information (and detailed steps) see Tile Indexes. If you need to only index shapefiles, you can use the tile4ms MapServer utility.
• Pre-Classify Your Data - MapServer allows for the use of quite complex EXPRESSIONs to classify data. How- ever, using logical and regular expressions is more resource intensive than string comparisons. To increase efficiency, you can divide your data into classes ahead of time, create a field to use as the CLASSITEM and pop-
ulate it with a simple value that identifies the class, such as 1,2,3, or 4 for a four class data set. You can then do a simple string comparison for the class EXPRESSION.
• Pre-Process Your Images - Do resource intensive processing up front. See the Raster Data reference for more info.
• Generalize for Overview - create a more simple, generalized data layer to display at small scales, and then use scale-dependent layers utilizing LAYER MINSCALE and LAYER MAXSCALE to show more detailed data layers as the user zooms in. This same concept applies to images.




See alsoOptimization
1.1.7 How do I get Help?
Documentation
• Official MapServer documentation lives here on this site.
• User contributed documentation exists on the MapServer Wiki.

Users Mailing List
Register and post questions to the MapServer Users mailing list. Questions to the list are usually answered quickly and often by the developers themselves. A few things to remember:
1. Search the archives for your answer first, people get tired of answering the same questions over and over.
2. Provide version and configuration information for your MapServer installation, and relevant snippets of your map and template files.
3. Always post your responses back to the whole list, as opposed to just the person who replied to your question.

Matrix/IRC
MapServer users and developers can be found on Matrix, and on IRC (Internet Relay Chat). The MapServer room is bridged to allow communication through your choice of Matrix or IRC.
• Matrix room is #mapserver:osgeo.org on matrix.osgeo.org.
• IRC channel is #mapserver on irc.libera.chat.

Reporting bugs
Software bugs are reported on the MapServer issue tracker. Documentation bugs are reported on the MapServer doc- umentation issue tracker.

Tutorial
Here is a quick tutorial for new users.

Test Suite (msautotest)
msautotest contains test mapfiles and data for most MapServer functionality.

Books
Web Mapping Illustrated, a book by Tyler Mitchell that describes well and provides real-world examples for the use of Web mapping concepts, Open Source GIS software, MapServer, Web services, and PostGIS.
Mapping Hacks, by Schuyler Erle, Rich Gibson, and Jo Walsh, creatively demonstrates digital mapping tools and concepts. MapServer only appears in a handful of the 100 hacks, but many more are useful for concepts and inspiration.
Beginning MapServer: Opensource GIS Development, by Bill Kropla. According to the publisher, it covers installation and configuration, basic MapServer topics and features, incorporation of dynamic data, advanced topics, MapScript, and the creation of an actual application.


CHAPTER
TWO



TUTORIAL



2.1 MapServer Tutorial
Author
Pericles S. Nacionales
Contact
pnaciona at gmail.com
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Updated
2023-04-19


This tutorial (initially created in the early-2000's by Perry, and maintained since by Jeff) was designed to give new users a quick (relatively speaking) introduction to the concepts behind MapServer. It is arranged into four sections with each section having one or more examples and increasing in complexity. Users can jump to any section at any time although it is recommended that absolute beginners work on the first three sections sequentially.
Section one focuses on basic MapServer configuration concepts such as layer and class ordering, using vector and raster data, projections and labeling. Section two provides examples on how to use HTML templates to create a simple interface for an interactive web mapping application. Section three introduces the use of HTML templates to provide a "query" interface. Finally, section four introduces some advanced user interface concepts.

2.1.1 Tutorial background
Tutorial Timeframe
While some users can go through this tutorial in one day, those who work on each example in detail can probably expect to finish in one week.

	MapServer Documentation, Release 8.6.0


Tutorial Data
The dataset used in this tutorial was taken from the U.S. Department of the Interior's National Atlas of the United States (which is no longer available, but was hosted by data.gov). The dataset was clipped to the upper great lakes region (Minnesota, Michigan, and Wisconsin) to reduce storage size. Additional raster images were added courtesy of the TerraSIP project at the University of Minnesota. When using this tutorial, you are encouraged to use your own dataset.
Like MapServer itself, this tutorial is open and customizable to anyone. This was done in the hope that someone (or some folks) will help design and develop it further.
Download the data (and all html files) for this tutorial at https://download.osgeo.org/mapserver/docs/ mapserver-tutorial.zip .

Before Using the Tutorial
There are some prerequisites to using this tutorial:
1. Users will need to have a web server installed and running on their computer. This web server has to have support for common gateway interface (CGI) programs.
2. Users should have a basic understanding of web servers and internet security. A poorly configured web server can easily be attacked by malicious people. At the very least your software installation will be corrupted and you'll lose hours of productivity, at worst your computer can be used to attack other computers on the internet.
3. It is recommended that users of this tutorial read the Introduction to MapServer before proceeding with this tutorial.
4. To use this tutorial, users will need to have a MapServer CGI program (mapserv or mapserv.exe) installed in their systems. MapServer source code is available for download here. Documentation exists on how to compile and install MapServer:
• for UNIX users, please read the MapServer UNIX Compilation and Installation HOWTO.
• Windows users should read the MapServer Win32 Compilation and Installation HOWTO
In addition, precompiled binaries exist for a number of platform (see the download page).

Windows, UNIX/Linux Issues Paths
This tutorial is packaged for Windows users, but should work with minimal changes on UNIX or other platforms. The main differences are the paths in the map files. Windows users can specify the drive letter of the hard disk where their tutorial files reside. Here's an example:
A UNIX map file might include a parameter like this:

In Windows, the same parameters might look like this:

or:

Notice that either slash or backslash works in Windows. The usual backslash may work well for you if you want to make a distinction between virtual (as in URLs or web addresses) and local paths in your map file. However, if you plan to move your application to UNIX at some point, you'll have the tedious task of switching all backslashes to slashes.

MapServer Documentation, Release 8.6.0


While we're on the subject of paths, keep in mind that paths in mapfiles are typically relative to the directory where the mapfile is stored. When working with HTML template files, paths are relative to the web server's root directory. i.e., "/tutorial/" is relative to "https://demo.mapserver.org/". Please read this for a few insights on URLs.

Executable
Another issue is that UNIX executable files don't contain a .EXE extension, but they do in Windows. So you might have to adjust all instances of "/cgi-bin/mapserv.exe" to "/cgi-bin/mapserv".

Other Resources
Other documentation exist to give you better understanding of the many customizations MapServer offer. Please visit the MapServer documentation page at https://mapserver.org/documentation.html . There you will find many HOWTO documents, from getting started to using MapScript, a scripting interface for MapServer.


Back to Tutorial home | Proceed to Section 1

2.1.2 Section 1: Static Maps and the MapFile
• Take a vector dataset. Any vector datatype supported by GDAL. We can use MapServer to display that vector dataset in a web browser. Look...
- Example 1.1 - A map with a single layer
• We can display the same Shapefile dataset repeatedly. We can display the polygon attributes in one LAYER and the line attributes in another...
- Example 1.2 - A map with two layers
• And we can select which parts of the Shapefile dataset to display. We do this using the CLASS object. . .
- Example 1.3 - Using classes to make a "useful" map
• We can also label our maps. . .
- Example 1.4 - Labeling layers and label layers
• Or add raster data such as satellite images, aerial photographs, or shaded reliefs. . .
- Example 1.5 - Adding a raster layer
• We can reproject our data from just about any projection to just about any... Yeah, check it out!
- Example 1.6 - Projection/Reprojection
• And we can use layers from other map servers on the Internet (for example WMS servers). . .
- Example 1.7 - Adding a WMS layer
• MapServer can output to various formats such as PDF and GeoTIFF.
- Example 1.8 - A different output format
• MapServer not only generates static maps, it can also create interactive maps. . .
- Example 1.9 - The difference between map mode and browse mode


Back to Tutorial home | Proceed to Section 2

	MapServer Documentation, Release 8.6.0

2.1.3 Section 2: CGI variables and the User Interface
So far we have only looked at the mapfile when creating maps. In creating web mapping applications, it is usually our intention to make maps that can be changed by the user (of the application) interactively. That is, a user should be able to change the content of (or the information in) the map. To accomplish this interactivity, we use the MapServer HTML templates.

HTML Templates
A MapServer HTML template is essentially an HTML file with a few MapServer specific tags. These tags are the MapServer CGI variables and are enclosed in square brackets "[]". When the MapServer CGI program processes an application, it first parses the query string and the mapfile, and produces the necessary output. Some of this output will need to be written to the HTML template file which you would have to also specify in the mapfile using the web template keyword (or in a separate HTML initialization file). The CGI program will replace all the variables in the HTML template with the proper value before sending it back to the web browser. If you are to directly view an HTML template in a web browser, there won't be any maps rendered and you will instead get blank images and other junk.

Variables
MapServer provides several variables for web mapping: the "img" variable which you've seen in Example 1.9 is but one example. There area few core CGI variables originally designed as part of the mapping interface but practically all the mapfile parameters can be defined as variables. The definitive reference to the MapServer CGI variables can be found here.
We can also define our own variables, which MapServer will pass along to our application. For example, we can create a variable called "root" to represent the root directory of this tutorial, the value for "root" will then be "/tutorial". When the MapServer CGI program processes our HTML template, it will replace every instance of he "[root]" tag with "/tutorial". You will see this in action for each of the following examples.

Run-time Substitution
Since MapServer 8.0.1, this tutorial uses MapServer's Run-time Substitution to pass the template name through the url, such as . . .&template=example2-2.html. The associated mapfile's WEB object contains a %template% variable, and a VALIDATION object with a regular expression to allow the "template=" variable's possible values through the url.


Examples
So, let's build an interactive interface for our application. . .
• Users of a web mapping application should be able to pan and zoom on the map: Example 2.1 - Pan and Zoom Controls
• They also should be able to turn on and off layers on a map: Example 2.2 - Layer Control
• A map should always include a scalebar. Example 2.3 - Adding a Scalebar
• If users are to navigate through the map, a reference map should be provided: Example 2.4 - Adding a Reference Map
• The map should include a legend. Example 2.5- Adding a Legend

MapServer Documentation, Release 8.6.0




Back to Section 1 index | Proceed to Section 3

2.1.4 Section 3: Query and more about HTML Templates
To learn more about query and HTML templates with MapServer, see examples 3.1 to 3.4 in the Tutorial Viewer.


Back to Section 2 index | Proceed to Section 4

2.1.5 Section 4: Advanced User Interfaces
To learn more about advanced navigation such as pan and rubber-band zoom with Javascript and MapServer CGI, see examples 4.1 to 4.4 in the Tutorial Viewer.


Back to Section 3 index | Tutorial home


Begin tutorial


CHAPTER
THREE



INSTALLATION



3.1 Installation
3.1.1 Compiling on Unix
Author
Howard Butler
Contact
hobu.inc at gmail.com
Author
Thomas Bonfort
Contact
thomas.bonfort at gmail.com
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2025-04-14




Introduction
The University of Minnesota's MapServer is an open-source and freely available map rendering engine for the web. Due to its open-source nature, it can be compiled on a wide variety of platforms and operating systems. We will focus on how to obtain, compile and install MapServer on UNIX-like platforms.




You might also check the MapServerCompilation wiki page for additional information.

Compiler Requirements
As of MapServer 8.0, a C++11 and C99 capable compiler is required to build MapServer. This means for example using GCC 4.8 or more recent, or CLang 3.3 or more recent.

Obtaining the necessary software
You can obtain the MapServer source code as well as the demo package from the download section. You can also get the latest MapServer source code from git.
Secure your installation
During your installation and configuration, it is strongly recommended to review the security steps for the MAP= call to the MapServer executable, by setting MS_MAP_PATTERN or MS_MAP_NO_PATH or hiding the MAP= parameter on public servers, as recommended in the document Limit Mapfile Access. All possible environment variables to secure your server are listed in Environment Variables.

Required External Libraries
• GDAL: the GDAL library allows MapServer to read a variety of geospatial raster formats (GDAL) and vector formats (OGR). It can be downloaded at https://gdal.org/. (some platforms refer to this library as libgdal-dev)
• PROJ: PROJ provides projection support for MapServer. Version 4.4.6 or greater is required.
• libpng: libpng should be on your system by default. Versions back to 1.2.7 should work.
• FreeType: Version 2.x or above is required.
• libjpeg: libjpeg allows MapServer to render images in JPEG format. A sufficient version should be installed by default on your system (probably version 6b from 1998).

WarningDirect JPEG support was deprecated in MapServer 5.8+, and you should now depend on GDAL for raster read support in MapServer. JPEG support is however still required for producing (i.e. writing) images.


• zlib: Zlib should be on your system by default. Though not used directly by MapServer, it's a mandatory depen- dency of libpng.

Highly Recommended Libraries
• libcurl: libcurl is the foundation of OGC (WFS/WMS/WCS) client and server support. Version 7.10 or greater is required.

Optional External Libraries
• GEOS:
Added in version 4.10.
GEOS allows MapServer to do spatial predicate and algebra operations (within, touches, etc & union, difference, intersection).
• libxml:
Added in version 4.10.
libxml is required to use OGC SOS support in MapServer
• Oracle Spatial OCI: The client libraries for your platform are available for download from Oracle's website. Ideally, your client library matches the database you are querying from, but this is not a hard requirement.
• libpq: libpq is required to support the use of PostGIS geometries within the PostgreSQL database. Ideally, your client library matches the database you are querying from.
• giflib: libgif / libgif is is used for reading GIF files used as PIXMAP symbols.
• FastCGI: FastCGI is a popular protocol for interfacing MapServer with various web servers. You will need to install the development package. More details on how to use this feature in MapServer is here FastCGI. On Ubuntu, that would be:

• Cairo (SVG, PDF) support: This library is required to produce PDF and SVG outputs. If you're on an ubuntu system, it can be installed with "apt-get install -y libcairo2-dev"
• KML support: This renderer is has no external dependency.
• HarfBuzz:
Added in version 7.0.
Support complex script shaping (to simplify: the tool that will insert ligatures between characters). Harfbuzz algorithms will be applied on text strings that have been determined to not be latin (i.e. the slowdown induced by harfbuzz is limited to those languages that actually require shaping). Requires FriBidi.

See alsorfc98
• MySQL: Support joining with MySQL (the WITH_MYSQL option).



Optional Features
• Cairo SVG parser support: The WITH_SVGCAIRO option is part of a proposal to improve SVG support. Using this feature requires installing the libsvg-cairo library available here: https://www.cairographics.org/snapshots/
. You will need to compile and install cairo, libsvg, and libsvg-cairo.
• SVG support can be enabled either through the unmaintained libsvg / libsvg-cairo combo, or through librsvg (the WITH_RSVG option) at the cost of more dependencies. Use librsvg if your distro provides a package for it, or fall back to libsvgcairo if the cost of compiling the librsvg dependencies is too important.

Anti-Grain Geometry Support
Since version 5.0 MapServer supports the AGG rendering backend. MapServer 5.6+ embeds it directly in the source tree and you do not have to do anything special to have support for it.

OGC Support
MapServer provides support for many OGC specifications. For an overview, see MapServer OGC Specification sup- port.

WMS support WMS Server
Support for WMS server is automatically enabled.
You can check it by looking for the following in your configure output:

If, for some reason you don't want WMS support, you can force it off using "-DWITH_WMS=OFF". More information on using this feature is available in WMS Server.
WMS Client
Cascading is also supported. This allows MapServer to transparently fetch remote layers over WMS, basically acting like a client, and combine them with other layers to generate the final map.
In order to enable this feature, you will need to pass the WITH_CLIENT_WMS option to the configure script. MapServer will automatically look for libcurl, which is also required.
To verify that this feature is enabled, check the configure output for:



More information on using this feature is available in WMS Client.



WFS support WFS Server
Support for WFS server is enabled by default. GDAL (actually OGR) and PROJ support are required. To verify that this feature is enabled, check the configure output for:

If, for some reason you don't want WFS support, you can force it off using "-DWITH_WFS=OFF". More information on using this feature is available in WFS Server.
WFS Client
MapServer can also act as a WFS client. This effectively means that MapServer reads it's data from a remote server's WFS output and renders it into a map, just like it would when reading data from a shapefile.
In order to enable this feature, you will need to make sure you have GDAL (actually OGR) built with Xerces support and PROJ support, and pass the WITH_CLIENT_WFS option to your configure script. MapServer will automatically look for libcurl, which is also required.
To verify that this feature is enabled, check the configure output for:



More information on using this feature is available in WFS Client.

WCS Server
Support for WCS server is enabled by default. WCS must be compiled against certain libraries. More information on this service is available in WCS Server.
To verify that this feature is enabled, check the configure output for:

If, for some reason you don't want WCS support, you can force it off using "-DWITH_WCS=OFF".

SOS Server
Support for SOS is enabled by using the WITH_SOS option. More information on this service is available in SOS Server.
To verify that this feature is enabled, check the configure output for:







Spatial Warehousing
MapServer can use a wide variety of sources of data input. One of the solutions growing in popularity is to use spatially enabled databases to store data, and to use them directly to draw maps for the web.
Here you will find out how to enable MapServer to talk to one of these products. Please refer to the MapFile reference for more details on how to use these. This section only details how to compile MapServer for their use.

PostGIS
PostGIS adds support for geographic objects to the PostgreSQL object-relational database. In effect, PostGIS "spatially enables" the PostgreSQL server, allowing it to be used as a backend spatial database for geographic information systems (GIS), much like ESRI's SDE or Oracle's Spatial extension. PostGIS is included in many distributions' packaging system, but you can also roll your own if needed.
MapServer can use PostGIS as a data source. PostGIS support is enabled by default. To verify that this feature is enabled, check the configure output for:
If, for some reason you don't want PostGIS support, you can force it off using "-DWITH_POSTGIS=OFF". To help CMake find your PostGIS installation, you can use the CMAKE_PREFIX_PATH option (for instance "- DCMAKE_PREFIX_PATH=/usr/local/pgsql").

Oracle Spatial
Oracle's Spatial is also supported by MapServer. In order to connect to it, you will need to compile MapServer against the Oracle libraries by using the WITH_ORACLESPATIAL option. You will very likely need an ORACLE_HOME environment variable set to have it configure things correctly.
To verify that this feature is enabled, check the configure output for:


Compiling
First prepare the ground by making sure all of your required and/or recommended libraries are installed before at- tempting to compile MapServer. This will make your life much less complicated ;). Here is the order that I usually use:
1. Compile GDAL. Describing how to compile GDAL is beyond the scope of this document. If you have require- ments for lots of different formats, make sure to install those libraries first. I often find that building up a GDAL library often takes as long as compiling MapServer itself!
2. Compile PROJ. PROJ (formerly PROJ.4) is a straight-forward configure/make/make install library.
3. Compile libcurl. libcurl is a straight-forward configure/make/make install library. This library is only used along with other features, so "-with-curl-config" won't do anything unless something like "-with-wmsclient" or "-with-wfsclient" is also selected.






4. Compile/install optional libraries. These might include PostGIS, Oracle Spatial, AGG, Ming, PDFlib, or MyGIS. Mix and match as you need them.
5. Unpack the MapServer tarball and cd into the MapServer directory:

6. Create the build directory and configure your environment. Create the build directory:

Configure your environment using "cmake" (this is an example):



The following options are enabled by default (version 7.0: WITH_PROJ, WITH_WMS, WITH_FRIBIDI, WITH_HARFBUZZ, WITH_ICONV, WITH_CAIRO, WITH_FCGI, WITH_GEOS, WITH_POSTGIS, WITH_GDAL, WITH_OGR, WITH_WFS, WITH_WCS, WITH_LIBXML2, WITH_GIF.
If you want to also build a static version of the library, the BUILD_STATIC and LINK_STATIC_LIBMAPSERVER options can be used,
There are a number of other options available. For an up-to-date list of available CMake options, refer to the CMakeLists.txt.



It can be a good idea to place the configuration commands in a file and change its mode to executable (+x) to save typing and have a record of how MapServer was configured.
7. Now that you have configured your build options and selected all the libraries you wish MapServer to use, you're ready to compile the source code.
This is actually quite simple, just execute "make":

8. Install the MapServer libraries:

To make sure all went well, look for the file called mapserv:

A simple test is to try and run it:

The message above is perfectly normal, and means exactly what it says. If you get anything else, something went terribly wrong.

Installation MapServer binary
The MapServer program itself consists of only one file, the "mapserv" binary executable. This is a CGI executable, meant to be called and run by your web server.
In this section, we will assume you are running Apache under its default directory structure in /usr/local/apache2. You may need to have privileges to edit your httpd.conf (the main apache configuration file), or have someone (such as your webmaster) help you with the configuration details.
If you don't have apache installed, and you want apache, php, fastcgi, etc, that might look something like this:

The main goal is to get the "mapserv" binary installed in a publicly accessible directory that is configured to run CGI programs and scripts.
1. Locate your cgi-bin directory. Under a default configuration, the CGI directory is "/usr/local/apache2/cgi-bin" (RedHat: "/home/httpd/cgi-bin", Debian: "/usr/lib/cgi-bin"). If you're using apache, there should be a ScriptAl- ias directive in your http.conf, or default site, something like:

2. Locate the installation path of your freshly compiled mapserv executable. This is shown when you run "make install", something like this:





3. You'll want to setup a symlink to that executable from your cgi-bin directory:



WarningMake sure you are linking against the installed mapserv file (after running 'make install') and NOT against where it was compiled in your source tree.
Testing your new Install
Placing the mapserv file in this directory makes it accessible by the following URL: "http://yourhostname.com/cgi-bin/ mapserv". When accessing this URL through your web client, you should expect the following output if all has worked well: "No query information to decode. QUERY_STRING is set, but empty." If you get this message, you're done installing MapServer.

Common problems File permissions
The most common problem one is likely to encounter when attempting to install the binary are permissions issues:
• You do not have write permissions into your web server's CGI Directory. Ask your webmaster to install the file for you.
• The web server gives you a "403 Permission denied" error. Make sure the user the web server runs as (usually "nobody") has execute permission on the binary executable. Making the file world executable is perfectly fine and safe:


Apache errors
You may receive a few different type of errors as well if your web server configuration isn't right:
• 500 Internal server error: This is a fairly generic error message. All it basically tells you is that the web server was unsuccessful in running the program. You will have to consult the web server's error log to find out more, and may need to enlist the help of your webmaster/system administrator. The apache docs also have pointers on
setting up cgi-bin.
::
Check your server logs $ tail /var/log/apache2/error.log

Where to go once you've got it compiled
The An Introduction to MapServer document provides excellent coverage of getting started with MapServer.


3.1.2 Compiling on Win32
Author
Pericles Nacionales
Contact
pnaciona at gmail.com



WarningThis part of the documentation is outdated. nmake is no longer used. cmake is used also for Win32. cmake instructions can be found on https://github.com/MapServer/MapServer/blob/main/README.WIN32. See also https://github.com/MapServer/MapServer/blob/main/appveyor.yml.
Introduction
This document provides a simple set of compilation procedures for MapServer on Win32 platforms.
If you've made it this far, chances are you already know about MapServer and are at least tempted to try compiling it for yourself. Pre-compiled binaries for MapServer are available from a variety of sources. Refer to windows. Building MapServer for win32 platforms can be a daunting task, so if existing binaries are sufficient for your needs, it is strongly advised that they be used in preference to trying to build everything from source.
However, there can be a variety of reasons to want to build MapServer from source on win32. Reasons include the need to enable specific options, to build with alternate versions of support libraries (such as GDAL), the desire for MapScript support not part of the core builds, the need to debug and fix bugs or even to implement new features in MapServer. To make it easy for users and developers, I've made a list of steps to compile MapServer. Background



information is provided in each step, along with examples. Each example is a continuation of the previous one and in the end will produce the MapServer DLL (libmap.dll), the CGI program (the mapserv.exe), and utility programs.

WarningThis document may refer to older library versions. You may want to try to use more recent library versions for your build.
Compiler Requirements
As of MapServer 8.0, a C++11 and C99 capable compiler is required to build MapServer. This means for example using Microsoft Visual Studio 2015 or more recent.

Compiling
If you are new to Windows programming, please follow this document carefully. The compilation steps are fairly simple but I've added a few blurbs in each step to help you understand how MapServer compiles. For the more experienced programmers, perhaps reading the README.Win32 that accompanies the MapServer source code would be more useful. For those who are antsy, compiling MapServer involves download and unpacking the source codes, editing the make files, and invoking Microsoft's Visual C++ compiler from the command prompt. The resulting mapserv.exe is the CGI program that installs in the cgi-bin directory of your web server.
For those who are willing to take the time, the compilation steps follow.

Set up a Project Directory
Before you start to compile MapServer, I recommend creating a directory called "projects" where you can put the source code for MapServer and its supporting libraries. Since you will be working with DOS-style commands, you might as well get used to the Windows command prompt. For Windows 95/98 users the command processor would be called command.com. For Windows NT/2000/XP, it would be cmd.exe. So fire up the old command prompt and go to the drive where you want to create the project directory.
Here is an example of how to create a directory called projects on the C: drive:

To go to that directory:

From the projects directory, you can extract the source codes for MapServer and its libraries. Now you're ready to download the source codes.

Download MapServer Source Code and Supporting Libraries
After creating a project directory, download the MapServer source code and the codes for the supporting libraries and save the source code packages in the newly created "projects" directory. These source codes are usually packaged as ZIP, or as UNIX TAR and GZIP files. You'll need a software that can unzip these packages. 7-Zip is an example of software that can handle these files.
Cygwin is a free, open-source software package which is a port of these tools on Windows. You can use the gzip and tar utilities from this tool collection. Cygwin is available from https://www.cygwin.com.
In order to compile the MapServer CGI program, you must download a few required and optional libraries. At its simplest configuration, MapServer only requires the GD (to provide the image output) and REGEX (to provide regular expression support) libraries. This configuration allows the developer/data provider to use shapefiles as input and,



depending on the version of GD library used, GIF or PNG images as output. Additional libraries are needed for input data in alternative formats. The libraries that work with MapServer are listed below.

The MapServer source code
The MapServer source code can be downloaded from the download page. If you'd like to get the current development version of the software, following the nightly snapshot link under the Interim Builds title. The absolute latest copy of the source code can be obtained from git; however, the GitHub repository does not contain several important source files (maplexer.c, mapparser.c and mapparser.h) normally generated on unix, so if possible, using a nightly snaphot is substantially easier than working directly from git.

Required Libraries
GD Library:
MapServer uses the GD graphics library for rendering map images in GIF, PNG and JPEG format. These map images are displayed in web browser clients using the MapServer CGI. The current official version of GD is
2.0.33. The distributed makefiles are setup to use the prebuilt GD Win32 DLL binaries which include GD, libjpeg, libpng, libz, libgif and FreeType 2 all within one DLL. This package is generally listed as "Windows DLL .zip" and the latest version is normally available at http://www.boutell.com/gd/http/gdwin32.zip.
Regex:
Regex is the regular expression library used by MapServer. It can be downloaded at http://ftp.gnu.org/old-gnu/ regex/regex-0.12.tar.gz

Optional Libraries
JPEG library:
This library is required by GD to render JPEG images, if building GD from source. You may download this library at http://www.ijg.org/files/jpegsrc.v6b.tar.gz
PNG library:
This library is required by GD to render PNG images, if building GD from source. You may download this library at https://sourceforge.net/projects/libpng/

Zlib:


This library is required by libpng to provide graphics compression support. It can be downloaded at https:
//zlib.net/ .

FreeType 2:
FreeType provides TrueType support in MapServer via GD. We only need to build FreeType separately if building GD from source. It can be downloaded at https://gnuwin32.sourceforge.net/packages/freetype.htm .
PROJ:
PROJ provides on-the-fly projection support to MapServer. Users whose data are in different projection systems can use this library to reproject into a common projection. It is also required for WMS, WFS or WCS services.
GDAL/OGR:
The GDAL/OGR library allows MapServer to read a variety of geospatial raster formats (GDAL) and vector formats (OGR). It can be downloaded at https://gdal.org/.
ArcSDE:
ArcSDE is an ESRI proprietary spatial database engine. Most users will not have access to it but if you have ArcSDE license, you can use its libraries to give MapServer access to SDE databases.
EPPL7:
This library allows MapServer to read EPPL7 ("Environmental Planning and Programming
Language") datasets, as well as the older Erdas LAN/GIS files. This library is set as a default library in MapServer so there's no special source code to download.



Now that you have reviewed the libraries that provide support to MapServer, it is time to decide which ones to compile and use. We will work with the pre-built GD distributed on Boutell.com with PNG, GIF, JPEG, and FreeType "built in". If you want to provide OGC Web Services (ie. WMS, WFS) or want to perform on the fly reprojection then the PROJ library will be needed. If you need additional raster and vector data sources consider including GDAL/OGR support. GDAL is also required for WCS service.
Our example calls for the required libraries and on-the-fly projection support so we need to download GD, regex, and PROJ libraries. Go ahead and get those libraries.

Set Compilation Options
MapServer, like many of it's support libraries, comes with a Visual C++ makefile called Makefile.vc. It includes the file nmake.opt which contains many of the site specific definitions. We will only need to edit the nmake.opt file to configure the build for our local site options, and support libraries. The Makefile.vc, and nmake.opt template file have been provided by Assefa Yewondwossen, and the DM Solutions folks.
As of MapServer 4.4, the default MapServer build options only include GD, and regex. MapServer is built using the
/MD option (which means MSVCRT.DLL should be used), so if any support libraries are being built statically (rather than as DLLs) we need to use /MD when building them as well. By default modern PROJ builds use /MD so we should be able to use the default PROJ build without tweaking.
The example will compile with the GDWin32 pre-built DLL as well as regex-0.12, and PROJ. The PROJ support will ensure we can enable MapServer OGC-WMS compatibility. Use notepad or another text editor to open the nmake.opt file and make the following changes.

Comments
Use the pound sign ( # ) to comment out the lines that you want to disable, or remove the pound sign to enable an option for NMAKE.
A. Enable PROJ support, and update the path to the PROJ directory. Uncomment the PROJ= line, and the PROJ_DIR= line as follows, and update the PROJ_DIR path to point to your PROJ build.

If you look down later in the file, you can see that once PROJ is enabled, MapServer will be linked with proj_i.lib, the PROJ stub library, meaning that MapServer will be using the PROJ.DLL as opposed to statically linking in PROJ.
B. Uncomment the WMS option.

C. Update to use GD. Here's what it should look like in our example.




Note: As distributed the GDWin32 binary build does not include the bgd.lib stub library. It is necessary to run the
makemsvcimport.bat script in the gdwin32 directory first.
D. Make sure the regex path is set correctly. In order for the "delete" command in the "nmake /f makefile.vc clean" target to work properly it is necessary to use backslashes in the REGEX_DIR definition.

Your Makefile is now set.

Compile the Libraries
Before compiling MapServer, you must first compile its supporting libraries. How this is done varies for each library. For the PROJ library a nmake /f makefile.vc command in the proj-4.4.9src directory should be sufficient. The regex-
0.12 code is actually built by the MapServer build process, so you don't need to do anything there.

Compiling libcurl
Previously, curl libraries can be compiled using the following command:

This creates a static library, libcurl.lib, to which you compile against. Versions newer than version 7.10.x should be compiled as dynamic library. This is accomplished using the command:

You will then need to edit MapServer's nmake.opt to replace the CURL_LIB variable with this line:


Compile MapServer
Once you have compiled the supporting libraries successfully, you are ready to take the final compilation step. If you have not already done so, open a command prompt and set the VC++ environment variables by running the vcvars32.bat usually located in C:Program FilesMicrosoft Visual StudioVC98binvcvars32.bat.




(continues on next page)



(continued from previous page)
Now issue the command: nmake /f Makefile.vc and wait for it to finish compiling. If it compiles successfully, you should get mapserver.lib, libmap.dll, mapserv.exe, and other .EXE files. That's it for the compilation process. If you run into problems, read section 4 about compiling errors. You can also ask for help from the helpful folks in the MapServer-dev e-mail list.

Compiling MapServer with PostGIS support
To compile PostGIS support into MapServer, here's what you need to do:
1. download the PostgreSQL 8.0.1 (or later) source from: ftp://ftp.heanet.ie/pub/postgresql/source/
2. I extracted them to C:projectspostgresql-8.0.1
3. download the Microsoft Platform SDK otherwise you get link errors on shfolder.lib.
4. compile libpq under C:projectspostgresql-8.0.1srcinterfaceslibpq using the win32.mak makefile
5. copy	everything	from	C:projectspostgresql-8.0.1srcinterfaceslibpqrelease	to	C:projectspostgresql- 8.0.1srcinterfaceslibpq as the MapServer makefile will try to find it there
6. Define the following in the nmake.opt for MapServer:	POSTGIS  =-DUSE_POSTGIS  POSTGIS_DIR
=c:/projects/postgresql-8.0.1/src
7. nmake /f makefile.vc
8. don't forget to copy libpq.dll (from C:projectspostgresql-8.0.1srcinterfaceslibpqrelease) into a location where MapServer can find it.

Common Compiling Errors
Following are a few common errors you may encounter while trying to build MapServer.
• Visual C++ Tools Not Properly Initialized.

This occurs if you have not properly defined the path and other environment variables required to use MS Vi- sualC++ from the command shell. Invoke the VCVARS32.BAT script, usually with the command C:Program FilesMicrosoft Visual StudioVC98binvcvars32.bat or something similar if visual studio was installed in an alternate location. To test if VC++ is available, just type "nmake" or "cl" in the command shell and ensure it is found.
• Regex Build Problems.

This occurs if you use the stock regex-0.12 we referenced. I work around this by commenting out the "extern" statement for the printchar() function, and replacing it with a stub implementation in regex-0.12regex.c.




• GD Import Library Missing.

If you are using the pre-built GD binaries, you still need to run the makemsvcimport.bat script in the gdwin32 directory to create a VC++ compatible stub library (bgd.lib).

Installation
The file we are most interested in is mapserv.exe. The other executable files are the MapServer utility programs.

See alsoMapServer Utilities
to learn more about these utilities.
To test that the CGI program is working, type mapserv.exe at the command prompt. You should see the following message:

You may instead get a popup indicating that a DLL (such as bgd.dll) is missing. You will need to copy all the required DLLs (ie. bgd.dll, and proj.dll) to the same directory as the mapserv.exe program.
Now type mapserv -v at the command prompt to get this message:

This tells us what data formats and other options are supported by mapserv.exe. Assuming you have your web server set up, copy mapserv.exe, libmap.dll, bgd.dll, proj.dll and any other required DLLs to the cgi-bin directory.
You are now ready to download the demo application and try out your own MapServer CGI program. If you wish, you can also create a directory to store the utility programs. I'd suggest making a subdirectory called "bin" under the directory "projects" and copy the executables to that subdirectory. You might find these programs useful as you develop MapServer applications.

Other Helpful Information
The MapServer Unix Compilation and Installation HOWTO has good descriptions of some MapServer compilation options and library issues. I will write more about those options and issues on the next revision of this HOWTO.
The README documents of each of the supporting libraries provide compilation instructions for Windows.
The MapServer User community has a collective knowledge of the nuances of MapServer compilation. Seek their advice wisely.



Acknowledgements
Thanks to Assefa Yewondwossen for providing the Makefile.vc. I would not have been able to write this HOWTO without that file.
Thanks to Bart van den Eijnden for the libcurl and PostGIS compilation info.
Thanks to the Steve Lime for developing MapServer and to the many developers who contribute time and effort in order to keep the MapServer project successful.

3.1.3 PHP MapScript Installation
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2020-01-17


Introduction
The PHP/MapScript module is a PHP dynamically loadable module that makes MapServer's MapScript functions and classes available in a PHP environment.
The original version of MapScript (in Perl) uses SWIG, but at that time SWIG did not support the PHP language, so the PHP module had to be maintained separately and was not always in sync with other mapscripts. As of MapServer 7.4.0, PHP/MapScript is also available through the SWIG API.
The original PHP module was developed by DM Solutions Group and Mapgears and is currently maintained by Gate- wayGeo and other contributors.
This document assumes that you are already familiar with certain aspects of your operating system:
• For Unix/Linux users, a familiarity with the build environment, notably make.
• For Windows users, some compilation skills if you don't have ready access to a pre-compiled installation and need to compile your own copy of MapServer with the PHP/MapScript module.

Which version of PHP is supported?
PHP MapScript was originally developed for PHP-3.0.14 but after MapServer 3.5 support for PHP3 was dropped. As of the last update of this document, PHP 5.6 or more recent was required, and PHP 7 is recommended.
The best combinations of MapScript and PHP versions are:
• MapScript 7.4.0 with PHP 7.0 and up (through the new SWIG API)
• MapScript 4.10 with PHP 5.2.1 and up



• MapScript 4.10 with PHP 4.4.6 and up


How to Get More Information on the PHP/MapScript Module for MapServer
• For a list of all classes, properties, and methods available in the module:
- through SWIG (and PHP 7) see the SWIG API
- for the legacy module, see the PHP MapScript API reference document.
• More information on the original PHP/MapScript module can be found on the PHP/MapScript page on Map- Tools.org.
• The MapServer Wiki also has PHP/MapScript build and installation notes and some php code snippets.
• As many users rely on MS4W for MapScript, you can also see user-contributed PHP 7 scripts through the SWIG API, on the MS4W wiki.
• Questions regarding the module should be forwarded to the MapServer mailing list.

Obtaining, Compiling, and Installing PHP and the PHP/MapScript Module Download PHP and PHP/MapScript
• The PHP source or the Win32 binaries can be obtained from the PHP web site.
• Once you have verified that PHP is installed and is running, you need to get the latest MapServer source and compile MapServer and the PHP module.

Setting Up PHP on Your Server
Unix
• Check if you have PHP already installed (several Linux distributions have it built in).
• If not, see the PHP manual's "Installation on Unix systems" section.
Windows
• MS4W (MapServer For Windows) is a popular product maintained by GatewayGeo that contains Apache, PHP, and PHP/MapScript ready to use in a zipfile or installer. Several Open Source applications are also available for use in MS4W.
• Windows users can follow steps in the Installing Apache, PHP and MySQL on Windows tutorial to install Apache and PHP manually on their system.
• Window users running IIS can follow iis.net's howto for installing PHP.




Build/Install the PHP/MapScript Module
Building on a Linux Box
NOTE: For UNIX users, see the README.CONFIGURE file in the MapServer source, or see the Compiling on Unix
HowTo.
• The main MapServer configure script will automatically setup the main makefile to compile php_mapscript.so if you pass the -WITH_PHP=ON argument to the configure script.


• Copy the php_mapscript.so library to your PHP extensions directory, and then use the dl() function to load the module at the beginning of your PHP scripts. See also the PHP function extension_loaded() to check whether an extension is already loaded.


• The file mapscript/php/examples/phpinfo_mapscript.phtml will test that the php_mapscript module is properly installed and can be loaded.
• If you get an error from PHP complaining that it cannot load the library, then make sure that you recompiled and reinstalled PHP with support for dynamic libraries. On RedHat 5.x and 6.x, this means adding "-rdynamic" to the CLDFLAGS in the main PHP3 Makefile after running ./configure Also make sure all directories in the path
to the location of php_mapscript.so are at least r-x for the HTTPd user (usually 'nobody'), otherwise dl() may complain that it cannot find the file even if it's there.
Building on Windows
• For Windows users, it is recommended to look for a precompiled binary for your PHP version on the MapServer download page or use the MS4W installer.
• If for some reason you really need to compile your own Windows binary then see the README.WIN32 file in the MapServer source (good luck!).

Installing PHP/MapScript
Simply copy the file php_mapscript.dll to your PHP extensions directory (pathto/php/extensions) Using phpinfo()
To verify that PHP and PHP/MapScript were installed properly, create a '.php' file containing the following code and try to access it through your web server:







(continues on next page)



(continued from previous page)
If PHP and PHP/MapScript were installed properly, several tables should be displayed on your page, and 'MapScript' should be listed in the 'Extensions' table.

Example Steps of a Full Windows Installation
Using MS4W (MapServer for Windows)
1. Download the latest MS4W base package.
2. Extract the files in the archive to the root of one of your drives (e.g. C:/ or D:/).
3. Double-click the file /ms4w/apache-install.bat to install and start the Apache Web server.
4. In a web browser goto http://127.0.0.1. You should see an MS4W opening page. You are now running PHP, PHP/MapScript, and Apache.
5. You can now optionally install other applications that are pre-configured for MS4W, which are located on the MS4W download page.
Manual Installation Using Apache Server
1. Download the Apache Web Server and extract it to the root of a directory (eg. D:/Apache).
2. Download PHP and extract it to your Apache folder (eg. D:/Apache/PHP).
3. Create a temp directory to store MapServer created GIFs. NOTE: This directory is specified in the IMAGEPATH parameter of the WEB Object in the Mapfile reference. For this example we will call the temp directory "ms_tmp" (eg. E:/tmp/ms_tmp).
4. Locate the file httpd.conf in the conf directory of Apache, and open it in a text viewer (eg. TextPad, Emacs, Notepad).
In the Alias section of this file, add aliases to the ms_tmp folder and any other folder you require (for this example we will use the msapps folder):

In the ScriptAlias section of this file, add an alias for the PHP folder.

In the AddType section of this file, add a type for php files.

In the Action section of this file, add an action for the php.exe file.





5. Copy the file php.ini-dist located in your Apache/php directory and paste it into your WindowsNT folder (eg. c:/winnt), and then rename this file to php.ini in your WindowsNT folder.
6. If you want specific extensions loaded by default, open the php.ini file in a text viewer and uncomment the appropriate extension.
7. Place the file php_mapscript.dll into your Apache/php/extensions folder.
Installation Using Microsoft's IIS
(please see the Running MapServer on IIS document for uptodate steps)
1. Install IIS if required (see the IIS installation procedure).
2. Install PHP and PHP/MapScript (see above).
3. Open the Internet Service Manager (eg. C/WINNT/system32/inetsrv/inetmgr.exe).
4. Select the Default web site and create a virtual directory (right click, select New/Virtual directory). For this example we will call the directory msapps.
5. In the Alias field enter msapps and click Next.
6. Enter the path to the root of your application (eg. "c:/msapps") and click Next.
7. Set the directory permissions and click Finish.
8. Select the msapps virtual directory previously created and open the directory property sheets (by right clicking and selecting properties) and then click on the Virtual directory tab.
9. Click on the Configuration button and then click the App Mapping tab.
10. Click Add and in the Executable box type: path/to/php/php.exe %s %s. You MUST have the %s %s on the end, PHP will not function properly if you fail to do this. In the Extension box, type the file name extension to be associated with your PHP scripts. Usual extensions needed to be associated are phtml and php. You must repeat this step for each extension.
11. Create a temp directory in Explorer to store MapServer created GIFs.


12. Open the Internet Service Manager again.
13. Select the Default web site and create a virtual directory called ms_tmp (right click, select New/Virtual directory). Set the path to the ms_tmp directory (eg. C:/tmp/ms_tmp) . The directory permissions should at least be set to Read/Write Access.

FAQ / Common Problems
Questions Regarding Documentation
Q	Is there any documentation available?



A
The main reference document is the SWIG API (or the legacy PHP MapScript reference), which de- scribes all of the current classes, properties and methods associated with the PHP/MapScript module.
To get a more complete description of each class and the meaning of their member variables, see the
MapScript reference and the MapFile reference.
The MapServer Wiki also has PHP/MapScript build and installation notes and some php code snip- pets.


Q
Where can I find sample scripts?
A
Some examples are included in directory mapserver/mapscript/php/examples/ in the MapServer source distribution. A good one to get started is test_draw_map.phtml: it's a very simple script that just draws a map, legend and scalebar in an HTML page.
A good intermediate example is the PHP MapScript By Example guide (note that this document was created for an earlier MapServer version but the code might be still useful).
As many users rely on MS4W for MapScript, you can also see user-contributed PHP 7 scripts through the SWIG API, on the MS4W wiki.
The original example is the "Gmap demo", download the whole source and data files from the Map- Tools.org download page.

Questions About Installation
Q
How can I tell that the module is properly installed on my server?
A
Create a file called phpinfo.phtml with the following contents:

Make sure you replace the php_mapscript.so with the name under which you installed it, it could be php_mapscript_74.so on Unix, or php_mapscript_74.dll on Windows
You can then try the second test page mapserver/mapscript/php/examples/test_draw_map.phtml. This page simply opens a MapServer .map file and inserts its map, legend, and scalebar in an HTML page. Modify the page to access one of your own MapServer .map files, and if you get the expected result, then everything is probably working fine.


Q
I try to display my .phtml or .php page in my browser but the page is shown as it would it Notepad.
A
The problem is that your PHP installation does not recognize ".phtml" as a PHP file extension. As- suming you're using PHP under Apache then you need to add the following line with the other PHP- related AddType lines in the httpd.conf:




For a more detailed explanation, see the Example Steps of a Full Windows Installation section of this document.


Q
I installed PROJ (formerly 'PROJ.4'), GDAL, and other support libraries on my system, they are recognized by MapServer's "configure" as a system lib but at runtime I get an error: "libproj.so.0: No such file or directory".
A
You are probably running a RedHat Linux system if this happened to you. This happens because the libraries install themselves under /usr/local/lib but this directory is not part of the runtime library path by default on your system.
(I'm still surprised that "configure" picked PROJ as a system lib since it's not in the system's lib path. . . probably something magic in autoconf that we'll have to look into)
There are a couple of possible solutions:
1. Add a "setenv LD_LIBRARY_PATH" to your httpd.conf to contain that directory
2. Edit /etc/ld.so.conf to add /usr/local/lib, and then run "/sbin/ldconfig". This will permanently add /usr/local/lib to your system's runtime lib path.
3. Configure MapServer with the following options:

and the /usr/local/lib directory will be hardcoded in the exe and .so files
I (Daniel Morissette) personally prefer option #2 because it is permanent and applies to everything running on your system.


Q
Does PHP/MapScript have to be setup as a CGI? If so, why?
A
Yes, please see the PHP/MapScript CGI page in the MapServer Wiki for details.


Q
I have compiled PHP as a CGI and when PHP tries to load the php_mapscript.so, I get an "undefined symbol: _register_list_destructors" error. What's wrong?
A
Your PHP CGI executable is probably not linked to support loading shared libraries. The MapServer configure script must have given you a message about a flag to add to the PHP Makefile to enable shared libs.
Edit the main PHP Makefile and add "-rdynamic" to the LDFLAGS at the top of the Makefile, then relink your PHP executable.
Note: The actual parameter to add to LDFLAGS may vary depending on the system you're running on. On Linux it is "-rdynamic", and on *BSD it is "-export-dynamic".




Q
What are the best combinations of MapScript and PHP versions?
A
The best combinations are:
• MapScript 7.4.0 with PHP 7.0 and up (through the new SWIG API)
• MapScript 4.10 with PHP 5.2.1 and up
• MapScript 4.10 with PHP 4.4.6 and up

3.1.4 .NET MapScript Compilation
Author
Tamas Szekeres
Contact
szekerest at gmail.com

Compilation
Before compiling C# MapScript you should compile MapServer with the options for your requirements. For more information about the compilation of MapServer please see Win32 Compilation and Installation Guide. It is highly recommended to minimize the library dependency of your application, so when compiling MapServer enable only the features really needed. To compile the C# binding SWIG 1.3.31 or later is required.

WarningThis document may refer to older library versions. You may want to try to use more recent library versions for your build.
Win32 compilation targeting the MS.NET framework 1.1
You should compile MapServer, MapScript and all of the subsequent libraries using Visual Studio 2003. Download and uncompress the latest SWIGWIN package that contains the precompiled swig.exe Open the Visual Studio .NET 2003 Command Prompt and step into the /mapscript/csharp directory. Edit makefile.vc and set the SWIG variable to the location of your swig.exe
Use:

to compile mapscript.dll and mapscript_csharp.dll.

Win32 compilation targeting the MS.NET framework 2.0
You should compile MapServer, MapScript and all of the subsequent libraries using Visual Studio 2005. Download and uncompress the latest SWIGWIN package that contains the precompiled swig.exe Open the Visual Studio 2005 Command Prompt and step into the /mapscript/csharp directory Edit makefile.vc and set the SWIG variable to the location of your swig.exe.
Use:

to compile mapscript.dll and mapscript_csharp.dll.



Win32 compilation targeting the MONO framework
Before the compilation you should download and install the recent mono Win32 setup package (eg. mono-1.1.13.2- gtksharp-2.8.1-win32-1.exe) Edit makefile.vc and set the CSC variable to the location of your mcs.exe. Alternatively you can define:

in your nmake.opt file.
You should use the same compiler for compiling MapScript as the compiler has been used for the MapServer compi- lation. To compile MapScript open the Command Prompt supplied with your compiler and use:

to compile mapscript.dll and mapscript_csharp.dll.

Alternative compilation methods on Windows
Beginning from MapServer 4.8.3 you can invoke the C# compilation from the MapServer directory by uncommenting DOT_NET in nmake.opt:

and invoking the compilation by:

You can also use:

for making the compilation an copying the targets into a common output directory.

Testing the compilation
For testing the compilation and the runtime environment you can use:

within the csharp directory for starting the sample applications compiled previously. Before making the test the location of the corresponding libraries should be included in the system PATH.

Linux compilation targeting the MONO framework
Before the compilation you should download and install the recent mono Linux package. Some distributions have pre- compiled binaries to install, but for using the latest version you might want to compile and install it from the source. Download and uncompress the latest SWIG release. You should probably compile it from the source if pre-compiled binaries are not available for your platform.



Before compiling MapScript, MapServer should be configured and compiled. Beginning from MapServer 4.8.2 during configuration the mapscript/csharp/Makefile will be created according to the configuration options. Edit this file and set the SWIG and CSC for the corresponding executable paths if the files could not be accessed by default. To compile at a console step into the /mapscript/csharp directory use:

to compile libmapscript.so and mapscript_csharp.dll.
For testing the compilation and the runtime environment you can use:

for starting the sample applications compiled previously.

OSX compilation targeting the MONO framework
Beginning from 4.10.0 the csharp/Makefile supports the OSX builds. Before making the build the recent MONO package should be installed on the system.
Before compiling MapScript, MapServer should be configured and compiled. Beginning from MapServer 4.8.2 during configuration the mapscript/csharp/Makefile will be created according to the configuration options. Edit this file and set the SWIG and CSC for the corresponding executable paths if the files could not be accessed by default. To compile at a console step into the /mapscript/csharp directory use:

to compile libmapscript.dylib and mapscript_csharp.dll.
For testing the compilation and the runtime environment you can use:

for starting the sample applications compiled previously.
To run the applications mapscript_csharp.dll.config is needed along with the mapscript_csharp.dll file. This file is created during the make process

Installation
The files required for your application should be manually installed. It is highly recommended to copy the files into the same folder as the executable resides.

Known issues
Visual Studio 2005 requires a manifest file to load the CRT native assembly wrapper
If you have compiled MapServer for using the CRT libraries and you are using the MS.NET framework 2.0 as the execution runtime you should supply a proper manifest file along with your executable, like:








(continues on next page)



(continued from previous page)
This will inform the CLR that your exe depends on the CRT and the proper assembly wrapper is to be used. If you are using the IDE the manifest file could be pregenerated by adding a reference to Microsoft.VC80.CRT.manifest within the /Microsoft Visual Studio 8/VC/redist/x86/Microsoft.VC80.CRT directory.

Manifests for the dll-s must be embedded as a resource
According to the windows makefile the MapScript compilation target (mapscript.dll) is linked with the /MD option. In this case the VS2005 linker will generate a manifest file containing the unmanaged assembly dependency. The sample contents of the manifest file are:

Like previously mentioned if you are creating a windows application the common language runtime will search for a manifest file for the application. The name of the manifest file should be the same as the executable append and end with the .manifest extension. However if the host process is not controlled by you (like web mapping applications using aspnet_wp.exe as the host process) you will not be certain if the host process (.exe) will have a manifest containing a reference to the CRT wrapper. In this case you may have to embed the manifest into the dll as a resource using the mt tool like:

the common language runtime will search for the embedded resource and load the CRT assembly properly.
Normally it is enough to load the CRT with the root dll (mapscript.dll), but it is not harmful embedding the manifest into the dependent libraries as well.



Issue with regex and Visual Studio 2005
When compiling with Microsoft Visual Studio 2005 variable name collision may occur between regex.c and crtdefs.h. For more details see:
https://github.com/MapServer/MapServer/issues/1651

C# MapScript library name mapping with MONO
Using the MapScript interface created by the SWIG interface generator the communication between the C# wrapper classes (mapscript_csharp.dll) and the C code (mapscript.dll) takes place using platform invoke like:

The DllImport declaration contains the library name, however to transform the library name into a file name is platform dependent. On Windows the library name is simply appended with the .dll extension (mapscript.dll). On the Unix systems the library file name normally starts with the lib prefix and appended with the .so extension (libmapscript.so).
Mapping of the library name may be manually controlled using a dll.config file. This simply maps the library file the DllImport is looking for to its unix equivalent. The file normally contains the following information (map- script_csharp.dll.config):

and with the OSX builds:

The file should be placed along with the corresponding mapscript_csharp.dll file, and created by default during the make process. For more information see:
https://github.com/MapServer/MapServer/issues/1596	http://www.mono-project.com/Interop_with_Native_ Libraries

Localization issues with MONO/Linux
According to https://github.com/MapServer/MapServer/issues/1762 MapServer may not operate equally well on dif- ferent locale settings. Especially when the decimal separator is other than "." inside the locale of the process may cause parse errors when the mapfile contains float numbers. Since the MONO process takes over the locale settings of the environment it is worth considering to set the default locale to "C" of the host process, like:


Most frequent errors
This chapter will summarize the most frequent problems the user can run into. The issues were collected mainly from the -users list and the IRC.



Unable to load dll (MapScript)
You can get this problem on Windows and in most cases it can be dedicated to a missing or an unloadable shared library. The error message talks about mapscript.dll but surely one or more of the dll-s are missing that libmap.dll depends on. So firstly you might want to check for the dependencies of your libmap.dll in your application directory. You can use the Visual Studio Dependency Walker to accomplish this task. You can also use a file monitoring tool (like SysInternal's filemon) to detect the dll-s that could not be loaded. I propose to store all of the dll-s required by your application in the application folder. If you can run the drawmap C# sample application with your mapfile your compilation might be correct and all of the dlls are available.
You may find that the MapScript C# interface behaves differently for the desktop and the ASP.NET applications. Al- though you can run the drawmap sample correctly you may encounter the dll loading problem with the ASP.NET applications. When creating an ASP.NET project your application folder will be 'Inetpubwwwroot[YourApp]bin' by default. The host process of the application will aspnet_wp.exe or w3wp.exe depending on your system. The appli- cation will run under a different security context than the interactive user (under the context of the ASPNET user by default). When placing the dll-s outside of your application directory you should consider that the PATH environment variable may differ between the interactive and the ASPNET user and/or you may not have enough permission to access a dll outside of your application folder.

Bug reports
If you find a problem dedicated to the MapScript C# interface feel free to file a bug report to the Issue Tracker.

3.1.5 Running MapServer on IIS
Author
Seth Girvin
Contact
sgirvin at compass.ie
Last Updated
2024-11-21

This document details how to configure a pre-built version of MapServer to run on IIS (Microsoft's web server - Internet Information Services). These steps have a minimum requirement of IIS 7 and Windows 7, and have been tested on IIS 10 running on Windows 10.



MapServer can also be run on Windows using MS4W (MapServer for Windows) - which installs its own preconfigured Apache web server, and other related tools such as PHP, TinyOWS, and MapCache. Running MapServer under IIS may be necessary when deploying to servers where the installation of an additional web server is restricted, or where system administrators have more experience maintaining IIS.


MapServer Set-up
Pre-compiled versions of MapServer and GDAL (a required dependency) can be downloaded from http://www. gisinternals.com/release.php. These downloads are built and maintained by Tamas Szekeres a long term contributor to MapServer, and Project Steering Committee (PSC) member.


Once you have downloaded the zip file follow the steps below.
1. Unzip the folder to your machine. In this example we will assume it has been unzipped to C:\MapServer. Make sure that you have "unblocked" the zip, to avoid and security related issues later. Right-click on the zip file, select properties and click the "Unblock" button on the General tab.




2. Test that MapServer is working by double clicking C:\MapServer\SDKShell.bat to start a new Windows command session configured with MapServer environment settings, and then type:

The MapServer version and supported format types should be displayed in the command window.

Configuring with IIS
These steps assume IIS 7 or higher is installed on the development machine, and MapServer is using the default website location of C:\Inetpub\wwwroot. MapServer is installed as a FastCGI application, which improves performance by allowing MapServer to share objects such as database connections between requests.
All command line steps should be "Run as Administrator" (to select this option this right-click on the Windows com- mand line icon). Make sure IIS is on the machine - if you have a folder named C:\Inetpub then it is likely IIS is already installed.
You can install IIS (for Windows 10) from the command line with:

More details on setting up a FastCGI application with IIS can be found in the Microsoft FastCGI documentation.
1. First copy the required .exes into the same folder as the MapServer DLLs. This can be done using the command below:

2. Create a new folder C:\Inetpub\wwwroot\mapserver




3. Create a new, empty C:\Inetpub\wwwroot\mapserver\web.config file, and open it (as an administrator) in Notepad:

4. Paste in the following configuration:

5. Next set up the web application in IIS:

6. Allow request handlers to be set in the web.config file (above), rather than just at the web site level.

7. Next make sure the required IIS CGI module (which includes FastCGI) is installed in IIS with the following command:








8. Next we set the mapserver.exe to be a FastCGI application and allow it to run in IIS:

These settings can also be viewed and configured using IIS Manager:





9. Test the set-up was successful by entering the following URL in a browser: http://localhost/mapserver/. If the following text is displayed then MapServer has been successfully configured as a FastCGI application in IIS.


MapServer Configuration File
The MapServer 8.0 release introduced a new CONFIG file. This allows all MapServer global environment variables to be set in a single place, which is easier to manage than IIS FastCGI variables, and more portable between different environments and operating systems.
For this example we will create an empty configuration file at C:\MapServer\apps\mapserver.conf. Once the file is created the following sample configuration can be copied in:














(continues on next page)



(continued from previous page)
An IIS FastCGI environment variable MAPSERVER_CONFIG_FILE however still needs to be created to point to this configuration file. This can be set using IIS Manager, and selecting Server > FastCGI Settings > C:\MapServer\bin\ mapserv.exe > Environment Variables:

Alternatively it can beset from the command line with the following command:


Setting up Applications
MapServer applications consist of a mapfile, and additional optional files for data, symbols, logs, and images. The same instance of MapServer can be used to serve many applications. In this example we will create a new test subfolder for a test application in a C:\MapServer\apps folder.




Now create a new test.map file in this folder and paste in the test Mapfile below.


You should now be able to test the application is accessible through IIS using the following URL to retrieve	an	image	via	WMS:	http://localhost/mapserver/mapserv?map=C:/MapServer/apps/test/test.map&  SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&LAYERS=country_bounds&STYLES=&CRS=EPSG:    4326&BBOX=-180,-90,180,90&WIDTH=400&HEIGHT=300&FORMAT=image/png















Setting up Logging
You can set-up MapServer logging by adding the following lines to your MAP block.

The path to the log file is relative to the mapfile, so in this example you need to create a new C:\MapServer\apps\ test\logs folder:

You may need to set read-write permissions on the log file to the IIS application pool user (in this example we are using the default IIS AppPoolDefaultAppPool account under which the MapServer FastCGI runs). In IIS10 the "Authenticated Users" group normally has Modify access to all folders on the C drive, so this step may not be necessary.

If a different application pool is used, or you don't set the permissions you will receive the following message (also check that the C:\MapServer\apps\test\logs folder exists as it will not be created automatically).


Further Configuration


MapServer makes use of Environment Variables to create application-wide settings. When using IIS these need to be set as FastCGI environment settings, rather than standard system-wide environment variables. Each FastCGI application can be configured with different environment variables and can be modified by IIS Manager, or using the command line.





FastCGI configurations are stored in C:\Windows\System32\inetsrv\config\applicationHost.config in the format below:


Setting a Default Mapfile
The MS_MAPFILE environment variable can be set to a default map as follows:

You can make then make a request without the query string requiring map=C:/MapServer/apps/test/ test.map:	http://localhost/mapserver/mapserv?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap& LAYERS=country_bounds&STYLES=&CRS=EPSG:4326&BBOX=-180,-90,180,90&WIDTH=400&HEIGHT=
300&FORMAT=image/png
In addition to this method the URL Rewrite module can be used to set different mapfiles dependent on query string parameters or domain names.

Setting a Certificates File
To access remote data sources via HTTPS (for example when cascading a WMS), you may need to point to a certificates file. This can be set using the CURL_CA_BUNDLE environment variable:

See Accessing OGC services over HTTPS for further details.



Securing MapServer in IIS
MapServer has two environment variables that can be used to restrict which mapfiles can be accessed.


MS_MAP_NO_PATH can be used to ensure that users can't provide their own map= parameter to the query string. This can be set to any value ("True" in this example) so that only the MS_MAPFILE environment value can be used (see "Setting a Default Mapfile" above).


MS_MAP_PATTERN can be set to limit the folders from which mapfiles can be accessed using a regular expression. For example to limit to the C:\MapServer\apps (note this path is case-sensitive) folder use the following regular expression: "^(C:)?\/MapServer\/apps\/((?!\.{2})[_A-Za-z0-9\-\.]+\/{1})*([_A-Za-z0-9\-\.]+\. (map))$"

In addition to these methods IIS itself can be used to block or filter query string parameters. The denyQueryStringSe- quences element can be set to block a mapfile being set by a URL. Both map= and the encoded map%3d are blocked.




Troubleshooting
Common error messages and how to resolve them are listed below.
• If the MAPSERVER_CONFIG_FILE environment variable has not been set in IIS, or it points to a missing or inac- cessible file, you will receive the following message:

• If the MAPSERVER_CONFIG_FILE is empty or doesn't begin with CONFIG you will receive the following message:

• If the MAPSERVER_CONFIG_FILE has invalid syntax you will receive a message similar to the following:

• The following error is returned (from MapServer 8.0) if allowPathInfo="false" is set in the handlers
section for MapServer in the web.config file. This should be set to true.

• If the CONFIG file security regular expressions used to limit access to mapfiles do not match the supplied mapfile you will receive the following:

• Check that the file exists if you receive the following error. If it does exist then check the file permissions.

• MapServer projections are stored in C:\MapServer\bin\proj\SHARE (or C:\MapServer\bin\proj9\ SHARE when using PROJ 9). When the projection is specified in the following form "init=epsg:3857", MapServer will try to find this code in the epsg file, where it is listed as <3857> +proj=merc +a=6378137.  If
you receive the error below then make sure the CONFIG "PROJ_DATA" "C:\MapServer\bin\proj\SHARE" setting is pointing to the correct path. Note on one installation this message was shown as forward slashes rather than backslashes were used.

• The following error is caused if IIS has been locked-down so settings cannot be overridden at the web.config
level.




Run the following in a command window (with administrator permissions). This enables the handlers section in the /mapserver/web.config file to override the ones set at the machine level. See http://stackoverflow.com/ questions/9794985/iis-this-configuration-section-cannot-be-used-at-this-path-configuration-lock

• Check C:\MapServer\bin\mapserv.exe exists if you encounter the error below.

• To view the CGI applications registered with IIS you can use the command below (this reads the C:\Windows\ System32\inetsrv\config):

This should output XML similar to below for this section:


3.1.6 Oracle Installation
Author
Till Adams
Last Updated
2007-02-16


Preface
This document explains the whole configuration needed to get the connect between MapServer CGI and an Oracle database server on a linux (Ubuntu) box. The aim of this document is just to put a lot of googled knowledge in ONE place. Hopefully it will preserve many of people spending analog amount of time than I did!
This manual was written, because I spent several days googling around to get my UMN having access to an oracle database. I'm NOT an oracle expert, so the aim of this document is just to put a lot of googled knowledge in ONE



place. Hopefully it will preserve many of people spending analog amount of time than I did! (Or: If you have the choice: Try PostGIS ;-))
Before we start, some basic knowledge, I didn't know before:
• MapServer can access oracle spatial as well as geodata from any oracle locator installation! Oracle locator comes with every oracle instance, there is no need for an extra license.
• There is no need for further installation of any packages beside oracle/oracle OCI

System Assumptions
We assume that Oracle is already installed, there is a database and there is some geodata in the database. The following paths should be known by the reader:
• ORACLE_HOME
• ORACLE_SID
• ORACLE_BASE
• LD_LIBRARY_PATH
We also assume that you have installed apache2 (our version was 2.0.49) and you are used to work with Linux/UNIX systems. We also think you are able to handle the editor vi/vim.
We ensure that the Oracle user who later accesses the database has write-access to the oracle_home directory. We also assume, that you already have setup the tnsnames.ora file. It should look like that:
It is important that you know the NAME of the datasource, in this example this is "MY_ORACLE" and will be used fur- ther on. Done that, you're fine using User/Password@MY_ORACLE in your mapfile to connect to the oracle database. But first we have to do some more stuff.

Compile MapServer
Compile as normal compilation and set this flag:

If MapServer configure and make runs well, try

This should at least give this output:

If you got that, you're fine from the MapServer point of view.



Set Environment Variables
It is important to set all environment variables correctly. There are one the one hand system-wide environment variables to be set, on the other hand there should be set some for the cgi-directory in your Apache configuration.

System Variables
On Ubuntu (and on many other systems) there is the file "/etc/profile" which sets environment variables for all users on the system (you may also dedicate user-specific environment variables by editing the users ".profile" file in their home directory, but usually the oracle database users are not users of the system with their own home)
Set the following variables:

The command comes silent, so there is no system output if you didn't mistype anything!

Setting the Apache Environment
Sometimes it is confusing WHERE to set WHAT in the split apache2.conf  files.	In the folder
/etc/apache2/sites_available you find your site's file. If you did not do anything special (e.g. installing virtual hosts) the file is named "default". In this file, the apache cgi-directory is defined. Our file looks like this:

In this file, the local apache environment variables must be set. We did it within a location-block like this:

Where /cgi-bin/ in the opening location block refers to the script alias /cgi-bin/ and the TNS_ADMIN directory point to the location of the tnsnames.ora file.
Then restart apache:






Create mapfile
Before we start creating our mapfile ensure that you have a your access data (User/Password) and that you know the Oracle SRID, which could be different from the proj-EPSG!
The data access parameters:

[. . . ]
Where:
• GEOM is the name of the geometry column
• MY_LAYER the name of the table
• 82032 is equivalent to the EPSG code 31468 (German projection system)

Testing & Error handling
So you are fine now. Load the mapfile in your application and try it. If everything goes well: Great, if not, possibly this ugly error-emssage occurs (this one cmae by querying MapServer through the WMS interface as a GetMap-request):

This points us towards, that there might be a problem with the connection to the database. First of all, let's check, if the mapfile is all right. Therefore we use the MapServer utility program map2img.
Let's assume you are in the directory, where you compiled MapServer and run map2img:

The output of the command should look like this:

If not, this possibly points you towards any error in your mapfile or in the way to access the data directly. In this case, take a look at Oracle Spatial. If there is a problem with your oracle connect, the same message as above (MsDrawMap()
. . . ) occurs. Check your mapfile syntax and/or the environment settings for Oracle.
For Debian/Ubuntu it's worth also checking the file "/etc/environment" and test-wise to add the system variables com- parable to System Variables



If the output is OK, you may have a look at the generated image (output.png). Then your problem reduces to the access of apache to oracle home directory. Carefully check your apache configuration. Please note, that the apache.config file differs in several linux-distributions. For this paper we talk about Ubuntu, which should be the same as Debian.

3.1.7 V8 MapScript Support
Author
Alan Boudreault
Contact
aboudreault@mapgears.com


Introduction
The V8/MapScript cannot be used as its own like other mapscripts. V8 is currently used internally to add 2 function- alities:
• Javascript Styleitem: rfc102
   • Javascript Geomtransform: rfc106 These instructions are for Unix/Linux users.
Version of V8 supported
You have to use v8 3.20, which is the version of the nodejs release:0.11.7. For future compatibility, this is a good thing to be synchronized to nodejs project.

Obtaining, Compiling, and Installing V8 and V8/MapScript Download and Compile V8
• The V8 source can be obtained from the v8 website.
Download v8:

Compile the v8 library:







Install the v8 library and include headers:



Setup the v8 lib in the system paths:


Compile MapServer with V8 Support
Configure:

Compile and install: (from the build directory)

Verify the V8 support:

You should see: SUPPORTS=V8. You can now refer to the following pages to try the javascript functionalities:
• Javascript Styleitem: STYLEITEM Javascript
• Javascript Geomtransform: Javascript transformation


CHAPTER
FOUR



MAPFILE


4.1 Mapfile
Author
Steve Lime
Contact
steve.lime at dnr.state.mn.us
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2025-06-27
The mapfile is the heart of MapServer. It defines the relationships between objects, points MapServer to where data are located and defines how things are to be drawn.
The mapfile must have a .map extension or MapServer will not recognize it. (if you try with another file extension, MapServer will throw an error of "Filename validation failed")
The mapfile consists of a MAP object, which has to start with the word MAP.
There are some important concepts that you must understand before you can reliably use mapfiles to configure MapServer. First is the concept of a LAYER. A layer is the combination of data plus styling. Data, in the form of attributes plus geometry, are given styling using CLASS and STYLE directives.

See alsoAn Introduction to MapServer for "An Introduction to the Mapfile"



4.1.1 Cartographical Symbol Construction with MapServer
Author
Peter Freimuth
Contact
pf at mapmedia.de
Author
Arnulf Christl
Author
Håvard Tveite

Table of Contents• Abstract
• Introduction
- Multiple Rendering and Overlay
- Symbol Scaling
- MapServer and symbol specification
• Using Cartographical Symbols in MapServer
- Output formats
- Symbol units
- Scaling of Symbols
• Construction of Point Symbols
- Symbols of TYPE vector and ellipse
- Symbols of TYPE truetype
- Symbols of TYPE pixmap
- Symbol definitions for the figure that demonstrates point symbols
- Combining symbols
• Construction of Line Symbols
- Overlaying lines
- Use of the PATTERN and GAP parameters
* LINECAP
* LINEJOIN
* LINEJOINMAXSIZE (only relevant for LINEJOIN miter)
- Use of the OFFSET parameter
- Asymmetrical line styling with point symbols
• Area Symbols
- Hatch fill




Abstract
This Document refers to the syntax of map and symbol files for MapServer 6. The first version of the document was based on the results of a project carried out at the University of Hannover, Institute of Landscape and Nature Conservation, in 2004, using MapServer 4. It was initiated by Mr. Dipl. Ing. Roland Hachmann. Parts have been taken from a study carried through by Karsten Hoffmann, student of Geography and Cartography at the FU Berlin. In the context of a hands-on training in the company GraS GmbH, Mr. Hoffman mainly dealt with the development of symbols. (Download study report in German) His degree dissertation will also concern this subject.
The document has been heavily revised for MapServer 6.


Introduction
A map is an abstract representation that makes use of point, line and area symbols. Bertin (1974) created a clear and logical symbol scheme in which symbols can be varied referring to graphical variables. The following graphical variables can be used within MapServer: FORM, SIZE, PATTERN, COLOR and LIGHTNESS. Point and area symbols as well as text fonts (ttf) can additionally be displayed with a frame which we call OUTLINE.
The following figure shows the theoretical structure of cartographical symbols, which is also used in MapServer:



















Fig. 1: Structure of Cartographical Symbols'


Multiple Rendering and Overlay
Say you want to display a highway with a black border line, two yellow lanes and a red center lane. This calls for a combination of signatures.
Complex cartographical effects can be achieved by rendering the same vector data with different symbols, sizes and colours on top of each other. This can be done using separate LAYERs. This could, however, have performance effects for the application, as every rendering process of the same geometry will take up additional processor time. The preferred solution is to use multiple STYLEs to create complex symbols by overlay.
To create the highway symbol mentioned above with a total width of 9 units, the lowest STYLE (in drawing order) will be a broad black line with a width of 9 units. The second level STYLE will be a yellow line with a width of 7 units, and the topmost STYLE will be a red line with a width of 1 unit. That way each yellow coloured lane will have a width of (7-1)/2 = 3 units.
Combining symbols can be a solution for many kinds of cartographical questions. A combination of different geometry types is also possible. A polygon data set can be rendered as lines to frame the polygons with a line signature. It can also be rendred as polygons with a symbol filling the polygon. When the polygon fill is rendered on top of the lines, the inner part of the underlying outline is covered by the fill symbol of the polygon. What is observed here is a clipping effect that will result in an asymmetric symbol for the boundary line. To present the outline without clipping, just reorder the LAYERs or STYLEs and put the outline presentation on top of the fill.
Yet another way to construct advanced line signatures for framed polygons is to tamper with the original geometries by buffering or clipping the original geometry such that the new objects lie inside the original polygons or grow over the borders. PostGIS can help achieve a lot of effects.
The OPACITY parameter of LAYER and STYLE can be used to achieve transparency (making lower symbols "shine" through upper symbols).

Symbol Scaling
There are two basically different ways of handling the display size of symbols and cartographical elements in a map at different scales. The size of cartographical elements is either set in screen pixels or in real world units.
• If the size is set in real world units (for example meters), the symbol will shrink and grow according to the scale at which the map is displayed.
• If the size is set in screen pixels, symbols look the same at all scales.
The default behaviour of MapServer is to implement the "screen pixels" size type for displaying cartographical ele- ments.
"Real world units", as described above, can be achieved using either the SIZEUNITS or the SYMBOLSCALEDENOM
parameter of the LAYER.
• When SIZEUNITS is set (and is not pixels), symbol sizes are specified in real world units (for instance meters). For available units, see the SIZEUNIT documentation.
• When SYMBOLSCALEDENOM is set, the given symbols size is used for the map scale 1:SYMBOLSCALEDE- NOM, for other scales, the symbols are scaled proportionally.
STYLE MAXSIZE and MINSIZE limits the scaling of symbols.

MapServer and symbol specification
In a MapServer application, SYMBOL parameters are organised in the map file as follows:
• Each LAYER has a TYPE parameter that defines the type of geometry (point, line or polygon). The symbols are rendered at points, along lines or over areas accordingly.



• Basic symbols are defined in SYMBOL elements, using the parameters TYPE, POINTS, IMAGE, FILLED, AN- CHORPOINT and more (SYMBOL elements can be collected in separate symbol files for reuse).
• Colour, lightness, size and outline are defined inside the STYLE sections of a CLASS section using the parameters
COLOR, SIZE, WIDTH and OUTLINECOLOR.
• Patterns for styling lines and polygons are defined in STYLE sections using GAP and PATTERN.
    • Several basic elements can be combined to achieve a complex signature using several STYLEs inside one CLASS. The following example shows the interaction of some of these elements and explains the configuration in the LAYER
and the SYMBOL sections necessary for rendering a cartographical point symbol (a red square with a 1 pixel wide black outline and a smaller blue circle inside):


Fig. 2: The generated overlay symbol

MapServer Documentation, Release 8.6.0


Table 1: Commented LAYER and SYMBOL sections.

LAYER section of the map fileSYMBOL (from a separate symbol file or in-line the map file)in
# Start of layer definition
LAYER
# Name of the layer
NAME "mytest"
TYPE POINT	# Point geometries
STATUS DEFAULT # Always draw # Use the dataset test.shp DATA test
# Start of a Class definition
CLASS
# Start of the first Style
STYLE
# Symbol to be used (reference)
SYMBOL "square"
# Size of the symbol in pixels
SIZE 16
# Colour (RGB) - red
COLOR 255 0 0
# Outline colour (RGB) - black
OUTLINECOLOR 0 0 0
END # end of STYLE
# Start of the second Style
STYLE
# Symbol to be used (reference)
SYMBOL "circle"
# Size of the symbol in pixels
SIZE 10
# Colour (RGB) - blue
COLOR 0 0 255
END # end of STYLE
END # end of CLASS
END # end of LAYER
# Start of symbol definition
SYMBOL
# Symbol name (referenced in STYLEs)
NAME "square"
TYPE vector # Type of symbol
# Start of the symbol geometry
POINTS
0 0
0 1
1 1
1 0
0 0
END # end of POINTS
# The symbol should be filled
FILLED true
# Place the according to its center
ANCHORPOINT 0.5 0.5
END # end of SYMBOL

# Start of symbol definition
SYMBOL
# Symbol name (referenced in STYLEs)
NAME "circle"
TYPE ellipse # Type of symbol # Start of the symbol geometry
POINTS
1 1
END # end of POINTS
# The symbol should be filled
FILLED true
# Place the according to its center
ANCHORPOINT 0.5 0.5
END # end of SYMBOL
Using Cartographical Symbols in MapServer
Vectors, truetype fonts and raster images are basic graphical elements that are defined by the TYPE parameter in the STYLE element. This and the following sections explain how these elements can be combined to create complex cartographical symbols, and they describes some other important aspects of map rendering in MapServer .

Output formats
MapServer support raster output formats (e.g. PNG, JPEG and GIF) and vector output formats (e.g. PDF, SVG). The raster formats (except for GIF) use anti-aliasing. See OUTPUTFORMAT (and MAP IMAGETYPE) for more.



Symbol units
The units used for specifying dimensions is defined in the SIZEUNITS parameter of the LAYER. The available units are listed there. The default unit is pixels.
The MAP element's RESOLUTION and DEFRESOLUTION parameters will determine the resolution of the resulting map and hence the size in pixels of the symbols on the map. DEFRESOLUTION is by default 72 dpi (dots per inch). If RESOLUTION is set to 144 (and DEFRESOLUTION is 72), all dimensions specified in the map file will be multiplied by 144/72 = 2. This can be used to produce higher resolution images.
Dimensions can be specified using decimals.

Scaling of Symbols
The SYMBOLSCALEDENOM parameter in the LAYER section specifies the scale at which the symbol or text label is displayed in exactly the dimensions defined in the STYLEs (for instance using SIZE and WIDTH). Observe that all the parameters concerned with the symbol dimensions (SIZE, WIDTH, . . . ) are tightly connected to the SYMBOLSCALE- DENOM parameter. The MAXSIZE and MINSIZE parameters inside the STYLE element limit the scaling of symbols to the maximum and minimum size specified here (but does not affect the size calculations).
When symbols are scaled as the scale changes, the elements (defined in STYLEs) of a composite cartographical symbol may change their positions relative to each other. This is due to rounding effects when creating the image. The effect is most noticeable at small scales (large scale denominators), when the symbols get small. Due to the same effects, symbols can also slightly change their shape when they get small.
It is not possible to define the display intervals with MINSCALEDENOM and MAXSCALEDENOM in the STYLE- section, so this kind of tuning has to be solved at the LAYER level. To do this, create several LAYERs with the same geometries for different scale levels.
Always observe that cartographical symbols depend a lot on the scale! So be careful with the interaction of content, symbols and scale. All three parameters heavily interact and have to be coordinated to produce a good map.

Construction of Point Symbols
In the figure below, point symbols of TYPE truetype, pixmap, ellipse and vector are demonstrated. The precise position of the point for which the symbol is rendered is shown with a small red dot. A small blue dot is used to show an offset position.
All point symbols can be rotated using the ANGLE parameter.
Since version 6.2, the anchor point / reference point of all point symbols can be set using the SYMBOL ANCHORPOINT
parameter. The default anchorpoint is at the center of the boundingbox of the symbol (ANCHORPOINT 0.5 0.5).

Symbols of TYPE vector and ellipse
For symbols of TYPE vector and ellipse the shape of the symbol by setting X and Y values in a local two dimensional coordinate system with X values increasing to the right and Y values increasing downwards. The coordinates defining the symbol is listed in the POINTS parameter, which is explicitly ended using END. Negative values should not be used.
• TYPE ellipse is used to create ellipses (and circles). The shape of the ellipse is defined in the POINTS parameter (X - size in the horizontal direction, Y - size in the vertical direction). To create a circle, let X and Y have the same value.
• TYPE vector is used to define advanced vector symbols. The shape of the symbol is defined in the POINTS parameter. A vector symbol can consist of several elements. The coordinates -99 -99 are used to separate the elements.
To create a polygon vector symbol, the SYMBOL FILLED parameter must be set to true. If the end point is not equal to the start point of a polygon geometry, it will be closed automatically.





Fig. 3: Basic point symbol TYPEs, showing effects of size, offset, angle and outlinecolor

The maximum number of points is 100, but this can be increased by changing the parameter MS_MAXVECTORPOINTS in the file mapsymbols.h before compilation.
When creating symbols of TYPE vector you should observe some style guidelines.
- Avoid downtilted lines in area symbols, as they will lead to heavy aliasing effects.
- Do not go below a useful minimum size. This is relevant for all types of symbols.
- Keep in mind that for pixel images, every symbol of TYPE vector has to be rendered using pixels.


Symbols of TYPE truetype
You can use symbols from truetype fonts. The symbol settings are defined in the SYMBOL element. Specify the character or the ASCII number of the character to be used in the CHARACTER parameter. The FONT parameter is used to specify the font to be used (the alias name from the font file - often "fonts.list"). The FONTSET parameter of the MAP element must be set for fonts to work.
For gif output (GD renderer), you can define that you want to apply antialiasing to the characters by using the parameter ANTIALIAS. It is recommended to do this especially with more complex symbols and whenever they don't fit well into the raster matrix or show a visible pixel structure.
Colours for truetype symbols can be specified in LAYER CLASS STYLE (as with symbols of the TYPE vector and



ellipse). You can specify both fill colour and outline colour.
To find out the character number of a symbol use one of the following options:
• Use the software FontMap (Shareware, with free trial version for download, thanks Till!).
• Use the MS Windows truetype map.
• Trial and Error. :-)
Please note that the numbering of the so-called "symbol fonts" starts at 61440! So if you want to use character &#84, you have to use 61440 + 84 = &#61524. (ain't that a pain!!)
You can also place truetype characters and strings on the map using LABEL. Then you can control the placing of the text by using the POSITION parameter [ul|uc|ur|cl|cc|cr|ll|lc|lr], that specifies the position relative to the geometric origin of the geometry.

Symbols of TYPE pixmap
Symbols of the TYPE pixmap are simply small raster images. The file name of the raster image is specified in the
IMAGE parameter of the SYMBOL element. MapServer supports the raster formats GIF and PNG for pixmaps.
Observe the colour depth of the images and avoid using 24 bit PNG symbols displayed in 8 bit mode as this may cause unexpected colour leaps.
When using raster images, the colour cannot be modified in the SYMBOL element subsequently.
You can specify a colour with the TRANSPARENT parameter which will not be displayed - i.e. it will be transparent. As a result, underlying objects and colours are visible.
The SIZE parameter defines the height of pixmap symbols when rendered. The pixel structure will show when the SIZE grows too large. If you are using symbol scaling (LAYER SYMBOLSCALEDENOM is set or LAYER SIZEUNITS is not pixels) and want to prevent this from happening, you should set the STYLE MAXSIZE parameter.

Symbol definitions for the figure that demonstrates point symbols
This code was used to produce the symbols in the point symbol figure. First, the symbol definitions:



















(continues on next page)



(continued from previous page)
Then, the LAYERs and STYLEs used for producing the polygon V symbols in the point symbol figure:






















(continues on next page)





LAYER	# Vector v - polygon, size
STATUS DEFAULT TYPE POINT FEATURE
POINTS
20 30
END # Points
END # Feature
CLASS
STYLE
SYMBOL "v-poly"
COLOR 0 0 0
SIZE 30
END # STYLE
STYLE
SYMBOL "circlef"
COLOR 255 0 0
SIZE 4
END # STYLE
END # CLASS
END # LAYER

LAYER	# Vector v - polygon, size, angle
STATUS DEFAULT TYPE POINT FEATURE
POINTS
30 30
END # Points
END # Feature
CLASS
STYLE
SYMBOL "v-poly"
COLOR 0 0 0
SIZE 30
ANGLE 60
END # STYLE
STYLE
SYMBOL "circlef"
COLOR 255 0 0
SIZE 4
END # STYLE
END # CLASS
END # LAYER

LAYER	# Vector v - polygon, size, offset
STATUS DEFAULT TYPE POINT FEATURE
POINTS
40 30
END # Points

(continued from previous page)





















































(continues on next page)





END # Feature
CLASS
STYLE
SYMBOL "v-poly"
COLOR 0 0 0
SIZE 30
OFFSET 0 15
END # STYLE
STYLE
SYMBOL "circlef"
COLOR 255 0 0
SIZE 4
END # STYLE
END # CLASS
END # LAYER

LAYER	# Vector v - polygon, size, angle, offset
STATUS DEFAULT TYPE POINT FEATURE
POINTS
50 30
END # Points
END # Feature
CLASS
STYLE
SYMBOL "v-poly"
COLOR 0 0 0
SIZE 30
ANGLE 60
OFFSET 0 15
END # STYLE
STYLE
SYMBOL "circlef"
COLOR 255 0 0
SIZE 4
END # STYLE
END # CLASS
END # LAYER

LAYER	# Vector v - polygon, size outline
STATUS DEFAULT TYPE POINT FEATURE
POINTS
60 30
END # Points
END # Feature
CLASS
STYLE
SYMBOL "v-poly"
COLOR 0 0 0

(continued from previous page)





















































(continues on next page)





SIZE 30
OUTLINECOLOR 0 255 0
END # STYLE
STYLE
SYMBOL "circlef"
COLOR 255 0 0
SIZE 4
END # STYLE
END # CLASS
END # LAYER

LAYER	# Vector v - polygon, size, outline, width
STATUS DEFAULT TYPE POINT FEATURE
POINTS
70 30
END # Points
END # Feature
CLASS
STYLE
SYMBOL "v-poly"
COLOR 0 0 0
SIZE 30
OUTLINECOLOR 0 255 0
WIDTH 4
END # STYLE
STYLE
SYMBOL "circlef"
COLOR 255 0 0
SIZE 4
END # STYLE
END # CLASS
END # LAYER

LAYER	# Vector v - polygon, size, outline, no color
STATUS DEFAULT TYPE POINT FEATURE
POINTS
80 30
END # Points
END # Feature
CLASS
STYLE
SYMBOL "v-poly"
SIZE 30
OUTLINECOLOR 0 255 0
END # STYLE
STYLE
SYMBOL "circlef"
COLOR 255 0 0

(continued from previous page)





















































(continues on next page)



(continued from previous page)

Combining symbols
The following figure shows how to combine several basic symbols to create a complex point symbol. The combination is achieved by adding several STYLEs within one LAYER. Each STYLE element references one SYMBOL element. All the basic symbols are centered and overlaid when rendered.
Notice that the SIZE parameter in the STYLE element refers to the height of the symbol (extent in the Y direction). A standing rectangle will thus display with a smaller area than a lying rectangle, although both have the same SIZE parameter and the same maximum Y value in the SYMBOL element. When combining several basic point symbols on top of each other, they will not always be centered correctly due to the integer mathematics required when rendering raster images. It is recommended not to combine elements with even and odd numbered SIZE parameters, as this tends to produce larger irregularities.




Fig. 4: Construction of Point Symbols



Construction of Line Symbols
For displaying line geometries, you specify the width of the lines using the WIDTH parameter and the colour using the COLOR parameter. If no colour is specified, the line will not be rendered. If no width is specified, a thin line (one unit (pixel) wide) will be rendered. The LINECAP, LINEJOIN and LINEJOINMAXSIZE parameters are used to specify how line ends and corners are to be rendered.

Overlaying lines
When combining several styles / symbols on a line, they will be positioned on the baseline which is defined by the geometry of the object. In most cases MapServer correctly centers symbols. The combination of a line displayed in 16 units width and overlaid with a 10 unit width line, results in a line symbol with a 3 unit border. If the cartographical symbol is to contain a centered line with a width of 1 pixel, then the widths should be reconfigured, for example to 11 and 17 units. As a rule of thumb don't combine even numbered and odd numbered widths.

Use of the PATTERN and GAP parameters
The PATTERN and GAP parameters can be used to produce styled lines in MapServer.
To create line patterns, use the PATTERN parameter of the STYLE. Here you define dashes by specifying the length of the first dash, followed by the length of the first gap, then the length of the second dash, followed by the second gap, and so on. This pattern will be repeated as many times as that pattern will fit into the line. LINECAP can be used to control how the ends of the dashes are rendered. LINEJOIN can be used to control how sharp bends are rendered. In the left column of the figure, you will find three examples where PATTERN has been used. Number 2 from below uses LINECAP butt, number 3 from below uses LINECAP round (and LINEJOIN miter) and number 4 from below uses LINECAP butt (and is overlaid over a wider, dark grey line). To produce dots, use 0 for dash length with LINECAP 'round'.
Styled lines can be specified using GAP and a symbol for styling. In the figure, you will find examples where GAP has been used (in the right column). At the bottom a SYMBOL of TYPE ellipse has been used, then a SYMBOL of TYPE vector, then a SYMBOL of TYPE font and then a SYMBOL of TYPE pixmap. To control the placement of the symbols relative to the line (to get asymmetrical styling), use SYMBOL ANCHORPOINT (as explained later).


The following figure shows how to use styles to define different kinds of line symbols.
• PATTERN usage is demonstrated in the 2nd, 3rd, 4th and 5th symbol from the bottom in the left column.
• GAP usage is demonstrated in the 2nd symbol from the bottom in the left column and all the symbols in the right column.
• negative GAP value usage is demonstrated in the all the symbols in the right column, except for the one at the bottom.
• INITIALGAP usage is demonstrated in the 2nd and 5th symbol from the bottom in the left column.
• STYLE OFFSET usage is demonstrated in the 5th symbol from the bottom in the right column
Below you will find the SYMBOLs and STYLEs that were used to produce the line symbols in "Construction of Line Symbols". The LAYERs are ordered from bottom to top of the figure.
Styles and symbols for lines





Fig. 5: Construction of Line Symbols



























(continues on next page)





2.8 0
0 0
END # POINTS
ANCHORPOINT 0.5 0
END # SYMBOL

SYMBOL
NAME "o-flag-trans"
TYPE pixmap
IMAGE "o-flag-trans.png"
END # SYMBOL

######## Left column ###############

LAYER	# Simple line STATUS DEFAULT TYPE LINE
FEATURE
POINTS
5 5
25 10
45 10
35 5
END # Points
END # Feature
CLASS
STYLE
COLOR 0 0 0
WIDTH 6.5
END # STYLE
END # CLASS
END # LAYER

LAYER	# Dashed line with symbol overlay
STATUS DEFAULT TYPE LINE FEATURE
POINTS
5 15
25 20
45 20
35 15
END # Points
END # Feature
CLASS
STYLE
COLOR 0 0 0
WIDTH 5.0
  PATTERN 40 10 END END # STYLE
STYLE
SYMBOL "circlef"

(continued from previous page)





















































(continues on next page)





COLOR 0 0 0
SIZE 8
INITIALGAP 20
GAP 50
END
END # CLASS
END # LAYER

LAYER	# Dashed line, varying
STATUS DEFAULT TYPE LINE FEATURE
POINTS
5 25
25 30
45 30
35 25
END # Points
END # Feature
CLASS
STYLE
COLOR 0 0 0
WIDTH 5.0
LINECAP round #[butt|round|square|triangle] LINEJOIN miter #[round|miter|bevel] LINEJOINMAXSIZE 3
PATTERN 40 17 0 17 0 17 0 17 END
END # STYLE
END # CLASS
END # LAYER

LAYER	# Line dash overlay
STATUS DEFAULT TYPE LINE FEATURE
POINTS
5 35
25 40
45 40
35 35
END # Points
END # Feature
CLASS
STYLE
COLOR 102 102 102
WIDTH 4.0
END # STYLE
STYLE
COLOR 255 255 255
WIDTH 2.0 LINECAP BUTT PATTERN 8 12 END

(continued from previous page)





















































(continues on next page)





END # STYLE
END # CLASS
END # LAYER

LAYER	# Line dashed with dashed overlay
STATUS DEFAULT TYPE LINE FEATURE
POINTS
5 45
25 50
45 50
35 45
END # Points
END # Feature
CLASS
STYLE
COLOR 0 0 0
WIDTH 16.0
  PATTERN 40 20 20 20 10 20 END END # STYLE
STYLE
COLOR 209 66 0
WIDTH 12.0
INITIALGAP 2
  PATTERN 36 24 16 24 6 24 END END # STYLE
END # CLASS
END # LAYER

LAYER	# Line overlay - 3
STATUS DEFAULT TYPE LINE FEATURE
POINTS
5 55
25 60
45 60
35 55
END # Points
END # Feature
CLASS
STYLE
COLOR 0 0 0
WIDTH 17.0
END # STYLE
STYLE
COLOR 209 66 0
WIDTH 11.0
END # STYLE
STYLE
COLOR 0 0 0

(continued from previous page)





















































(continues on next page)





WIDTH 1.0
END # STYLE
END # CLASS
END # LAYER

######## right column ############

LAYER	# Line - ellipse overlay
STATUS DEFAULT TYPE LINE FEATURE
POINTS

50570109010805  END # Points END # Feature CLASS
STYLE
COLOR 0 0 0
WIDTH 3.6
END # STYLE
STYLE
COLOR 0 0 0
SYMBOL "circlef"
SIZE 10
GAP 42
END # STYLE
STYLE
COLOR 255 0 0
SYMBOL "circlef"
SIZE 3
GAP 42
END # STYLE
END # CLASS
END # LAYER

LAYER	# Line - symbol overlay
STATUS DEFAULT TYPE LINE FEATURE
POINTS

5015702090208015  END # Points END # Feature CLASS
STYLE
COLOR 0 0 0

(continued from previous page)





















































(continues on next page)





  WIDTH 2.8 END # STYLE STYLE
COLOR 0 0 0
SYMBOL "vertline"
SIZE 10.0
ANGLE 30
GAP -50
END # STYLE
STYLE
COLOR 255 0 0
SYMBOL "circlef"
SIZE 3
GAP 50
END # STYLE
END # CLASS
END # LAYER

LAYER	# Line - font overlay
STATUS DEFAULT TYPE LINE FEATURE
POINTS

5025703090308025  END # Points END # Feature CLASS
STYLE
COLOR 0 0 0
WIDTH 6
END # STYLE
STYLE
COLOR 102 0 0 SYMBOL "P" SIZE 20
GAP -30
END # STYLE
STYLE
COLOR 255 0 0
SYMBOL "circlef"
SIZE 3
GAP 30
END # STYLE
END # CLASS
END # LAYER

LAYER	# Line - pixmap overlay
STATUS DEFAULT
TYPE LINE

(continued from previous page)





















































(continues on next page)





FEATURE POINTS
5035704090408035  END # Points END # Feature CLASS
STYLE
COLOR 0 0 0
WIDTH 6
END # STYLE
STYLE
COLOR 102 0 0
SYMBOL "o-flag-trans"
SIZE 20
GAP -30
END # STYLE
STYLE
COLOR 255 0 0
SYMBOL "circlef"
SIZE 3
GAP 30
END # STYLE
END # CLASS
END # LAYER

LAYER	# Line - pixmap overlay
STATUS DEFAULT TYPE LINE FEATURE
POINTS

5045705090508045  END # Points END # Feature CLASS
STYLE
COLOR 0 0 0
WIDTH 6
END # STYLE
STYLE
COLOR 102 0 0
SYMBOL "o-flag-trans"
SIZE 20
GAP -30
OFFSET -10 -99
END # STYLE
STYLE

(continued from previous page)





















































(continues on next page)



(continued from previous page)

LINECAP
By default, all lines (and patterns) will be drawn with rounded ends (extending the lines slightly beyond their ends). This effect gets more obvious the larger the width of the line is. It is possible to alter this behaviour using the LINECAP parameter of the STYLE. LINECAP butt will give butt ends (stops the line exactly at the end), with no extension of the line. LINECAP square will give square ends, with an extension of the line. LINECAP round is the default.

LINEJOIN
The different values for the parameter LINEJOIN have the following visual effects. Default is round. miter will follow line borders until they intersect and fill the resulting area. none will render each segment using linecap butt. The figure below illustrates the different linejoins.


Fig. 6: Different kinds of linejoins

LINEJOINMAXSIZE (only relevant for LINEJOIN miter)
Specify the maximum length of miter linejoin factor m (see the figure below). The value is a multiplication factor (default 3).
The max length of the miter join is calculated as follows (d is the line width, specified with the WIDTH parameter of the STYLE):

If m > m_max, then the connection length will be set to m_max.

Use of the OFFSET parameter
In STYLE, an OFFSET parameter can be set to shift symbols in the X and Y direction. The displacement is not influenced by the direction of the line geometry. Therefore the point symbols used for styling are all shifted in the same direction, independent of the direction of the line (as defined in style number 2 in the map file example below - red line in the map image). A positive X value shifts to the right. A positive Y value shifts downwards.
To generate lines that are shifted relative to the original lines, -99 has to be used for the Y value of the OFFSET. Then the X value defines the distance to the line from the original geometry (perpendicular to the line). A positive X value will shift to the right (when viewed in the direction of the line), a negative X value will shift to the left.





Fig. 7: Miter linejoin

The example below shows how OFFSET works with the use of -99 (blue and green lines) and without the use of -99 (red line). The thin black line shows the location of the line geometry.


Fig. 8: Use of the OFFSET parameter with lines - map image

















(continues on next page)



(continued from previous page)

Asymmetrical line styling with point symbols
Line number 2 and 5 from the bottom in the right column of the "Construction of Line Symbols" figure are examples of asymmetrical line styling using a point symbol. This can be achieved either by using an OFFSET (with a Y value of -99), or by using ANCHORPOINT, as described in the tricks section below. Line number 2 from the bottom can be produced using ANCHORPOINT - this is the best method for placing symbols on lines. Line number 5 from the bottom is produced using STYLE OFFSET. As can be seen, the symbols are here rendered on the offset line, meaning that at sharp bends, some symbols will be placed far away from the line.

Area Symbols
Areas (polygons) can be filled with full colour. Areas can also be filled with symbols to create for instance hatches and graticules.
The symbols are by default used as tiles, and rendered (without spacing) one after the other in the x and y direction, filling the whole polygon.
If the SIZE parameter is used in the STYLE, the symbols will be scaled to the specified height. The GAP parameter of the STYLE can be used to increase the spacing of the symbols.
The AGG renderer uses anti-aliasing by default, so edge effects around the symbols can occur.

Hatch fill
Simple line hatches (e.g. horizontal, vertical and diagonal) can be created by filling the polygon with a hatch symbol.
The SIZE parameter in the STYLE that uses a SYMBOL of type hatch specifies the distance from center to center between the lines (the default is 1). The WIDTH parameter specifies the width of the lines in the hatch pattern (default is 1). The ANGLE parameter specifies the direction of the lines (default is 0 - horizontal lines). Since version 6.2, the PATTERN parameter can be used to create hatches with dashed lines.
The figure demonstrates the use of SIZE (bottom left); WIDTH (bottom right); ANGLE, PATTERN and SIZE (top left); and overlay (top right) of hatches.
The code below shows excerpts of the map file that was used to produce the figure. First, the SYMBOL definition:





Fig. 9: Hatch examples


Then the CLASS definitions:






















(continues on next page)



(continued from previous page)

Polygon fills with symbols of TYPE pixmap
Polygons can be filled with pixmaps.


Pixmap symbols can be rotated using the ANGLE parameter, but for polygon fills, this produces strange effects, and is not recommended.
To create complex area symbols, e.g. with defined distances between single characters or hatches with broad lines, pixmap fill is probably the best option. Depending on the desired pattern you have to generate the raster image with high precision using a graphical editor. The figure below is an example of how to obtain a regular allocation of symbols with defined spacing.
You can use other shapes than circles. B defines the width and H the height of the raster image. For a regular arrange-







Fig. 10: Raster image for a regular symbol fill

ment of symbols in a 45 degree angle B = H. For symbols, which are regularly arranged in parallel and without offset between each other one centered symbol with the same x and y distances to the imageborder is enough.
The following figure shows an example of how you can design a pixmap to produce a hatch with wide lines. To create a 45 degree hatch use:





Fig. 11: Raster image for a hatched fill



The example below shows some pixmap symbols which can be used as area symbols with transparency. The raster images were created using FreeHand, finished with Photoshop and exported to PNG with special attention to the colour palette.

Table 2: Construction of a horizontally arranged area symbol

CLASS sectionSYMBOL definition
CLASS
SYMBOLSTYLENAME "in_the_star"COLOR 255 255 0TYPE PIXMAPENDIMAGE "stern.png"STYLETRANSPARENT 8SYMBOL "in_the_star"ENDENDSTYLEOUTLINECOLOR 0 0 0WIDTH 1ENDEND




Fig. 12: Polygon fill - regular grid pattern


Table 3: Construction of a diagonally arranged area symbol

CLASS sectionSYMBOL definition
CLASS
SYMBOLSTYLENAME "in_point1"SYMBOL "in_point1"TYPE PIXMAPENDIMAGE "flaeche1_1.png"STYLETRANSPARENT 13OUTLINECOLOR 0 0 0ENDWIDTH 1ENDEND


Fig. 13: Polygon fill - diagonal pattern Table 4: Construction of a hatch

CLASS sectionSYMBOL definition
CLASS
SYMBOLSTYLENAME "in_hatch"COLOR 255 255 0TYPE PIXMAPENDIMAGE "schraffur.png"STYLETRANSPARENT 2SYMBOL "in_hatch"ENDENDSTYLEOUTLINECOLOR 0 0 0WIDTH 1ENDEND
Polygon fills with symbols of TYPE vector
Polygons can be filled with symbols of TYPE vector. As for the other symbol fills, the pattern will be generated by using the specified symbol for the tiles. The bounding box of the symbol is used when tiling.





Fig. 14: Polygon fill - hatch

Creating vector symbols for polygon fills is done in much the same way as for pixmap symbols. Precision is necessary to get nice symmetrical symbols.
The upper left corner of the bounding box of a symbol of TYPE vector is always (0, 0) in the symbol's coordinate system. The lower right corner of the bounding box is determined by the maximum x and y values of the symbol definition (POINTS parameter). The fact that the upper left corner always is at (0,0) makes it convenient to construct symbols such as the dash signature found as number two from the bottom in the centre column of the example below.
Both polygon (FILLED true) and line (FILLED false) vector symbols can be used. For line symbols, the WIDTH
parameter of the STYLE will give the line width and the SIZE parameter will specify the height of the symbol.


STYLE ANGLE can be used for polygon fills, but will only rotate each individual symbol, not the pattern as a whole. It is therefore quite demanding to generate rotated patterns.
Below you will find some examples of vector symbols used for polygon fills. The polygon fill is accompanied by the vector symbol used for the fill. The center of the vector symbol is indicated with a red dot.

Excerpts from the map file for the polygon fill vector examples above
First, the LAYERs





















(continues on next page)


















Fig. 15: Polygon fills - vector



(continued from previous page)

LAYER	# x - line STATUS DEFAULT TYPE POLYGON FEATURE
POINTS
5 30
5 50
45 50
45 30
5 30
END # Points
END # Feature
CLASS
STYLE
SYMBOL "x-line"
COLOR 0 0 0
WIDTH 5
SIZE 35
END # STYLE
END # CLASS
END # LAYER

LAYER	# v polygon STATUS DEFAULT TYPE POLYGON FEATURE
POINTS
5 55
5 75
45 75
45 55
5 55
END # Points
END # Feature
CLASS
STYLE
SYMBOL "v-poly"
COLOR 0 0 0
SIZE 35
END # STYLE
END # CLASS
END # LAYER

LAYER	# Circles STATUS DEFAULT TYPE POLYGON FEATURE
POINTS
5 80
5 100
45 100
(continues on next page)





45 80
5 80
END # Points
END # Feature
CLASS
STYLE
SYMBOL "circlef"
COLOR 0 0 0
SIZE 20
GAP 25
END # STYLE
END # CLASS
END # LAYER

LAYER	# x polygon STATUS DEFAULT TYPE POLYGON FEATURE
POINTS

55555259525955555  END # Points END # Feature CLASS
STYLE
COLOR 0 0 0
SYMBOL "x-poly-fill"
SIZE 35
END # STYLE
END # CLASS
END # LAYER

LAYER	#  indistinct  marsh
STATUS DEFAULT TYPE POLYGON FEATURE
POINTS

55305550955095305530  END # Points END # Feature CLASS
STYLE
COLOR 0 0 255
SYMBOL "ind_marsh_poly"
SIZE 25

(continued from previous page)





















































(continues on next page)





END # STYLE
END # CLASS
END # LAYER

LAYER	# diagonal circles
STATUS DEFAULT TYPE POLYGON FEATURE
POINTS

55555575957595555555  END # Points END # Feature CLASS
STYLE
COLOR	255 230 51
SYMBOL "diag_dots"
SIZE 30
END # STYLE
END # CLASS
END # LAYER


LAYER	# diagonal holes in yellow
STATUS DEFAULT TYPE POLYGON FEATURE
POINTS

5580551009510095805580  END # Points END # Feature CLASS
STYLE
SYMBOL "diag_holes"
SIZE 30
COLOR 250 220 102
END # STYLE
END # CLASS
END # LAYER

LAYER	# v line + circle
STATUS DEFAULT TYPE POLYGON FEATURE
POINTS

(continued from previous page)





















































(continues on next page)





1005100251402514051005END #PointsEND # Feature
CLASS
STYLE
COLOR 255 0 0
SYMBOL "circlef"
SIZE 30
GAP 45
END # STYLE
STYLE
COLOR 0 0 0
SYMBOL "v-line" LINEJOIN miter LINECAP butt SIZE 35
WIDTH 10
GAP 45
END # STYLE
END # CLASS
END # LAYER

LAYER	# indistinct marsh + diagonal holes in yellow
STATUS DEFAULT TYPE POLYGON FEATURE
POINTS
100 30
100 50
140 50
140 30
100 30
END # Points
END # Feature
CLASS
STYLE
COLOR 0 0 255
SYMBOL "ind_marsh_poly"
SIZE 25
END # STYLE
STYLE
SYMBOL "diag_holes"
SIZE 30
COLOR 250 220 0
OPACITY 75
END # STYLE
END # CLASS
END # LAYER

(continued from previous page)





















































(continues on next page)



(continued from previous page)
Then the SYMBOLs:




















(continues on next page)





NAME "v-line" TYPE vector POINTS
0	0
5 10
10 0
END
END

SYMBOL
NAME "v-poly" TYPE vector FILLED false FILLED true POINTS
0	0
3.587 05.203.541.800 0   END END

SYMBOL
NAME "x-line" TYPE vector POINTS
0 0
1 1
-99 -99
0 1
1 0
END
END

SYMBOL
NAME "chess" TYPE vector FILLED true POINTS
0 0
10 0
10 10
0 10
0 0
-99 -99
10 10
20 10
20 20
10 20

(continued from previous page)





















































(continues on next page)





10 10
END
END

SYMBOL
NAME "x-poly-fill"
TYPE vector FILLED true POINTS
0	1.131
0	0
1.131 0
4.566 3.434
8	0
9.131 0
9.131 1.131
5.697 4.566
9.131 8
9.131 9.131
8	9.131
4.566 5.697
1.131 9.131
0	9.131
0	8
3.434 4.566
0	1.131
END # POINTS
END # SYMBOL

SYMBOL
NAME "ind_marsh_poly"
TYPE vector FILLED true POINTS
# Half line
0 2
4.5 2
4.5 3
0 3
0 2
-99 -99
# Half line
7 2
11.5 2
11.5 3
7 3
7 2
-99 -99
# Hole line
1.25 5
10.25 5
10.25 6

(continued from previous page)





















































(continues on next page)





1.25 6
1.25 5
END
END

SYMBOL
NAME "diag_dots" TYPE vector FILLED true POINTS

# Centralcircle:0.74500.45000.73650.51470.71150.57500.67180.62680.62000.66650.55970.69150.49500.70000.43030.69150.37000.66650.31820.62680.27850.57500.25350.51470.24500.45000.25350.38530.27850.32500.31820.27320.37000.23350.43030.20850.49500.20000.55970.20850.62000.23350.67180.27320.71150.32500.73650.38530.74500.4500-99 -990.250.00.24150.06470.21650.12500.17680.17680.12500.21650.06470.24150.00.250.00.00.250.0-99 -991 0.250.92520.24150.86490.21650.81320.17680.77340.1250
(continued from previous page)





















































(continues on next page)





0.74850.06470.740.01 0.01 0.25-99 -990.7410.74850.92520.77340.86490.81320.81320.86490.77340.92520.74851 0.741 10.741-99 -990.00.740.06470.74850.12500.77340.17680.81320.21650.86490.24150.92520.2510.010.00.74   END END

SYMBOL
NAME "diag_holes" TYPE vector FILLED true POINTS

0.00.0# Lefthalf circle0.00.240.06470.24850.12500.27340.17680.31320.21650.36490.24150.42520.250.50.24150.56470.21650.62500.17680.67680.12500.71650.06470.74150.00.75
0.0
1.0# Bottomhalf circle0.2410.24850.9252
(continued from previous page)





















































(continues on next page)



(continued from previous page)

0.27340.86490.31320.81320.36490.77340.42520.74850.50.740.56470.74850.62500.77340.67680.81320.71650.86490.74150.92520.751
1.0
1.0# Right
1 0.75half circle0.92520.74150.86490.71650.81320.67680.77340.62500.74850.56470.740.50.74850.42520.77340.36490.81320.31320.86490.27340.92520.24851 0.24
1.0
0.0# Tophalf circle0.750.00.74150.06470.71650.12500.67680.17680.62500.21650.56470.24150.50.250.42520.24150.36490.21650.31320.17680.27340.12500.24850.06470.240.0
0.0	0.0
END
END



Polygon outlines
Polygon outlines can be created by using OUTLINECOLOR in the STYLE. WIDTH specifies the width of the outline.

Dashed polygon outlines can be achieved by using OUTLINECOLOR, WIDTH and PATTERN (together with LINECAP, LINEJOIN and LINEJOINMAXSIZE). For more information on the use of PATTERN, see Use of the PATTERN and GAP parameters.

For some symbol types, it is even possible to style polygon outlines using OUTLINECOLOR, SYMBOL and GAP.


Examples (MapServer 4)
The examples in this section were made for MapServer 4.


The symbols were created with map files and symbol files (download_old_symbols). If you want to use these MAP files please note, that your MapServer must at least be able to handle 50 symbols, otherwise you will get an error while loading the symbol files.






Basic Symbols












Complex Symbols













Tricks
Changing the center of a point symbol
MapServer does all transformations (offset, rotation) with respect to the symbol anchor point. By default, the anchor point is calculated from the symbol's bounding box. In some cases it can be useful to change the anchor point of a symbol. Since version 6.2, this can be done using the SYMBOL ANCHORPOINT.
Here are some examples of what can be achieved by using the ANCHORPOINT mechanisms for point symbols and decorated lines. There are three examples in the illustration, and each example shows the result with and without the use of ANCHORPOINT. At the top, arrows are added to lines using GEOMTRANSFORM start / end. In the middle, tags are added to lines using GAP and ANGLE. At the bottom, a point symbol is shifted and rotated. The red dots represent the center points, and the blue dots the offsets.
Below you will find three tables that contain the SYMBOLs and the STYLE mechanisms that were used to generate the shifted symbols in the illustration.

















Fig. 16: Shifting trick



Table 5: Symbol tricks - shift - arrows

SYMBOLsLAYER STYLEs
SYMBOL
LAYER	# LineNAME "arrow-start"STATUS DEFAULTTYPE vectorTYPE LINEFILLED trueFEATUREPOINTSPOINTS0 0.420 803 0.440 853 060 855 0.870 803 1.6END # Points3 1.2END # Feature0 1.2CLASS0 0.4STYLEEND # POINTSCOLOR 0 0 0ANCHORPOINT 0 0.5WIDTH 15END # SYMBOLLINECAP buttSYMBOLEND # STYLENAME "arrow-end"STYLETYPE vectorGEOMTRANSFORM "start"FILLED trueCOLOR 0 255 0POINTSSYMBOL "arrow-start"0 0.4SIZE 15.03 0.4ANGLE AUTO3 0END # STYLE5 0.8STYLE3 1.6GEOMTRANSFORM "start"3 1.2COLOR 255 0 00 1.2SYMBOL "circlef"0 0.4SIZE 3END # POINTSEND # STYLEANCHORPOINT 1 0.5STYLEEND # SYMBOLGEOMTRANSFORM "end"COLOR 0 255 0SYMBOL "arrow-end"SIZE 15.0ANGLE AUTOEND # STYLESTYLEGEOMTRANSFORM "end"COLOR 255 0 0SYMBOL "circlef"SIZE 3END # STYLEEND # CLASSEND # LAYER


Table 6: Symbol tricks - shift - asymmetrical tags

SYMBOLsLAYER STYLEs
SYMBOL
LAYER	# Line - symbol overlayNAME "vert-line-shift"STATUS DEFAULTTYPE vectorTYPE LINEPOINTSFEATURE0 0POINTS0 1020 50END # POINTS40 55ANCHORPOINT 0.5 060 55END # SYMBOL70 50END # PointsSYMBOLEND # FeatureNAME "vert-line"CLASSTYPE vectorSTYLEPOINTSCOLOR 0 0 00 0WIDTH 40 10END # STYLEEND # POINTSSTYLEEND # SYMBOLCOLOR 0 0 0SYMBOL "vert-line-shift"SIZE 20.0WIDTH 3ANGLE 30GAP -50END # STYLESTYLECOLOR 255 0 0SYMBOL "circlef"SIZE 3GAP 50END # STYLEEND # CLASSEND # LAYER
	MapServer Documentation, Release 8.6.0



Table 7: Symbol tricks. Unshifted symbol (top) and shifted symbol

SYMBOLsSYMBOL
NAME "v-line" TYPE vector POINTS
0	0
5	10
10 0
END # POINTS
END # SYMBOL

SYMBOL
NAME "v-line-shift"
TYPE vector
POINTS
0	0
5	10
10	0
END # POINTS
ANCHORPOINT 0.5 0
END # SYMBOL
Shifting combined with rotation can also be used to good effect:



MapServer Documentation, Release 8.6.0


Table 8: Symbol tricks - shift plus rotation
SYMBOLsLAYER STYLEs
SYMBOL
LAYER # HoleNAME "circle"TYPE POINTTYPE ellipseSTATUS DEFAULTPOINTSFEATURE1 1POINTSEND # POINTS20 20FILLED trueEND # POINTSANCHORPOINT 0.5 0.5END # FEATUREEND # SYMBOLFEATUREPOINTSSYMBOL80 30NAME "stick"END # POINTSTYPE vectorEND # FEATUREPOINTSFEATURE-0.5 0.5POINTS0.5 0.550 800.51223 0.42274END # POINTS0.54774 0.35305END # FEATURE0.60305 0.29774CLASS0.67274 0.26223STYLE0.75 0.25SYMBOL "circle"0.82725 0.26223SIZE 250.89694 0.29774COLOR 102 102 1020.95225 0.35305OUTLINECOLOR 51 51 1020.98776 0.42274END1 0.5END0.98776 0.57725END # layer0.95225 0.646940.89694 0.70225LAYER # Methods0.82725 0.73776TYPE POINT0.75 0.75STATUS DEFAULT0.67274 0.73776PROCESSING "ITEMS=method"0.60305 0.70225FEATURE0.54774 0.64694POINTS0.51223 0.5772520 200.5 0.5END # POINTS-0.5 0.5ITEMS "1"END # POINTSEND # FEATUREFILLED trueFEATUREANCHORPOINT 0 0.5POINTSEND # SYMBOL20 20END # POINTSITEMS "5"END # FEATUREFEATUREPOINTS20 20END # POINTSITEMS "8"END # FEATUREFEATURE4.1. MapfilePOINTS13320 20END # POINTSITEMS "13"END # FEATURE


Mapfile changes related to symbols Version 6.2
The ANCHORPOINT SYMBOL parameter was added. The INITIALGAP STYLE parameter was added.
The GAP STYLE parameter's behaviour was modified to specify center to center spacing.
PATTERN support for symbols of TYPE hatch.

Version 6.0
Parameters related to styling was moved from the SYMBOL element to the STYLE element of CLASS (in LAYER):
PATTERN (introduced in 5.0, previously called STYLE), GAP, LINECAP, LINEJOIN, LINEJOINMAX- SIZE
The SYMBOL TYPE cartoline is no longer needed, and therefore not available in version 6.0.

Current Problems / Open Issues
GAP - PATTERN incompatibility
Creating advanced line symbols involving dashed lines is difficult due to the incompatibility of the dashed line mech- anisms (PATTERN ) and the symbol on line placement mechanisms (GAP). If GAP could be a list instead of a single number (and perhaps renaming it to GAPS or DISTANCES), it would solve the issue, since we already have the IN- TIALGAP parameter (that specifies the distance to the first symbol on the line - added in version 6.2).

GAP - not full support for 2D
GAP does not support two dimensions (relevant for polygon fills), so the same gap will have to be used for for the x and the y directions. The introduction of new parameters - GAPX and GAPY could be a solution to this.

The End
We hope that this document will help you to present your data in a cartographically nice manner with MapServer and explains some basics and possibilities of the concept of MapServer as well as some weaknesses. It would be great to put together a cartographical symbols library for the profit of everyone. This especially concerns truetype fonts, which have been developed for some projects and contain some typical signatures for cartographical needs.
You can also view the discussion paper for the improvement of the MapServer Graphic-Kernel (German only).

4.1.2 CLASS
BACKGROUNDCOLOR [r] [g] [b] | [hexadecimal string] Removed in version 8.0: Use CLASS STYLEs instead.
COLOR [r] [g] [b] | [hexadecimal string]
Removed in version 8.0: Use CLASS STYLEs instead.
DEBUG [on|off]
Enables debugging of the class object. Verbose output is generated and sent to the standard error output (STDERR) or the MapServer logfile if one is set using the LOG parameter in the WEB object. Must be an integer in the range 0 to 5.




See alsoDebugging MapServer
EXPRESSION [string]
Four types of expressions are now supported to define which class a feature belongs to: String comparisons, regular expressions, logical expressions, and string functions (see Expressions). If no expression is given, then all features are said to belong to this class.
• String comparisons are case sensitive and are the fastest to evaluate. No special delimiters are necessary although strings must be quoted if they contain special characters. (As a matter of good habit, it is recom- mended that you quote all strings). The attribute to use for comparison is defined in the LAYER CLASSITEM
parameter.
• Regular expression are limited using slashes (/regex/). The attribute to use for comparison is defined in the
LAYER CLASSITEM parameter.
• Logical expressions allow the building of fairly complex tests based on one or more attributes. Logical expressions are delimited by parentheses "(expression)". Attribute names are delimited by square brack- ets "[ATTRIBUTE]". Attribute names are case sensitive and must match the items in the shapefile. For
example:

The following logical operators are supported: =, >, <, <=, >=, =, or, and, lt, gt, ge, le, eq, ne, in, ~, ~*. As one might expect, this level of complexity is slower to process.
• One string function exists: length(). It computes the length of a string:

String comparisons and regular expressions work from the classitem defined at the layer level. You may mix expression types within the different classes of a layer.


FALLBACK [true|false]
Added in version 8.6.0.
Specifies whether the class should act as a fallback class. Default is false. A fallback class is applied if and only if none of the previously defined classes has been applied. This is similar in concept to the SLD ElseFilter.
GROUP [string]
Allows for grouping of classes. It is only used when a CLASSGROUP at the LAYER level is set. If the CLASS- GROUP parameter is set, only classes that have the same group name would be considered at rendering time. An example of a layer with grouped classes might contain:







(continues on next page)



(continued from previous page)
KEYIMAGE [filename]
Full filename of the legend image for the CLASS. This image is used when building a legend (or requesting a legend icon via MapScript or the CGI application).


LABEL
Signals the start of a LABEL object. A class can contain multiple labels (since MapServer 6.2).
LEADER
Added in version 6.2.
Signals the start of a LEADER object. Use this along with a LABEL object to create label leader lines.
MAXSCALEDENOM [double]
Minimum scale at which this CLASS is drawn. Scale is given as the denominator of the actual scale fraction, for example for a map at a scale of 1:24,000 use 24000. Implemented in MapServer 5.0, to replace the deprecated MAXSCALE parameter. Must be greater or equal to 0.

See alsoMap Scale
MAXSIZE [integer]
Removed in version 8.0: Use CLASS STYLEs instead.
METADATA
This keyword allows for arbitrary data to be stored as name value pairs.
MINFEATURESIZE [integer]
Minimum feature size (in pixels) at which a feature should be rendered. Must be greater than 0.
MINSCALEDENOM [double]
Maximum scale at which this CLASS is drawn. Scale is given as the denominator of the actual scale fraction, for



example for a map at a scale of 1:24,000 use 24000. Implemented in MapServer 5.0, to replace the deprecated
MINSCALE parameter. Must be greater or equal to 0.

See alsoMap Scale
MINSIZE [integer]
Removed in version 8.0: Use CLASS STYLEs instead.
NAME [string]
Name to use in legends for this class. If not set class won't show up in legend.
OUTLINECOLOR [r] [g] [b] | [hexadecimal string] Removed in version 8.0: Use CLASS STYLEs instead.
SIZE [integer]
Removed in version 8.0: Use CLASS STYLEs instead.
STATUS [on|off]
Sets the current display status of the class. Default turns the class on.
STYLE
Signals the start of a STYLE object. A class can contain multiple styles. Multiple styles can be used create complex symbols (by overlay/stacking). See Cartographical Symbol Construction with MapServer for more information on advanced symbol construction.
SYMBOL [integer|string|filename]
Removed in version 8.0: Use CLASS STYLEs instead.
TEMPLATE [filename]
Template file or URL to use in presenting query results to the user. See Templating for more info.
TEXT [string|expression]
Text to label features in this class with. This overrides values obtained from the LAYER LABELITEM. The string can contain references to feature attributes. This allows you to concatenate multiple attributes into a single label. You can for example concatenate the attributes FIRSTNAME and LASTNAME like this:

More advanced Expressions can be used to specify the labels. Since version 6.0, there are functions available for formatting numbers:



TITLE [string]
Text used for legend labelling.






VALIDATION
Signals the start of a VALIDATION block.
As of MapServer 5.4.0, VALIDATION blocks are the preferred mechanism for specifying validation patterns for CGI param runtime substitutions. See Run-time Substitution.

4.1.3 CLUSTER


Description
Since version 6.0, MapServer has the ability to combine multiple features from a point layer into single (aggregated) features based on their relative positions. Only POINT layers are supported. This feature was added through rfc69.

Supported Layer Types
Only layers of TYPE POINT are supported.

Mapfile Parameters
MAXDISTANCE [double]
Specifies the distance of the search region (rectangle or ellipse) in pixel positions. Must be greater than 0.
REGION [string]
Defines the search region around a feature in which the neighbouring features are negotiated. Can be 'rectangle' or 'ellipse'.
BUFFER [double]
Defines a buffer region around the map extent in pixels. Default is 0. Using a buffer allows that the neighbouring shapes around the map are also considered during the cluster creation.



GROUP [string]
This expression evaluates to a string and only the features that have the same group value are negotiated. This parameter can be omitted. The evaluated group value is available in the 'Cluster_Group' feature attribute.
FILTER [string]
We can define the FILTER expression filter some of the features from the final output. This expression evaluates to a boolean value and if this value is false the corresponding shape is filtered out. This expression is evaluated after the the feature negotiation is completed, therefore the 'Cluster_FeatureCount' parameter can also be used, which provides the option to filter the shapes having too many or to few neighbors within the search region.

Supported Processing Options
The following processing options can be used with the cluster layers:
CLUSTER_GET_ALL_SHAPES=ON
Return all shapes contained by a cluster instead of a single shape. This setting affects both the drawing and the query processing (especially useful for GetFeatureInfo requests). Example usage: PROCESSING "CLUS- TER_GET_ALL_SHAPES=ON"
CLUSTER_KEEP_LOCATIONS=ON
Set whether the location of the cluster shape should be preserved (setting this will show all points in the cluster). Example usage: PROCESSING "CLUSTER_KEEP_LOCATIONS=ON"
CLUSTER_ALGORITHM=SIMPLE
From MapServer 6.2 we can choose a more simplified clustering algorithm which performs better that the original (more accurate) approach. usage: PROCESSING "CLUSTER_ALGORITHM=SIMPLE" For more information see:
Bug 5503
CLUSTER_USE_MAP_UNITS=ON
Provide scale independent clustering (maxdistance and the buffer parameters are specified in map units). Exam- ple usage: PROCESSING "CLUSTER_USE_MAP_UNITS=ON"
ITEMS
Specify the feature attributes in the cluster to expose during a query, separated by a comma. Example usage:
PROCESSING "ITEMS=attribute_x,attribute_y,attribute_z"

Mapfile Snippet


















(continues on next page)



(continued from previous page)

Feature attributes
The clustered layer itself provides the following aggregated attributes:
1. Cluster_FeatureCount - count of the features in the clustered shape
2. Cluster_Group - The group value of the cluster (to which the group expression is evaluated)


These attributes (in addition to the attributes provided by the original data source) can be used to configure the labels of the features and can also be used in expressions. The ITEMS processing option can be used to specify a subset of the attributes from the original layer in the query operations according to the user's preference.
We can use simple aggregate functions (Min, Max, Sum, Count) to specify how the clustered attribute should be calculated from the original attributes. The aggregate function should be specified as a prefix separated by ':' in the attribute definition, like: [Max:itemname]. If we don't specify aggregate functions for the source layer attributes, then the actual value of the cluster attribute will be non-deterministic if the cluster contains multiple shapes with different values. The Count aggregate function in fact provides the same value as Cluster_FeatureCount.

Handling GetFeatureInfo
If you want to allow WMS GetFeatureInfo on all features inside a cluster, you must 1) set the "wms_include_items" metadata as usual, and 2) set the following PROCESSING parameters in the layer:

So your layer might look like the following:


















(continues on next page)



(continued from previous page)

PHP MapScript Usage
The CLUSTER object is exposed through PHP MapScript. An example follows:


Example: Clustering Railway Stations
The following example uses a point datasource, in this case in KML format, to display clusters of railway stations. Two classes are used: one to style and label the cluster, and one to style and label the single railway station.


Mapfile Layer



























(continues on next page)





################################
# Class1: For the cluster symbol ################################ CLASS
NAME "Clustered Lightrail Stations" EXPRESSION ("[Cluster_FeatureCount]" != "1") STYLE
SIZE 30
SYMBOL "citycircle"
COLOR 255 0 0
END
LABEL
FONT scb
TYPE TRUETYPE
SIZE 8
COLOR 255 255 255 ALIGN CENTER PRIORITY 10
BUFFER 1 PARTIALS TRUE POSITION cc
END
END
################################
# Class2: For the single station ################################ CLASS
NAME "Lightrail Stations"
EXPRESSION "1"
STYLE
SIZE 30
SYMBOL "lightrail"
END
TEXT "[Name]"
LABEL
FONT scb
TYPE TRUETYPE
SIZE 8
COLOR 0 0 0
OUTLINECOLOR 255 255 255
ALIGN CENTER
PRIORITY 9
BUFFER 1 PARTIALS FALSE POSITION ur
END
END
# the following is used for a query
TOLERANCE 50
UNITS PIXELS
HEADER "../htdocs/templates/cluster_header.html"
FOOTER  "../htdocs/templates/cluster_footer.html"

(continued from previous page)





















































(continues on next page)



(continued from previous page)

Map Image


4.1.4 COMPOSITE
Background
Available since MapServer 7.0, the COMPOSITE block is used to achieve blending effects with MapServer.
Some cartographic renderings benefit from the addition of advanced blending modes, as explained in detail in Blend Modes. This functionality is essential for more pleasant renderings of raster hillshadings over vector surfaces. It is also useful for simulating different kinds of overprinting effects.

See alsorfc113
Performance is affected by advanced blending (all modes except src-over).

Parameters
COMPFILTER [string]
Added in version 7.2.
Name of the compositing filter. The primary purpose is to enable soft shadow and blurring effects, although other usages can exist or could be added in the future. Several compfilters can be placed after another to create



a combined effect. For example a blur and translate effect can be combined to make a soft shadow effect behind a feature.
The currently available filters are:
• blur(integer)
• translate(integer,integer)
• grayscale()
• blacken()
• whiten()
COMPOP [string]
Name of the compositing operator to use when blending the temporary image onto the main map image. See
https://en.wikipedia.org/wiki/Blend_modes. The default compositing operator is "src-over". Available operators are:
• clear
Both the color and the alpha of the destination are cleared. Neither the source nor the destination are
used. This is an unusual compose method that essentially ignores the overlay image completely, and just clears the background image.
• color-burn
Divides the inverted bottom layer by the top layer, and then inverts the result. This darkens the top
layer increasing the contrast to reflect the color of the bottom layer. The darker the bottom layer, the more its color is used.
• color-dodge
Divides the bottom layer by the inverted top layer. This lightens the bottom layer depending on the
value of the top layer: the brighter the top layer, the more its color affects the bottom layer. Blending any color with white gives white. Blending with black does not change the image.
• contrast*
• darken
Creates a image that retains the smallest components of the foreground and background pixels. If the
foreground pixel has the components r1, g1, and b1, and the background has r2, g2, b2, the resultant pixel is [min(r1,r2), min(g1,g2), min(b1,b2)]
• difference
Subtracts the bottom layer from the top layer or the other way round, to always get a positive value.
Blending with black produces no change, as values for all colors are 0. (The RGB value for black is 0,0,0.) Blending with white inverts the picture.

• dst


This operator does nothing. The source, or overlay image, is completely ignored and the destination, or background image, is left unchanged. The method's real use is as a means of 'turning off' an alpha composition operation in other image operators.

• dst-atop
The part of the source lying inside of the destination is composited onto the destination.
• dst-in
The part of the destination lying inside of the source replaces the destination. Areas not overlaid are
cleared. Will remove the overlay image's shape from the background image like a cookie cutter which cuts out a cookie's shape from cookie dough (result is the cookie).
• dst-out
The part of the destination lying outside of the source replaces the destination. Using the 'cookie



dough' metaphor of 'dst-in' the result of the 'dst-out' method is the dough that was left behind once a cookie has been cut out. It can be used to cut holes, or take bites out of the background image, using the shape of the overlay. Any color in the overlay is again completely ignored.
• dst-over
The destination is composited over the source and the result replaces the destination. Equivalent to
placing the source overlay image 'under' the destination. The result is that only the parts of our source or overlay image not hidden by the destination or background image will be visible as they peek out from underneath.
• exclusion
This is sort of an averaged difference. White on white will produce black (no difference), the same
with black on black. However grey on grey will produce a grey result. White and black naturally still produce white (maximum difference).
• hard-light
Hard Light is a combination of Multiply and Screen, each at half strength. Hard Light effects the blend
layer's relationship to the base layer in the same way Overlay effects the base layer's relationship to the blend layer.
• hsl-color (added in 8.4)
Creates a color with the hue and saturation of the source and the luminosity of the target. This preserves
the gray levels of the target and is useful for coloring monochrome images or tinting color images.
• hsl-hue (added in 8.4)
Creates a color with the hue of the source and the saturation and luminosity of the target.
• hsl-luminosity (added in 8.4)
Creates a color with the luminosity of the source and the hue and saturation of the target. This produces
an inverse effect to hsl-color
• hsl-saturation (added in 8.4)
Creates a color with the saturation of the source and the hue and luminosity of the target. Painting with
this mode onto a gray area produces no change.
• invert*
• invert-rgb*
• lighten
Lighten has the opposite action of Darken. It selects the maximum of each component from the fore-
ground and background pixels. If the foreground pixel has the components r1, g1, and b1, and the background has r2, g2, b2, the resultant pixel is [max(r1,r2), max(g1,g2), max(b1,b2)]
• minus*
Subtract the colors in the source image from the destination image. When transparency is involved,
opaque areas is subtracted from any destination opaque areas.
• multiply
A simple multiply of the two images. Its formula is: [Src * Dest]. This means that if one of the images
is pure white, the result will be the other image. On the other hand if one image is black the result will be black. Between these extremes one image will darken the destination image by the amount given. Note that 'Multiply' will only darken an image, it will never brighten it. That is, it 'attenuates' an image toward black, which makes this compose method a 'Burn' style of composition.
• overlay
Overlay combines Multiply and Screen blend modes, at half strength. The parts of the top layer where
the base layer is light become lighter, the parts where the base layer is dark become darker. Areas where the top layer are mid grey are unaffected.




• plus


The source is added to the destination and replaces the destination. This operator is useful for averaging or a controlled merger of two images, rather than a direct overlay.

• screen
The source and destination are complemented and then multiplied and then replace the destination.
The resultant color is always at least as light as either of the two constituent colors. Screening any color with white produces white. Screening any color with black leaves the original color unchanged.
• soft-light
Soft light is most closely related to Overlay and is only similar to Hard Light by name. Will add
highlights and shadows to an existing color image. However, the colors of the destination image are modified to produce a softer contrast, and smoother gradient in lighting effects.

• src


The source is copied to the destination. The destination is not used as input, though it is cleared. This operator completely replaces the background image with the overlay image. The colors and trans- parency in the background are completely junked leaving a blank image the same size as the original destination over which is applied the source image.

• src-atop
The part of the source lying inside of the destination is composited onto the destination. Like 'src-over'
but limits the result to the original shape of the background image. In other words, the alpha channel on the destination is unchanged but the image colors are overlaid by any non-transparent parts of the source image. If the background image is fully opaque (no transparency), this operation will act exactly like the normal 'src-over' composition. It only differs when the background contains transparency which also clips the overlay. What makes this useful is for overlaying lighting and shading effects that are limited to the object (shape) of the destination.
• src-in
The part of the source lying inside of the destination replaces the destination.
• src-out
The part of the source lying outside of the destination replaces the destination.
• src-over
The source is composited over the destination. This is the default composite option if no other is
specified.

• xor


The part of the source that lies outside of the destination is combined with the part of the destination that lies outside of the source. Source or Destination, but not both.

Operators marked with a star (*) will only be supported when using an AGG backends and when pixman support is not enabled, and will fall back to "src-over" when this is not the case.
OPACITY [integer]
Sets the opacity level (or the inability to see through the layer) of all classed pixels for a given layer. Must be between 0 to 100. A value of 100 is opaque and 0 is fully transparent.

Usage
Simple transparency / opacity is achieved by only specifying the OPACITY parameter (this achieves the same effect as the legacy LAYER OPACITY parameter):




(continues on next page)



(continued from previous page)
The darkening effect is achieved by adding the COMPOP parameter with the value darken:


4.1.5 CONFIG
As of MapServer 8.0, MapServer has a required global configuration file, implemented through RFC 135, which aims to make configuring MapServer both more secure and straight forward. The configuration file path can be set using the environment variable MAPSERVER_CONFIG_FILE. A default location can also be set at compile time, for different distributions.




If MapServer cannot find the config file, an error is returned such as:



The configuration file is loaded by the MapServer CGI at runtime and provides site-level configuration for all mapfiles. The configuration file has 3 sections detailed below.
ENV
This block allows for environment variables to be stored as name value pairs - see the Environment Variables page for all available options. Prior to the introduction of the configuration file support of environment variables varied between different platforms.







MAPS
This block allows for aliases to be mapped to mapfile paths. If the MS_MAP_NO_PATH environment variable is set then only these aliases can be used in the map= CGI parameter.
Aliases are case-insensitive - "ITASCA" and "Itasca" are handled identically.
The use of aliases also helps to simplify OGC API : Features URLs, for example the alias itasca can be used in the place of a mapfile path in a URL for example: http://localhost/mapserver/itasca/ogcapi/collections.
As of MapServer 8.2 all types of MapServer requests can use keys from the MAPS block in the config file as part of a URL for example http://localhost/itasca/?request=WMS&...

PLUGINS
This block allows for keys to be mapped to plugin library paths. For example the MS SQL Plugin. This registry of plugins avoids possible unsafe libraries being loaded by a mapfile.

A full sample config file is shown below:














(continues on next page)



(continued from previous page)
MS_MAP_PATTERN "^/opt/mapserver" ## required when referencing mapfiles by path # MS_MAP_BAD_PATTERN "[/\\\\]{2}|[/\\\\]?\\.+[/\\\\]|,"

#
# Global Log/Debug Setup #
# MS_DEBUGLEVEL "5"
#  MS_ERRORFILE  "/opt/mapserver/logs/mapserver.log"

#
# Proj Library #
#  PROJ_DATA  "/usr/local/share/proj"

#
# Default Map #
#  MS_MAPFILE  "/opt/mapserver/test/test.map"

# disable POST requests (allowed by default, any value will do) # MS_NO_POST "1"

#
# Other Options #
#  MS_ENCRYPTION_KEY  "/opt/mapserver/mykey.txt"
# MS_USE_GLOBAL_FT_CACHE 1 # use a global font cache
# MS_PDF_CREATION_DATE "01/02/2022" # PDF create date metadata # MS_MAPFILE_PATTERN "\.map$"
#  MS_XMLMAPFILE_XSLT  "/path/to/mapfile.xsl"
# MS_MODE "BROWSE" # default mode for CGI calls
# MS_OPENLAYERS_CSS_URL "//mapserver.org/lib/10.4.0/ol-mapserver.css" # default value # MS_OPENLAYERS_JS_URL "//mapserver.org/lib/10.4.0/ol-mapserver.js" # default value
# MS_TEMPPATH "/tmp"
# MS_MAX_OPEN_FILES 200 # maximum number of open files allowed on Windows
# MS_WMS_ERROR_STATUS_CODE "ON"	# enable HTTP status code 4xx and 5xx in case of?
??errors on WMS requests
END

#
# Map aliases #
MAPS
TEST_MAPFILE "/opt/mapserver/test/test.map"
END

END


4.1.6 Display of International Characters in MapServer
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2020-10-28


Credit
Initial functionality was added to MapServer 4.4.0 as a part of a project sponsored by the Information-technology Promotion Agency (IPA), in Japan. Project members included: Venkatesh Raghavan, Masumoto Shinji, Nonogaki Susumu, Nemoto Tatsuya, Hirai Naoki (Osaka City University, Japan), Mario Basa, Hagiwara Akira, Niwa Makoto, Mori Toru (Orkney Inc., Japan), and Hattori Norihiro (E-Solution Service, Inc., Japan).

Related Links
• MapServer ticket:858 (original implementation)
• RFC 103: Layer Level Character Encoding changes in MapServer 7
• MapServer ticket:4758 (MapServer 7 updates)

Requirements
• MapServer >= 4.4.0 (MapServer >= 7.0 for layer-level encoding)
• MapServer compiled with the libiconv library






How to Enable in Your Mapfile (MapServer >= 7.0)
The MapServer 7.0 release contained changes in how MapServer handles encoding; new in 7.0 is that encoding is set at the LAYER level. This makes it much easier to manage having multiple layers in different encodings, in the same mapfile. The reason for this change was that the encoding of a dataset affects the whole layer, not only the labels. MapServer 7 will also convert any strings into UTF8 in the background, and any output (such as through OGC GetCapabilities, GetFeature, or queries) will be returned in UTF8.
The mapfile LAYER object's ENCODING parameter accepts the encoding name as its parameter.
MapServer uses GNU's libiconv library to deal with encodings. The libiconv web site has a list of supported encodings. One can also use the "iconv -l" command on a system with libiconv installed to get the complete list of supported encodings on that specific system.


Step 1: Verify ICONV Support and MapServer Version
Execute mapserv -v at the commandline, and verify that your MapServer version >= 7.0 and it includes SUP- PORTS=ICONV, such as:


Step 2: Verify That Your Files' Encoding is Supported by ICONV
Since MapServer uses the libiconv library to handle encodings, you can check the list of supported encodings here: https://www.gnu.org/software/libiconv/
Unix users can also use the iconv -l command on a system with libiconv installed to get the complete list of supported encodings on that specific system.



Step 3: Add ENCODING Parameter to your LAYER Object
Now you can simply add the ENCODING parameter to your mapfile LAYER object, such as:









Step 4: Test with the map2img utility
• see map2img commandline utility


How to Enable in Your Mapfile (MapServer < 7.0)
Older MapServer versions only allowed encoding to be set at the LABEL level in the mapfile.

Add ENCODING Parameter to your LABEL Object
Add the ENCODING parameter to your mapfile LABEL object, such as:







(continues on next page)



(continued from previous page)
Here is an example layer using the encoding set at the LABEL level:


Example Using PHP MapScript
For PHP Mapscript, the Encoding parameter is included in the LabelObj Class (for MapServer < 7), so that the encoding parameter of a layer can be modified such as:















(continues on next page)



(continued from previous page)

Notes


4.1.7 Expressions
Author
Dirk Tilger
Contact
dirk at MIRIUP.DE
Author
Umberto Nicoletti
Contact
umberto.nicoletti at gmail.com
Last Updated
2018-08-24

Contents• Expressions
- Introduction
* String quotation
* Quotes escaping in strings
* Using attributes
- Expression Types
- String comparison (equality)
- Regular expression comparison
- List expressions




Introduction
As of version 6.0, expressions are used in four places:
• In LAYER FILTER to specify the features of the dataset that are to be included in the layer.
• In CLASS EXPRESSION to specify to which features of the dataset the CLASS applies to.
• In CLASS TEXT to specify text for labeling features.
• In STYLE GEOMTRANSFORM.

String quotation
Strings can be quoted using single or double quotes:


Quotes escaping in strings



Starting with MapServer 5.0, if your dataset contains double-quotes, you can use a C-like escape sequence:

To escape a single quote use the following sequence instead:




Starting with MapServer 6.0 you don't need to escape single quotes within double quoted strings and you don't need to escape double quotes within single quoted strings. In 6.0 you can also write the string as follows:

To escape a single quote use the following sequence instead:


Using attributes
Attribute values can be referenced in the Map file and used in expressions. Attribute references are case sensitive and can be used in the following types of expressions:
• In LAYER FILTER
• In CLASS EXPRESSION
• In CLASS TEXT
Referencing an attribute is done by enclosing the attribute name in square brackets, like this: [ATTRIBUTENAME]. Then, every occurrence of "[ATTRIBUTENAME]" will be replaced by the actual value of the attribute "ATTRIBUTE- NAME".
Example: The data set of our layer has the attribute "BUILDING_NAME". We want the value of this attribute to appear inside a string. This can be accomplished as follows (single or double quotes):

For the building which has its BUILDING_NAME attribute set to "Historical Museum", the resulting string is:

For Raster Data layers special attributes have been defined that can be used for classification, for example:
• [PIXEL] . . . will become the pixel value as number
• [RED], [GREEN], [BLUE] . . . will become the color value for the red, green and blue component in the pixel value, respectively.

Expression Types
Expression are used to match attribute values with certain logical checks. There are three different types of expressions you can use with MapServer:
• String comparisons: A single attribute is compared with a string value.
• Regular expressions: A single attribute is matched with a regular expression.
• List expressions: Compare a string attribute to a list of multiple possible values
• Logical "MapServer expressions": One or more attributes are compared using logical expressions.

String comparison (equality)
String comparison means, as the name suggests, that attribute values are checked if they are equal to some value. String comparisons are the simplest form of MapServer expressions and the fastest option.



To use a string comparison for filtering a LAYER, both FILTERITEM and FILTER must be set. FILTERITEM is set to the attribute name. FILTER is set to the value for comparison. The same rule applies to CLASSITEM in the LAYER object and EXPRESSION in the CLASS object.
Example for a simple string comparison filter

would match all records that have the attribute "year" set to "2005". The rendered map would appear as if the dataset would only contain those items that have the "year" set to "2005".
Similarly, a classification for the items matched above would be done by setting the CLASSITEM in the LAYER and the EXPRESSION in the CLASS:

For reasons explained later, the values for both CLASSITEM and FILTERITEM should start with neither a '/' nor a '(' character.

Regular expression comparison
Regular expressions are a standard text pattern matching mechanism from the Unix world. The functionality of regular expression matching is provided by the operating system on UNIX systems and therefore slightly operating system dependent. However, their minimum set of features are those defined by the POSIX standard. The documentation of the particular regular expression library is usually in the "regex" manual page ("man regex") on Unix systems.
Regular expression with MapServer work similarly to string comparison, but allow more complex operation. They are slower than pure string comparisons, but might be still faster than logical expression. As for string comparison, when using a regular expressions, FILTERITEM (LAYER FILTER) or CLASSITEM (CLASS EXPRESSION ) has to be defined if the items are not included in the LAYER FILTER or CLASS EXPRESSION.
A regular expression typically consists of characters with special meanings and characters that are interpreted as they are. Alphanumeric characters (A-Z, a-z and 0-9) are taken as they are. Characters with special meanings are:
• . will match a single character.
• [ and ] are used for grouping. For example [A-Z] would match the characters A,B,C,...,X,Y,Z.
• {, }, and * are used to specify how often something should match.
• ^ matches the beginning, $ matches the end of the value.
   • The backslash \ is used to take away the special meaning. For example \$ would match the dollar sign. MapServer supports two regex operators:
• ~ case sensitive regular expression
• ~* case insensitive regular expression



The following LAYER configuration would have all records rendered on the map that have "hotel" in the attribute named "placename"



Example: Match records that have a value from 2000 to 2010 in the attribute "year":

Example: Match all the records that are either purely numerical or empty

Example: Match all the features where the name attribute ends with "by", "BY", "By" or "bY" (case insensitive matching):

Example: Match all the features where the rdname attribute starts with "Main".



List expressions
Added in version 6.4.
List expressions (see rfc95) are a performant way to compare a string attribute to a list of multiple possible values. Their behavior duplicates the existing regex or MapServer expressions, however they are significantly more performant. To activate them enclose a comma separated list of values between {}, without adding quotes or extra spaces.






WarningList expressions do not support quote escaping, or attribute values that contain a comma in them.
"MapServer expressions"
MapServer expressions are the most complex and depending how they are written can become quite slow. They can match any of the attributes and thus allow filtering and classification depending on more than one attribute. Besides pure logical operations there are also expressions that allow certain arithmetic, string and time operations.
To be able to use a MapServer expression for a FILTER or EXPRESSION value, the expression has to finally become a logical value.

Typing
The type of attributes and literals is determined as followed :
• Strings: enclosed in quote or single quote characters


• Numbers: no quoting


• Date-time: enclosed in backquote characters





Logical expressions
Logical expressions take logical values as their input and return logical values. A logical expression is either 'true' or 'false'. The full expression needs to be surrounded by brackets, but individual logical expressions only require brackets to establish precedence or for clarity.
• ( Expression1 AND Expression2 )
( ( Expression1 ) AND ( Expression2 ) ) ( ( Expression1 ) && ( Expression2 ) )
returns true when both of the logical expressions (Expression1 and Expression2) are true.
• ( ( Expression1 ) OR ( Expression2 ) ) ( ( Expression1 ) || ( Expression2 ) )
returns true when at least one of the logical expressions (Expression1 or Expression2) is true.
• NOT ( Expression1 )
! ( Expression1 )
returns true when Expression1 is false.

String expressions that return a logical value
Syntactically, a string is something encapsulated in single or double quotes.
• ( "String1" eq "String2" )
( "String1" == "String2" ) - deprecated since 6.0 ( "String1" = "String2" )
returns true when the strings are equal. Case sensitive.
• ( "String1" =* "String2" )
returns true when the strings are equal. Case insensitive.
• ( "String1" != "String2" ) ( "String1" ne "String2" )
returns true when the strings are not equal.
• ( "String1" < "String2" ) ( "String1" lt "String2" )
returns true when "String1" is lexicographically smaller than "String2"
• ( "String1" > "String2" ) ( "String1" gt "String2" )
returns true when "String1" is lexicographically larger than "String2".
• ( "String1" <= "String2" ) ( "String1" le "String2" )
returns true when "String1" is lexicographically smaller than or equal to "String2"



• ( "String1" >= "String2" ) ( "String1" ge "String2" )
returns true when "String1" is lexicographically larger than or equal to "String2".
• ( "String1" IN "token1,token2,. . .,tokenN" )
returns true when "String1" is equal to one of the given tokens.


• ( "String1" ~ "regexp" )
returns true when "String1" matches the regular expression "regexp". This operation is identical to the regular expression matching described earlier.
• ( "String1" ~* "regexp" )
returns true when "String1" matches the regular expression "regexp" (case insensitive). This operation is iden- tical to the regular expression matching described earlier.

Arithmetic expressions that return a logical value
The basic element for arithmetic operations is the number. Arithmetic operations that return numbers will be covered in the next section.
• ( n1 eq n2 )
( n1 == n2 ) - deprecated since 6.0 ( n1 = n2 )
returns true when the numbers are equal.
• ( n1 != n2 ) ( n1 ne n2 )
returns true when the numbers are not equal.
• ( n1 < n2 ) ( n1 lt n2 )
returns true when n1 is smaller than n2.
• ( n1 > n2 ) ( n1 gt n2 )
returns true when n1 is larger than n2.
• ( n1 <= n2 ) ( n1 le n2 )
returns true when n1 is smaller than or equal to n2.
• ( n1 >= n2 ) ( n1 ge n2 )



returns true when n1 is larger than or equal to n2.
• ( n1 IN "number1,number2,. . .,numberN" )
returns true when n1 is equal to one of the given numbers.

Spatial expressions that return a logical value (GEOS)
• ( shape1 eq shape2 )
returns true if shape1 and shape2 are equal
• ( shape1 intersects shape2 ) Added in version 6.0.
returns true if shape1 and shape2 intersect
• ( shape1 disjoint shape2 ) Added in version 6.0.
returns true if shape1 and shape2 are disjoint
• ( shape1 touches shape2 ) Added in version 6.0.
returns true if shape1 and shape2 touch
• ( shape1 overlaps shape2 ) Added in version 6.0.
returns true if shape1 and shape2 overlap
• ( shape1 crosses shape2 ) Added in version 6.0.
returns true if shape1 and shape2 cross
• ( shape1 within shape2 ) Added in version 6.0.
returns true if shape1 is within shape2
• ( shape1 contains shape2 ) Added in version 6.0.
returns true if shape1 contains shape2
• ( shape1 dwithin shape2 ) Added in version 6.0.
returns true if the distance between shape1 and shape2 is equal to 0
• ( shape1 beyond shape2 ) Added in version 6.0.
returns true if the distance between shape1 and shape2 is greater than 0



String operations that return a string
• "String1" + "String2'
returns "String1String2", that is, the two strings concatenated to each other.

Functions that return a string
• tostring ( n1, "Format1" ) Added in version 6.0.
uses "Format1" to format the number n1 (C style formatting - sprintf).
• commify ( "String1" ) Added in version 6.0.
adds thousands separators (commas) to a long number to make it more readable
• upper ( "String1" ) Added in version 7.0.
force all characters to uppercase
• lower ( "String1" ) Added in version 7.0.
force all characters to lowercase
• initcap ( "String1" ) Added in version 7.0.
force the first character to uppercase and the rest of the characters to lower case for EACH word in the string.
• firstcap ( "String1" ) Added in version 7.0.
force the first character to uppercase and the rest of the characters to lower case in the first word in the string.

String functions that return a number
• length ( "String1" )
returns the number of characters of "String1"

Arithmetic operations and functions that return a number
• round ( n1 , n2 ) Added in version 6.0.
returns n1 rounded to a multiple of n2: n2 * round(n1/n2)
• round ( n1 )
Added in version 8.0.
returns n1 rounded to the closest integer (SLD interoperability addition)
• n1 + n2
returns the sum of n1 and n2



• n1 - n2
returns n2 subtracted from n1
• n1 * n2
returns n1 multiplied with n2
• n1 / n2>
returns n1 divided by n2
• -n1
returns n1 negated
• n1 ^ n2
returns n1 to the power of n2
• n1 % n2
returns n1 % n2 (the modulus operator). This returns the remainder after division of one number by another, for example 10 % 3 returns 1.


Spatial functions that return a number (GEOS)
• area ( shape1 ) Added in version 6.0.
returns the area of shape1

Spatial functions that return a shape (GEOS)
• fromtext ( "String1" ) Added in version 6.0.
returns the shape corresponding to String1 (WKT - well known text)

• buffer (shape1 , n1 ) Added in version 6.0.
returns the shape that results when shape1 is buffered with bufferdistance n1



• difference ( shape1 , shape2 ) Added in version 6.0.
returns the shape that results when the common area of shape1 and shape2 is subtracted from shape1

Temporal expressions
MapServer uses an internal time type to do comparison. To convert a string into this time type it will check the list below from the top and down to check if the specified time matches, and if so, it will do the conversion. The following are integer values: YYYY - year, MM - month, DD - date, hh - hours, mm - minutes, ss - seconds. The following are character elements of the format: - (dash) - date separator, : (colon) - time separator, T - marks the start of the time component (ISO 8601), space - marks the end of the date and start of the time component, Z - zulu time (0 UTC offset).
• 'YYYY-MM-DDThh:mm:ssZ'
• 'YYYY-MM-DDThh:mm:ss'
• 'YYYY-MM-DD hh:mm:ss'
• 'YYYY-MM-DDThh:mm'
• 'YYYY-MM-DD hh:mm'
• 'YYYY-MM-DDThh'
• 'YYYY-MM-DD hh'
• 'YYYY-MM-DD'
• 'YYYY-MM'
• 'YYYY'
• 'Thh:mm:ssZ'
• 'Thh:mm:ss'
For temporal values obtained this way, the following operations are supported:
• ( t1 eq t2 )
( t1 == t2 ) - deprecated since 6.0 ( t1 = t2 )
returns true when the times are equal.
• ( t1 != t2 ) ( t1 ne t2 )
returns true when the times are not equal.
• ( t1 < t2 ) ( t1 lt t2 )
returns true when t1 is earlier than t2
• ( t1 > t2 ) ( t1 gt t2 )
returns true when t1 is later than t2.



• ( t1 <= t2 ) ( t1 le t2 )
returns true when t1 is earlier than or equal to t2
• ( t1 >= t2 ) ( t1 ge t2 )
returns true when t1 is later than or equal to t2.

4.1.8 FEATURE
POINTS
A set of xy pairs terminated with an END, for example:



Multipart features can be created by adding further sets of points, for example:

ITEMS
Semicolon separated list of the feature attributes:



TEXT [string]
String to use for labeling this feature.
WKT [string]
A geometry expressed in OpenGIS Well Known Text geometry format. This feature is only supported if MapServer is built with OGR or GEOS support.








4.1.9 FONTSET
Author
Kari Guerts
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2020-10-22

FONTSET is a MAP parameter. The syntax is:

Where filename gives the location of the fontset file of the system. The location of the system fontset file could for instance be /usr/share/fonts/truetype/font.list (Debian) or C:/ms4w/apps/etc/fonts.txt (MS4W). The location can be specified using a relative or absolute path. Here is an example using relative paths (relative to the mapfile):


Format of the fontset file
The format of the fontset file is very simple. Each line contains 2 items: An alias and the name/path of the font separated by white space. The alias is simply the name you refer to the font as in your Mapfile (eg. times-bold). The name is the actual name of the TrueType file. If not full path then it is interpreted as relative to the location of the fontset. Here's the fontset I use (the font.list file and all .ttf files are stored in the same sub-directory).







(continues on next page)



(continued from previous page)

4.1.10 GEOMTRANSFORM - Geometry Transformations
Author
Håvard Tveite
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2022-08-14

Table of Contents• Transformations for simple styling (CLASS STYLE only)
- bbox
- centroid
- end and start
- vertices
• Labels (LABEL STYLE only)
- labelpnt and labelpoly


• Expressions and advanced transformations (LAYER and CLASS STYLE)
- Combining / chaining expressions
- buffer
- centerline
- densify
- generalize ([shape], tolerance)
- inner
- simplify([shape], tolerance)
- simplifypt([shape], tolerance)
- smoothsia ( [shape], smoothing_size, smoothing_iterations, preprocessing )
* Tuning the behaviour of smoothsia
* Dataset resolution is too high
* Dataset resolution is too low
* Curves
- outer
• Javascript transformation
- Introduction
- Usage
* Example 1. Simple Geomtransform
* Example 2. Printing logs in MapServer logs
- Basic API
* pointObj
* Constructor
* Members
* Methods
* lineObj
* Constructor
* Members
* Methods
* shapeObj
* Constructor
* Members
* Methods

Geometry transformations return a new geometry. The purpose of a geometry transformation can be to achieve special effects for symbol rendering and labeling.



Geometry transformation is available at the LAYER level and the STYLE level. At the LAYER level (since MapServer 6.4), the original vector geometry ("real world" coordinates) is used. At the STYLE level (since MapServer 6.0), pixel coordinates are used.
It may be useful to apply pixel values also at the LAYER level, and that is possible. If UNITS is defined in the LAYER, the [map_cellsize] variable can be used to convert to pixel values at the LAYER level:


Transformations for simple styling (CLASS STYLE only)
The following simple geometry transformations are available at the CLASS STYLE level:
• bbox
• centroid
• end
• start
• vertices

bbox
• GEOMTRANSFORM bbox returns the bounding box of the geometry.
- GEOMTRANSFORM "bbox"



Fig. 17: Geomtransform bbox

Class definitions for the example:




centroid
• GEOMTRANSFORM centroid returns the centroid of the geometry.
- GEOMTRANSFORM "centroid"



Fig. 18: Geomtransform centroid

Style definitions for the example:

Symbol definition for the circlef symbol:


end and start
• GEOMTRANSFORM end returns the end point of a line.
• GEOMTRANSFORM start returns the start point of a line.
- GEOMTRANSFORM "start"
- GEOMTRANSFORM "end" (since END is used to end objects in the map file, end must be embedded in quotes)
The direction of the line at the start / end point is available for rendering effects.







Fig. 19: Geomtransform start and end usage

Class definitions for the example.
Lower part of the figure:

Upper part of the figure:









(continues on next page)



(continued from previous page)
The startarrow symbol definition (endarrow is the same, except for ANCHORPOINT (value for endarrow: 1 0.5):


vertices
• GEOMTRANSFORM vertices produces the set of vertices of a line (with direction information).
- GEOMTRANSFORM "vertices"







Fig. 20: Geomtransform vertices

Class definitions for the example:

The vertline symbol definition:


Labels (LABEL STYLE only)
The following simple geometry transformations are available at the LABEL STYLE level:
• labelpnt
• labelpoly
These are used for label styling (background colour, background shadow, background frame).






labelpnt and labelpoly
• GEOMTRANSFORM labelpnt produces the geographic position the label is attached to. This corresponds to the center of the label text only if the label is in position CC.
- GEOMTRANSFORM "labelpnt"
• GEOMTRANSFORM labelpoly produces a polygon that covers the label plus a 1 pixel padding.
- GEOMTRANSFORM "labelpoly"


These transformations can be used to make background rectangles for labels and add symbols to the label points.


Fig. 21: Geomtransform labelpnt and labelpoly

Class definitions for the example:




















(continues on next page)



(continued from previous page)
Symbol definition for the circlef symbol:


Expressions and advanced transformations (LAYER and CLASS STYLE) Combining / chaining expressions
A geometry transformation produces a geometry, and that geometry can be used as input to another geometry transfor- mation. There are (at least) two ways to accomplish this. One is to combine basic geometry transformation expressions into more complex geometry transformation expressions, and another is to combine a geometry transformation expres- sion at the LAYER level with a geometry transformation expressions or a simple geometry transformation at the CLASS STYLE level.
Combining geometry transformation expressions A geometry transformation expression contains a [shape] part. The
[shape] part can be replaced by a geometry transformation expression. For example:
In this transformation, buffer is first applied on the geometry ([shape]). The resulting geometry is then used as input to simplify.
A style that demonstrates this:

The result of this transformation is shown at the top of the following figure (red line). The original polygon is shown with a full black line and the buffer with a dashed black line.
Combining expressions with simple geometry transformations Simple geometry transformations are only available for
CLASS STYLE, but can be combined with geometry transformation expressions at the LAYER level.



Excerpts from a layer definitions that does this kind of combination:

The result of this transformation is shown at the bottom of the following figure (the red lines). The result of the LAYER level geomtransform is shown with a full black line. The original polygon is the same as the one used at the top of the figure.


Fig. 22: Combining geomtransform expressions

buffer
• GEOMTRANSFORM buffer returns the buffer of the original geometry. The result is always a polygon geometry.
- GEOMTRANSFORM (buffer ([shape], buffersize))










Fig. 23: Geomtransform buffer

Some class definitions for the example. Lower part (polygon with buffers):
Upper right part (layer level geomtransform):








(continues on next page)



(continued from previous page)

centerline
Added in version 8.0: centerline()
• (centerline([shape]): Useful for labeling polygons, creates a centered line ([shape]) using a Voronoi diagram generated by GEOS and then additional simplification. Requires GEOS >= 3.5 Centerlines can only be computed for polygon shapes.
- an example showing a generated red centerline that is used to label lakes, from a polygon datasource lakes.db
(and uses densify() to add more verticies to the generated red line, so it follows the lake's shape) :













densify
Added in version 8.0: densify()
• (densify([shape],tolerance): Add more verticies to the feature ([shape]). Requires a positive tolerance value. Might be useful in combination with centerline() to add more verticies to the generated labeled line.

generalize ([shape], tolerance)
• GEOMTRANSFORM generalize simplifies a geometry ([shape]) in a way comparable to FME's ThinNoPoint algorithm. See https://trac.osgeo.org/gdal/ticket/966 for more information.
- GEOMTRANSFORM (generalize([shape], tolerance))
tolerance is mandatory, and is a specification of the maximum deviation allowed for the generalized line compared to the original line. A higher value for tolerance will give a more generalised / simplified line.




The figure below shows the result of applying generalize at the STYLE level with increasing values for tolerance (10 - green, 20 - blue and 40 - red).
One of the STYLE definitions for the example (tolerance 40):



(continues on next page)


Fig. 24: Geomtransform generalize

(continued from previous page)

inner
Added in version 8.0: inner()
• (inner([shape]): creates an inner corresponding ring from an input polygon, as a new [shape]

simplify([shape], tolerance)
• GEOMTRANSFORM simplify simplifies a geometry ([shape]) using the standard Douglas-Peucker algorithm.
- GEOMTRANSFORM (simplify([shape], tolerance))
tolerance is mandatory, and is a specification of the maximum deviation allowed for the generalized line compared to the original line. A higher value for tolerance will give a more generalised / simplified line.


The figure below shows the result of applying simplify at the STYLE level with increasing values for tolerance (10 - green, 20 - blue and 40 - red).
One of the STYLE definitions for the example (tolerance 40):

• an example showing a generated red centerline that is used to label a province, from a polygon datasource ns.db
(and uses simplify() to reduce the verticies in the generated line) :


Fig. 25: Geomtransform simplify







simplifypt([shape], tolerance)
• GEOMTRANSFORM simplifypt simplifies a geometry ([shape]), ensuring that the result is a valid geometry having the same dimension and number of components as the input. tolerance must be non-negative.
- GEOMTRANSFORM (simplifypt([shape], tolerance))
tolerance is mandatory, and is a specification of the maximum deviation allowed for the generalized line compared to the original line. A higher value for tolerance will give a more generalised / simplified line.


The figure below shows the result of applying simplifypt at the STYLE level with increasing values for tolerance (10 - green, 20 - blue and 40 - red).


                                   Fig. 26: Geomtransform simplifypt One of the STYLE definitions for the example (tolerance 40):





simplifypt




smoothsia ( [shape], smoothing_size, smoothing_iterations, preprocessing )
• GEOMTRANSFORM smoothsia returns a smoothed version of a line.
   - GEOMTRANSFORM (smoothsia ( [shape], smoothing_size, smoothing_iterations, preprocessing )) The following parameters are used:
- shape (mandatory). Specify the geometry to be used
- smoothing_size (optional). The window size (number of points) used by the algorithm. The default is 3.
- smoothing_iterations (optional). The number of iterations of the algorithm. The default is 1.
- preprocessing (optional). Preprocessing method to add more vertices to the geometry prior to smoothing, described below. There are two possible preprocessing methods:
* all Adds two intermediate vertices on each side of each original vertex. This is useful to preserve the general shape of the line with low resolution data.
* angle Add vertices at some specific places based on angle detection.


Example of a simple layer definition:

Here are some examples showing results with different parameter values.

Tuning the behaviour of smoothsia
smoothsia has several parameters that can be used to tune its behaviour. The following sections describe some cases / possibilities.











Fig. 27: Original geometry (left) and smoothsia with default parameters (right)














Fig. 28: Smoothsia - Larger window size (left) and larger window size with more iterations (right)



Dataset resolution is too high
If you are trying to smooth a line that has a very high resolution (high density of vertices at the current view scale), you may not get the expected result because the vertices are too dense for the smoothing window size. In this case you might want to simplify the geometries before the smoothing. You can combine smoothing and simplification in a single geomtransform for that:

See RFC 89: Layer Geomtransform for more info. Here's a visualization of the issue:


Fig. 29: High resolution geometry, smoothing and simplification

Dataset resolution is too low
If you are trying to smooth a long line that has a low density of vertices, you may not get the expected result in some situations. You may lose some important parts of the geometry during the smoothing, for instance around acute angles. You can improve the result by enabling a preprocessing step to add intermediate vertices along the line prior to smoothing.
This behavior is controlled using the all value in the preprocessing argument of the smoothsia geomtransform:

This preprocessing will be performed before the smoothing. It adds 2 intermediate vertices on each side of each original vertex. This is useful if we really need to preserve the general shape of the low resolution line. Note that this might have an impact on the rendering since there will be more vertices in the output.
Here's a visualization of the issue:

Curves
The preprocessing step might not be appropriate for all cases since it can impact the smoothing result significantly. However, without it, you might notice bad smoothing for curved lines with large distances between the line vertices. See this example:
You can improve that by enabling another type of preprocessing: angle. This one will add points at some specific places based on angle detection to recognize the curves. Here's how you can enable it:








Fig. 30: Effects of normal smoothing and preprocessing





Fig. 31: Effects of normal smoothing (without preprocessing)





Fig. 32: The use of angle with smoothsia



outer
Added in version 8.0: outer()
• (outer([shape]): creates an outer corresponding ring from an input polygon, as a new [shape]. This might be useful when you want to ignore islands when labeling a lake.

Javascript transformation
Author
Alan Boudreault
Contact
aboudreault at mapgears.com
Last Updated
2013-12-16

Introduction
Using GEOMTRANSFORM this way makes it possible to modify the geometry programmatically in addition to the built-in geomtransform functions.

Usage
Simply declare the javascript plugin this way:

The path can also be absolute.

The javascript plugin has to implement a function named geomtransform that will be automatically called. This function has to return a new shape. Note that only the geometry of this new shape will be used, so your original shape attributes will be preserved.
Access to the feature attributes is made through the shape.attributes javascript object. The following javascript functions are available:



• alert(str1, str2, . . . , str)
print some text in MapServer logs
• print(str1, str2, . . . , str)
print some text in MapServer logs
• require(path_to_lib1, path_to_lib2, . . . , path_to_lib)
include one or more javascript lib

Example 1. Simple Geomtransform
This example does a simple vertical translation . . .


Example 2. Printing logs in MapServer logs
Extends example 1 by printing information to the MapServer log.



Basic API
A minimal API is currently available to create a new shape.



pointObj Constructor


Members


TypeNameNotedoublexdoubleydoublezdoublem
Methods
void setXY(double x, double y[, double m])
Set the x,y[,m] values.
void setXYZ(double x, double y, double Z[, double m])
Set the x,y,z[,m] values.

lineObj Constructor


Members


TypeNameNoteintnumpointsread-only
Methods
pointObj point(int index)
Returns the point at the index position.
void add(pointObj point)
Add a point to the line.
void addXY(double x, double y[, double m])
Add point to the line from an x,y[,m] values.
void addXYZ(double x, double y, double Z[, double m])
Add point to the line from an x,y,z[,m] values.



shapeObj Constructor

'type' is one of shapeObj.Point, shapeObj.Line, shapeObj.Polygon or shapeObj.Null

Members


TypeNameNoteintnumvaluesread-onlyintnumlinesread-onlyintindexread-onlyinttyperead-onlyinttileindexread-onlyintclassindexread-onlytexttextobjectattributes
Methods
shapeObj clone()
Returns a clone of the shape.
lineObj line(int index)
Returns the line at the index position.
void add(lineObj line)
Add a line to the shape.
void setGeometry(shapeObj shape)
Replace the geometry of the object with the shape geometry.

4.1.11 GRID
Description
The GRID object can be used to add labeled graticule lines to your map. Initially developed in 2003 by John Novak, the GRID object is designed to be used inside a LAYER object to allow multiple GRID objects for a single map (allowing for example: a lat/long GRID, a State Plane GRID, and a UTM GRID to be displayed on the same map image).

Mapfile Parameters:
LABELFORMAT [DD|DDMM|DDMMSS|C format string]
Format of the label. "DD" for degrees, "DDMM" for degrees minutes, and "DDMMSS" for degrees, minutes, seconds. A C-style formatting string is also allowed, such as "%g°" to show decimal degrees with a degree symbol. The default is decimal display of whatever SRS you're rendering the GRID with.
MINARCS [double]
The minimum number of arcs to draw. Increase this parameter to get more lines. Optional. Must be greater than 0.
MAXARCS [double]
The maximum number of arcs to draw. Decrease this parameter to get fewer lines. Optional. Must be greater than 0.



MININTERVAL [double]
The minimum number of intervals to try to use. The distance between the grid lines, in the units of the grid's coordinate system. Optional. Must be greater than 0.
MAXINTERVAL [double]
The maximum number of intervals to try to use. The distance between the grid lines, in the units of the grid's coordinate system. Optional. Must be greater than 0.
MINSUBDIVIDE [double]
The minimum number of segments to use when rendering an arc. If the lines should be very curved, use this to smooth the lines by adding more segments. Optional. Must be greater than 0.
MAXSUBDIVIDE [double]
The maximum number of segments to use when rendering an arc. If the graticule should be very straight, use this to minimize the number of points for faster rendering. Optional, default 256. Must be greater than 0.

Example1: Grid Displaying Degrees






Example2: Grid Displaying Degrees with Symbol


























(continues on next page)



(continued from previous page)


Example3: Grid Displayed in Other Projection (Google Mercator)





















(continues on next page)



(continued from previous page)



4.1.12 IDENTIFY
Added in version 8.6.0.
Controls how vector features are identified, typically through WMS GetFeatureInfo or MODE=QUERY requests.
TOLERANCE [double]
Sensitivity for point based queries (i.e. via mouse and/or map coordinates). Given in TOLERANCEUNITS. If the layer is a POINT or a LINE, the default is 3. For all other layer types, the default is 0. To restrict polygon searches so that the point must occur in the polygon set the tolerance to zero. This setting does not apply to WFS GetFeature operations.



TOLERANCEUNITS  [pixels|feet|inches|kilometers|meters|miles|nauticalmiles|dd]
Units of the TOLERANCE value. Default is pixels.
CLASSAUTO
By default, identification of point features is based on their location, potentially extended with the radius defined by TOLERANCE value.
When setting the CLASSAUTO keyword, symbols from the style classes used to render the incoming WMS GetFeatureInfo request are used for more precise identification, by recognizing non-transparent pixels of the symbol.
The TOLERANCE value is also used to extend sensitive pixels beyond non-transparent pixels of the sym- bol.
This option is mutually exclusive with CLASSGROUP.
This option is currently only honoured on layers of type POINT using SYMBOL. Example:

CLASSGROUP [string]
By default, identification of point features is based on their location, potentially extended with the radius defined by TOLERANCE value.
When setting the CLASSGROUP keyword, symbols from the specified class's group are used for more precise identification, by recognizing non-transparent pixels of the symbol.
The CLASS object's GROUP parameter must be used in combination with CLASSGROUP.
The TOLERANCE value is also used to extend sensitive pixels beyond non-transparent pixels of the sym- bol.
This option is mutually exclusive with CLASSAUTO.
This option is currently only honoured on layers of type POINT using SYMBOL. Example:









(continues on next page)



(continued from previous page)


See alsooriginal Pull Request #7318
4.1.13 INCLUDE
When this directive is encountered parsing switches to the included file immediately. As a result the included file can be comprised of any valid mapfile syntax. For example:

Performance does not seem to be seriously impacted with limited use, however in high performance instances you may want to use includes in a pre-processing step to build a production mapfile. The C pre-processor can also be used (albeit with a different syntax) and is far more powerful.

Notes
• Supported in versions 4.10 and higher.
• The name of the file to be included MUST be quoted (single or double quotes).
• Includes may be nested, up to 5 deep.
• File location can be given as a full path to the file, or (in MapServer >= 4.10.1) as a path relative to the mapfile.


• Debugging can be problematic because:
1) the file an error occurs in does not get output to the user
2) the line number counter is not reset for each file. Here is one possible error that is thrown when the include file cannot be found:


Example







(continues on next page)



(continued from previous page)
where test_include_symbols.map contains:

and test_include_layer.map contains:


4.1.14 JOIN
Description
Joins are defined within a LAYER object. It is important to understand that JOINs are ONLY available once a query has been processed. You cannot use joins to affect the look of a map. The primary purpose is to enable lookup tables for coded data (e.g. 1 => Forest) but there are other possible uses.

Supported Formats
• DBF/XBase files
• CSV (comma delimited text file)
• PostgreSQL tables
• MySQL tables



Mapfile Parameters:
CONNECTION [string]
Parameters required for the join table's database connection (not required for DBF or CSV joins). The following is an example connection for PostgreSQL:

CONNECTIONTYPE [csv|mysql|postgresql]
Type of connection (not required for DBF joins). For PostgreSQL use postgresql, for CSV use csv, for MySQL use mysql.
FOOTER [filename]
Template to use after a layer's set of results have been sent. In other words, this header HTML will be displayed after the contents of the TEMPLATE HTML.
FROM [column]
Join column in the dataset. This is case sensitive.
HEADER [filename]
Template to use before a layer's set of results have been sent. In other words, this header HTML will be displayed before the contents of the TEMPLATE HTML.
NAME [string]
Unique name for this join. Required.
TABLE [filename|tablename]
For file-based joins this is the name of XBase or comma delimited file (relative to the location of the mapfile) to join TO. For PostgreSQL support this is the name of the PostgreSQL table to join TO.
TEMPLATE [filename]
Template to use with one-to-many joins. The template is processed once for each record and can only con- tain substitutions for columns in the joined table. Refer to the column in the joined table in your template like [joinname_columnname], where joinname is the NAME specified for the JOIN object.
TO [column]
Join column in the table to be joined. This is case sensitive.
TYPE  [ONE-TO-ONE|ONE-TO-MANY]
The type of join. Default is one-to-one.

Example 1: Join from Shapefile to DBF file Mapfile Layer













(continues on next page)



(continued from previous page)

Ogrinfo



Template




Example 2: Join from Shapefile to PostgreSQL table Mapfile Layer


Ogrinfo


Template





(continues on next page)



(continued from previous page)

Example 3: Join from Shapefile to CSV file Mapfile Layer


CSV File Structure







Ogrinfo


Template (prov.html)
Ideally this the template should look like this:

But since attribute names are not supported for CSV files (see note above), the following will have to be used:


Example 4: Join from Shapefile to MySQL Mapfile Layer









(continues on next page)



(continued from previous page)

Example 5: One-to-many join
In a join of type ONE-TO-MANY, the JOIN object needs to contain a TEMPLATE. This TEMPLATE is used for each matching record in the join table. Columns in the join table are referenced using <join_name>_<join_column_name>. Columns in the layer table are referenced using <column_name>.
For a one-to-many join, the LAYER TEMPLATE file has to contain a reference to the the JOIN object, as follows: [join_<join_name>].
In this example, it is assumed that the join table many.dbf contains the columns MANYFIELD1 and MANYFIELD2 in addition to the join column (IDENT).
Layer object:






















(continues on next page)



(continued from previous page)
Template oneToMany_header.html:

Template oneToMany.html:

Template oneToMany_join.html:

Template oneToMany_footer.html:


4.1.15 LABEL
ALIGN [left|center|right|attribute]
Added in version 5.4.
Specifies text alignment for multiline labels (see WRAP) Note that the alignment algorithm is far from precise, so don't expect fabulous results (especially for right alignment) if you're not using a fixed width font.
[attribute] was added in version 7.6. If an attribute is used, it is expected to be:
• of type string and should be one of the following: left, center, right.
• of type integer and should be [1,2,3] which means:
- 1 = "left"



- 2 = "center"
- 3 = "right"
if the [attribute] is of type integer as described above, the label generation will be much faster, since string comparison is avoided.
ANGLE [double|auto|auto2|follow|attribute]
• Angle, counterclockwise, given in degrees, to draw the label. Default is 0, and must be in the range -360 to 360.
• AUTO allows MapServer to compute the angle. Valid for LINE layers only.
• AUTO2 same as AUTO, except no logic is applied to try to keep the text from being rendered in reading orientation (i.e. the text may be rendered upside down). Useful when adding text arrows indicating the line direction.
• FOLLOW was introduced in version 4.10 and tells MapServer to compute a curved label for appropriate linear features (see RFC11 for specifics). See also MAXOVERLAPANGLE.
• [Attribute] was introduced in version 5.0, to specify the item name in the attribute table to use for angle values. The hard brackets [] are required. For example, if your shapefile's DBF has a field named "MYAN- GLE" that holds angle values for each record, your LABEL object might contain:

The associated RFC document for this feature is RFC19.
ANTIALIAS [true|false]
Removed in version 7.0: GD support was removed in 7.0
Should text be antialiased? Note that this requires more available colors, decreases drawing performance, and results in slightly larger output images. Only useful for GD (gif) rendering. Default is false. Has no effect for the other renderers (where anti-aliasing can not be turned off).
BACKGROUNDCOLOR [r] [g] [b] | [hexadecimal string]
Removed in version 6.0: Use a LABEL STYLE object with'GEOMTRANSFORM labelpoly' and COLOR in- stead.
Color to draw a background rectangle (i.e. billboard). Off by default.
BACKGROUNDSHADOWCOLOR [r] [g] [b] | [hexadecimal string]
Removed in version 6.0: Use a LABEL STYLE object with GEOMTRANSFORM labelpoly, COLOR and OFFSET
instead.
Color to draw a background rectangle (i.e. billboard) shadow. Off by default.
BACKGROUNDSHADOWSIZE [x][y]
Removed in version 6.0: Use a LABEL STYLE object with GEOMTRANSFORM labelpoly, COLOR and OFFSET
instead.
How far should the background rectangle be offset? Default is 1.



BUFFER [integer]
Padding, in pixels, around labels. Useful for maintaining spacing around text to enhance readability. Available only for cached labels. Default is 0.
COLOR [r] [g] [b] | [hexadecimal string] | [attribute]
• Color to draw text with.
• r, g and b shall be integers [0..255]. To specify green, the following is used:

• hexadecimal string can be
- RGB value: "#rrggbb". To specify magenta, the following is used:

- RGBA value (adding translucence): "#rrggbbaa". To specify a semi-translucent magenta, the follow- ing is used:

• [Attribute] was introduced in version 5.0, to specify the item name in the attribute table to use for color values. The hard brackets [] are required. For example, if your shapefile's DBF has a field named "MY- COLOR" that holds color values for each record, your LABEL object might contain:

The associated RFC document for this feature is RFC19.
ENCODING [string]
Removed in version 7.0: UTF-8 is now the encoding used by MapServer, and dataset encodings are handled using LAYER ENCODING instead.
Supported encoding format to be used for labels. If the format is not supported, the label will not be drawn. Requires the iconv library (present on most systems). The library is always detected if present on the system, but if not, the label will not be drawn.
Required for displaying international characters in MapServer. More information can be found in the Label Encoding document.
EXPRESSION [string]
Added in version 6.2.
Expression that determines when the LABEL is to be applied. See EXPRESSION in CLASS.
FONT [name|attribute]
• Font alias (as defined in the FONTSET) to use for labeling.
• [Attribute] was introduced in version 5.6 to specify the font alias.



• May contain a comma-separated list of up to MS_MAX_LABEL_FONTS (usually 5) font aliases used as fallback fonts in renderers supporting it, if a glyph is not available in a font. If specified directly, be sure to enclose the list with quotes. See RFC80.
• Since version 7, MapServer supports language specific fonts. See RFC98.
FORCE [true|false|group]
Forces labels for a particular class on, regardless of collisions. Available only for cached labels. Default is false. If FORCE is true and PARTIALS is false, FORCE takes precedence, and partial labels are drawn.
The GROUP parameter, added in version 6.2, determines if the label is allowed to intersect other labels from the same feature. Multiple STYLE blocks can be used to render graphic symbols instead of or alongside text. See announce-6-2-force-group.
MAXLENGTH [integer]
Added in version 5.4.
This keyword interacts with the WRAP keyword so that line breaks only occur after the defined number of char- acters.

Table 9: Interaction with WRAP keyword

without maxlengthmaxlength > 0wrap =
'char'always wrap at the WRAP char-
acternewline at the first WRAP character after MAXLENGTH
charactersno wrapno processingskip label if it contains more than MAXLENGTH characters

WarningSpecifying MAXLENGTH 0 to always wrap at the wrap character will cause an error in MapServer >=8 (as there are more strict checks in MapServer >= 8 for negative or zero values), so instead, do not specify a MAXLENGTH and MapServer will then wrap at the wrap character.
Here is an example that wraps at the first dash "-" that occurs after 12 characters in the label (MAXLENGTH 12) :



















(continues on next page)



(continued from previous page)
so the label will appear in the map image as:




The associated RFC document for this feature is RFC40.
Support for negative MAXLENGTH that implied forced linebreaks is not supported since version 7, a workaround implies pre-processing such labels to include linebreaks or wrap characters. Must be greater than 0.
MAXOVERLAPANGLE [double]
Angle threshold to use in filtering out ANGLE FOLLOW labels in which characters overlap (floating point value in degrees). This filtering will be enabled by default starting with MapServer 6.0. The default MAXOVERLA- PANGLE value will be 22.5 degrees, which also matches the default in GeoServer. Users will be free to tune the value up or down depending on the type of data they are dealing with and their tolerance to bad overlap in labels. As per RFC 60, if MAXOVERLAPANGLE is set to 0, then we fall back on pre-6.0 behavior which was to use maxoverlapangle = 0.4*MS_PI (40% of 180 degrees = 72degree). Must be between 0 to 360.
The associated RFC document for this feature is RFC60.
MAXSCALEDENOM [double]
Added in version 5.4.
Minimum scale at which this LABEL is drawn. Scale is given as the denominator of the actual scale fraction, for example for a map at a scale of 1:24,000 use 24000. Must be greater or equal to 0.

See alsoMap Scale
MAXSIZE [double]
Maximum font size to use when scaling text (pixels). Default is 256. Starting from version 5.4, the value can also be a fractional value (and not only an integer). Must be greater than 0. See LAYER SYMBOLSCALEDENOM.
MINDISTANCE [integer]
Minimum distance between duplicate labels. Given in pixels. Starting from version 7.2, the distance is calculated from the label boundary. Prior versions used the label center. Must be greater than 0.
MINFEATURESIZE [integer|auto]
Minimum size a feature must be to be labeled. Given in pixels. For line data the overall length of the displayed line is used, for polygons features the smallest dimension of the bounding box is used. "Auto" keyword tells MapServer to only label features that are larger than their corresponding label. Available for cached labels only. Must be greater than 0.
MINSCALEDENOM [double]
Added in version 5.4.



Maximum scale at which this LABEL is drawn. Scale is given as the denominator of the actual scale fraction, for example for a map at a scale of 1:24,000 use 24000. Must be greater or equal to 0.

See alsoMap Scale
MINSIZE [double]
Minimum font size to use when scaling text (pixels). Default is 4. Starting from version 5.4, the value can also be a fractional value (and not only integer). Must be greater than 0. See LAYER SYMBOLSCALEDENOM.
OFFSET [x|attribute_x][y|attribute_y]
Offset values for labels, relative to the lower left hand corner of the label and the label point. Given in pixels. In the case of rotated text specify the values as if all labels are horizontal and any rotation will be compensated for.
[attribute_x] and [attribute_y] were added in version 7.6. If an attribute is used, it must be of type integer.
When used with FOLLOW angle, two additional options are available to render the label parallel to the original feature:
• OFFSET x -99 : will render the label to the left or to the right of the feature, depending on the sign of {x}.
   • OFFSET x 99 : will render the label above or below the feature, depending on the sign of {x}. See LAYER SYMBOLSCALEDENOM.
OUTLINECOLOR [r] [g] [b] | [hexadecimal string] | [attribute]
• Color to draw a one pixel outline around the characters in the text.
• r, g and b shall be integers [0..255]. To specify green, the following is used:

• hexadecimal string can be
- RGB value: "#rrggbb". To specify magenta, the following is used:

- RGBA value (adding translucence): "#rrggbbaa". To specify a semi-translucent magenta, the follow- ing is used:

• [attribute] was introduced in version 5.0, to specify the item name in the attribute table to use for color values. The hard brackets [] are required. For example, if your shapefile's DBF has a field named "MY- OUTCOLOR" that holds color values for each record, your LABEL object might contain:




The associated RFC document for this feature is RFC19.
OUTLINEWIDTH [integer]
Width of the outline if OUTLINECOLOR has been set. Defaults to 1. Currently only the AGG renderer supports values greater than 1, and renders these as a 'halo' effect: recommended values are 3 or 5. If the renderer supports it and the text size is variable, the outline will be scaled proportionally to the text and the value specified as OUTLINEWIDTH is therefore the width at the same scale at which the SIZE is specified. Must be greater than 0.
PARTIALS [true|false]
Can text run off the edge of the map? Default is false. If FORCE is true and PARTIALS is false, FORCE takes precedence, and partial labels are drawn.


POSITION [ul|uc|ur|cl|cc|cr|ll|lc|lr|auto|attribute]
Position of the label relative to the labeling point (layers only). First letter is "Y" position, second letter is "X" position. "Auto" tells MapServer to calculate a label position that will not interfere with other labels. With points, MapServer selects from the 8 outer positions (i.e. excluding cc). With polygons, MapServer selects from cc (added in MapServer 5.4), uc, lc, cl and cr as possible positions. With lines, it only uses lc or uc, until it finds a position that doesn't collide with labels that have already been drawn. If all positions cause a conflict, then the label is not drawn (Unless the label's FORCE a parameter is set to "true"). "Auto" placement is only available with cached labels.
When used with attribute, it must be of type string and use one of the following: ul|uc|ur|cl|cc|cr|ll|lc|lr|auto.
PRIORITY [integer]|[item_name]|[attribute]|[expression]
Added in version 5.0.
The priority parameter takes an integer value between 1 (lowest) and 10 (highest). The default value is 1. It is also possible to bind the priority to an attribute (item_name) using square brackets around the [item_name]. e.g. "PRIORITY [someattribute]"
Labels are stored in the label cache and rendered in order of priority, with the highest priority levels rendered first. Specifying an out of range PRIORITY value inside a map file will result in a parsing error. An out of range value set via MapScript, coming from a shape attribute, or calculated by an expression will be clamped to the min/max values at rendering time. There is no expected impact on performance for using label priorities.
• [attribute] was introduced in version 5.6.
• [expression] was added in version 8.2.
REPEATDISTANCE [integer]
Added in version 5.6.
The label will be repeated on every line of a multiline shape and will be repeated multiple times along a given line at an interval of REPEATDISTANCE pixels. Must be greater than 0.
The associated RFC document for this feature is RFC57.
SHADOWCOLOR [r] [g] [b] | [hexadecimal string]
Color of drop shadow. A label with the same text will be rendered in this color before the main label is drawn, resulting in a shadow effect on the the label characters. The offset of the renderered shadow is set with SHAD- OWSIZE.
• r, g and b shall be integers [0..255]. To specify green, the following is used:





• hexadecimal string can be
- RGB value: "#rrggbb". To specify magenta, the following is used:

- RGBA value (adding translucence): "#rrggbbaa". To specify a semi-translucent magenta, the follow- ing is used:

SHADOWSIZE [x][y]|[attribute][attribute]|[x][attribute]|[attribute][y]
Shadow offset in pixels, see SHADOWCOLOR.
[Attribute] was introduced in version 6.0, and can be used like:

SIZE [integer]|[tiny|small|medium|large|giant]|[attribute]|[expression]
• Text size. Use a number to give the size in pixels of your TrueType font based label, or any of the other 5 listed keywords for bitmap fonts.
When scaling is in effect (SYMBOLSCALEDENOM is specified for the LAYER), SIZE gives the size of the font to be used at the map scale 1:SYMBOLSCALEDENOM.
• [Attribute] was introduced in version 5.0, to specify the item name in the attribute table to use for size values. The hard brackets [] are required. For example, if your shapefile's DBF has a field named "MYSIZE" that holds size values for each record, your LABEL object might contain:

The associated RFC document for this feature is RFC19.
• [expression] was added in version 7.6 to allow arithmetic expressions returning an integer value as part of RFC124. Attributes can be used as part of this expression:







STYLE
The start of a STYLE object.
Label specific mechanisms of the STYLE object are the GEOMTRANSFORM options:
GEOMTRANSFORM [labelcenter|labelpnt|labelpoly]
Added in version 6.0.
Creates a geometry that can be used for styling the label. Does not apply to ANGLE FOLLOW labels.
• labelcenter places the text in the center of the feature.
• labelpnt draws a marker on the geographic position the label is attached to. This corresponds to the center of the label text only if the label is in position CC.
  • labelpoly generates the bounding rectangle for the text, with 1 pixel of padding added in all directions. The resulting geometries can be styled using the mechanisms available in the STYLE object.
Example - draw a red background rectangle for the labels with a "shadow" (i.e. billboard) in gray text, centered in the polygon feature:








TEXT [string|expression]
Added in version 6.2.
Text to label features with (useful when multiple labels are used). Overrides values obtained from the LAYER LABELITEM and the CLASS TEXT. See TEXT in CLASS.
TYPE [bitmap|truetype]
Type of font to use. Generally bitmap fonts are faster to draw then TrueType fonts. However, TrueType fonts are scalable and available in a variety of faces. Be sure to set the FONT parameter if you select TrueType.


WRAP [character]
Character that represents an end-of-line condition in label text, thus resulting in a multi-line label. Interacts with
MAXLENGTH for conditional line wrapping after a given number of characters.
Labels are also wrapped at Zero Width Space Unicode characters (0x200b) when WRAP is enabled. For example, allow wrapping after hyphens without removing the hyphen character at the wrap. You can insert this character in your PostGIS query with replace(field, '-', E'-u200b').
Added in version 7.2.1: Wrapping at Zero Width Space

4.1.16 LAYER

BINDVALS
Added in version 6.0.
This keyword allows name value pairs to be created to bind variables in SQL statements. Variable binding prevents SQL injection by properly escaping strings and integers. Applies to PostGIS and Oracle connections only.

See alsorfc59
Example:







CLASS
Signals the start of a CLASS object.
Inside a layer, only a single class will be used for the rendering of a feature. Each feature is tested against each class in the order in which they are defined in the mapfile. The first class that matches the its min/max scale constraints and its EXPRESSION check for the current feature will be used for rendering.
This can be controlled with RENDERMODE processing directive.
CLASSGROUP [string]
Specify the class's group that would be considered at rendering time. The CLASS object's GROUP parameter must be used in combination with CLASSGROUP.
CLASSITEM [attribute]
Item name in attribute table to use for class lookups.
CLUSTER
Signals the start of a CLUSTER object.
The CLUSTER configuration option provides to combine multiple features from the layer into single (aggregated) features based on their relative positions. Supported only for POINT layers.

See alsorfc69
COMPOSITE
Signals the start of a COMPOSITE object.
One or more COMPOSITE blocks can be used to signal that rendering should be done in a temporary image and merged onto the final map image in a final step. The options defined inside the COMPOSITE block will determine how this merging should be done (e.g. by appying opacity, composition operator, or pixel filters)

See alsorfc113
CONNECTION [string]
Database connection string to retrieve remote data.
A PostGIS connection string is basically a regular PostgreSQL connection string, it takes the form of "user=nobody password=****** dbname=dbname host=localhost port=5432"
An Oracle connection string: user/pass[@db]
An SDE connection string consists of a hostname, instance name, database name, username and password sep- arated by commas.

Warning


MapServer's native SDE driver was removed for the MapServer 7.0 release (see discussion). SDE support can still be accessed through the OGR driver.

See alsoVector Data for specific connection information for various data sources.

See alsoSee Kernel Density Estimation (Dynamic Heatmap) for specific connection information for kernel density estimation.


CONNECTIONOPTIONS
Added in version 7.6.0.
This keyword allows to define connection options expressed as key / value pairs. This is currently only imple- mented for CONNECTIONTYPE OGR or raster layers, to pass open options to GDAL/OGR drivers.
Example for a GeoJSON datasource to specify the FLATTEN_NESTED_ATTRIBUTES open option of the OGR GeoJSON driver.



See alsorfc125
CONNECTIONTYPE
[contour|kerneldensity|idw|local|ogr|oraclespatial|plugin|postgis|rasterlabel|sde|union|uvraster|wfs|wms]
Type of connection. Default is local. See additional documentation for any other type.

See alsoVector Data for specific connection information for various data sources. See Union Layer for combining layers, added in MapServer 6.0

See alsoSee Kernel Density Estimation (Dynamic Heatmap) for specific connection information for kernel density estimation.



See alsoSee Inverse distance weighted interpolation for specific connection information for inverse distance weighted interpolation.


DATA [filename]|[sde parameters][postgis table/column][oracle table/column]
Full filename of the spatial data to process. No file extension is necessary for shapefiles. Can be specified relative to the SHAPEPATH option from the Map Object.
If this is an SDE layer, the parameter should include the name of the layer as well as the geometry column, i.e. "mylayer,shape,myversion".
If this is a PostGIS layer, the parameter should be in the form of "<columnname> from <tablename>", where "columnname" is the name of the column containing the geometry objects and "tablename" is the name of the table from which the geometry data will be read.
For Oracle, use "shape FROM table" or "shape FROM (SELECT statement)" or even more complex Oracle compliant queries! Note that there are important performance impacts when using spatial subqueries however. Try using MapServer's FILTER whenever possible instead. You can also see the SQL submitted by forcing an error, for instance by submitting a DATA parameter you know won't work, using for example a bad column name.
In a standard use case, when PostGIS, SpatiaLite, or GeoPackage are used as data source the BBOX filter (bound- ing boxes intersect, && with PostGIS) is used automatically. However in some rare use case, a subquery can be very time consuming if data is really important as the final data will be filtered only in the query. In order to filter data sooner, ie before the final query, one can filter data directly in the subquery using the !BOX! variable: WHERE ST_Intersects(wkb_geometry,!BOX!).

See alsoVector Data for specific connection information for various data sources.


DEBUG [off|on|0|1|2|3|4|5]
Enables debugging of a layer in the current map.
Debugging with MapServer versions >= 5.0:
Verbose output is generated and sent to the standard error output (STDERR) or the MapServer errorfile if one is set using the "MS_ERRORFILE" environment variable. You can set the environment variable by using the CONFIG parameter at the MAP level of the mapfile, such as:

You can also set the environment variable in Apache by adding the following to your httpd.conf:





Once the environment variable is set, the DEBUG mapfile parameter can be used to control the level of debugging output. Here is a description of the possible DEBUG values:
• DEBUG O or OFF - only msSetError() calls are logged to MS_ERRORFILE. No msDebug() output at all. This is the default and corresponds to the original behavior of MS_ERRORFILE in MapServer 4.x
• DEBUG 1 or ON - includes all output from DEBUG 0 plus msDebug() warnings about common pitfalls, failed assertions or non-fatal error situations (e.g. missing or invalid values for some parameters, missing shapefiles in tileindex, timeout error from remote WMS/WFS servers, etc.)
• DEBUG 2 - includes all output from DEBUG 1 plus notices and timing information useful for tuning mapfiles and applications
• DEBUG 3 - all of DEBUG 2 plus some debug output useful in troubleshooting problems such as WMS connection URLs being called, database connection calls, etc. This is the recommended level for debugging mapfiles.
• DEBUG 4 - DEBUG 3 plus even more details. . .
• DEBUG 5 - DEBUG 4 plus any msDebug() output that might be more useful to the developers than to the users.
You can also set the debug level by using the "MS_DEBUGLEVEL" environment variable.
The DEBUG setting can also be specified for the entire map, by setting the DEBUG parameter in the MAP object. For more details on this debugging mechanism, please see Debugging MapServer.
Debugging with MapServer versions < 5:
Verbose output is generated and sent to the standard error output (STDERR) or the MapServer logfile if one is set using the LOG parameter in the WEB object. Apache users will see timing details for drawing in Apache's error_log file. Requires MapServer to be built with the DEBUG=MSDEBUG option (-with-debug configure option).
DUMP [true|false]
Removed in version 8.0: Please use LAYER METADATA instead.
Switch to allow MapServer to return data in GML format. Useful when used with WMS GetFeatureInfo opera- tions. "false" by default.

See alsoWMS Server
ENCODING [string]
Added in version 7.0.
The encoding used for text in the layer data source. The value must be supported by ICONV (for example "LATIN1"). When ENCODING is set (and not equal to "UTF-8"), the data source text attributes will be converted to UTF-8.
Required for displaying international characters in MapServer. More information can be found in the Label Encoding document.
EXTENT [minx] [miny] [maxx] [maxy]
The spatial extent of the data. In most cases you will not need to specify this, but it can be used to avoid the speed cost of having MapServer compute the extents of the data. An application can also possibly use this value to override the extents of the map.






FEATURE
Signals the start of a FEATURE object.
FILTER [string]
This parameter allows for data specific attribute filtering that is done at the same time spatial filtering is done, but before any CLASS expressions are evaluated. The string is simply a MapServer expression:

Native filters are supported through the NATIVE_FILTER PROCESSING key:





FILTERITEM [attribute]
Item to use with simple FILTER expressions. OGR and shapefiles only.
FOOTER [filename]
Template to use after a layer's set of results have been sent. Multiresult query modes only.
GEOMTRANSFORM [<expression>|<Javascript file>]
Added in version 6.4.
Used to indicate that the current feature will be transformed.
• <expression>: Applies the given expression to the geometry. Supported expressions:
- (buffer([shape],dist)): Buffer the geometry ([shape]) using dist ground units as buffer distance. For polygons, a negative dist will produce a setback.
Added in version 8.0: centerline()
- (centerline([shape]): Useful for labeling polygons, creates a centered line ([shape]) using a Voronoi diagram generated by GEOS and then additional simplification. Requires GEOS >= 3.5 Centerlines can only be computed for polygon shapes.



* an example showing a generated red centerline that is used to label lakes, from a polygon data- source lakes.db (and uses densify() to add more verticies to the generated red line, so it follows the lake's shape) :









Added in version 8.0: densify()
- (densify([shape],tolerance): Add more verticies to the feature ([shape]). Requires a positive tolerance value. Might be useful in combination with centerline() to add more verticies to the generated labeled line.



- (generalize([shape],tolerance)): simplifies a geometry ([shape]) in way comparable to FME's ThinNoPoint algorithm. See https://trac.osgeo.org/gdal/ticket/966 for more information.
Added in version 8.0: inner()
- (inner([shape]): creates an inner corresponding ring from an input polygon, as a new [shape]
- (simplify([shape],tolerance)): simplifies a geometry ([shape]) using the standard Douglas-Peucker algorithm.
* an example showing a generated red centerline that is used to label a province, from a polygon datasource ns.db (and uses simplify() to reduce the verticies in the generated line) :





- (simplifypt([shape], tolerance)): simplifies a geometry ([shape]), ensuring that the result is a valid geometry having the same dimension and number of components as the input. tolerance must be non-negative.
- (smoothsia([shape], smoothing_size, smoothing_iteration, preprocessing)): will smooth a geometry ([shape]) using the SIA algorithm
Added in version 8.0: outer()
- (outer([shape]): creates an outer corresponding ring from an input polygon, as a new [shape]. This might be useful when you want to ignore islands when labeling a lake.


There is a difference between STYLE and LAYER GEOMTRANSFORM. LAYER-level will receive ground coordinates (meters, degress, etc) and STYLE-level will receive pixel coordinates. The argument to methods such as simplify() must be in the same units as the coordinates of the shapes at that point of the rendering workflow, i.e. pixels at the STYLE-level and in ground units at the LAYER-level.




The [map_cellsize] variable is available if you need to pass a pixel value at the LAYER-level.

To get this variable working in the math expression parser, the [map_cellsize] has to be converted into the layer ground unit. If you choose to use [map_cellsize] in your GEOMTRANSFORM expression, you must explicitly set the UNITS option in the layer.
• <Javascript file>: A Javascript file that returns a new geometry. See Javascript transformation. Added in version 7.0.

or






GRID


Signals the start of a GRID object.

GROUP [name]
Name of a group that this layer belongs to. The group name can then be reference as a regular layer name in the template files, allowing to do things like turning on and off a group of layers at once.
If a group name is present in the LAYERS parameter of a CGI request, all the layers of the group are returned (the STATUS of the LAYERs have no effect).
HEADER [filename]
Template to use before a layer's set of results have been sent. Multiresult query modes only.
IDENTIFY
Added in version 8.6.0.






JOIN


Signals the start of an IDENTIFY object.
Controls how vector features are identified, typically through WMS GetFeatureInfo or MODE=QUERY requests.

Signals the start of a JOIN object.

LABELANGLEITEM [attribute]
Removed in version 5.0: Please see the LABEL object's ANGLE parameter instead.
For MapServer versions < 5.0, this is the item name in attribute table to use for class annotation angles. Values should be in degrees.
LABELCACHE [on|off]
Specifies whether labels should be drawn as the features for this layer are drawn, or whether they should be cached and drawn after all layers have been drawn. Default is on. Label overlap removal, auto placement etc. . . are only available when the label cache is active.
LABELITEM [attribute]
Item name in attribute table to use for class annotation (i.e. labeling).
LABELMAXSCALEDENOM [double]
Minimum scale at which this LAYER is labeled. Scale is given as the denominator of the actual scale fraction, for example for a map at a scale of 1:24,000 use 24000. Implemented in MapServer 5.0, to replace the deprecated LABELMAXSCALE parameter. Must be greater or equal to 0.

See alsoMap Scale
LABELMINSCALEDENOM [double]
Maximum scale at which this LAYER is labeled. Scale is given as the denominator of the actual scale fraction, for example for a map at a scale of 1:24,000 use 24000. Implemented in MapServer 5.0, to replace the deprecated LABELMINSCALE parameter. Must be greater or equal to 0.

See alsoMap Scale
LABELREQUIRES [expression]
Sets context for labeling this layer, for example:

means that this layer would NOT be labeled if a layer named "orthoquads" is on. The expression consists of a boolean expression based on the status of other layers, each [layer name] substring is replaced by a 0 or a 1 depending on that layer's STATUS and then evaluated as normal. Logical operators AND and OR can be used.
LABELSIZEITEM [attribute]
Removed in version 5.0: Please see the LABEL object's SIZE parameter instead.
For MapServer versions < 5.0, this is the item name in attribute table to use for class annotation sizes. Values should be in pixels.
MASK [layername]
The data from the current layer will only be rendered where it intersects features from the [layername] layer. [layername] must reference the NAME of another LAYER defined in the current mapfile. can be any kind of



MapServer layer, i.e. vector or raster. If the current layer has labelling configured, then only labels who's label- point fall inside the unmasked area will be added to the labelcache (the actual glyphs for the label may be rendered ontop of the masked-out area.



See alsorfc79


MAXFEATURES [integer]
Specifies the number of features that should be drawn for this layer in the CURRENT window. Has some inter- esting uses with annotation and with sorted data (i.e. lakes by area). Must be greater than 0.
MAXGEOWIDTH [double]
Added in version 5.4.0.
Maximum width, in the map's geographic units, at which this LAYER is drawn. If MAXSCALEDENOM is also specified then MAXSCALEDENOM will be used instead. Must be greater than 0.
The width of a map in geographic units can be found by calculating the following from the extents:

MAXSCALEDENOM [double]
Added in version 5.0.0: Replaced MAXSCALE.
Minimum scale at which this LAYER is drawn. Scale is given as the denominator of the actual scale fraction, for example for a map at a scale of 1:24,000 use 24000. Must be greater or equal to 0.

See alsoMap Scale
METADATA
This keyword allows for arbitrary data to be stored as name value pairs. This is used with OGC WMS to define things such as layer title. It can also allow more flexibility in creating templates, as anything you put in here will be accessible via template tags.
Example:







MINFEATURESIZE [integer]
Minimum feature size (in pixels) for shapes in the layer. Must be greater than 0.
MINGEOWIDTH [double]
Added in version 5.4.0.
Minimum width, in the map's geographic units, at which this LAYER is drawn. If MINSCALEDENOM is also specified then MINSCALEDENOM will be used instead. Must be greater than 0.
The width of a map in geographic units can be found by calculating the following from the extents:

MINSCALEDENOM [double]
Maximum scale at which this LAYER is drawn. Scale is given as the denominator of the actual scale fraction, for example for a map at a scale of 1:24,000 use 24000. Implemented in MapServer 5.0, to replace the deprecated MINSCALE parameter. Must be greater or equal to 0.

See alsoMap Scale
NAME [string]
Short name for this layer. This name is the link between the mapfile and web interfaces that refer to this name. They must be identical. The name should be unique, unless one layer replaces another at different scales. Use the GROUP option to associate layers with each other. It is recommended that the name not contain spaces, special characters, or begin with a number (which could cause problems through interfaces such as OGC services).


OFFSITE [r] [g] [b] | [hexadecimal string]
Sets the color index to treat as transparent for raster layers.
• r, g and b shall be integers [0..255]. To specify black pixels, the following is used:

• hexadecimal string can be
- RGB value: "#rrggbb". To specify magenta, the following is used:

- RGBA value (adding translucence): "#rrggbbaa". To specify a semi-translucent magenta, the follow- ing is used:




OPACITY [integer|alpha]
Removed in version 8.0: Use a COMPOSITE block instead.
PLUGIN [filename]
Additional library to load by MapServer, for this layer. This is commonly used to load specific support for Oracle and Microsoft SQL Server layers, such as:
For MapServer >=8:

Where "oci" is an alias mapped in the global CONFIG file:

For MapServer <8:

POSTLABELCACHE [true|false]
Tells MapServer to render this layer after all labels in the cache have been drawn. Useful for adding neatlines and similar elements. Default is false.
PROCESSING [string]
Passes a processing directive to be used with this layer. The supported processing directives vary by layer type, and the underlying driver that processes them.


• ArcSDE Directives - All ArcSDE processing options are described in ArcSDE. Here are two examples.

• Attributes Directive - The ITEMS processing option allows to specify the name of attributes for inline layers or specify the subset of the attributes to be used by the layer, such as:

• Clustering - cluster object directives are described in CLUSTER





• Connection Pooling Directive - This is where you can enable connection pooling for certain layer layer types. Connection pooling will allow MapServer to share the handle to an open database or layer connection throughout a single map draw process. Additionally, if you have FastCGI enabled, the connection handle
will stay open indefinitely, or according to the options specified in the FastCGI configuration. Oracle Spatial, ArcSDE, OGR Vector Layers Through MapServer and PostGIS/PostgreSQL currently support this approach. "DEFER" enables connection pooling; "ALWAYS" will always close the connection after use, and will also not try to reuse a shared connection from the pool that might come from another layer.

or

• Contour Directives - contour directives are described in Contour.

• Kernel density radius
Added in version 7.0.
Radius in pixels of the gaussian filter to apply to the bitmap array once all features have been accumulated. Higher values result in increased cpu time needed to compute the filtered data.

• Kernel density compute borders
Added in version 7.0.
A kernel of radius "r" cannot be applied to "r" pixels along the borders of the image. The default is to extend the search rectangle of the input datasource to include features "r" pixels outside of the current map extent so that the computed heatmap extends to the full extent of the resulting image. This can be deactivated when tiling if the tiling software applies a metabuffer of "r" pixels to its requests, to avoid the performance overhead of computing this extra information.

• Kernel density normalization
Added in version 7.0.
If set to "AUTO", the created raster band will be scaled such that its intensities range from 0 to 255, in order to fully span the configured color ramp. Such behavior may not be desirable (typically for tiling) as the resulting intensity of a pixel at a given location will vary depending on the extent of the current map request. If set to a numeric value, the samples will be multiplied by the given value. It is up to the user to determine which scaling value to use to make the resulting pixels span the full 0-255 range; determining that value is mostly a process of trial and error. Pixels that fall outside the 0-255 range will be clipped to 0 or 255.





• Inverse distance weight interpolation radius
Added in version 8.0.
Radius in pixels of the search radius of features to take into account. Higher values result in increased cpu time needed to compute the filtered data. The default is the dimension of the image to render.

• Inverse distance weight interpolation compute borders
Added in version 8.0.
A kernel of radius "r" cannot be applied to "r" pixels along the borders of the image. The default is to extend the search rectangle of the input datasource to include features "r" pixels outside of the current map extent so that the computed result extends to the full extent of the resulting image. This can be deactivated when tiling if the tiling software applies a metabuffer of "r" pixels to its requests, to avoid the performance overhead of computing this extra information.

• Inverse distance weight interpolation power
Added in version 8.0.
Value such that 1 / distance^power is the weight applied when computing pixel values. The default is 1.0.

• Raster colour ramping
Added in version 7.0.
RANGE_COLORSPACE=RGB|HSL - The default RANGE support interpolates colors between stops in RGB space, which usually results in washed out colors. The interpolation can be done in HSL space which usually results in wanted output for heatmaps.

• Label Directive - The LABEL_NO_CLIP processing option can be used to skip clipping of shapes when determining associated label anchor points. This avoids changes in label position as extents change between map draws. It also avoids duplicate labels where features appear in multiple adjacent tiles when creating
tiled maps.

• Line Rendering Directive - The POLYLINE_NO_CLIP processing option can be used to skip clipping of shapes when rendering styled lines (dashed or styled with symbols). This avoids changes in the line styling as extents change between map draws. It also avoids edge effects where features appear in multiple adjacent
tiles when creating tiled maps.

• Class Rendering Directive
Added in version 7.6.



The RENDERMODE processing option specifies how classes are selected for rendering a layer. Default value, and historic behaviour, is FIRST_MATCHING_CLASS: only the first applicable class is selected to render a feature (see CLASS description). The other available value is ALL_MATCHING_CLASSES: all applicable classes are used to render a feature, each one being used on top of the previous ones. This is the default behaviour with SLD styles.

• OGR Styles Directive - This directive can be used for obtaining label styles through MapScript. For more information see the MapServer's OGR document.

• MSSQL specific options - MSSQL_READ_WKB=TRUE - Uses WKB (Well Known Binary) format in- stead of native format when fetching geometries.

• Native filter Directive
Added in version 7.0.
This directive can be used to do driver specific filtering. For database connections the string is a SQL WHERE clause that is valid with respect to the underlying database.

• PostGIS specific options - FORCE2D=YES can be used to force 2D only geometries to be retrieved from PostGIS.

• Vector field specific rendering options - UV_SPACING: The spacing is the distance, in pixels, between arrows to be displayed in the vector field. Default is 32. UV_SIZE_SCALE: Used to convert the vector lengths (magnitude) of the raster to pixels for a better rendering. Default is 1.



• AGG renderer tweaking - This directive can be used for setting the linear gamma to be used when render- ing polygon features. The default value of 0.75 (that can be overridden at the OUTPUTFORMAT level) can be set to a lower value to limit/remove the faint outlines that appear between adjacent polygons. A value of
0.5 is usually good enough.
Note that starting with MapServer 8.4, a GAMMA processing option is also available for rasters, but its default value is 1.0.

• Raster Directives - All raster processing options are described in Raster Data. Here we see the SCALE and BANDs directives used to autoscale raster data and alter the band mapping.




• Union layer Directives - The following processing options can be used with the union layers: UNION_STATUS_CHECK (TRUE or FALSE) - controls whether the status of the source layers should be checked and the invisible layers (STATUS=OFF) should be skipped. Default value is FALSE.
UNION_SCALE_CHECK (TRUE or FALSE) - controls whether the scale range of the source layers should be checked and the invisible layers (falling outside of the scale range and zoom range) should be skipped. Default value is TRUE. UNION_SRCLAYER_CLOSE_CONNECTION - override the connection pool setting of the source layers. By introducing this setting we alter the current behaviour which is equivalent to:   "UNION_SRCLAYER_CLOSE_CONNECTION=ALWAYS"

PROJECTION
Signals the start of a PROJECTION object.
REQUIRES [expression]
Sets context for displaying this layer (see LABELREQUIRES).
An example could be that you have a states_poly layer that you want turned off whenever a modis layer is turned on; in this case you would set the REQUIRES parameter in the states_poly layer such as:

with REQUIRES:

without REQUIRES




The REQUIRES setting should affect all modes (confirmed through testing is: mode=map, WMS GetMap, Map- Script, and map2img commandline).
SCALETOKEN
Added in version 6.4.
Signals the start of a SCALETOKEN object. Allows scale dependent string substitutions. See rfc86.

In the previous example, %pri% would be replaced by:
• "1" for scale denominators smaller than 1,000, giving:





• "2" for scale denominators between 1,000 and 10,000:

• "3" for scale denominators larger than 10,000:

SIZEUNITS [feet|inches|kilometers|meters|miles|nauticalmiles|pixels]
Sets the unit of STYLE object SIZE values (default is pixels). Useful for simulating buffering. nauticalmiles was added in MapServer 5.6.
STATUS [on|off|default]
Sets the current status of the layer. Often modified by MapServer itself. Default turns the layer on permanently.






STYLEITEM [<attribute>|auto|<javascript file>|<sld file>]
Styling based on attributes, generated with JavaScript, or generated from an SLD file.
• <attribute>: Item to use for feature specific styling. The style information may be represented by a separate attribute (style string) attached to the feature. MapServer supports the following style string representations:
- MapServer STYLE definition
* The style string can be represented as a MapServer STYLE block according to the following ex- ample:





- MapServer CLASS definition
* By specifying the entire CLASS instead of a single style allows to use further options (like setting expressions, label attributes, multiple styles) on a per feature basis.
- OGR Style String
* MapServer support rendering the OGR style string format according to the OGR - Feature Style Specification documentation. Currently only a few data sources support storing the styles along with the features (like MapInfo, AutoCAD DXF, Microstation DGN), however those styles can eas-
ily be transferred to many other data sources as a separate attribute by using the ogr2ogr command line tool as follows:

- SLD String
Added in version 8.2.0.
* Different Styled Layer Descriptor documents (see SLD) can be stored as strings in the fea- ture attribute to allow styling on a per feature basis. The SLD string must end with StyledLayerDescriptor> (part of the SLD closing tag) for it to be interpreted as SLD.
To use the first NamedLayer in the SLD string, whether or not the LAYER NAME matches the NamedLayer Name, add a SLD_USE_FIRST_NAMEDLAYER METADATA key and set its value to "true".



• AUTO: The value: AUTO can be used for automatic styling.
- Automatic styling can be provided by the driver. Currently, only the OGR driver supports automatic styling.
- When used for a Union Layer, the styles from the source layers will be used.
• <Javascript file>:
Added in version 6.6.
A Javascript file that returns a new string containing either a STYLE definition or a CLASS definition with one or multiple styles. See STYLEITEM Javascript.





or



• <SLD file>:
Added in version 8.2.0.
A path to an SLD file. The path mush start with the prefix sld://, and can be a path relative to the mapfile, or an absolute path. CLASS and STYLE blocks will then be generated based on the SLD document.

For SLD files containing multiple NamedLayers, if Name matches the LAYER name then this style will be used. If there is no name match then the first NamedLayer in the SLD will be used. See Named Styles support for more details.
To enforce matching of a NamedLayer Name and the LAYER NAME a METADATA key can be set to
"false" as in the example below:



SYMBOLSCALEDENOM [double]
The scale at which symbols and/or text appear full size. This allows for dynamic scaling of objects based on the



scale of the map. If not set then this layer will always appear at the same size. Scaling only takes place within the limits of MINSIZE and MAXSIZE as described above. Scale is given as the denominator of the actual scale fraction, for example for a map at a scale of 1:24,000 use 24000. Implemented in MapServer 5.0, to replace the deprecated SYMBOLSCALE parameter. Must be greater or equal to 1.

See alsoMap Scale
TEMPLATE [file|url]
Used as a global alternative to CLASS TEMPLATE. See Templating for more info.
TILEINDEX [filename|layername]
Name of the tileindex file or layer. A tileindex is similar to an ArcInfo library index. The tileindex contains polygon features for each tile. The item that contains the location of the tiled data is given using the TILEITEM parameter. When a file is used as the tileindex for shapefile or raster layers, the tileindex should be a shapefile. For CONNECTIONTYPE OGR layers, any OGR supported datasource can be a tileindex. Normally the location should contain the path to the tile file relative to the shapepath, not relative to the tileindex itself. If the DATA parameter contains a value then it is added to the end of the location. When a tileindex layer is used, it works similarly to directly referring to a file, but any supported feature source can be used (ie. postgres, oracle).






TILEITEM [attribute]
Item that contains the location of an individual tile, default is "location".
TILESRS [attribute]
Name of the attribute that contains the SRS of an individual tile. That SRS can be expressed in WKT format, as an EPSG:XXXX code or as a PROJ string. If the tileindex contains rasters in different projections, this option must be specified. If the tileindex has been generated with gdaltindex (GDAL >= 2.0) or ogrtindex (GDAL >= 2.2), the value of TILESRS is the value of the -src_srs_name option of gdaltindex/ogrtindex. See Tileindexes with tiles in different projections




TOLERANCE [double]
Sensitivity for point based queries (i.e. via mouse and/or map coordinates). Given in TOLERANCEUNITS. If the layer is a POINT or a LINE, the default is 3. For all other layer types, the default is 0. To restrict polygon searches so that the point must occur in the polygon set the tolerance to zero. This setting does not apply to WFS GetFeature operations.


TOLERANCEUNITS  [pixels|feet|inches|kilometers|meters|miles|nauticalmiles|dd]
Units of the TOLERANCE value. Default is pixels. Nauticalmiles was added in MapServer 5.6.


TRANSFORM [true|false] | [ul|uc|ur|cl|cc|cr|ll|lc|lr]
Tells MapServer whether or not a particular layer needs to be transformed from some coordinate system to image coordinates. Default is true. This allows you to create shapefiles in image/graphics coordinates and therefore have features that will always be displayed in the same location on every map. Ideal for placing logos or text in maps. Remember that the graphics coordinate system has an origin in the upper left hand corner of the image, contrary to most map coordinate systems.
Version 4.10 introduces the ability to define features with coordinates given in pixels (or percentages, see UNITS), most often inline features, relative to something other than the UL corner of an image. That is what 'TRANS- FORM FALSE' means. By setting an alternative origin it allows you to anchor something like a copyright statement to another portion of the image in a way that is independent of image size.
TRANSPARENCY  [integer|alpha]
Removed in version 8.0: Use COMPOSITE instead.
TYPE [chart|circle|line|point|polygon|raster|query]
Specifies how the data should be drawn. Need not be the same as the shapefile type. For example, a polygon shapefile may be drawn as a point layer, but a point shapefile may not be drawn as a polygon layer. Common sense rules.
In order to differentiate between POLYGONs and POLYLINEs (which do not exist as a type), simply respectively use or omit the COLOR keyword when classifying. If you use it, it's a polygon with a fill color, otherwise it's a polyline with only an OUTLINECOLOR.
A circle must be defined by a a minimum bounding rectangle. That is, two points that define the smallest square that can contain it. These two points are the two opposite corners of said box. The following is an example using inline points to draw a circle:








(continues on next page)



(continued from previous page)
TYPE query means the layer can be queried but not drawn.



See alsoThe Dynamic Charting HowTo for TYPE chart.
UNITS [dd|feet|inches|kilometers|meters|miles|nauticalmiles|percentages|pixels]
Units of the layer. percentages (in this case a value between 0 and 1) was added in MapServer 4.10 and is mostly geared for inline features. nauticalmiles was added in MapServer 5.6.
UTFDATA [string]
Added in version 7.0.
A UTFGrid JSON template. MapServer expression syntax (expressionObj). If no UTFDATA is provided, no data beyond the UTFITEM values will be exposed. If UTFITEM is set, the UTFDATA expose those so that keys and data can be connected. See rfc93 and UTFGrid Output.

UTFITEM [string]
Added in version 7.0.
The attribute to use as the ID for the UTFGrid. If a UTFITEM is not set, the sequential id (based on rendering order) is being used. If UTFITEM is set, the UTFDATA expose those so that keys and data can be connected. See rfc93 and UTFGrid Output.

VALIDATION
Signals the start of a VALIDATION block.
As of MapServer 5.4.0, VALIDATION blocks are the preferred mechanism for specifying validation patterns for CGI param runtime substitutions. See Run-time Substitution.


4.1.17 LEADER


Description
Since version 6.2, MapServer has the ability to draw label lines to features where space is an issue for the label (often when the label text is larger than the polygon being labelled). This feature was added through rfc81.

Supported Layer Types
POINT, LINE, POLYGON

Mapfile Parameters
GRIDSTEP [integer]
Specifies the number of pixels between positions that are tested for a label line. You might start with a value of 5, and increase depending on performance (see example below). Must be greater than 0.
MAXDISTANCE [integer]
Specifies the maximum distance in pixels from the normal label location that a leader line can be drawn. You might start with a value of 30, and increase depending on the resulting placement (see example below). Must be greater than 0.
STYLE
Signals the start of a STYLE object. Use this to style the leader line.

Mapfile Snippet















(continues on next page)



(continued from previous page)

Example: World Countries Labels
The following example uses a polygon layer to display country labels.


Mapfile Example #1



































(continues on next page)



(continued from previous page)



Map Image





Mapfile Example #2
This time use a shorter maximum leader line (MAXDISTANCE) and increase the number of tests (GRIDSTEP).


















(continues on next page)



(continued from previous page)

Map Image





4.1.18 LEGEND
The size of the legend image is NOT known prior to creation so be careful not to hard-code width and height in the
<IMG> tag in the template file.
IMAGECOLOR [r] [g] [b] | [hexadecimal string]
Color to initialize the legend with (i.e. the background).
• r, g and b shall be integers [0..255]. To specify green, the following is used:




• hexadecimal string can be
- RGB value: "#rrggbb". To specify magenta, the following is used:

- RGBA value (adding translucence): "#rrggbbaa". To specify a semi-translucent magenta, the follow- ing is used:

INTERLACE [on|off]
Deprecated since version 4.6.
Default is [on]. This keyword is now deprecated in favor of using the FORMATOPTION "INTERLACE=ON" line in the OUTPUTFORMAT declaration.
KEYSIZE [x][y]
Size of symbol key boxes in pixels. Default is 20 by 10. Minimum values are 5, and maximum values are 1000.
KEYSPACING [x][y]
Spacing between symbol key boxes ([y]) and labels ([x]) in pixels. Default is 5 by 5. Minimum values are 0, and maximum values are 50.
LABEL
Signals the start of a LABEL object
OUTLINECOLOR [r] [g] [b] | [hexadecimal string]
Color to use for outlining symbol key boxes.
• r, g and b shall be integers [0..255]. To specify green, the following is used:

• hexadecimal string can be
- RGB value: "#rrggbb". To specify magenta, the following is used:

- RGBA value (adding translucence): "#rrggbbaa". To specify a semi-translucent magenta, the follow- ing is used:

POSITION [ul|uc|ur|ll|lc|lr]
Where to place an embedded legend in the map. Default is lr.
POSTLABELCACHE [true|false]
Tells MapServer to render this legend after all labels in the cache have been drawn. Useful for adding neatlines and similar elements. Default is false.
STATUS [on|off|embed]
Is the legend image to be created.
TEMPLATE [filename]
HTML legend template file.




See alsoHTML Legends with MapServer
TRANSPARENT [on|off]
By default, a legend will inherit the same transparency setting as the map OUTPUTFORMAT . However, this flag can be used to override this setting, allowing, for example, a transparent legend to be embedded in a non-transparent map.

4.1.19 MAP



ANGLE [double]
Angle, given in degrees, to rotate the map. Default is 0, and must be in the range -360 to 360. The rendered map will rotate in a clockwise direction. The following are important notes:
• Requires a PROJECTION object specified at the MAP level and for each LAYER object (even if all layers are in the same projection).
• Requires MapScript (SWIG, PHP MapScript). Does not work with CGI mode.
• If using the LABEL object's ANGLE or the LAYER object's LABELANGLEITEM parameters as well, these parameters are relative to the map's orientation (i.e. they are computed after the MAP object's ANGLE). For example, if you have specified an ANGLE for the map of 45, and then have a layer LABELANGLEITEM
value of 45, the resulting label will not appear rotated (because the resulting map is rotated clockwise 45 degrees and the label is rotated counter-clockwise 45 degrees). Note that a missing ANGLE or a value set to 0 means that map rotation is ignored. (so if wanting to have a zero relative angle relative to the map rotation, use an almost zero value like 0.0001)
• Starting with MapServer 7.2, if using the STYLE . ANGLE parameter of a ponctual symbol, that parameter is relative to the map's orientation (i.e. it is computed after the MAP object's ANGLE). For example, if you have specified an ANGLE for the map of 45, and then have a symbol ANGLE value of 45, the resulting label
will not appear rotated (because the resulting map is rotated clockwise 45 degrees and the label is rotated counter-clockwise 45 degrees). Note that a missing ANGLE or a value set to 0 means that map rotation is ignored. (so if wanting to have a zero relative angle relative to the map rotation, use an almost zero value like 0.0001)
• More information can be found on the MapRotation Wiki Page.
CONFIG [key] [value]
This can be used to specify several values at run-time, for both MapServer and GDAL/OGR libraries. Developers:



values will be passed on to CPLSetConfigOption(). Details on GDAL/OGR options are found in their associated driver documentation pages (GDAL/OGR). The following options are available specifically for MapServer:
CGI_CONTEXT_URL [value]
This CONFIG parameter can be used to enable loading a map context from a URL. See the Map Context HowTo for more info.
MS_ENCRYPTION_KEY [filename]
This CONFIG parameter can be used to specify an encryption key that is used with MapServer's msencypt utility.
MS_ERRORFILE [filename]
This CONFIG parameter can be used to write MapServer errors to a file (as of MapServer 5.0). With MapServer 5.x, a full path (absolute reference) is required, including the filename. Starting with MapServer 6.0, a filename with relative path can be passed via this CONFIG directive, in which case the filename is relative to the mapfile location. Note that setting MS_ERRORFILE via an environment variable always requires an absolute path since there would be no mapfile to make the path relative to. For more on this see the DEBUG parameter below.
MS_NONSQUARE [yes|no]
This CONFIG parameter can be used to allow non-square pixels (meaning that the pixels represent non- square regions). For "MS_NONSQUARE" "yes" to work, the MAP, and each LAYER will have to have a PROJECTION object.


ON_MISSING_DATA [FAIL|LOG|IGNORE]
This CONFIG parameter can be used to tell MapServer how to handle missing data in tile indexes (as of MapServer 5.3-dev, r8015). Previous MapServer versions required a compile-time switch ("IG- NORE_MISSING_DATA"), but this is no longer required.
FAIL
This will cause MapServer to throw an error and exit (to crash, in other words) on a missing file in a tile index. This is the default.

LOG
This will cause MapServer to log the error message for a missing file in a tile index, and continue with the map creation. Note: DEBUG parameter and CONFIG "MS_ERRORFILE" need to be set for logging to occur, so please see the DEBUG parameter below for more information.

IGNORE
This will cause MapServer to not report or log any errors for missing files, and map creation will occur normally.

PROJ_DATA [path]
This CONFIG parameter can be used to define the location of your EPSG files for the PROJ library. Setting the [key] to PROJ_DATA and the [value] to the location of your EPSG files will force PROJ to use this value.



Using CONFIG allows you to avoid setting environment variables to point to your PROJ_DATA directory. Here are some examples:

1. Unix

2. Windows

PROJ_DEBUG [ON|OFF]
Turn on PROJ debugging. See Debugging MapServer for more details.
DATAPATTERN [regular expression]
Removed in version 8.0: See VALIDATION instead
This defines a regular expression to be applied to requests to change DATA parameters via URL requests (i.e. map.layer[layername]=DATA+...). If a pattern doesn't exist then web users can't monkey with sup- port files via URLs. This allows you to isolate one application from another if you desire, with the default operation being very conservative. See also TEMPLATEPATTERN .
DEBUG [off|on|0|1|2|3|4|5]
Enables debugging of all of the layers in the current map.
Debugging with MapServer versions >= 5.0:
Verbose output is generated and sent to the standard error output (STDERR) or the MapServer errorfile if one is set using the "MS_ERRORFILE" environment variable. You can set the environment variable by using the CONFIG parameter at the MAP level of the mapfile, such as:

You can also set the environment variable in Apache by adding the following to your httpd.conf:

Once the environment variable is set, the DEBUG mapfile parameter can be used to control the level of debugging output. Here is a description of the possible DEBUG values:
• DEBUG O or OFF - only msSetError() calls are logged to MS_ERRORFILE. No msDebug() output at all. This is the default and corresponds to the original behavior of MS_ERRORFILE in MapServer 4.x.
• DEBUG 1 or ON - includes all output from DEBUG 0 plus msDebug() warnings about common pitfalls, failed assertions or non-fatal error situations (e.g. missing or invalid values for some parameters, missing shapefiles in tileindex, timeout error from remote WMS/WFS servers, etc.).
• DEBUG 2 - includes all output from DEBUG 1 plus notices and timing information useful for tuning mapfiles and applications.
• DEBUG 3 - all of DEBUG 2 plus some debug output useful in troubleshooting problems such as WMS connection URLs being called, database connection calls, etc. This is the recommended level for debugging mapfiles.
• DEBUG 4 - DEBUG 3 plus even more details. . .



• DEBUG 5 - DEBUG 4 plus any msDebug() output that might be more useful to the developers than to the users.
You can also set the debug level by using the "MS_DEBUGLEVEL" environment variable.
The DEBUG setting can also be specified for a layer, by setting the DEBUG parameter in the LAYER object. For more details on this debugging mechanism, please see the Debugging MapServer document.
Debugging with MapServer versions < 5:
Verbose output is generated and sent to the standard error output (STDERR) or the MapServer logfile if one is set using the LOG parameter in the WEB object. Apache users will see timing details for drawing in Apache's error_log file. Requires MapServer to be built with the DEBUG=MSDEBUG option (-with-debug configure option).
DEFRESOLUTION [double]
Added in version 5.6.
Sets the reference resolution (pixels per inch) used for symbology. Default is 72. Minimum is 10 and maximum is 1000.
Used to automatically scale the symbology when RESOLUTION is changed, so the map maintains the same look at each resolution. The scale factor is RESOLUTION / DEFRESOLUTION.
EXTENT [minx] [miny] [maxx] [maxy]
The spatial extent of the map to be created. In most cases you will need to specify this, although MapServer can sometimes (expensively) calculate one if it is not specified.
FONTSET [filename]
Filename of fontset file to use. Can be a path relative to the mapfile, or a full path.
IMAGECOLOR [r] [g] [b] | [hexadecimal string]
Color to initialize the map with (i.e. background color). When transparency is enabled (TRANSPARENT ON in OUTPUTFORMAT ) for the typical case of 8-bit pseudocolored map generation, this color will be marked as transparent in the output file palette. Any other map components drawn in this color will also be transparent, so for map generation with transparency it is best to use an otherwise unused color as the background color.
• r, g and b shall be integers [0..255]. To specify green, the following is used:

• hexadecimal string can be
- RGB value: "#rrggbb". To specify magenta, the following is used:

- RGBA value (adding translucence): "#rrggbbaa". To specify a semi-translucent magenta, the follow- ing is used:

IMAGEQUALITY [int]
Removed in version 8.0.
Instead use FORMATOPTION "QUALITY=n" in the OUTPUTFORMAT declaration to specify compression quality for JPEG output.
IMAGETYPE [jpeg|pdf|png|svg|. . . |userdefined]
Output format (raster or vector) to generate. The name used here must match the 'NAME' of a user defined or



internally available OUTPUTFORMAT . For a complete list of available IMAGEFORMAT s, see the OUTPUT- FORMAT section.
INTERLACE [on|off]
Removed in version 8.0.
Instead use FORMATOPTION "INTERLACE=ON" in the OUTPUTFORMAT declaration to specify if the output images should be interlaced.
LAYER
Signals the start of a LAYER object.
LEGEND
Signals the start of a LEGEND object.
MAXSIZE [integer]
Sets the maximum size of the map image. This will override the default value. For example, setting this to 4096 means that you can have up to 4096 pixels in both dimensions (i.e. max of 4096x4096). Default is 4096 for MapServer version >= 7.0.3 (for earlier versions the default was 2048). Must be a value greater than 0.
NAME [name]
Prefix attached to map, scalebar and legend GIF filenames created using this mapfile. It should be kept short.
OUTPUTFORMAT
Signals the start of a OUTPUTFORMAT object.
PROJECTION
Signals the start of a PROJECTION object.
QUERYMAP
Signals the start of a QUERYMAP object.
REFERENCE
Signals the start of a REFERENCE MAP object.
RESOLUTION [double]
Sets the pixels per inch for output, only affects scale computations. Default is 72. Minimum is 10 and maximum is 1000.
SCALEDENOM [double]
Computed scale of the map. Set most often by the application. Scale is given as the denominator of the actual scale fraction, for example for a map at a scale of 1:24,000 use 24000. Implemented in MapServer 5.0, to replace the deprecated SCALE parameter. Must be greater or equal to 1.

See alsoMap Scale
SCALEBAR
Signals the start of a SCALEBAR object.
SHAPEPATH [foldername]
Relative or absolute path to the directory holding the data files, for vector and raster formats (such as GeoPack- ages, GEOJSON, SpatiaLite, Shapefiles, raster images, tiles, etc.). This path will be used to find the file specified through the DATA or CONNECTION parameters. For relative paths, SHAPEPATH is relative to the mapfile lo- cation. There can be further subdirectories under SHAPEPATH.
Here is an example using relative paths (where the DATA folder lives at the same level as the mapfile and the
DATA folder contains a SpatiaLite db) :





SIZE [x][y]
Size in pixels of the output image (i.e. the map). Values must be less than the MAXSIZE property.
STATUS [on|off]
Is the map active? Sometimes you may wish to turn this off to use only the reference map or scale bar.
SYMBOLSET [filename]
Filename of the symbolset to use. Can be a path relative to the mapfile, or a full path.


SYMBOL
     Signals the start of a SYMBOL object. TEMPLATEPATTERN [regular expression]
Removed in version 8.0: See VALIDATION instead
This defines a regular expression to be applied to requests to change the TEMPLATE parameters via URL requests (i.e. map.layer[layername].template=. . . ). If a pattern doesn't exist then web users can't monkey with support files via URLs. This allows you to isolate one application from another if you desire, with the default operation being very conservative. See also DATAPATTERN .
TRANSPARENT [on|off] Removed in version 8.0.
Instead use TRANSPARENT ON in the OUTPUTFORMAT declaration to specify if the output images should be transparent.
UNITS [dd|feet|inches|kilometers|meters|miles|nauticalmiles]
Units of the map coordinates. Used for scalebar and scale computations. Nauticalmiles was added in MapServer 5.6.

WEB


Signals the start of a WEB object.


4.1.20 OUTPUTFORMAT
A map file may have zero, one or more OUTPUTFORMAT object declarations, defining available output formats supported including formats like PNG, JPEG, GeoTIFF, SVG, PDF and KML.



If OUTPUTFORMAT sections declarations are not found in the map file, the following implicit declarations will be made. Only those for which support is compiled in will actually be available. The GeoTIFF depends on building with GDAL support, and the PDF and SVG depend on building with cairo support.
OUTPUTFORMAT
NAME "png"
DRIVER AGG/PNG
MIMETYPE "image/png" IMAGEMODE RGB EXTENSION "png"
FORMATOPTION "GAMMA=0.75"
END
OUTPUTFORMAT NAME "png8"
DRIVER AGG/PNG8
MIMETYPE "image/png; mode=8bit"
IMAGEMODE RGB
EXTENSION "png"
FORMATOPTION "QUANTIZE_FORCE=on" FORMATOPTION "QUANTIZE_COLORS=256" FORMATOPTION "GAMMA=0.75"
END
OUTPUTFORMAT
NAME "jpeg"
DRIVER AGG/JPEG
MIMETYPE "image/jpeg" IMAGEMODE RGB EXTENSION "jpg"
FORMATOPTION "GAMMA=0.75"
END
OUTPUTFORMAT
NAME "jpeg_png"
MIMETYPE "image/vnd.jpeg-png"
DRIVER AGG/MIXED
IMAGEMODE RGBA
FORMATOPTION "TRANSPARENT_FORMAT=png"
FORMATOPTION "OPAQUE_FORMAT=jpeg"
END
OUTPUTFORMAT
NAME "jpeg_png8"
MIMETYPE "image/vnd.jpeg-png8"
DRIVER AGG/MIXED
IMAGEMODE RGBA
FORMATOPTION "TRANSPARENT_FORMAT=png8"
FORMATOPTION "OPAQUE_FORMAT=jpeg"
END
OUTPUTFORMAT
NAME "svg"
DRIVER CAIRO/SVG
MIMETYPE "image/svg+xml"
IMAGEMODE RGB
EXTENSION "svg"
END
(continues on next page)



(continued from previous page)
DRIVER [name]
The name of the driver to use to generate this output format. Some driver names include the definition of the format if the driver supports multiple formats. For AGG, the possible driver names are "AGG/PNG" and "AGG/JPEG". For output through OGR the OGR driver name is appended, such as "OGR/Mapinfo File". For output through GDAL the GDAL shortname for the format is appended, such as "GDAL/GTiff". Note that PNG and JPEG output can be generated with either GDAL or AGG (AGG is generally more efficient). TEMPLATE should be used for template based output. (mandatory). Other drivers: KML, KMZ and UTFGRID.
EXTENSION [type]
Provide the extension to use when creating files of this type. (optional)



FORMATOPTION [option]
Provides a driver or format specific option. Zero or more FORMATOPTION statement may be present within a OUTPUTFORMAT declaration. (optional)


• AGG/*: "GAMMA=n" is used to specify the gamma correction to apply to polygon rendering. Allowed values are [0.0,1.0] , default is 0.75. This value is used to prevent artifacts from appearing on the border of contiguous polygons. Set to 1.0 to disable gamma correction.
• AGG/JPEG: The "QUALITY=n" option may be used to set the quality of jpeg produced (value from 0-100).
• AGG/PNG: "COMPRESSION=n" is used to determine the ZLIB compression applied to the png creation. n is expected to be an integer value from 0 to 9, with 0 meaning no compression (not recommended), 1
meaning fastest compression, and 9 meaning best compression. The compression levels come at a cost (be it in terms of cpu processing or file size, chose the setting that suits you most). The default is COMPRES- SION=6.
• AGG/PNG supports quantizing from 24/32 bits to 8bits, in order to reduce the final image size (and therefore save bandwidth) (see also MapServer issue #2436 for strategies when applying these options):
- "QUANTIZE_FORCE=on" used to reduce an RGB or RGBA image into an 8bit (or less) paletted images. The colors used in the palette are selected to best fit the actual colors in the RGB or RGBA image.
- "QUANTIZE_COLORS=256" used to specify the number of colors to be used when applying quanti- zation. Maximum value is 256. Specifying anything between 17 and 255 is probably a waste of quality as each pixel is still encoded with a full byte. Specifying a value under 16 will produce tiny images, but severely degraded.
- "PALETTE=/path/to/palette.txt" is used to define the absolute path where palette colors can be found. This file must contain 256 entries of r,g,b triplets for RGB imagemodes, or r,g,b,a quadruplets for RGBA imagemodes. The expected format is one triplet (or quadruplet) per line, each value separated by commas, and each triplet/quadruplet on a single line. If you want to use transparency with a palette, it is important to have these two colors in the palette file: 0,0,0,0 and 255,255,255,255.


- "PALETTE_FORCE=on" is used to reduce image depth with a predefined palette. This option is incompatible with the previous quantization options. To allow additional colours for anti-aliasing other than those in the predefined palette, use with "QUANTIZE_COLORS".
• AGG/MIXED
Added in version 7.2.
AGG/MIXED is a meta driver that automatically selects the appropriate format depending if the result image has transparency or not. It requires the TRANSPARENT_FORMAT and OPAQUE_FORMAT options to be defined and set to another valid format. The valid formats for TRANSPARENT_FORMAT and OPAQUE_FORMAT are those handled by the AGG/PNG, AGG/JPEG or GDAL/xxxx drivers. By default,



the "jpeg_png" format (with "image/vnd.jpeg-png" mime type) is pre-configured to use PNG images when they are non-opaque pixels and JPEG when they are only opaque pixels. Similarly a "jpeg_png8" format (with "image/vnd.jpeg-png8" mime type) is pre-configured to use PNG 8bits images when they are non- opaque pixels and JPEG when they are only opaque pixels.
- "TRANSPARENT_FORMAT=name": which output format to be used when the image contains non- opaque/transparent pixels.
- "OPAQUE_FORMAT=name": which output format to be used when the image contains only opaque pixels.
Example:

• CAIRO/PDF:
- "GEO_ENCODING=ISO32000" or "GEO_ENCODING=OGC_BP":
Added in version 6.2.
Geospatial PDF will be generated. Requires GDAL 1.10 with PDF driver. See the GDAL Geospatial PDF documentation for requirements.
- "METADATA_ITEM:option=value":
Added in version 6.2.
Additional PDF options can be provided using the METADATA_ITEM prefix. The following options are available: AUTHOR, CREATOR, CREATION_DATE, KEYWORDS, PRODUCER, SUBJECT, TI- TLE.
Example:




• GDAL/GTiff:	Supports the "TILED=YES", "BLOCKXSIZE=n", "BLOCKYSIZE=n", "INTER- LEAVE=[PIXEL/BAND]" and "COMPRESS=[NONE,PACKBITS,JPEG,LZW,DEFLATE]" format spe-
cific options.
• GDAL/*: All FORMATOPTIONs are passed onto the GDAL create function. Options supported by GDAL are described in the detailed documentation for each GDAL format.
• GDAL/*: "NULLVALUE=n" is used in raw image modes (IMAGEMODE BYTE/INT16/FLOAT) to pre- initialize the raster and an attempt is made to record this in the resulting file as the nodata value. This is automatically set in WCS mode if rangeset_nullvalue is set.
• OGR/*: See the OGR Output document for details of OGR format options.
• UTFGRID: See rfc93.
- "LABELS=true". Labels can be rendered using their parent feature id (derived via UTFITEM) where the labels bounding box is drawn to the map.
- "UTFRESOLUTION=4". The resolution of the grid. A larger resolution will make the grid smaller and therefore reduce its weight but also its precision.
- "DUPLICATES=false". It may be desirable NOT to remove duplicate feature id/key pairs since that process could be expensive depending on the number of features in the map. This option can be used to skip this step. The resulting JSON file will be a bit larger.
IMAGEMODE [RGB|RGBA|INT16|FLOAT32|FEATURE]
Selects the imaging mode in which the output is generated. Does matter for non-raster formats like Flash. Not all formats support all combinations. (optional)
• RGB: Render in 24bit Red/Green/Blue mode. Supports all colors but does not support transparency.
• RGBA: Render in 32bit Red/Green/Blue/Alpha mode. Supports all colors, and alpha based transparency. All features are rendered against an initially transparent background.
• BYTE: Render raw 8bit pixel values (no presentation). Only works for RASTER layers (through GDAL) and WMS layers currently.
• INT16: Render raw 16bit signed pixel values (no presentation). Only works for RASTER layers (through GDAL) and WMS layers currently.
• FLOAT32: Render raw 32bit floating point pixel values (no presentation). Only works for RASTER layers (through GDAL) and WMS layers currently.
• FEATURE: Output is a non-image result, such as features written via templates or OGR.
MIMETYPE [type]
Provide the mime type to be used when returning results over the web. (optional)
NAME [name]
The name to use in the IMAGETYPE keyword of the map file to select this output format. This name is also used in metadata describing wxs formats allowed, and can be used (sometimes along with mimetype) to select the output format via keywords in OGC requests. (optional)
TRANSPARENT [on|off]
Indicates whether transparency should be enabled for this format. Note that transparency does not work for IMAGEMODE RGB output. Not all formats support transparency (optional). When transparency is enabled for the typical case of 8-bit pseudocolored map generation, the IMAGECOLOR color will be marked as transparent in the output file palette. Any other map components drawn in this color will also be transparent, so for map generation with transparency it is best to use an otherwise unused color as the background color.


4.1.21 PROJECTION


Background
There are thousands of geographical reference systems. In order to combine datasets with different geographical ref- erence systems into a map, the datasets will have to be transformed (projected) to the chosen geographical reference system of the map. If you want to know more about geographical reference systems and map projections in general, please see the More Information links below, or look into Geomatics courses (Geographical Information Systems, Cartography, Geodesy), as projections are an advanced topic for beginners.

Projections with MapServer
To set up projections you must define one projection object for the output image (in the MAP object) and one projection object for each layer (in the LAYER objects) to be projected. MapServer relies on the PROJ library for projections. Projection objects therefore consist of a series of PROJ keywords, which are either specified within the object directly or referred to in a PROJ data file, that contains EPSG definitions. A PROJ data file (proj.db for PROJ >=6, or epsg file for PROJ <6) is a lookup file containing projection parameters, and is part of the PROJ library.
Starting with MapServer 8 and when the PROJ 6 library or above is used, the use of EPSG codes when available, rather than the inline projection parameters, is recommended to benefit from higher accuracy coordinate reprojection.
The following two examples both define the same projection (UTM zone 15, NAD83), but use 2 different methods:
Example 1: Inline Projection Parameters








Example 2: EPSG Projection Use





The next two examples both display how to possibly define unprojected lat/long ("geographic"):
Example 3: Inline Projection Parameters

Example 4: epsg Projection Use


"Web Mercator" or "Google Mercator"
The EPSG code for the commonly used "Web" or "Google" mercator projection is '3857'. See EPSG:3857 for more information on this coordinate system. This code was also unofficially referred to as EPSG:900913; you are recom- mended to use the official EPSG:3857 code instead, such as:


PROJECTION AUTO
The following syntax may be used in LAYERs that are OGR connections, shapefile layers or raster layers :





• In case of a OGR connection, the projection will be retrieved from the OGR layer.
• In case of a shapefile layer, the projection will be retrieved from the associated .prj file.
• In case of raster layers containing a single raster (DATA keyword), the projection will be retrieved from the GDAL datasource.
• If the raster layer refers to a tile index (OGR layer or shapefile tileindex), the projection will be retrieved according to the above describe rules.
• If the raster layer refers to a tile index with rasters in a variety of projections, the TILESRS keyword should be specified to choose the appropriate projection for the corresponding raster. See Tileindexes with tiles in different projections for more details.


Setting the location of PROJ files


There are several ways to point MapServer to the PROJ files (proj.db for PROJ >=6, or epsg file for PROJ <6) :
1. Use MapServer's global configuration file, available since the MapServer 8.0 release, to set the "PROJ_DATA" environment variable. The default name of the config file is mapserver.conf (for MS4W users, the file is
/ms4w/ms4w.conf ). Your config file could contain an ENV section such as:



See alsoCONFIG
2. Set the MAP object's CONFIG parameter in your mapfile to specify the location of PROJ files:


(continues on next page)



(continued from previous page)
It is important that the CONFIG "PROJ_DATA" line comes before the PROJECTION block.
3. Set a system variable ("environment variable" on windows) called "PROJ_DATA" and point it to your proj di- rectory.
4. Set an environment variable through your web server. Apache has a SetEnv directive that can set environment variables. Add something like the following to your Apache httpd.conf file:


Important Notes
• If all of your data in the mapfile is in the same projection, you DO NOT have to specify any projection objects. MapServer will assume that all of the data is in the same projection.
• Think of the MAP-level projection object as your output projection. The EXTENT and UNITS values at the MAP- level must be in the output projection units. Also, if you have layers in other projections (other than the MAP-level projection) then you must define PROJECTION objects for those layers, to tell MapServer what projections they
are in.
• If you specify a MAP-level projection, and then only one other LAYER projection object, MapServer will assume that all of the other layers are in the specified MAP-level projection.
• Always refer to the EPSG file in lowercase, because it is a lowercase filename and on Linux/Unix systems this parameter is case sensitive.


For More Information
• If you get projection errors, refer to the Errors to check if your exact error has been discussed.
• Search the MapServer-users email list archives, odds are that someone has faced your exact issue before.
• See the PROJ user guides for complete descriptions of supported projections and coordinate systems.
• Read more about the history of the Web Mercator projection.
• A respected author on map projections is John P. Snyder, if you are wishing for printed material to review.
• To lookup specific EPSG projection codes, the website https://spatialreference.org/ is recommended, and https:
//epsg.io/ may also be useful. The main EPSG site now also contains a text or map search for EPSG codes :
https://epsg.org/home.html


4.1.22 QUERYMAP
COLOR [r] [g] [b] | [hexadecimal string]
Color in which features are highlighted. Default is yellow.
• r, g and b shall be integers [0..255]. To specify green, the following is used:

• hexadecimal string can be
- RGB value: "#rrggbb". To specify magenta, the following is used:

- RGBA value (adding translucence): "#rrggbbaa". To specify a semi-translucent magenta, the follow- ing is used:

SIZE [x][y]
Size of the map in pixels. Defaults to the size defined in the map object. Minimum x and y values are -1 (to allow for querymaps to be hidden), and maximum values are the same as the parent MAP MAXSIZE.
STATUS [on|off]
Is the query map to be drawn?
STYLE [normal|hilite|selected]
Sets how selected features are to be handled. Layers not queried are drawn as usual.
• Normal: Draws all features according to the settings for that layer.
• Hilite: Draws selected features using COLOR. Non-selected features are drawn normally.
• Selected: draws only the selected features normally.

4.1.23 REFERENCE
Three types of reference maps are supported. The most common would be one showing the extent of a map in an interactive interface. It is also possible to request reference maps as part of a query. Point queries will generate an image with a marker (see below) placed at the query point. Region based queries will depict the extent of the area of interest. Finally, feature based queries will display the selection feature(s) used.
COLOR [r] [g] [b] | [hexadecimal string]
Color in which the reference box is drawn. Set any component to -1 for no fill. Default is red.
• r, g and b shall be integers [0..255]. To specify green, the following is used:

• hexadecimal string can be
- RGB value: "#rrggbb". To specify magenta, the following is used:

- RGBA value (adding translucence): "#rrggbbaa". To specify a semi-translucent magenta, the follow- ing is used:





EXTENT [minx][miny][maxx][maxy]
The spatial extent of the base reference image.
IMAGE [filename]
Full filename of the base reference image. Must be a GIF image.
MARKER [integer|string]
Defines a symbol (from the symbol file) to use when the box becomes too small (see MINBOXSIZE and MAXBOXSIZE below). Uses a crosshair by default. Must be greater or equal to 0. A value of 0 indicates the default symbol for the geometry type.
MARKERSIZE [integer]
Defines the size of the symbol to use instead of a box (see MARKER above). Must be greater than 0.
MINBOXSIZE [integer]
If box is smaller than MINBOXSIZE (use box width or height) then use the symbol defined by MARKER and MARKERSIZE. Must be greater than 0.
MAXBOXSIZE [integer]
If box is greater than MAXBOXSIZE (use box width or height) then draw nothing (often the whole map gets covered when zoomed way out and it's perfectly obvious where you are). Must be greater than 0.
OUTLINECOLOR [r] [g] [b] | [hexadecimal string]
Color to use for outlining the reference box. Set any component to -1 for no outline.
• r, g and b shall be integers [0..255]. To specify green, the following is used:

• hexadecimal string can be
- RGB value: "#rrggbb". To specify magenta, the following is used:

- RGBA value (adding translucence): "#rrggbbaa". To specify a semi-translucent magenta, the follow- ing is used:

SIZE [x][y]
Size, in pixels, of the base reference image. These values must both be 5 or greater.
STATUS [on|off]
Is the reference map to be created? Default it off.

4.1.24 SCALEBAR






Scalebars currently do not make use of TrueType fonts. The size of the scalebar image is NOT known prior to rendering, so be careful not to hard-code width and height in the <IMG> tag in the template file. Future versions will make the image size available.
ALIGN [left|center|right]
Added in version 5.2.
Defines how the scalebar is aligned within the scalebar image. Default is center. Available in versions 5.2 and higher.
BACKGROUNDCOLOR [r] [g] [b] | [hexadecimal string]
Color to use for scalebar background, not the image background.
• r, g and b shall be integers [0..255]. To specify green, the following is used:

• hexadecimal string can be
- RGB value: "#rrggbb". To specify magenta, the following is used:

- RGBA value (adding translucence): "#rrggbbaa". To specify a semi-translucent magenta, the follow- ing is used:

COLOR [r] [g] [b] | [hexadecimal string]
Color to use for drawing all features if attribute tables are not used.
• r, g and b shall be integers [0..255]. To specify green, the following is used:

• hexadecimal string can be
- RGB value: "#rrggbb". To specify magenta, the following is used:

- RGBA value (adding translucence): "#rrggbbaa". To specify a semi-translucent magenta, the follow- ing is used:

IMAGECOLOR [r] [g] [b] | [hexadecimal string]
Color to initialize the scalebar with (i.e. background).
• r, g and b shall be integers [0..255]. To specify green, the following is used:




• hexadecimal string can be
- RGB value: "#rrggbb". To specify magenta, the following is used:

- RGBA value (adding translucence): "#rrggbbaa". To specify a semi-translucent magenta, the follow- ing is used:

INTERLACE [true|false]
Removed in version 8.0.
Should output images be interlaced? Default is [on]. This keyword is now deprecated in favour of using the FORMATOPTION "INTERLACE=ON" line in the OUTPUTFORMAT declaration.
INTERVALS [integer]
Number of intervals to break the scalebar into. Default is 4. Minimum value is 1 and maximum is 100.
LABEL
Signals the start of a LABEL object.
OFFSET [x] [y]
Added in version 7.2.
'OFFSET' moves the scalebar closer to the center of the map. Minimum value is -50 and maximum is 50. Examples:
• If POSITION is "LL" then "OFFSET 5 2" will shift the scalebar 2 pixels up and 5 pixels to the right.
• If POSITION is "UR" then "OFFSET 5 2" will shift the scalebar 2 pixels down and 5 pixels to the left.
OUTLINECOLOR [r] [g] [b] | [hexadecimal string]
Color to use for outlining individual intervals. Set any component to -1 for no outline which is the default.
• r, g and b shall be integers [0..255]. To specify green, the following is used:

• hexadecimal string can be
- RGB value: "#rrggbb". To specify magenta, the following is used:

- RGBA value (adding translucence): "#rrggbbaa". To specify a semi-translucent magenta, the follow- ing is used:

POSITION [ul|uc|ur|ll|lc|lr]
Where to place an embedded scalebar in the image. Default is lr.
POSTLABELCACHE [true|false]
For use with embedded scalebars only. Tells the MapServer to embed the scalebar after all labels in the cache have been drawn. Default is false.
SIZE [x][y]
Size in pixels of the scalebar. Labeling is not taken into account. Minimum x (width) is 5 and minimum y (height) is 2. Maximum x (width) is 1000 and maximum y (height) is 100.



STATUS [on|off|embed]
Is the scalebar image to be created, and if so should it be embedded into the image? Default is off. (Please note that embedding scalebars require that you define a markerset. In essence the scalebar becomes a custom marker that is handled just like any other annotation.)
STYLE [integer]
Chooses the scalebar style. Valid styles are 0 and 1.
TRANSPARENT [on|off]
By default, a scalebar will inherit the same transparency setting as the map OUTPUTFORMAT . However, this flag can be used to override this setting, allowing, for example, a transparent scalebar to be embedded in a non-transparent map.
UNITS [feet|inches|kilometers|meters|miles|nauticalmiles]
Output scalebar units, default is miles. Used in conjunction with the map's units to develop the actual graphic. Note that decimal degrees are not valid scalebar units. Nauticalmiles was added in MapServer 5.6.

4.1.25 STYLE
Style holds parameters for symbolization and styling. Multiple styles may be applied within a CLASS or LABEL.
This object appeared in 4.0 and the intention is to separate logic from looks. The final intent is to have named styles (Not yet supported) that will be re-usable through the mapfile. This is the way of defining the appearance of an object (a CLASS or a LABEL).
ANGLE [double|attribute|AUTO]
Angle, given in degrees, to rotate the symbol (counter clockwise). Default is 0 (no rotation), and must be in the range 0 to 360. If you have an attribute that specifies angles in a clockwise direction (compass direction), you have to adjust the angle attribute values before they reach MapServer (360-ANGLE), as it is not possible to use a mathematical expression for ANGLE.
• For points, it specifies the rotation of the symbol around its center.
• For decorated lines, the behaviour depends on the value of the GAP element.
- For negative GAP values it specifies the rotation of the decoration symbol relative to the direction of the line. An angle of 0 means that the symbol's x-axis is oriented along the direction of the line.
- For non-negative (or absent) GAP values it specifies the rotation of the decoration symbol around its center. An angle of 0 means that the symbol is not rotated.
• For polygons, it specifies the angle of the lines in a HATCH symbol (0 - horizontal lines), or it specifies the rotation of the symbol used to generate the pattern in a polygon fill (it does not specify the rotation of the fill as a whole). For its use with hatched lines, see Example #7 in the symbology examples.
• [attribute] was introduced in version 5.0, to specify the attribute to use for angle values. The hard brackets [] are required. For example, if your data source has an attribute named "MYROTATE" that holds angle values for each feature, your STYLE object for hatched lines might contain:

The associated RFC document for this feature is RFC19.



• The AUTO keyword was added in version 5.4, and currently only applies when coupled with the GEOM- TRANSFORM keyword.
ANGLEITEM [string]
Removed in version 8.0.
ANGLE[attribute] must now be used instead.
ANTIALIAS [true|false]
Removed in version 8.0: GD support was removed in 7.0 (and this mapfile parameter was removed in 8.0) Should antialiasing be applied to the style. For line rendering only. Default is false.
BACKGROUNDCOLOR [r] [g] [b] | [hexadecimal string]
Removed in version 8.0: Use multiple STYLEs instead, as shown in the note below. Color to use for non-transparent symbols.


COLOR [r] [g] [b] | [hexadecimal string] | [attribute]
Color to use for drawing features.
• r, g and b shall be integers [0..255]. To specify green, the following is used:

• hexadecimal string can be
- RGB value: "#rrggbb". To specify magenta, the following is used:

- RGBA value (adding translucence): "#rrggbbaa". To specify a semi-translucent magenta, the follow- ing is used:

• [attribute] was introduced in version 5.0, to specify the attribute to use for color values. The hard brackets [] are required. For example, if your data set has an attribute named "MYPAINT" that holds color values for each record, use: object for might contain:





If COLOR is not specified, and it is not a SYMBOL of TYPE pixmap, then the symbol will not be rendered. The associated RFC document for this feature is RFC19.
COLORRANGE [r] [g] [b] [r] [g] [b] | [hexadecimal string] [hexadecimal string]
Defines two colors to correspond to the low and high ends of the DATARANGE values. Colors are mapped to a continuous linear gradient between the two values.
See Kernel Density Estimation (Dynamic Heatmap) for further details on applying these to raster layers, and RFC6 for working with vector layers.
DATARANGE [integer|double] [integer|double]
Defines two values, a low value and a high value, that MapServer will map to the color range defined by the COLORRANGE entry. Values must be integers or doubles. Colors are mapped to a continuous linear gradient between the two values.
See Kernel Density Estimation (Dynamic Heatmap) for further details on applying these to raster layers, and RFC6 for working with vector layers.
GAP [double]
Added in version 6.0: moved from SYMBOL
GAP specifies the distance between SYMBOLs (center to center) for decorated lines and polygon fills in layer SIZEUNITS. For polygon fills, GAP specifies the distance between SYMBOLs in both the X and the Y direction. For lines, the centers of the SYMBOLs are placed on the line. As of MapServer 5.0 this also applies to PixMap symbols.
When scaling of symbols is in effect (SYMBOLSCALEDENOM is specified for the LAYER), GAP specifies the distance in layer SIZEUNITS at the map scale 1:SYMBOLSCALEDENOM.
• For lines, if INITIALGAP is not specified, the first symbol will be placed GAP/2 from the start of the line.
• For lines, a negative GAP value will cause the symbols' X axis to be aligned relative to the tangent of the line.
• For lines, a positive GAP value aligns the symbols' X axis relative to the X axis of the output device.
• For lines, a GAP of 0 (the default value) will cause the symbols to be rendered edge to edge
• For polygons, a missing GAP or a GAP of less than or equal to the size of the symbol will cause the symbols to be rendered edge to edge.
Symbols can be rotated using ANGLE.


GEOMTRANSFORM [bbox|centroid|end|labelcenter|labelpnt|labelpoly|start|vertices|<expression>]
Used to indicate that the current feature will be transformed before the actual style is applied. Introduced in version 5.4.
• bbox: produces the bounding box of the current feature geometry.
• centroid: produces the centroid of the current feature geometry.



• end: produces the last point of the current feature geometry. When used with ANGLE AUTO, it can for instance be used to render arrowheads on line segments.
• labelcenter: used for LABEL styles. Places the text in the center of the feature.
• labelpnt: used for LABEL styles. Draws a marker on the geographic position the label is attached to. This corresponds to the center of the label text only if the label is in position CC.
• labelpoly: used for LABEL styles. Produces a polygon that covers the label plus a 1 pixel padding.
• start: produces the first point of the current feature geometry. When used with ANGLE AUTO, it can for instance be used to render arrow tails on line segments.
• vertices: produces all the intermediate vertices (points) of the current feature geometry (the start and end are excluded). When used with ANGLE AUTO, the marker is oriented by the half angle formed by the two adjacent line segments.
• <expression>: Applies the given expression to the geometry. Supported expressions:
- (buffer([shape],dist)): Buffer the geometry ([shape]) using dist pixels as buffer distance. For polygons, a negative dist will produce a setback.
- (generalize([shape],tolerance)): simplifies a geometry ([shape]) in way comparable to FME's ThinNoPoint algorithm. See https://trac.osgeo.org/gdal/ticket/966 for more information.


- (simplify([shape],tolerance)): simplifies a geometry ([shape]) using the standard Douglas-Peucker algorithm.
- (simplifypt([shape],tolerance)): simplifies a geometry ([shape]), ensuring that the result is a valid geometry having the same dimension and number of components as the input. tolerance must be non-negative.
- (smoothsia([shape], smoothing_size, smoothing_iteration, preprocessing)): will smooth a geometry ([shape]) using the SIA algorithm
Example (polygon data set) - draw a two pixel wide line 5 pixels inside the boundary of the polygon:




hape

There is a difference between STYLE and LAYER GEOMTRANSFORM. LAYER-level will receive ground coordinates (meters, degrees, etc) and STYLE-level will receive pixel coordinates. The argument to methods such as simplify() must be in the same units as the coordinates of the shapes at that point of the rendering workflow, i.e. pixels at the STYLE-level and in ground units at the LAYER-level.
LAYER NAME "my_layer"
TYPE LINE
STATUS DEFAULT
DATA "lines.shp"

GEOMTRANSFORM (simplify([s
CLASS

], 10))	## 10 ground units



(continues on next page)



(continued from previous page)


See alsoGEOMTRANSFORM - Geometry Transformations
INITIALGAP [double]
Added in version 6.2.
INITIALGAP is useful for styling dashed lines. Value must be greater or equal to 0.
If used with GAP, INITIALGAP specifies the distance to the first symbol on a styled line.
If used with PATTERN, INITIALGAP specifies the distance to the first dash on a dashed line. Example 1 - dashed line styled with circles:
Example 1 - dashed line styled with dashed line overlay:

LINECAP [butt|round|square]
Added in version 6.0: moved from SYMBOL



Sets the line cap type for lines. Default is round. See Cartographical Symbol Construction with MapServer for explanation and examples.
LINEJOIN [round|miter|bevel|none]
Added in version 6.0: moved from SYMBOL
Sets the line join type for lines. Default is round. See Cartographical Symbol Construction with MapServer for explanation and examples.
LINEJOINMAXSIZE [int]
Added in version 6.0: moved from SYMBOL
Sets the max length of the miter LINEJOIN type. The value represents a coefficient which multiplies a current symbol size. Default is 3. Must be greater than 0. See Cartographical Symbol Construction with MapServer for explanation and examples.
MAXSCALEDENOM [double]
Added in version 5.4.
Minimum scale at which this STYLE is drawn. Scale is given as the denominator of the actual scale fraction, for example for a map at a scale of 1:24,000 use 24000. Must be greater or equal to 0.

See alsoMap Scale
MAXSIZE [double]
Maximum size in pixels to draw a symbol. Default is 500. Must be greater than 0. Starting from version 5.4, the value can also be a decimal value (and not only integer). See LAYER SYMBOLSCALEDENOM.
MAXWIDTH [double]
Maximum width in pixels to draw the line work. Default is 32. Must be greater than 0. Starting from version 5.4, the value can also be a decimal value (and not only integer). See LAYER SYMBOLSCALEDENOM.
MINSCALEDENOM [double]
Added in version 5.4.
Maximum scale at which this STYLE is drawn. Scale is given as the denominator of the actual scale fraction, for example for a map at a scale of 1:24,000 use 24000. Must be greater or equal to 0.

See alsoMap Scale
MINSIZE [double]
Minimum size in pixels to draw a symbol. Default is 0. Must be greater or equal to 0. Starting from version 5.4, the value can also be a decimal value (and not only integer). See LAYER SYMBOLSCALEDENOM.
MINWIDTH [double]
Minimum width in pixels to draw the line work. Default is 0. Must be greater or equal to 0. Starting from version 5.4, the value can also be a decimal value (and not only integer). See LAYER SYMBOLSCALEDENOM.
OFFSET [double|attribute] [double|attribute]
Geometry offset values in layer SIZEUNITS. In the general case, SIZEUNITS will be pixels. The first parameter corresponds to a shift on the horizontal - x, and the second parameter to and a shift on the vertical - y.



When scaling of symbols is in effect (SYMBOLSCALEDENOM is specified for the LAYER), OFFSET gives offset values in layer SIZEUNITS at the map scale 1:SYMBOLSCALEDENOM.
An OFFSET of 20 40 will shift the geometry 20 SIZEUNITS to the left and 40 SIZEUNITS down before render- ing.
For lines, an OFFSET of y = -99 will produce a line geometry that is shifted x SIZEUNITS perpendicular to the original line geometry. A positive x shifts the line to the right when seen along the direction of the line. A negative x shifts the line to the left when seen along the direction of the line.
For lines, an OFFSET of y = -999 (added in version 6.4) will produce a multiline geometry corresponding to the borders of a line that is x SIZEUNITS wide. This can be used to render only the outlines of a thick line.
OPACITY [integer|attribute]
Opacity to draw the current style (applies to 5.2+, AGG Rendering Specifics only, does not apply to pixmap symbols)
• [attribute] was introduced in version 5.6, to specify the attribute to use for opacity values.
OUTLINECOLOR [r] [g] [b] | [hexadecimal string] | [attribute]
Color to use for outlining polygons and certain marker symbols (ellipse, vector polygons and truetype). Has no effect for lines. The width of the outline can be specified using WIDTH. If no WIDTH is specified, an outline of one pixel will be drawn.
If there is a SYMBOL defined for the STYLE, the OUTLINECOLOR will be used to create an outline for that SYMBOL (only ellipse, truetype and polygon vector symbols will get an outline). If there is no SYMBOL defined for the STYLE, the polygon will get an outline.
• r, g and b shall be integers [0..255]. To specify green, the following is used:

• hexadecimal string can be
- RGB value: "#rrggbb". To specify magenta, the following is used:

- RGBA value (adding translucence): "#rrggbbaa". To specify a semi-translucent magenta, the follow- ing is used:

• [attribute] was introduced in version 5.0, to specify the attribute to use for color values. The hard brackets [] are required. For example, if your data set has an attribute named "MYPAINT" that holds color values for each record, use: object for might contain:

The associated RFC document for this feature is RFC19.
OUTLINEWIDTH [double|attribute]
Added in version 5.4.
Width in pixels for the outline. Default is 0.0. Must be greater or equal to 0. The thickness of the outline will not depend on the scale.
PATTERN [double on] [double off] [double on] [double off] . . . END
Added in version 6.0: moved from SYMBOL



Used to define a dash pattern for line work (lines, polygon outlines, hatch lines, . . . ). The numbers (doubles) specify the lengths of the dashes and gaps of the dash pattern in layer SIZEUNITS. When scaling of symbols is in effect (SYMBOLSCALEDENOM is specified for the LAYER), the numbers specify the lengths of the dashes and gaps in layer SIZEUNITS at the map scale 1:SYMBOLSCALEDENOM.
LINECAP, LINEJOIN and LINEJOINMAXSIZE can be used to control the appearance of the dashed lines.
To specify a dashed line that is 5 units wide, with dash lengths of 5 units and gaps of 5 units, the following style can be used:

Since version 6.2, PATTERN can be used to create dashed lines for SYMBOLs of TYPE hatch. Patterns for hatches are always drawn with LINECAP butt. The patterns are generated relative to the edges of the bounding box of the polygon (an illustrated example can be found in the hatch fill section of the symbol construction document).
POLAROFFSET [double|attribute] [double|attribute]
Added in version 6.2: (added through RFC 78) Offset given in polar coordinates.
The first parameter is a double value in layer SIZEUNITS (or the name of a layer attribute) that specifies the radius/distance.
The second parameter is a double value (or the name of a layer attribute) that specifies the angle (counter clock- wise).
When scaling of symbols is in effect (SYMBOLSCALEDENOM is specified for the LAYER), POLAROFFSET
gives the distance in layer SIZEUNITS at the map scale 1:SYMBOLSCALEDENOM.
A POLAROFFSET of 20 40 will shift the geometry to a position that is 20 SIZEUNITS away along a line that is at an angle of 40 degrees with a line that goes horizontally to the right.
When POLAROFFSET is used with layers that have CONNECTIONTYPE uvraster (vector field), the special attributes uv_length, uv_length_2, uv_angle and uv_minus_angle are available, making it convenient to specify arrow heads and tails. Example:

















(continues on next page)



(continued from previous page)
RANGEITEM [attribute]
Specifies the attribute that will be used to map colors between the high and low ends of the COLORRANGE
entry. Colors are mapped to a continuous linear gradient between the two values. Here is an example mapping the values 0.0-1.0 to RED-GREEN:
See the associated RFC document RFC6.
SIZE [double|attribute|expression]
Height, in layer SIZEUNITS, of the symbol/pattern to be used. Default value depends on the SYMBOL TYPE. For pixmap: the height (in pixels) of the pixmap; for ellipse and vector: the maximum y value of the SYMBOL POINTS parameter, for hatch: 1.0, for truetype: 1.0. In all cases the value must be greater than 0.
When scaling of symbols is in effect (SYMBOLSCALEDENOM is specified for the LAYER), SIZE gives the height, in layer SIZEUNITS, of the symbol/pattern to be used at the map scale 1:SYMBOLSCALEDENOM.
• For symbols of TYPE hatch, the SIZE is the center to center distance between the lines. For its use with hatched lines, see Example#8 in the symbology examples.
• [attribute] was introduced in version 5.0, to specify the attribute to use for size values. The hard brackets [] are required. For example, if your data set has an attribute named "MYHEIGHT" that holds size values for each feature, your STYLE object for hatched lines might contain:

The associated RFC document for this feature is RFC19.
• Starting from version 5.4, the value can also be a decimal value (and not only integer).



• [expression] was introduced in version 8.2 to allow expressions to be used to calculate size values. Expres- sions must return a numeric value, and attributes can be used as part of the expression.

SYMBOL [integer|string|filename|url|attribute]
The symbol to use for rendering the features.
• Integer is the index of the symbol in the symbol set, starting at 1 (the 5th symbol is symbol number 5). A value of 0 is the default symbol for the geometry type.
• String is the name of the symbol (as defined using the SYMBOL NAME parameter).
• Filename specifies the path to a file containing a symbol. For example a PNG file. Specify the path relative to the directory containing the mapfile.
• URL
Added in version 6.0.
URL specifies the address of a file containing a pixmap symbol. For example a PNG file. A URL must start with "http":

• [attribute]
Added in version 5.6.
Allows individual rendering of features by using an attribute in the dataset that specifies the symbol name (as defined in the SYMBOL NAME parameter). The hard brackets [] are required.
If SYMBOL is not specified, the behaviour depends on the type of feature.
• For points, nothing will be rendered.
• For lines, SYMBOL is only relevant if you want to style the lines using symbols, so the absence of SYMBOL means that you will get lines as specified using the relevant line rendering parameters (COLOR, WIDTH, PATTERN, LINECAP, . . . ).
• For polygons, the interior of the polygons will be rendered using a solid fill of the color specified in the
COLOR parameter.

See alsoSYMBOL
WIDTH [double|attribute]
WIDTH refers to the thickness of line work drawn, in layer SIZEUNITS. Default is 1.0. Must be greater or equal to 0.
When scaling of symbols is in effect (SYMBOLSCALEDENOM is specified for the LAYER), WIDTH refers to the thickness of the line work in layer SIZEUNITS at the map scale 1:SYMBOLSCALEDENOM.
• If used with SYMBOL and OUTLINECOLOR, WIDTH specifies the width of the symbol outlines. This applies to SYMBOL TYPE vector (polygons), ellipse and truetype.



• For lines, WIDTH specifies the width of the line.
• For polygons, if used with OUTLINECOLOR, WIDTH specifies the thickness of the polygon outline.
• For a symbol of SYMBOL TYPE hatch, WIDTH specifies the thickness of the hatched lines. For its use with hatched lines, see Example #7 in the symbology examples.
• [attribute] was added in version 5.4 to specify the attribute to use for the width value. The hard brackets [] are required.
• Starting from version 5.4, the value can also be a decimal value (and not only integer).

4.1.26 STYLEITEM Javascript
Author
Charles-Éric Bourget
Contact
cbourget at mapgears.com
Author
Alan Boudreault
Contact
aboudreault at mapgears.com
Last Updated
2015-05-21


Introduction
Using STYLEITEM this way makes it possible to style features programmatically rather than with the standard MapServer expressions.

Usage
Simply declare the javascript plugin this way:







(continues on next page)



(continued from previous page)
The path can also be absolute.

The javascript plugin has to implement a function named styleitem that will be automatically called. This function has to return one of these two options:
• a STYLE definition (Plain String)
• a CLASS definition with one or multiple styles (Plain String)




Access to the feature attributes is made through the shape.attributes javascript object. The following javascript functions are available:
• alert(str1, str2, . . . , str)
print some text in MapServer logs
• print(str1, str2, . . . , str)
print some text in MapServer logs
• require(path_to_lib1, path_to_lib2, . . . , path_to_lib)
include one or more javascript lib

Example 1. Single STYLE definition
This example returns a single STYLE definition . . .



(continues on next page)



(continued from previous page)

Example 2. CLASS with multiple STYLE definitions
This example returns a single CLASS with multiple STYLE definitions . . .


Example 3. Printing logs in MapServer logs
This example prints some javascript logs in MapServer logs.







4.1.27 SYMBOL
• Symbol definitions can be included within the main map file or, more commonly, in a separate file. Symbol definitions in a separate file are designated using the SYMBOLSET keyword, as part of the MAP object. This recommended setup is ideal for re-using symbol definitions across multiple MapServer applications.
• There are 3 main types of symbols in MapServer: Markers, Lines and Shadesets.
• Symbol 0 is always the degenerate case for a particular class of symbol. For points, symbol 0 is a single pixel, for shading (i.e. filled polygons) symbol 0 is a solid fill, and for lines, symbol 0 is a single pixel wide line.
• Symbol definitions contain no color information, colors are set within STYLE objects.
• Line styling was moved to CLASS STYLE in MapServer version 5. The mechanisms are no longer available in
SYMBOL.
• For MapServer versions < 5 there is a maximum of 64 symbols per file. This can be changed by editing map- symbol.h and changing the value of MS_MAXSYMBOLS at the top of the file. As of MapServer 5.0 there is no symbol limit.
• More information can be found in the Construction of Cartographic Symbols document.
ANCHORPOINT [x] [y]
Added in version 6.2.
Used to specify the location (within the symbol) that is to be used as an anchorpoint when rotating the symbol and placing the symbol on a map. Default is 0.5 0.5 (corresponding to the center of the symbol).
x: A double in the range [0,1] that specifies the location within the symbol along the x axis. 0 specifies the left edge of the symbol, 1 specifies the right edge of the symbol. 0.5 specifies the center of the symbol (in the x direction).
y: A double in the range [0,1] that specifies the location within the symbol along the y axis. 0 specifies the top edge of the symbol, 1 specifies the lower edge of the symbol. 0.5 specifies the center of the symbol (in the y direction).
ANCHORPOINT can be used with SYMBOLs of TYPE ellipse, pixmap, svg, truetype and vector. To ensure proper behaviour for vector symbols, the left and top edges of the bounding box of the symbol should be at 0.






ANTIALIAS [true|false]
Should TrueType fonts be antialiased. Only useful for GD (gif) rendering. Default is false. Has no effect for the other renderers (where anti-aliasing can not be turned off).

WarningGD support was removed in MapServer 7.0.
CHARACTER [char|entity number]
Character used to reference a particular TrueType font character. You'll need to figure out the mapping from the keyboard character to font character.
HTML entity numbers can also be used, for example:

FILLED [true|false]
If true, the symbol will be filled with a user defined color (using STYLE COLOR). Default is false.
If true, symbols of TYPE ellipse and vector will be treated as polygons (fill color specified using STYLE COLOR
and outline specified using STYLE OUTLINECOLOR and WIDTH).
If false, symbols of TYPE ellipse and vector will be treated as lines (the lines can be given a color using STYLE COLOR and a width using STYLE WIDTH).
FONT [string]
Name of TrueType font to use as defined in the FONTSET .
IMAGE [string]
Filename of image to use as a marker. For type pixmap, use GIF or PNG files; for type svg, use SVG.
NAME [string]
Alias for the symbol. To be used in CLASS STYLE objects.
POINTS [x y] [x y] . . . END
Signifies the start of a sequence of points that make up a symbol of TYPE vector or that define the x and y radius of a symbol of TYPE ellipse. The end of this section is signified with the keyword END. The x and y values can be given using decimal numbers. The maximum x and y values define the bounding box of the symbol. The size (actually height) of a symbol is defined in the STYLE. You can create non-contiguous paths by inserting "-99 -99" at the appropriate places.
x values increase to the right, y values increase downwards.
For symbols of TYPE ellipse, a single point is specified that defines the x and y radius of the ellipse. Circles are created when x and y are equal.






TRANSPARENT [color index]
Sets a transparent color for the input image for pixmap symbols, or determines whether all shade symbols should have a transparent background. For shade symbols it may be desirable to have background features "show through" a transparent hatching pattern, creating a more complex map. By default a symbol's background is the same as the parent image (i.e. color 0). This is user configurable.



WarningGD support was removed in MapServer 7.0.
TYPE [ellipse|hatch|pixmap|svg|truetype|vector]
• ellipse: radius values in the x and y directions define an ellipse.
• hatch: produces hatched lines throughout the (polygon) shape.
• pixmap: a user supplied image will be used as the symbol.
• svg: scalable vector graphics (SVG) symbol. Requires the libsvg/libsvg-cairo libraries (or alternatively the librsvg library).
• truetype: TrueType font to use as defined in the MAP FONTSET .
• vector: a vector drawing is used to define the shape of the symbol.


4.1.28 Symbology Examples
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Author
Håvard Tveite



Last Updated
2022-08-15


Example 1. Dashed Line
This example creates a dashed line that is 5 SIZEUNITS wide, with 10 SIZEUNITS on, 5 off, 5 on, 10 off . . .


Example 2. TrueType font marker symbol
This example symbol is a star, used to represent the national capital, hence the name. The font name in defined in the
FONTSET file. The code number "114" varies, you can use MS Windows' character map to figure it out, or guestimate.




Example 3. Vector triangle marker symbol
This example is fairly straight forward. Note that to have 3 sides you need 4 points, hence the first and last points are identical. The triangle is not filled.





0420440
END4

Example 4. Non-contiguous vector marker symbol (Cross)
This example draws a cross, that is 2 lines (vectors) that are not connected end-to-end (Like the triangle in the previous example). The negative values separate the two.





2.00.02.04.0-99-990.02.04.02.0


Example 5. Circle vector symbol
This example creates a simple filled circle. Using non-equal values for the point will give you an actual ellipse.


Example 6. Downward diagonal fill
This example creates a symbol that can be used to create a downward diagonal fill for polygons.




(continues on next page)



(continued from previous page)

Example 7. Using the Symbol Type HATCH (new in 4.6)
As of MapServer 4.6, you can use the symbol type HATCH to produce hatched lines. The following will display hatched lines at a 45 degree angle, 10 SIZEUNITS apart (center to center), and 3 SIZEUNITS wide.
Symbol definition:

Layer definition:

Other parameters available for HATCH are: MINSIZE, MAXSIZE, MINWIDTH, and MAXWIDTH.

Example 8. Styled lines using GAP
This example shows how to style lines with symbols.
A 5 SIZEUNITS wide black line is decorated with ellipses that are 15 SIZEUNITS long (and 7.5 SIZEUNITS'wide). The ellipses are placed 30 'SIZEUNITS apart, and the negative GAP value ensures that the ellipses are oriented relative to the direction of the line. The ellipses are rotated 30 degrees counter clock-wise from their position along the line.
Symbol definition:




Layer definition:


4.1.29 Templating
Author
Frank Koormann
Contact
frank.koormann at intevation.de
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2024-01-25


Introduction
Templates are used:
• to define the look of a MapServer CGI application interface
• to present the results of a query.
• to create customised output (see Template-Driven Output)



They guide the presentation of results, either a query or a map, to the user. Templates are almost always HTML files although they can also be a URL (e.g.. http://www.somewhere.com/{[}ATTRIBUTE{]}/info.html). URL templates can only be used with simple QUERY or ITEMQUERY results so many substitutions defined below are not available for them. Simple pan/zoom interfaces use a single template file while complicated queries often require many templates. Templates often use JavaScript to enhance the basic interface.

Notes
• Templates must contain the magic string 'mapserver template' in the first line of the template. Often this takes the form of an HTML, javascript or XML comment. This line is not written to the client. The magic string is not case sensitive.
• MapServer will only accept certain file extensions for templates; valid file extensions are:

• All CGI parameters can be referenced in template substitutions, MapServer specific parameters as well as user defined ones. In principle parameters are handed through by the MapServer 1:1. This feature is essential for implementing MapServer applications.
The reference below only lists special template substitution strings which are needed to obtain information mod- ified by the MapServer, e.g. a new scale, query results, etc.
• Template substitution strings are case sensitive.
• Attribute item substitutions must be the same case as the item names in the dbase file.
• ArcView and ArcInfo generally produce dbase files with item names that are all uppercase. Appropriate URL encoding (i.e. ' ' to '+') is applied when templates are URLs.
• Some substitutions are also available in escaped form (i.e. URL encoded).
As an example this is needed when generating links within a template. This might pass the current mapextent to a new MapServer call. [mapext] is substituted by a space delimited set of lower left and upper right coordinates. This would break the URL. [mapext_esc] is substituted by a proper encoded set.

Format
Templates are simply HTML files or URL strings that contains special characters that are replaced by mapserv each time the template is processed. The simple substitution allows information such as active layers or the spatial extent to be passed from the user to mapserv and back again. Most often the new values are dumped into form variables that will be passed on again. The list of special characters and form variables is given below. HTML templates can include just about anything including JavaScript and Java calls.
In HTML files, the attribute values can be inside quotes(""). Writing attribute values inside quotes allows you to set special characters in value that you couldn't use normally (ie: ],=," and space). To write a single quote in a attribute value, just use two quotes ("").



General
[date]
Outputs the date (as per the web server's clock). The default format is the same as is used by Apache's Common Log format, which looks like:

Available arguments:
• format=
A format string as supported by the standard C strftime() function. As an example, the default format
is defined as:










[version]
• 
tz=


timezone to use for the date returned. Default is "local". Valid values are:
- "gmt"
Output date will be Greenwich time
- "local"
Output the time in the web server's local time zone.
Additionally or alternatively, the %z and %Z strftime format strings allow the timezone offset or name to be output.


[id]


[host]

[port]

The MapServer version number.

Unique session id. The id can be passed in via a form but is more commonly generated by the software. In that case the id is a concatenation of UNIX time (or NT equivalent) and the process id. Unless you're getting more requests in a second than the system has process ids the id can be considered unique. ;->

Hostname of the web server.

Port the web server is listening to.

[post or get variable name], [post or get variable name_esc]
The contents of any variables passed to the MapServer, whether they were used or not, can be echoed this way. One use might be to have the user set a map title or north arrow style in an interactive map composer. The system doesn't care about the values, but they might be real important in creating the final output, e.g. if you specified a CGI parameter like myvalue=.  you can access this in the template file with [myvalue].
Also available as escaped version.
[web_meta data key],[web_meta data key_esc]
Web object meta data access (e.g [web_projection] Also available as escaped version.
[errmsg], [errmsg_esc]
Current error stack output. Various error messages are delimited by semi-colons. Also available as escaped version.



File Reference
[img]




[ref]

Path (relative to document root) of the new image, just the image name if IMAGEURL is not set in the mapfile.
In a map interface template, [img] is substituted with the path to the map image. In a query results template, it is substituted with the path to the querymap image (if a QUERYMAP object is defined in the Mapfile).

Path (relative to document root) of the new reference image.

[legend]
Path (relative to document root) of new legend image rendered by the MapServer.
Since version 3.5.1 a new HTML Legend template is provided by MapServer. If a template is defined in the Mapfile the [legend] string is replaced by the processed legend as. See the HTML Legends with MapServer for details.
[scalebar]
Path (relative to document root) of new scalebar image.
[queryfile]
Path to the query file (if savequery was set as a CGI Parameter).
[map]
Path to the map file (if savemap was set as a CGI Parameter).

Image Geometry
[center]
Computed image center in pixels. Useful for setting imgxy form variable when map sizes change.
[center_x], [center_y]
Computed image center X or Y coordinate in pixels.
[mapsize], [mapsize_esc]
Current image size in cols and rows (separated by spaces). Also available as escaped version.
[mapwidth], [mapheight]
Current image width or height.
[scaledenom]
Current image scale. The exact value is not appropriate for user information but essential for some applications. The value can be rounded e.g. using JavaScript or server side post processing.
[scale] - deprecated
Since MapServer 5.0 the proper parameter to use is [scaledenom] instead. The deprecated [scale] is the current image scale. The exact value is not appropriate for user information but essential for some applications. The value can be rounded e.g. using JavaScript or server side post processing.
[cellsize]
Size of an pixel in the current image in map units. Useful for distance measurement tools in user interfaces.

Map Geometry
[mapx], [mapy]
X and Y coordinate of mouse click.
[mapext], [mapext_esc]
Full mapextent (separated by spaces).



Also available as escaped version. (mapext_esc is deprecated in MapServer 5.2. You should use the "escape=" argument instead)
The default template [mapext] returns coordinates in the format of: mixx miny maxx maxy Available arguments:
• escape=
Escape the coordinates returned. Default is "none". Valid values are:
- "url"
Use URL escape codes to encode the coordinates returned.
- "none"
Do not escape.
• expand=
Expand the bounds of the extents by a specific value. Specified in map coordinates. For example,
[mapext] might return:

and [mapext expand=1000] would therefore return:

• format=
Format of the coordinates. Default is "$minx $miny $maxx $maxy". For example, to add commas to
the coordinates you would use:

• precision=
The number of decimal places to output for coordinates (default is 0).
[minx], [miny], [maxx], [maxy]
Minimum / maximum X or Y coordinate of new map extent.
[dx], [dy]
The differences of minimum / maximum X or Y coordinate of new map extent.
Useful for creating cachable extents (i.e. 0 0 dx dy) with legends and scalebars
[rawext], [rawext_esc]
Raw mapextent, that is the extent before fitting to a window size (separated by spaces). In cases where input came from imgbox (via Java or whatever) rawext refers to imgbox coordinates transformed to map units. Useful for spatial query building.
Also available as escaped version. (rawext_esc is deprecated in MapServer 5.2. You should use the "escape=" argument instead)
The default template [rawext] returns coordinates in the format of: mixx miny maxx maxy Available arguments:
• escape=
Escape the coordinates returned. Default is "none". Valid values are:
- "url"
Use URL escape codes to encode the coordinates returned.
- "none"
Do not escape.



• expand=
Expand the bounds of the extents by a specific value. Specified in map coordinates. For example,
[rawext] might return:

and [rawext expand=1000] would therefore return:

• format=
Format of the coordinates. Default is "$minx $miny $maxx $maxy". For example, to add commas to
the coordinates you would use:

• precision=
The number of decimal places to output for coordinates (default is 0).
[rawminx], [rawminy], [rawmaxx], [rawmaxy]
Minimum / maximum X or Y coordinate of a raw map/search extent.
The following substitutions are only available if the MapServer was compiled with PROJ support and a PROJECTION
is defined in the Mapfile.
[maplon], [maplat]
Longitude / latitude value of mouse click. Available only when projection enabled.
[mapext_latlon], [mapext_latlon_esc]
Full mapextent (separated by spaces). Available only when projection enabled.
Also available as escaped version. (mapext_latlon_esc is deprecated in MapServer 5.2. You should use the "escape=" argument instead)
The default template [mapext_latlon] returns coordinates in the format of: mixx miny maxx maxy Available arguments:
• escape=
Escape the coordinates returned. Default is "none". Valid values are:
- "url"
Use URL escape codes to encode the coordinates returned.
- "none"
Do not escape.
• expand=
Expand the bounds of the extents by a specific value. Specified in map coordinates. For example,
[mapext_latlon] might return:

and [mapext_latlon expand=1000] would therefore return:

• format=
Format of the coordinates. Default is "$minx $miny $maxx $maxy". For example, to add commas to
the coordinates you would use:





• precision=
The number of decimal places to output for coordinates (default is 0).
[minlon], [minlat], [maxlon] [maxlat]
Minimum / maximum longitude or latitude value of mapextent. Available only when projection enabled.
[refext], [refext_esc]
Reference map extent (separated by spaces).
This template has been added with version 4.6 on behalf of an enhancement request. See the thread in the MapServer ticket#1102 for potential use cases.
Also available as escaped version. (refext_esc is deprecated in MapServer 5.2. You should use the "escape=" argument instead)
The default template [refext] returns coordinates in the format of: mixx miny maxx maxy Available arguments:
• escape=
Escape the coordinates returned. Default is "none". Valid values are:
- "url"
Use URL escape codes to encode the coordinates returned.
- "none"
Do not escape.
• expand=
Expand the bounds of the extents by a specific value. Specified in map coordinates. For example,
[refext] might return:

and [refext expand=1000] would therefore return:

• format=
Format of the coordinates. Default is "$minx $miny $maxx $maxy". For example, to add commas to
the coordinates you would use:





Layer
• 
precision=
The number of decimal places to output for coordinates (default is 0).

[layers] | [layers_esc]
All active layers space delimited. Used for a "POST" request. Also available as escaped version.
[toggle_layers] | [toggle_layers_esc]
List of all layers that can be toggled, i.e. all layers defined in the Mapfile which status is currently not default. Also available as escaped version.



[layername_check | select]
Used for making layers persistent across a map creation session. String is replaced with the keyword "checked", "selected" or "" if layername is on. Layername is the name of a layer as it appears in the Mapfile. Does not work for default layers.
[layername_meta data key]
Layer meta data access (e.g. [streets_build] the underscore is essential).

Zoom
[zoom_minzoom to maxzoom_check|select]
Used for making the zoom factor persistent. Zoom values can range from -25 to 25 by default. The string is replaced with the HTML keyword "checked", "selected" or "" depending on the current zoom value.
E.g. if the zoom is 12, a [zoom_12_select] is replaced with "selected", while a [zoom_13_select] in the same HTML template file is not.
[zoomdir_-1|0|1_check|select]
Used for making the zoom direction persistent. Use check with a radio control or select with a selection list. See the demo for an example. The string is replaced with the HTML keyword "checked", "selected" or "" depending on the current value of zoomdir.

Query
The following substitutions are only available when the template is processed as a result of a query.
[shpext], [shpext_esc]
Extent of current shape plus a 5 percent buffer. Available only when processing query results. The default template [shpext] returns coordinates in the format of: mixx miny maxx maxy Available arguments:
• escape=
Escape the coordinates returned. Default is "none". Valid values are:
- "url"
Use URL escape codes to encode the coordinates returned.
- "none"
Do not escape.
• expand=
Expand the bounds of the extents by a specific value. Specified in map coordinates. For example,
[shpext] might return:

and [shpext expand=1000] would therefore return:

• format=
Format of the coordinates. Default is "$minx $miny $maxx $maxy". For example, to add commas to
the coordinates you would use:




• precision=
The number of decimal places to output for coordinates (default is 0).
[shpminx], [shpminy], [shpmaxx], [shpmaxy]
Minimum / maximum X or Y coordinate of shape extent. Available only when processing query results.
[shpmid]
Middle of the extent of current shape. Available only when processing query results.
[shpmidx], [shpmidy]
X or Y coordinate of middle of the extent of the current shape. Available only when processing query results.
[shpidx]
Index value of the current shape. Available only when processing query results.
[shpclass]
Classindex value of the current shape. Available only when processing query results.
[shpxy formatting options]
The list of shape coordinates, with list formatting options, especially useful for SVG.
The default template [shpxy] returns a comma separated list of space delimited of coordinates (i.e. x1 y1, x2 y2, x3 y3).
Available only when processing query results. Available attributes (h = header, f=footer, s=separator):
• buffer=,
Buffer size, currently the only unit available is pixels. Default is 0.
• centroid=
Should only the centroid of the shape be used? true or false (case insensitive). Default is false.

• cs=


Coordinate separator. Default is ",".

• irh=, irf=, orh=, orf=
Characters to be put before (irh) and after (irf ) inner rings, and before (orh) and after (orf ) outer rings of polygons with holes. Defaults are "".


If neither irh nor orh are set, rings are output as "parts" using ph/pf /ps.
• ph=, pf=, ps=
Characters to put before (ph) and after (pf ) and separators between (ps) feature parts (e.g. rings of
multigeometries). Defaults are ph="", pf="" and ps=" ".
• precision=
The number of decimal places to output for coordinates. Default is 0.
• proj=
The output projection definition for the coordinates, a special value of "image" will convert to image
coordinates. Default is none.
• scale=, scale_x=, scale_y=
Scaling factor for coordinates: Both axes (scale), x axis (scale_x) and y axis (scale_y). Defaults are
1.0.



• sh=, sf=
Characters to put before (sh) and after (sf ) a feature. Defaults are "".
• xh=, xf=
Characters to put before (xh) and after (xf ) the x coordinates. Defaults are xh="" and xf=",").
• yh= yf=
Characters to put before (yh) and after (yf ) the y coordinates. Defaults are "".
As a simple example:

And a more complicated example of outputting KML for multipolygons which may potentially have holes (note that the parameters must all be on one line):

[tileindex]
Index value of the current tile. If no tiles used for the current shape this is replaced by "-1". Available only when processing query results.
[item formatting options]
An attribute table "item", with list formatting options. The "name" attribute is required. Available only when processing query results.
Available attributes:
• name =
The name of an attribute, case insensitive. (required)
• precision =
The number of decimal places to use for numeric data. Use of this will force display as a number and
will lead to unpredictable results with non-numeric data.
• pattern =
Regular expression to compare the value of an item against. The tag is output only if there is a match.

• uc =


Set this attribute to "true" to convert the attribute value to upper case.




• lc =


Set this attribute to "true" to convert the attribute value to lower case.

• commify =
Set this attribute to "true" to add commas to a numeric value. Again, only useful with numeric data.
• escape =
Default escaping is for HTML, but you can escape for inclusion in a URL (=url), or not escape at all
(=none).
• format =
A format string used to output the attribute value. The token "$value" is used to place the value in a
more complex presentation. Default is to output only the value.
• ignoremissing =
Set this attribute to "true" to ignore errors if the attribute set in name is missing for the feature. In this
case the nullformat value will be used, or an empty string if not set. Useful for using the same template for multiple datasets with variations in attribute names.
• nullformat =
String to output if the attribute value is NULL, empty or doesn't match the pattern (if defined). If not
set and any of these conditions occur the item tag is replaced with an empty string.
• padding =
Set to an integer value to pad an item value with spaces to the right. Useful to create fixed width strings.
As a simple example:

[attribute name],[attrribute name_esc],[attribute item name_raw]
Attribute name from the data table of a queried layer. Only attributes for the active query layers are accessible. Case must be the same as what is stored in the data file. ArcView, for example, uses all caps for shapefile field names. Available only when processing query results.
By default the attributes are encoded especially for HTML representation. In addition the escaped version (for use in URLs) as well as the raw data is available.
[Join name_attribute name],[Join name_attribute name_esc], [Join name_attribute name_raw]
One-to-one joins: First the join name (as specified in the Mapfile has to be given, second the tables fields can be accessed similar to the layers attribute data. Available only when processing query results.
By default the attributes are encoded especially for HTML representation. In addition the escaped version (for use in URLs) as well as the raw data is available.
[join_Join name]
One-to-many joins: The more complex variant. If the join type is multiple (one-to-many) the template is replaced by the set of header, template file and footer specified in the Mapfile.
[metadata_meta data key], [metadata_meta data key_esc]
Queried layer meta data access (e.g [metadata_projection] Also available as escaped version.
For query modes that allow for multiple result sets, the following string substitutions are available. For FEATURESE- LECT and FEATURENSELECT modes the totals a re adjusted so as not to include the selection layer. The selection layer results ARE available for display to the user.
[nr]
Total number of results. Useful in web header and footers. Available only when processing query results.




[nl]


[nlr]


[rn]


[lrn]


[cl]


Number of layers returning results. Useful in web header and footers. Available only when processing query results.

Total number of results within the current layer. Useful in web header and footers. Available only when process- ing query results.

Result number within all layers. Starts at 1. Useful in web header and footers. Available only when processing query results.

Result number within the current layer. Starts at 1. Useful in query templates. Available only when processing query results.

Current layer name. Useful in layer headers and footers. Available only when processing query results.


Example Template
A small example to give an idea how to work with templates. Note that it covers MapServer specific templates (e.g. the [map], [mapext]) and user defined templates (e.g. [htmlroot] or [program]) used to store application settings.
1	<!-- MapServer Template -->
2	<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
3	"http://www.w3.org/TR/html4/transitional.dtd">
4	<html>
5	<head>
6	<title>MapServer Template Sample</title>
7	</head>
8
9	<body>
10	MapServer Template Sample<br>
11
12	<!-- The central form the application is based on. -->
13	<form method="GET" action="[program]">
14
15	<!-- CGI MapServer applications are server stateless in principle,
16	all information must be "stored" in the client. This includes
17	some basic settings as below.
18	The example is based on the pan and zoom test suite:
19	http://maps.dnr.state.mn.us/mapserver_demos/tests36/	-->
20	<input type="hidden" name="map" value="[map]">
21	<input type="hidden" name="imgext" value="[mapext]">
22	<input type="hidden" name="imgxy" value="149.5 199.5">
23	<input type="hidden" name="program" value="[program]">
24	<input type="hidden" name="htmlroot" value="[htmlroot]">
25	<input type="hidden" name="map_web" value="[map_web]">
26
27	<!-- A table for minimal page formatting. -->
28	<table border=0 cellpadding=5>
29	<tr>
30	<!-- First column: Map and scale bar -->
31	<td align=center>
32	<!-- The map -->
(continues on next page)



(continued from previous page)
33

34

35

36

37

38

39

40

41

42

43

44

45

46

47

48

49

50

51

52

53

54

55

56

57

58

59

60

61

62

63

64

65

66

4.1.30 VALIDATION




Introduction
Because Run-time Substitution affects potentially sensitive areas of your mapfile such as database columns and file- names, it is mandatory that you use pattern validation (since version 6.0).




Pattern validation uses regular expressions, which are strings that describe how to compare strings to patterns. The exact functionality of your systems' regular expressions may vary, but you can find a lot of general information by a Google search for "regular expression tutorial".
As of MapServer 5.4.0 the preferred mechanism is a VALIDATION block in the LAYER definition. This is only slightly different from the older METADATA mechanism. VALIDATION blocks can be used with CLASS, LAYER and WEB.

If identical keys appear in more than one validation block, then keys in more specialised blocks override those in more generalised blocks. So CLASS overrides LAYER which overrides WEB.

Default values if not provided in the URL
The runtime substitution mechanism will usually create syntactically incorrect, and almost always semantically incor- rect mapfiles if the substitution parameter was not provided in the calling URL.
Since version 5.6, you can provide a default value for any substitution parameter, that will be applied if the parameter was not found in the url. You do this by providing special entries inside CLASS, LAYER or WEB validation blocks:

In this example, the mapfile will be created as if the url contained "&sound=yes&nseats=5&multimedia=yes"



If identical default keys appear in more than one validation block then keys in more specialised blocks override those in more generalised blocks. i.e. CLASS overrides LAYER which overrides WEB.
The same functionality is available using METADATA blocks instead of VALIDATION but this is deprecated as of MapServer 5.4.0.

Test with Commandline
You can test at the commandline, allowing you to test runtime substitution mapfiles without using a webserver, with the mapserv utility such as:


Filter example
You can use runtime substitutions to change values within a FILTER as you go. For example your FILTER could be written like this:

Then (assuming you're using the CGI interface) you could pass in variables named multimedia, nseats and sound with values defined by the user in an HTML form.
You must define validation expressions on these variables to guard against unintentional SQL being submitted to your server. Within the layer you'd do the following:

The first two limit the value of multimedia and sound to yes or no. The third limits the value for nseats to a 2 digit integer.




Expression Example
You can also use runtime substitutions to change values within a CLASS EXPRESSION, such as EXPRESSION ([year]
< %year%).
Again you must define validation expressions on these variables to guard against unintentional requests being submitted to your server. Within the layer you'd do the following:

The first limits the possible values to 4 digits, with each a valid number. The second sets the default value. The entire layer may appear as:








You can test this at the commandline, allowing you to test runtime substitution mapfiles without using a webserver, with the mapserv utility such as:


4.1.31 Union Layer
Author
Tamas Szekeres
Contact
szekerest at gmail.com
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2021-03-30

Table of Contents• Union Layer
- Description
- Requirements
- Mapfile Configuration
- Feature attributes
- Classes and Styles
- Projections
- Supported Processing Options
- Examples
* Mapfile Example




Description
Since version 6.0, MapServer has the ability to display features from multiple vector layers (called 'source layers') in a single mapfile layer. This feature was added through rfc68. Raster layers cannot be combined using this feature.

Requirements
This is a native MapServer option that doesn't use any external libraries to support it.

Mapfile Configuration
• The CONNECTIONTYPE parameter must be set to UNION.
• The CONNECTION parameter must contain a comma separated list of the source layer names.
• All of the source layers and the union layer must be the same TYPE (e.g. all must be TYPE POINT, or all TYPE POLYGON etc.)


For example:


























(continues on next page)



(continued from previous page)

Feature attributes
In the LAYER definition you may refer to any attributes supported by each of the source layers. In addition to the source layer attributes the union layer provides the following additional attributes:
1) Union_SourceLayerName - The name of the source layer the feature belongs to
2) Union_SourceLayerGroup - The group of the source layer the feature belongs to
During the selection / feature query operations only the 'Union_SourceLayerName' and 'Union_SourceLayerGroup' attributes are provided by default. The set of the provided attributes can manually be overridden (and further attributes can be exposed) by using the ITEMS processing option (refer to the example above).

Classes and Styles
We can define the symbology and labelling for the union layers in the same way as for any other layer by specifying the classes and styles. In addition the STYLEITEM AUTO option is also supported for the union layer, which provides to display the features as specified at the source layers. The source layers may also use the STYLEITEM AUTO setting if the underlying data source provides that.

Projections
For speed, it is recommended to always use the same projection for the union layer and source layers. However MapServer will reproject the source layers to the union layer if requested. (for more information on projections in MapServer refer to PROJECTION )

Supported Processing Options
The following processing options can be used with the union layers:
UNION_STATUS_CHECK (TRUE or FALSE)
Controls whether the status of the source layers should be checked and the invisible layers (STATUS=OFF) should be skipped. Default value is FALSE.
UNION_SCALE_CHECK (TRUE or FALSE)
Controls whether the scale range of the source layers should be checked and the invisible layers (falling outside of the scale range and zoom range) should be skipped. Default value is TRUE.
UNION_SRCLAYER_CLOSE_CONNECTION
Override the connection pool setting of the source layers. By introducing this setting we alter the current be- haviour which is equivalent to:




Examples Mapfile Example
The follow example contains 3 source layers in different formats, and one layer (yellow) in a different projection. The union layer uses the STYLEITEM "AUTO" parameter to draw the styles from the source layers. (in this case MapServer will reproject the yellow features, in EPSG:4326, for the union layer, which is in EPSG:3978).






























(continues on next page)



(continued from previous page)
DATA 'nb.shp'
CLASS
NAME 'red'
STYLE
OUTLINECOLOR 0 0 0
COLOR 255 85 0
END
   END END

LAYER
NAME 'green' TYPE POLYGON STATUS OFF
CONNECTIONTYPE OGR CONNECTION 'ns.mif' CLASS
NAME 'green'
STYLE
OUTLINECOLOR 0 0 0
COLOR 90 218 71
END
   END END

LAYER
NAME 'yellow' TYPE POLYGON STATUS OFF CONNECTIONTYPE OGR
CONNECTION 'pei.gml'
CLASS
NAME 'yellow'
STYLE
OUTLINECOLOR 0 0 0
COLOR 255 255 0
END
END PROJECTION
"init=epsg:4326"
END
END

END # Map

PHP MapScript Example





(continues on next page)



(continued from previous page)

4.1.32 WEB
BROWSEFORMAT [mime-type]
Format of the interface output, using MapServer CGI. (added to MapServer 4.8.0) The default value is "text/html". Example:

EMPTY [url]
URL to forward users to if a query fails. If not defined the value for ERROR is used.
ERROR [url]
URL to forward users to if an error occurs. Ugly old MapServer error messages will appear if this is not defined
FOOTER [filename]
Template to use AFTER anything else is sent. Multiresult query modes only.
HEADER [filename]
Template to use BEFORE everything else has been sent. Multiresult query modes only.
IMAGEPATH [path]
Path to the temporary directory for writing temporary files and images. Must be writable by the user the web server is running as. Must end with a / or depending on your platform.
IMAGEURL [path]
Base URL for IMAGEPATH. This is the URL that will take the web browser to IMAGEPATH to get the images.
LEGENDFORMAT [mime-type]
Format of the legend output, using MapServer CGI. (added to MapServer 4.8.0) The default value is "text/html". Example:

LOG [filename]
Removed in version 8.0.
Since MapServer 5.0 the recommended parameters to use for debugging are the MAP object's CONFIG and DEBUG parameters instead (see the Debugging MapServer document).
File to log MapServer activity in. Must be writable by the user the web server is running as.



MAXSCALEDENOM [double]
Minimum scale at which this interface is valid. When a user requests a map at a smaller scale, MapServer automatically returns the map at this scale. This effectively prevents user from zooming too far out. Scale is given as the denominator of the actual scale fraction, for example for a map at a scale of 1:24,000 use 24000. Implemented in MapServer 5.0, to replace the deprecated MAXSCALE parameter. Must be greater or equal to 0.

See alsoMap Scale
MAXSCALE [double]
Removed in version 8.0.
Since MapServer 5.0 the proper parameter to use is MAXSCALEDENOM instead. The deprecated MAXSCALE is the minimum scale at which this interface is valid. When a user requests a map at a smaller scale, MapServer automatically returns the map at this scale. This effectively prevents user from zooming too far out. Scale is given as the denominator of the actual scale fraction, for example for a map at a scale of 1:24,000 use 24000.
MAXTEMPLATE [file|url]
Template to be used if below the minimum scale for the app (the denominator of the requested scale is larger than MAXSCALEDENOM), useful for nesting apps.
METADATA
This keyword allows for arbitrary data to be stored as name value pairs.

• Used with OGC services (WMS Server, WFS Server, WCS Server, SOS Server, . . . ) to define things such as layer title.
• It can also allow more flexibility in creating templates, as anything you put in here will be accessible via template tags.
• If you have XMP support enabled, you can also embed xmp_metadata in your output images by specifying XMP tag information here. Example:

• labelcache_map_edge_buffer
For tiling, the amount of gutter around an image where no labels are to be placed is controlled by the parameter labelcache_map_edge_buffer. The unit is pixels. The value had to be a negative value for 6.0 and earlier versions. From 6.2 the absolute value is taken, so the sign does not matter.

• ms_enable_modes



Enable / disable modes (see rfc90).
Use the asterisk "*" to specify all modes and a preceding exclamation sign "!" to negate the given condition To disable all CGI modes:
To disable everything but MAP and LEGEND:

• tile_map_edge_buffer
Added in version 6.0.
For mode=tile, renders the tile into a buffered rendering frame, then clips out the final tile. This will reduce edge effects when large symbols or wide lines are drawn. Recommended value: the size of the largest symbol or line width in your mapfile.


• tile_metatile_level
Added in version 6.0.
For mode=tile, renders the tiles into a fixed metatile, then clips out the final tile. This will reduce label repetition, at the expense of much higher rendering cost. Recommended value: 1 if you are doing labelling of large features in your layer. 0 otherwise.


MINSCALEDENOM [double]
Maximum scale at which this interface is valid. When a user requests a map at a larger scale, MapServer au- tomatically returns the map at this scale. This effectively prevents the user from zooming in too far. Scale is given as the denominator of the actual scale fraction, for example for a map at a scale of 1:24,000 use 24000. Implemented in MapServer 5.0, to replace the deprecated MINSCALE parameter. Must be greater or equal to 0.

See alsoMap Scale
MINSCALE [double]
Removed in version 8.0.
Since MapServer 5.0 the proper parameter to use is MINSCALEDENOM instead. The deprecated MINSCALE is the maximum scale at which this interface is valid. When a user requests a map at a larger scale, MapServer



automatically returns the map at this scale. This effectively prevents the user from zooming in too far. Scale is given as the denominator of the actual scale fraction, for example for a map at a scale of 1:24,000 use 24000.
MINTEMPLATE [file|url]
Template to be used if above the maximum scale for the app (the denominator of the requested scale is smaller than MINSCALEDENOM), useful for nesting apps.
QUERYFORMAT [mime-type]
Format of the query output. (added to MapServer 4.8.0) This works for mode=query (using query templates in CGI mode), but not for mode=browse. The default value is "text/html". Example:

TEMPLATE [filename|url]
Template file or URL to use in presenting the results to the user in an interactive mode (i.e. map generates map and so on . . . ).
URL is not a remote file, rather a template. For example:



TEMPPATH [path]
Added in version 6.0.
Path for storing temporary files. If not set, the standard system temporary file path will be used (e.g. tmp for unix). TEMPPATH can also be set using the environment variable MS_TEMPPATH.
TEMPPATH is used in many contexts (see rfc66).
Make sure that that MapServer has sufficient rights to read and write files at the specified location.
VALIDATION
Signals the start of a VALIDATION block.
As of MapServer 5.4.0, VALIDATION blocks are the preferred mechanism for specifying validation patterns for CGI param runtime substitutions. See Run-time Substitution.

4.1.33 XML Mapfile support
MapServer is able to load XML mapfiles automatically, without user XSLT transformations. Basically, MapServer will simply do an XSLT transformation when the mapfile passed to it is an XML one, convert it to a text mapfile in a temporary file on disk, then process the mapfile normally.
New Dependencies
• libxslt
• libexslt

Enabling the support
You can enable the XML mapfile support by adding the following option: -with-xml-mapfile. This configure option will enable the libxslt and libexslt check up. If your libxslt/libexslt are not installed in /usr, you'll have to add the following options:






Usage:
In order to enable this feature, set the MS_XMLMAPFILE_XSLT environment variable to point to the location of the XSLT to use for the XML->text mapfile conversion. e.g. in Apache:

With this enabled, passing an .xml filename to the CGI map parameter will automatically trigger the conversion.


4.1.34 Notes
• The mapfile is NOT case-sensitive.
• The mapfile is read from top to bottom by MapServer; this means that LAYERs near the top of your mapfile will be drawn before those near the bottom. Therefore users commonly place background imagery and other background layer types near the top of their mapfile, and lines and points near the bottom of their mapfile.
• Strings containing non-alphanumeric characters or a MapServer keyword MUST be quoted. It is recommended to put ALL strings in double-quotes.
• As of MapServer 7.0, mapfiles are expected to be UTF-8 encoded. Non UTF-8 encoded mapfiles will need to be iconv'ed to UTF-8.
• For MapServer versions < 5, there was a default maximum of 200 layers per mapfile (there is no layer limit with MapServer >= 5). This can be changed by editing the map.h file to change the value of MS_MAXLAYERS to the desired number and recompiling. Here are other important default limits when using a MapServer version <
5:
- MAXCLASSES 250 (set in map.h)
- MAXSTYLES 5 (set in map.h)
- MAXSYMBOLS 64 (set in mapsymbol.h)
MapServer versions >= 5 have no limits for classes, styles, symbols, or layers.
• File paths may be given as absolute paths, or as paths relative to the location of the mapfile. In addition, data files may be specified relative to the SHAPEPATH.


• The mapfile has a hierarchical structure, with the MAP object being the "root". All other objects fall under this one.



• Comments are designated with a #. Since version 7.2 MapServer also supports single or multi-line C-style comments, as /* . . . */
• Attributes are named using the following syntax: [ATTRIBUTENAME].


• MapServer Regular Expressions are used through the operating system's C Library. For information on how to use and write Regular Expressions on your system, you should read the documentation provided with your C Library. On Linux, this is GLibC, and you can read "man 7 regex" . . . This man page is also available on most
UNIX's. Since these RegEx's are POSIX compliant, they should be the same on Windows as well, so windows users can try searching the web for "man 7 regex" since man pages are available all over the web.
• Syntax coloring for .map files should be available for your favorite text editor (for example: Notepad++ steps)


CHAPTER
FIVE



MAPSCRIPT



5.1 MapScript
Release
8.6.0


5.1.1 SWIG MapScript API Reference
Author
Sean Gillies
Author
Steve Lime
Contact
steve.lime at dnr.state.mn.us
Author
Frank Warmerdam
Contact
warmerdam at pobox.com
Author
Umberto Nicoletti
Contact
umberto.nicoletti at gmail.com
Author
Tamas Szekeres
Contact
szekerest at gmail.com
Author
Daniel Morissette
Contact
dmorisette at mapgears.com



Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Author
Seth Girvin
Contact
sethg at geographika.co.uk
Last Updated
2025-12-03

Introduction
This documentation is for the MapScript interface to MapServer generated by SWIG.
To make the document as agnostic as possible, we refer to the following types: int, float, and string. There are yet no MapScript methods that return arrays or sequences or accept array or sequence arguments.
We will use the SWIG term immutable to indicate that an attribute's value is read-only.
Note that because of the way that MapScript is generated many confusing, meaningless, and even dangerous attributes might be exposed by objects.


Appendices
Language-specific extensions are described in the following appendices
Python MapScript Appendix

MapScript Classes


















continues on next page



Table 1 - continued from previous page
layerObj([map])The LAYER objectlegendObj()The LEGEND objectlineObj()A lineObj is composed of one or more pointObj in-
stancesmapObj(*args)The MAP objectmarkerCacheMemberObj()An individual marker.outputFormatObj(driver, name)The OUTPUTFORMAT objectpointObj([x, y, z, m])A pointObj has an x, y, z and m values.projectionObj(proj4)The PROJECTION object MapServer's Maps and Lay-
ers have Projection attributes, and these are C projec-
tionObj structures, but are not directly exposed by the mapscript modulequeryMapObj()The QUERYMAP object.rectObj([minx, miny, maxx, maxy, imageunits])A rectObj represents a rectangle or bounding box.referenceMapObj()The REFERENCE objectreprojectionObj(_in, out)A holder object for projection coordinate transforma-
tions, introduced in RFC 126.resultCacheObj()A cached result objectresultObj(shapeindex)The result object is a handle, of sorts, for a feature of the
layerscaleTokenEntryObj()An individual value within the SCALETOKEN objectscaleTokenObj()The SCALETOKEN objectscalebarObj()The SCALEBAR objectshapeObj(type)Each feature of a layer's data is a shapeObj.shapefileObj(filename[, type])An object representing a Shapefile.styleObj([parent_class])The STYLE object.symbolObj(symbolname, imagefile)The SYMBOL objectsymbolSetObj(symbolfile)A symbolSetObj is an attribute of a mapObj and is as-
sociated with instances of symbolObj.webObj()The WEB object.
mapscript.DBFInfo
class  mapscript.DBFInfo
An object containing information about a DBF file

Attributes

nFields	int immutable Number of fields in the DBFnRecords	int immutable Number of records in the DBFthisown	The membership flag
Methods
  init  ()
getFieldDecimals(iField: int) ? int
Get the field decimals of a DBF using the field index iField
getFieldName(iField: int) ? char
Get the field name of a DBF using the field index iField


getFieldType(iField: int) ? int
Get the field type of a DBF using the field index iField. Field types are one of FTString, FTInteger,
FTDouble, FTInvalid
getFieldWidth(iField: int) ? int
Get the field width of a DBF using the field index iField

mapscript.OWSRequest
class  mapscript.OWSRequest
Class for programming OWS services

Attributes

NumParams	int immutable The number of querystring parameterscontenttype	char The content type of the requesthttpcookiedata	char Any cookie data associated with the requestpostrequest	char Any POST data requestthisown	The membership flagtype	enum MS_REQUEST_TYPE A request type con-
stant
Methods
  init  ()
Not associated with other mapscript classes. Serves as a message intermediary between an application and MapServer's OWS capabilities. Using it permits creation of lightweight WMS services.
addParameter(name: char, value: char) ? void
Add a request parameter, even if the parameter key was previously set. This is useful when multiple parameters with the same key are required. For example: request.addParameter('SIZE', 'x(100)') re- quest.addParameter('SIZE', 'y(100)')
getName(index: int) ? char
Return the name of the parameter at index in the request's array of parameter names.
getValue(index: int) ? char
Return the value of the parameter at index in the request's array of parameter values.
getValueByName(name: char const) ? char
Return the value associated with the parameter name
loadParams() ? int
Initializes the OWSRequest object from the cgi environment variables REQUEST_METHOD, QUERY_STRING and HTTP_COOKIE. Returns the number of name/value pairs collected. Warning: most errors will result in a process exit!
loadParamsFromPost(postData: char, url: char const) ? int
Initializes the OWSRequest object with POST data, along with a the provided URL which is treated like a QUERY_STRING. Note that REQUEST_METHOD=POST and the caller is responsible for setting the correct content type e.g. req.contenttype = "application/xml"
loadParamsFromURL(url: char const) ? int
Initializes the OWSRequest object from the provided URL which is treated like a QUERY_STRING. Note that REQUEST_METHOD=GET and no post data is assumed in this case.



setParameter(name: char, value: char) ? void Set a request parameter. For example:
request.setParameter('REQUEST', 'GetMap') request.setParameter('BBOX', '-107.0,40.0,-106.0,41.0')

mapscript.classObj
class mapscript.classObj(layer: layerObj = None)
The CLASS object. Used for symbolization and classification information.

Overview
The classObj has the following relationships:





Examples
Class creation:


Attributes









continues on next page



Table 4 - continued from previous page
leader	labelLeaderObj immutable see LEADERmaxscaledenom	double See MAXSCALEDENOMmetadata	hashTableObj immutable see METADATAminfeaturesize	int See MINFEATURESIZE minimum feature size in
pixelsminscaledenom	double See MINSCALEDENOMname	char See NAME should be unique within a layernumlabels	int immutable number of labels for classnumstyles	int immutable number of styles for classrefcount	int immutable number of references to this objectsizeunits	int Supersedes layer's sizeunits and applies to all
styles and labels - see LAYER SIZEUNITSstatus	int MS_ON or MS_OFF - draw features of this class or
do not - see STATUStemplate	char See TEMPLATEthisown	The membership flagtitle	char See TITLEvalidation	hashTableObj immutable see VALIDATION
Methods
  init  (layer: layerObj = None)
Create a new child classObj instance at the tail (highest index) of the class array of the parent_layer. A class can be created outside the context of a parent layer by omitting the layerObj constructor argument
addLabel(label: labelObj) ? int
Add a labelObj to the classObj and return its index in the labels array
clone() ? classObj
Return an independent copy of the class without a parent layer


convertToString() ?  char
Output the CLASS as a Mapfile string
createLegendIcon(map: mapObj, layer: layerObj, width: int, height: int) ? imageObj
Draw and return a new legend icon
drawLegendIcon(map: mapObj, layer: layerObj, width: int, height: int, dstImage: imageObj, dstX: int, dstY: int) ? int
Draw the legend icon onto image at dstx, dsty. Returns MS_SUCCESS or MS_FAILURE
getExpressionString()  ?  char
Return a string representation of the EXPRESSION enclosed in the quote characters appropriate to the expression type
getLabel(i: int) ? labelObj
Return a reference to the labelObj at index in the labels array



getStyle(i: int) ? styleObj
Return a reference to the styleObj at index in the styles array
getTextString() ? char
Return a string representation of TEXT
insertStyle(style: styleObj, index: int = -1) ? int
Insert a copy of style into the styles array at index index Default is -1, or the end of the array. Returns the index at which the style was inserted.
moveStyleDown(index: int) ? int
Swap the styleObj at index with the styleObj at index + 1
moveStyleUp(index: int) ? int
Swap the styleObj at index with the styleObj at index - 1
removeLabel(index: int) ? labelObj
Remove the labelObj at index from the labels array and return a reference to the labelObj. numlabels is decremented, and the array is updated
removeStyle(index: int) ? styleObj
Remove the styleObj at index from the styles array and return a copy.
setExpression(expression: char) ? int
Set EXPRESSION string where expression is a MapServer regular, logical or string expression. Returns
MS_SUCCESS or MS_FAILURE
setText(text: char) ? int
Set TEXT string where text is a MapServer text expression. Returns MS_SUCCESS or MS_FAILURE
updateFromString(snippet: char) ? int
Update a class from a string snippet. Returns MS_SUCCESS or MS_FAILURE

mapscript.clusterObj
class  mapscript.clusterObj
The CLUSTER object. See RFC 69.

Attributes

buffer	double The buffer size around the selection area - see
BUFFERmaxdistance	double Maximum distance between clusters - see
MAXDISTANCEregion	char The type of the cluster region (rectangle or el-
lipse) - see REGIONthisown	The membership flag
Methods
  init  ()
convertToString() ?  char
Output the CLUSTER as a Mapfile string



getFilterString() ? char
getGroupString() ? char
Return a string representation of GROUP
setFilter(filter: char) ? int
Set FILTER string where filter is a MapServer text expression. Returns MS_SUCCESS or MS_FAILURE
setGroup(group: char) ? int
Set GROUP string where group is a MapServer text expression. Returns MS_SUCCESS or MS_FAILURE
updateFromString(snippet: char) ? int
Update a cluster from a string snippet. Returns MS_SUCCESS or MS_FAILURE

mapscript.colorObj
class mapscript.colorObj(red: int = 0, green: int = 0, blue: int = 0, alpha: int = 255)
An object representing a color.

Attributes

alpha	int Alpha (opacity) component of color in range [0- 255]blue	int Blue component of color in range [0-255]green	int Green component of color in range [0-255]red	int Red component of color in range [0-255]thisown	The membership flag
Methods
  init  (red: int = 0, green: int = 0, blue: int = 0, alpha: int = 255)
An object representing a color.
setHex(psHexColor: char) ? int
Set the color to values specified in case-independent hexadecimal notation. hex must start with a '#' fol- lowed by three or four hex bytes, e.g. '#ffffff' or '#ffffffff'. If only three hex bytes are supplied, the alpha will be set to 255. Calling setHex('#ffffff') therefore assigns values of 255 to each color component, including the alpha. Returns MS_SUCCESS or MS_FAILURE
setRGB(red: int, green: int, blue: int, alpha: int = 255) ? int
Set all four RGBA components. Returns MS_SUCCESS or MS_FAILURE
toHex() ? char
Complement to setHex, returning a hexadecimal representation of the color components. If alpha is 255 then this is three hex bytes '#rrggbb', otherwise four hex bytes '#rrggbbaa'

mapscript.errorObj
class  mapscript.errorObj
This class allows inspection of the MapServer error stack. Instances of errorObj are created internally by MapServer as errors happen. Errors are managed as a chained list with the first item being the most recent error.



Attributes

code	int MapServer error code such as MS_IMGERRerrorcount	int Number of subsequent errorshttp_status	char [128] TODO Add documentationisreported	int MS_TRUE or MS_FALSE flag indicating if the error
has been outputmessage	char [2048] Context-dependent error messageroutine	char [64] MapServer function in which the error was
setthisown	The membership flag
Methods
  init  ()
Create a new instance
next() ? errorObj
Returns the next error in the stack or NULL if the end has been reached

mapscript.fontSetObj
class  mapscript.fontSetObj
The FONTSET object

Attributes

filename	char immutable The filename of the fonsetfonts	hashTableObj immutable Key, value pairs of font
name and font filenumfonts	int immutable The number of fonts in the fontsetthisown	The membership flag
Methods
  init  ()

mapscript.hashTableObj
class  mapscript.hashTableObj
An object to store key-value pairs

Attributes

numitemsint immutable immutablenumberofitemsthisownThe membership flag


Methods
  init  ()
Create a new instance
clear() ? void
Empties the table of all items
get(key: char, default_value: char = None) ? char
Returns the value of the item by its key, or default if the key does not exist
keys()
Python-only. In Python MapScript the hashTableObj can be used and accessed as a dictionary. The
keys method returns a view of all the keys in the hashTableObj.
nextKey(prevkey: char = None) ? char const
Returns the name of the next key or NULL if there is no valid next key. If the input key is NULL, returns the first key
remove(key: char) ? int
Removes the hash item by its key. Returns MS_SUCCESS or MS_FAILURE
set(key: char, value: char) ? int
Set a hash item given key and value. Returns MS_SUCCESS or MS_FAILURE

mapscript.imageObj
class  mapscript.imageObj(*args)
An image object is a wrapper for images generated by MapServer.

Attributes

formatoutputFormatObj immutable	an outputFormatObj representing the output for- mat of the imageheightint immutable image height in pixelsimagepathchar immutable if image is drawn by mapObj.
draw() this is IMAGEPATHimageurlchar immutable if image is drawn by mapObj.
draw() this is IMAGEURLresolutiondouble immutable image resolution in pixels per inchresolutionfactordouble immutable resolution factorthisownThe membership flagwidthint immutable image width in pixels
Methods
  init  (*args)
Create a new imageObj instance. If filename is specified, an imageObj is created from the file and any spec- ified width, height, and format parameters will be overridden by values of the image in filename. Otherwise, if format is specified (as an outputFormatObj) an imageObj is created using that format. If filename is not specified, then width and height should be specified. The default resolution is currently 72 and defined by MS_DEFAULT_RESOLUTION - this setting is not available in MapScript.
getBytes() ? gdBuffer




Returns the image contents as a binary buffer. The exact form of this buffer will vary by MapScript language (e.g. a string in Python, byte[] array in Java and C#, unhandled in Perl)
getSize() ? int
Returns the size of the binary buffer representing the image buffer


pasteImage(imageSrc: imageObj, opacity: double = 1.0, dstx: int = 0, dsty: int = 0) ? int
Pastes another imageObj on top of this imageObj. If optional dstx,dsty are provided then they define the position where the image should be copied (dstx,dsty = top-left corner position).
save(filename: char, map: mapObj = None) ? void
Save image to filename. The optional map parameter must be specified if saving GeoTIFF images.
saveWebImage() ? char
Writes the image to temp directory. Returns the image URL.
write(*args) ? int
Write image data to an open file handle. Replaces the removed saveToString function. See python/ pyextend.i for the Python specific version of this method.

mapscript.labelCacheMemberObj
class  mapscript.labelCacheMemberObj
An individual feature label. The labelCacheMemberObj class is associated with labelCacheObj.

Overview
The labelCacheMemberObj has the following relationships:


Attributes

bboxrectObj immutable Bounds of the whole cachePtr.classindexint immutable Index of the class of the labelled fea-
turelayerindexint immutable The index of the layer of the labelled
featureleaderbboxrectObj immutable Leader rectObjleaderlinelineObj immutable Leader lineObjmarkeridint immutable Corresponding marker (POINT layers
only)continues on next page



Table 11 - continued from previous page
numtextsymbolsint immutable Number of text symbols found in textsymbolspointpointObj immutable Label pointstatusint immutable Has this label been drawn or not?thisownThe membership flag
Methods
  init  ()

mapscript.labelCacheObj
class  mapscript.labelCacheObj
Set of a map's cached labels. Has no other existence other than as a labelcache attribute of a mapObj. Associated with labelCacheMemberObj and markerCacheMemberObj.

Overview
The labelCacheObj has the following relationships:



Attributes

num_rendered_membersint immutable NumberofrenderedlabelsthisownThe membership flag
Methods
  init  ()
freeCache() ? void Free the labelCache

mapscript.labelCacheSlotObj
class  mapscript.labelCacheSlotObj
A cache slot to hold labels grouped by priority

Attributes

cachesize	int immutable TODOcontinues on next page



Table 13 - continued from previous page
labels	labelCacheMemberObj immutable TODO Add
documentationmarkercachesize	int immutable TODOmarkers	markerCacheMemberObj immutable TODO Add
documentationnumlabels	int immutable Number of label membersnummarkers	int immutable Number of marker membersthisown	The membership flag
Methods
  init  ()

mapscript.labelLeaderObj
class  mapscript.labelLeaderObj
The LEADER object

Attributes

gridstep	int See GRIDSTEPmaxdistance	int See MAXDISTANCEnumstyles	int immutable Number of styles usedthisown	The membership flag
Methods
  init  ()

mapscript.labelObj
class  mapscript.labelObj
The LABEL object

Overview
The labelObj has the following relationships:






Attributes

align	int See ALIGNangle	double See ANGLEanglemode	enum MS_POSITIONS_ENUM One of AUTO
AUTO2, or FOLLOW - see ANGLEautominfeaturesize	int MS_TRUE or MS_FALSEbuffer	int Space to reserve around a label (padding) - see
BUFFERcolor	colorObj Foreground color - see COLORencoding	char Supported encoding format to be used for labels
- see ENCODINGfont	char Name of TrueType font see FONTforce	int Indicates if labels must be drawn - see FORCEmaxlength	int See MAXLENGTHmaxoverlapangle	double See MAXOVERLAPANGLEmaxscaledenom	double See MAXSCALEDENOMmaxsize	int Maximum height in pixels for scaled labels.mindistance	int Minimum distance in pixels between duplicate la-
bels - see MINDISTANCEminfeaturesize	int Minimum feature size (in pixels) to label, features
of this size or greater will be labeled - see MINFEA-
TURESIZEminscaledenom	double See MINSCALEDENOMminsize	int Minimum height in pixels - see MINSIZEnumstyles	int The number of styles associated with the labeloffsetx	int Horizontal offset of label - see OFFSEToffsety	int Vertical offset of label - see OFFSEToutlinecolor	colorObj Color of one point outline - see OUTLINE-
COLORoutlinewidth	int See OUTLINEWIDTHpartials	int Indicates if labels can run off the edge of an image,
either MS_TRUE or MS_FALSE (default) - see PAR-
TIALSposition	int See POSITIONpriority	int Priority level 1 to MS_MAX_LABEL_PRIORITY,
default=1 - see PRIORITYrefcount	int immutable TODO Add documentationrepeatdistance	int See REPEATDISTANCEshadowcolor	colorObj See SHADOWCOLORshadowsizex	int See SHADOWSIZEshadowsizey	int See SHADOWSIZEsize	int Annotation height in pixels - see SIZEsizeunits	int Supersedes class's sizeunits, defaults to
MS_INHERIT.space_size_10	double Cached size of a single space character used
for label text alignment of rfc40thisown	The membership flagwrap	char See WRAP


Methods
  init  ()
Create a new labelObj. A labelObj is associated with a classObj a scalebarObj or a legendObj. An instance of labelObj can exist outside of a classObj container and be explicitly inserted into the classObj:


convertToString() ?  char
Output the labelObj object as a Mapfile string.	Provides the inverse option for labelObj. updateFromString().
getBinding(binding: int) ? char const
Get the attribute binding for a specified label property. Returns NULL if there is no binding for this property.
getExpressionBinding(binding: int) ? char const
getExpressionString()  ?  char
getStyle(i: int) ? styleObj
Return a reference to the styleObj at index i in the styles array.
getTextString() ? char
insertStyle(style: styleObj, index: int = -1) ? int
Insert a copy of style into the styles array at index index. Default is -1, or the end of the array. Returns the index at which the style was inserted.
moveStyleDown(index: int) ? int
Swap the styleObj at index with the styleObj index + 1.
moveStyleUp(index: int) ? int
Swap the styleObj at index with the styleObj index - 1.
removeBinding(binding: int) ? int
Remove the attribute binding for a specified label property.
removeExpressionBinding(binding: int) ? int
Remove an expression binding for a specified label property.
removeStyle(index: int) ? styleObj
Remove the styleObj at index from the styles array and return a copy.
setBinding(binding: int, item: char const) ? int
Set the attribute binding for a specified label property.	Binding constants look like this:
MS_LABEL_BINDING_[attribute  name]:

setExpression(expression: char) ? int Set the label expression property



setExpressionBinding(binding: int, text: char const) ? int
Set the expression binding for a specified label property. Binding constants look like this: MS_LABEL_BINDING_[attribute name] Expressions are automatically wrapped in brackets, so do not need to be added to the input string

setText(text: char) ? int Set the label text.
updateFromString(snippet: char) ? int
Update a labelObj from a string snippet. Returns MS_SUCCESS or MS_FAILURE

mapscript.layerObj
class mapscript.layerObj(map: mapObj = None)
The LAYER object

Overview
The layerObj has the following relationships:




Attributes

bandsitemchar The attribute from the index file used to select the source raster band(s) to be used - normally NULL for default bands processingbindvalshashTableObj immutable Relates to RFC59classgroupchar See CLASSGROUPclassitemchar the attribute used to classify layer data - see
CLASSITEMclusterclusterObj immutable See CLUSTERcompositerLayerCompositer immutable See COMPOSITEconnectionchar layer connection or data source name - see CON-
NECTIONconnectionoptionshashTableObj immutable See CONNECTIONOP-
TIONSconnectiontypeenum MS_CONNECTION_TYPE the layer con-
nection type - see CONNECTIONTYPEcontinues on next page



Table 16 - continued from previous page






















































continues on next page



Table 16 - continued from previous page
rendermodeenum	MS_RENDER_MODE
MS_FIRST_MATCHING_CLASS - default and historic MapServer behavior, MS_ALL_MATCHING_CLASSES
- SLD behaviorrequireschar Context expressions, simple enough to not use
expressionObj - see REQUIRESsizeunitsint applies to all classes - see SIZEUNITSstartindexint Feature start index - used for pagingstatusint See STATUSMS_ON, MS_OFF or MS_DEFAULTstyleitemchar item to be used for style lookup - can also be
'AUTO' - see STYLEITEMsymbolscaledenomdouble scale at which symbols are default size - see
SYMBOLSCALEDENOMtemplatechar See TEMPLATE - global template, used across
all classesthisownThe membership flagtileindexchar layer index file for tiling support - see TILEIN-
DEXtileitemchar attribute defining tile paths - see TILEITEMtilesrschar name of the attribute that contains the SRS of
an individual tile - see TILESRStolerancedouble search buffer for point and line queries (in tol-
eranceunits) - see TOLERANCEtoleranceunitsint See TOLERANCEUNITStransformint MS_TRUE (default) or MS_FALSE whether or not
layer data is to be transformed to image units - see
TRANSFORMtypeenum MS_LAYER_TYPE the layer type - see
TYPEunitsint units of the layer - see UNITSutfdataexpressionObj immutable See UTFDATAutfitemchar See UTFITEMutfitemindexint See CLASSITEMvalidationhashTableObj immutable See VALIDATION
Methods
  init  (map: mapObj = None)
A layerObj is associated with mapObj. An instance of layerObj can exist outside of a mapObj
addFeature(shape: shapeObj) ? int
Add a new inline feature on a layer. Returns -1 on error. TODO: Is this similar to inline features in a mapfile? Does it work for any kind of layer or connection type?
addProcessing(directive: char const) ? void
Adds a new processing directive line to a layer, similar to the PROCESSING directive in a map file. Pro- cessing directives supported are specific to the layer type and underlying renderer.
applySLD(sld: char, stylelayer: char) ? int
Apply the SLD document to the layer object. The matching between the SLD document and the layer will be done using the layer's name. If a stylelayer argument is passed (argument is optional), the NamedLayer in the SLD that matches it will be used to style the layer. See SLD HOWTO for more information on the SLD support.



applySLDURL(sld: char, stylelayer: char) ? int
Apply the SLD document pointed by the URL to the layer object. The matching between the SLD document and the layer will be done using the layer's name. If a stylelayer argument is passed (argument is optional), the NamedLayer in the SLD that matches it will be used to style the layer. See SLD HOWTO for more information on the SLD support.
clearProcessing() ?  int
Clears the layer's raster processing directives. Returns the subsequent number of directives, which will equal MS_SUCCESS if the directives have been cleared.
clone() ? layerObj
Return an independent copy of the layer with no parent map.


close() ? void
Close the underlying layer.
convertToString() ?  char
Output the layerObj object as a Mapfile string.	Provides the inverse option for layerObj. updateFromString().
draw(map: mapObj, image: imageObj) ? int
Renders this layer into the target image, adding labels to the cache if required. Returns MS_SUCCESS or
MS_FAILURE.
drawQuery(map: mapObj, image: imageObj) ? int
Draw query map for a single layer into the target image. Returns MS_SUCCESS or MS_FAILURE.
executeWFSGetFeature() ? char
Executes a GetFeature request on a WFS layer and returns the name of the temporary GML file created. Returns an empty string on error.
generateSLD() ? char
Returns an SLD XML string based on all the classes found in the layer (the layer must have STATUS ON').
getClass()
Fetch the requested class object at i. Returns NULL if the class index is out of the legal range. The numclasses field contains the number of classes available, and the first class is index 0.
getClassIndex(map: mapObj, shape: shapeObj, classgroup: int = None, numclasses: int = 0) ? int Get the class index for a shape in the layer.
getExtent() ? rectObj
Fetches the extents of the data in the layer. This normally requires a full read pass through the features of the layer and does not work for raster layers.
getFilterString() ? char
Returns the current filter expression.
getGeomTransform() ? char
Return the geomtransform string for the layer.



getItem(i: int) ? char
Returns the requested item. Items are attribute fields, and this method returns the item name (field name). The numitems field contains the number of items available, and the first item is index zero.
getItemDefinitions()
Python MapScript only
Return item (field) names and their types if available. Field types are specified using GML metadata and can be one of the following:
Integer|Long|Real|Character|Date|Boolean
getItemType(i: int) ? char
Returns the requested item's field type. A layer must be open to retrieve the item definition.
Pass in the attribute index to retrieve the type. The layer's numitems property contains the number of items available, and the first item is index zero.
getNumFeatures() ? int
Returns the number of inline features in a layer. TODO: is this really only online features or will it return the number of non-inline features on a regular layer?
getNumProcessing() ? int
Return the number of processing directives
getNumResults() ? int
Returns the number of entries in the query result cache for this layer.
getOpacity() ? int
Returns the opacity value for the layer.
getProcessing(index: int) ? char
Return the raster processing directive at index.
getProcessingKey(key: char const) ? char Return the processing directive specified by key.
getProjection() ? char
Returns the PROJ definition of the layer's projection.
getResult(i: int) ? resultObj
Fetches the requested query result cache entry, or NULL if the index is outside the range of available results. This method would normally only be used after issuing a query operation.
getResults() ? resultCacheObj
Returns a reference to layer's result cache. Should be NULL prior to any query, or after a failed query or query with no results.
getResultsBounds() ? rectObj
Returns the bounds of the features in the result cache.
getShape(record: resultObj) ? shapeObj
Get a shape from layer data. Argument is a result cache member from layerObj.getResult()
getWMSFeatureInfoURL(map: mapObj, click_x: int, click_y: int, feature_count: int, info_format: char) ?
char
Return a WMS GetFeatureInfo URL (works only for WMS layers) clickX, clickY is the location of to query in pixel coordinates with (0,0) at the top left of the image. featureCount is the number of results to return. infoFormat is the format the format in which the result should be requested. Depends on remote server's



capabilities. MapServer WMS servers support only "MIME" (and should support "GML.1" soon). Returns "" and outputs a warning if layer is not a WMS layer or if it is not queryable.
insertClass()
Insert a copy of the class into the layer at the requested index. Default index of -1 means insertion at the end of the array of classes. Returns the index at which the class was inserted.
isVisible() ? int
Returns MS_TRUE or MS_FALSE after considering the layer status, minscaledenom, and maxscaledenom within the context of the parent map.
moveClassDown(index: int) ? int
The class specified by the class index will be moved up into the array of classes. Returns MS_SUCCESS or MS_FAILURE. For example moveClassDown(1) will have the effect of moving class 1 down to position 2, and the class at position 2 will be moved to position 1.
moveClassUp(index: int) ? int
The class specified by the class index will be moved up in the array of classes. Returns MS_SUCCESS or MS_FAILURE. For example moveClassUp(1) will have the effect of moving class 1 up to position 0, and the class at position 0 will be moved to position 1.
nextShape() ? shapeObj
Called after layerObj.whichShapes() has been called to actually retrieve shapes within a given area returns a shape object or MS_FALSE Example of usage:

open() ? int
Opens the underlying layer. This is required before operations like layerObj.getResult() will work, but is not required before a draw or query call.
queryByAttributes(map: mapObj, qitem: char, qstring: char, mode: int) ? int
Query layer for shapes that intersect current map extents. qitem is the item (attribute) on which the query is performed, and qstring is the expression to match. The query is performed on all the shapes that are part of a CLASS that contains a TEMPLATE value or that match any class in a layer that contains a LAYER TEMPLATE value. Note that the layer's FILTER/FILTERITEM are ignored by this function. mode is MS_SINGLE or MS_MULTIPLE depending on number of results you want. Returns MS_SUCCESS if the query was successfully performed, regardless of whether any shapes were found, or MS_FAILURE if an error occurred.
queryByFeatures(map: mapObj, slayer: int) ? int
Perform a query set based on a previous set of results from another layer. At present the results MUST be based on a polygon layer. Returns MS_SUCCESS if the query was successfully performed, regardless of whether any shapes were found, or MS_FAILURE if an error occurred.
queryByFilter(map: mapObj, string: char) ? int
Query by the filter string. For querying, we switch layer status ON and then back to original value before returning.



queryByIndex(map: mapObj, tileindex: int, shapeindex: int, bAddToQuery: int = 0) ? int
Pop a query result member into the layer's result cache. By default clobbers existing cache. Returns
MS_SUCCESS or MS_FAILURE
queryByPoint(map: mapObj, point: pointObj, mode: int, buffer: double) ? int
Query layer at point location specified in georeferenced map coordinates (i.e. not pixels). The query is performed on all the shapes that are part of a CLASS that contains a TEMPLATE value or that match any class in a layer that contains a LAYER TEMPLATE value. Note that the layer's FILTER/FILTERITEM are ignored by this function. mode is MS_SINGLE or MS_MULTIPLE depending on number of results you want. Returns MS_SUCCESS if the query was successfully performed, regardless of whether any shapes were found, or MS_FAILURE if an error occurred.
queryByRect(map: mapObj, rect: rectObj) ? int
Query layer using a rectangle specified in georeferenced map coordinates (i.e. not pixels). The query is performed on all the shapes that are part of a CLASS that contains a TEMPLATE value or that match any class in a layer that contains a LAYER TEMPLATE value. Note that the layer's FILTER/FILTERITEM are ignored by this function. The MS_MULTIPLE mode is set by default. Returns MS_SUCCESS if the query was successfully performed, regardless of whether any shapes were found, or MS_FAILURE if an error occurred.
queryByShape(map: mapObj, shape: shapeObj) ? int
Query layer based on a single shape, the shape has to be a polygon at this point. Returns MS_SUCCESS if the query was successfully performed, regardless of whether any shapes were found, or MS_FAILURE if an error occurred.
removeClass(index: int) ? classObj
Removes the class at index and returns a copy, or NULL in the case of a failure. Note that subsequent classes will be renumbered by this operation. The numclasses field contains the number of classes available.
setConnectionType(connectiontype: int, library_str: char const) ? int
Changes the connectiontype of the layer and recreates the vtable according to the new connection type. This method should be used instead of setting the connectiontype parameter directly. In case when the layer.connectiontype = MS_PLUGIN the library_str parameter should also be specified so as to select the library to load by MapServer. For the other connection types this parameter should be set to an empty string "".
setExtent(minx: double = -1.0, miny: double = -1.0, maxx: double = -1.0, maxy: double = -1.0) ? int Sets the extent of a layer. Returns MS_SUCCESS or MS_FAILURE
setFilter(filter: char) ? int
Sets a filter expression similarly to the FILTER expression in a map file. Returns MS_SUCCESS or
MS_FAILURE if the expression fails to parse.
setGeomTransform(transform: char) ? void Set the geomtransform string for the layer.
setItems(items: char, numitems: int) ? int
Set the items to be retrieved with a particular shape.
setOpacity(opacity: int) ? void
Sets an opacity for the layer, where the value is an integer in range [0, 100]. A new COMPOSITE block is generated, containing this OPACITY value.
setProcessingKey(key: char const, value: char const) ? void
Adds or replaces a processing directive of the form "key=value". Unlike the layerObj.addProcessing() function, this will replace an existing processing directive for the given key value. Processing directives supported are specific to the layer type and underlying renderer.



setProjection(proj4: char) ? int
Set the layer projection using a PROJ format projection definition (i.e. "+proj=utm +zone=11 +da- tum=WGS84" or "init=EPSG:26911"). Returns MS_SUCCESS or MS_FAILURE
setWKTProjection(wkt: char) ? int
Set the layer projection using OpenGIS Well Known Text format. Returns MS_SUCCESS or MS_FAILURE
updateFromString(snippet: char) ? int
Update a layerObj from a string snippet. Returns MS_SUCCESS or MS_FAILURE
whichShapes(rect: rectObj) ? int
Performs a spatial, and optionally an attribute based feature search. The function basically prepares things so that candidate features can be accessed by query or drawing functions (e.g using layerObj. nextShape() function). Returns MS_SUCCESS, MS_FAILURE or MS_DONE. MS_DONE is returned if the layer extent does not overlap rect.

mapscript.legendObj
class  mapscript.legendObj
The LEGEND object

Overview
The legendObj has the following relationships:



Attributes

heightint Legend heightimagecolorcolorObj Legend background color - see IMAGE-
COLORkeysizexint Width in pixels of legend keys - see KEYSIZEkeysizeyint Height in pixels of legend keys - see KEYSIZEkeyspacingxint Horizontal padding around keys in pixels - see
KEYSPACINGkeyspacingyint Vertical padding around keys in pixels - see
KEYSPACINGlabellabelObj immutable See LABELmapmapObj immutable Instances of legendObj are always
are always embedded inside the mapObjoutlinecolorcolorObj Key outline color, -1 for no outline - see
OUTLINECOLORpositionint Used for embedded legends, see POSITIONpostlabelcacheint MS_TRUE, MS_FALSE - see POSTLABELCACHEstatusint MS_ON, MS_OFF or MS_EMBED- see STATUScontinues on next page



Table 17 - continued from previous page
templatechar See TEMPLATEthisownThe membership flagtransparentint Allows transparency for an embedded legend - see
TRANSPARENTwidthint Legend width
Methods
  init  ()
convertToString() ?  char
Output the legendObj object as a Mapfile string.	Provides the inverse option for legendObj. updateFromString().
updateFromString(snippet: char) ? int
Update a legendObj from a string snippet. Returns MS_SUCCESS or MS_FAILURE

mapscript.lineObj
class  mapscript.lineObj
A lineObj is composed of one or more pointObj instances

Overview
The lineObj has the following relationships:


Attributes

numpointsint immutable NumberofpointsinthelinethisownThe membership flag
Methods
  init  ()
A lineObj is composed of one or more pointObj instances
add(p: pointObj) ? int
Add point p to the line. Returns MS_SUCCESS or MS_FAILURE
get(i: int) ? pointObj
Return reference to point at index i.
project(*args) ? int
Overload 1: Transform line in place from proj_in to proj_out. Returns MS_SUCCESS or MS_FAILURE



Overload 2: Reproject line given a reprojection object. Transformation is done in place. Returns
MS_SUCCESS or MS_FAILURE
set(i: int, p: pointObj) ? int
Set the point at index i to point p. Returns MS_SUCCESS or MS_FAILURE

mapscript.mapObj
class  mapscript.mapObj(*args)
The MAP object

Overview
The mapObj has the following relationships:






Attributes

cellsizedouble Pixel size in map unitsconfigconfigObj const immutable TODO Add documenta-
tionconfigoptionshashTableObj immutable A hash table of configu-
ration options from CONFIG keywords in the map - see CONFIGdatapatternchar TODO - Deprecated use VALIDATION .debugint See DEBUGdefresolutiondouble Default resolution - used to calculate the
scalefactor, see DEFRESOLUTIONextentrectObj Map extent array - see EXTENTfontsetfontSetObj immutable See FONTSETheightint See SIZEcontinues on next page



Table 19 - continued from previous page
imagecolorcolorObj Holds the initial image color value - see
IMAGECOLORimagetypechar immutable Name of current outputformatlabelcachelabelCacheObj immutable We need this here so
multiple feature processors can access itlayerorderint Used to modify the order in which the layers are
drawn - TODO should be immutable?legendlegendObj immutable See LEGENDmappathchar Path of the mapfile, all paths are relative to this
pathmaxlayersint immutable Allocated size of layers[] arraymaxsizeint See MAXSIZEnamechar Small identifier for naming etc - see NAMEnumlayersint immutable Number of layers in mapfilenumoutputformatsint immutable Number of output formats available in
the mapoutputformatoutputFormatObj immutable See OUTPUTFOR-
MATquerymapqueryMapObj immutable See QUERYMAPrefcountint immutable Used for reference counting see
RFC24referencereferenceMapObj immutable See SCALEBARresolutiondouble See RESOLUTIONscalebarscalebarObj immutable See SCALEBARscaledenomdouble The nominal map scale, a value of 25000
means 1:25000 scale - see SCALEDENOMshapepathchar Where are the shape files located - see
SHAPEPATHsldurlchar URL of SLD document as specified with
"&SLD=..." WMS parameter d- currently this refer- ence is used only in mapogcsld.c and has a NULL value outside that contextstatusint Is map creation on or off - see STATUSsymbolsetsymbolSetObj immutable See SYMBOLSETtemplatepatternchar TODO - Deprecated use VALIDATION .thisownThe membership flagunitsenum MS_UNITS Units of the projection - see
UNITSwebwebObj immutable See WEBwidthint See SIZE
Methods
OWSDispatch(req: OWSRequest) ? int
Processes and executes the passed OpenGIS Web Services request on the map. Returns MS_DONE (2) if there is no valid OWS request in the req object, MS_SUCCESS (0) if an OWS request was successfully processed and MS_FAILURE (1) if an OWS request was not successfully processed. OWS requests include WMS, WFS, WCS and SOS requests supported by MapServer. Results of a dispatched request are written to stdout and can be captured using the msIO services (i.e. mapscript.msIO_installStdoutToBuffer()
and mapscript.msIO_getStdoutBufferString()
  init  (*args)
Create a new instance of mapObj. Note that the filename is optional.



appendOutputFormat(format: outputFormatObj) ? int
Attach format to the map's output format list. Returns the updated number of output formats.
applyConfigOptions() ? void
Apply the defined configuration options set by setConfigOption()
applyDefaultSubstitutions()  ?  void
Apply any default values defined in a VALIDATION block used for runtime substitutions
applySLD(sld: char) ? int
Parse the SLD XML string sldxml and apply to map layers. Returns MS_SUCCESS or MS_FAILURE
applySLDURL(sld: char) ? int
Fetch SLD XML from the URL sldurl and apply to map layers. Returns MS_SUCCESS or MS_FAILURE
applySubstitutions(names: char) ? void
Pass in runtime substitution keys and values and apply them to the map. Note - this method is currently enabled for Python only. Typemaps are needed for other MapScript languages.
clone() ? mapObj
Return an independent copy of the map, less any caches.


convertToString() ?  char
Saves the object to a string. Provides the inverse option for updateFromString.
draw() ? imageObj
Draw the map, processing layers according to their defined order and status. Return an imageObj.
drawLabelCache(image: imageObj) ? int
Draw map's label cache on image. Returns MS_SUCCESS or MS_FAILURE.
drawLegend(scale_independent: int = 0) ? imageObj
Draw map legend, returning an imageObj.
drawQuery() ? imageObj
Draw query map, returning an imageObj.
drawReferenceMap() ? imageObj
Draw reference map, returning an imageObj.
drawScalebar() ? imageObj
Draw scale bar, returning an imageObj.
embedLegend(image: imageObj) ? int
Embed map's legend in image. Returns MS_SUCCESS or MS_FAILURE.
embedScalebar(image: imageObj) ? int
Embed map's legend in image. Returns MS_SUCCESS or MS_FAILURE.
freeQuery(qlayer: int = -1) ? void
Clear layer query result caches. Default is -1, or all layers.



generateSLD(sldVersion: char = None) ? char
Return SLD XML as a string for map layers that have STATUS on.
getConfigOption(key: char) ? char
Fetches the value of the requested configuration key if set. Returns NULL if the key is not set.
getLayer()
Returns a reference to the layer at index i.
getLayerByName()
Returns a reference to the named layer.
getLayerOrder() ? PyObject
Python MapScript only - returns the map layer order as a native sequence
getLayersDrawingOrder()  ?  intarray
Returns an array of layer indexes in drawing order. Note Unless the proper typemap is implemented for the module's language a user is more likely to get back an unusable SWIG pointer to the integer array.
getNumSymbols() ? int
Return the number of symbols in map
getOutputFormat(i: int) ? outputFormatObj
Returns the output format at the specified i index from the output formats array or null if i is beyond the array bounds. The number of outpuFormats can be retrieved by calling mapObj.getNumoutputformats().
getOutputFormatByName(name: char const) ? outputFormatObj
Return the output format corresponding to driver name imagetype or to format name imagetype. This works exactly the same as the IMAGETYPE directive in a mapfile, is case insensitive and allows an output format to be found either by driver (like 'AGG/PNG') or name (like 'png').
getProjection() ? char
Returns the PROJ definition of the map's projection.
getRotation() ? double
Returns the map rotation angle.
getSize() ? PyObject
Python MapScript only - gets the map size as a tuple
getSymbolByName(name: char) ? int
Return the index of the named symbol in the map's symbolset.


get_height()
Python MapScript only Return the map height from the map size
get_width()
Python MapScript only Return the map width from the map size



insertLayer()
Insert a copy of layer into the map at index. The default value of index is -1, which means the last possible index. Returns the index of the new layer, or -1 in the case of a failure.
loadMapContext(szFileName: char, useUniqueNames: int = 0) ? int
Load an OGC map context file to define extents and layers of a map Returns MS_SUCCESS or MS_FAILURE
loadOWSParameters(*args) ? int
Load OWS request parameters (BBOX, LAYERS, &c.) into map. Returns MS_SUCCESS or MS_FAILURE
loadQuery(filename: char) ? int
Load a saved query. Returns MS_SUCCESS or MS_FAILURE
moveLayerDown(layerindex: int) ? int
Move the layer at layerindex down in the drawing order array, meaning that it is drawn later. Returns
MS_SUCCESS or MS_FAILURE
moveLayerUp(layerindex: int) ? int
Move the layer at layerindex up in the drawing order array, meaning that it is drawn earlier. Returns
MS_SUCCESS or MS_FAILURE
offsetExtent(x: double, y: double) ? int
Offset the map extent based on the given distances in map coordinates.	Returns MS_SUCCESS or
MS_FAILURE.
pixelToGeoref(pixPosX: double, pixPosY: double, geoPos: pointObj) ? void TODO
prepareImage() ? imageObj
Returns an imageObj initialized to map extents and outputformat.
prepareQuery() ? void
TODO this function only calculates the scale or am I missing something?
processLegendTemplate(names: char, values: char, numentries: int) ? char
Process MapServer legend template and return HTML. Note none of the three template processing methods will be usable unless the proper typemaps are implemented in the module for the target language.Currently the typemaps are not implemented.
processQueryTemplate(names: char, values: char, numentries: int) ? char
Process MapServer query template and return HTML. Note none of the three template processing methods will be usable unless the proper typemaps are implemented in the module for the target language.Currently the typemaps are not implemented.
processTemplate(bGenerateImages: int, names: char, values: char, numentries: int) ? char
Process MapServer template and return HTML. Note none of the three template processing methods will be usable unless the proper typemaps are implemented in the module for the target language.Currently the typemaps are not implemented.
queryByFeatures(slayer: int) ? int
Query map layers, result sets contain features that intersect or are contained within the features in the result set of the MS_LAYER_POLYGON type layer at layer index slayer. Returns MS_SUCCESS or MS_FAILURE.
queryByFilter(string: char) ? int
Query map layers using the filter string. Returns MS_SUCCESS or MS_FAILURE.



queryByPoint(point: pointObj, mode: int, buffer: double) ? int
Query map layers, result sets contain one or more features, depending on mode, that intersect point within a tolerance buffer. Returns MS_SUCCESS or MS_FAILURE.
queryByRect(rect: rectObj) ? int
Query map layers, result sets contain features that intersect or are contained within the features in the result set of the MS_LAYER_POLYGON type layer at layer index slayer. Returns MS_SUCCESS or MS_FAILURE.
queryByShape(shape: shapeObj) ? int
Query layer based on a single shape, the shape has to be a polygon at this point. Returns MS_SUCCESS if shapes were found or MS_FAILURE if nothing was found or if some other error happened
removeLayer(index: int) ? layerObj
Remove the layer at index. Returns the layerObj.
removeOutputFormat(name: char const) ? int
Removes the format named name from the map's output format list. Returns MS_SUCCESS or MS_FAILURE
save(filename: char) ? int
Save map to disk as a new map file. Returns MS_SUCCESS or MS_FAILURE
saveMapContext(szFileName: char) ? int
Save map definition to disk as OGC-compliant XML. Returns MS_SUCCESS or MS_FAILURE
saveQuery(filename: char, results: int = 0) ? int
Save query to disk. Returns MS_SUCCESS or MS_FAILURE
saveQueryAsGML(*args) ? int
Save query to disk. Returns MS_SUCCESS or MS_FAILURE
scaleExtent(zoomfactor: double, minscaledenom: double, maxscaledenom: double) ? int
Scale the map extent using the zoomfactor and ensure the extent within the minscaledenom and maxscale- denom domain. If minscaledenom and/or maxscaledenom is 0 then the parameter is not taken into account.
Returns MS_SUCCESS or MS_FAILURE
selectOutputFormat(imagetype: char const) ? void
Set the map's active output format to the internal format named imagetype. Built-in formats are "PNG", "PNG24", "JPEG", "GIF", "GTIFF".
setCenter(center: pointObj) ? int
Set the map center to the given map point. Returns MS_SUCCESS or MS_FAILURE.
setConfigOption(key: char, value: char) ? void
Set the indicated key configuration option to the indicated value. Equivalent to including a CONFIG key- word in a map file.
setExtent(minx: double, miny: double, maxx: double, maxy: double) ? int
Set the map extent, returns MS_SUCCESS or MS_FAILURE. This method will correct the extents (width/height ratio) before setting the minx, miny, maxx, maxy values. See extent properties to set up a custom extent from rectObj.
setFontSet(filename: char) ? int
. Load fonts defined in filename into map fontset. The existing fontset is cleared.
Returns MS_SUCCESS or MS_FAILURE
setImageType(imagetype: char const) ? void Sets map outputformat to the named format.






setLayerOrder(order: PyObject) ? int
Python MapScript only - sets the map layer order using a native sequence
setLayersDrawingOrder(panIndexes: int) ? int
Set map layer drawing order. Note Unless the proper typemap is implemented for the module's language users will not be able to pass arrays or lists to this method and it will be unusable.
setOutputFormat(format: outputFormatObj) ? void Sets map outputformat.
setProjection(proj4: char) ? int
Set map projection from PROJ definition string proj4.
setRotation(rotation_angle: double) ? int
Set map rotation angle. The map view rectangle (specified in EXTENTS) will be rotated by the indicated angle in the counter- clockwise direction. Note that this implies the rendered map will be rotated by the angle in the clockwise direction.
Returns MS_SUCCESS or MS_FAILURE
setSize(width: int, height: int) ? int
setSymbolSet(szFileName: char) ? int
Load symbols defined in filename into map symbolset.  The existing symbolset is cleared.  Returns
MS_SUCCESS or MS_FAILURE
setWKTProjection(wkt: char) ? int
Sets map projection from OGC definition wkt.
set_height(value)
Python MapScript only Set the map height value of the map size
set_width(value)
Python MapScript only Set the map width value of the map size
zoomPoint(zoomfactor: int, poPixPos: pointObj, width: int, height: int, poGeorefExt: rectObj,
poMaxGeorefExt: rectObj) ? int
Zoom by the given factor to a pixel position within the width and height bounds. If max_extent is not NULL, the zoom is constrained to the max_extents
Returns MS_SUCCESS or MS_FAILURE
zoomRectangle(poPixRect: rectObj, width: int, height: int, poGeorefExt: rectObj, poMaxGeorefExt:
rectObj) ? int
Set the map extents to a given extents. Returns MS_SUCCESS or MS_FAILURE on error
zoomScale(scale: double, poPixPos: pointObj, width: int, height: int, poGeorefExt: rectObj,
poMaxGeorefExt: rectObj) ? int
Zoom by the given factor to a pixel position within the width and height bounds. If max_extent is not NULL, the zoom is constrained to the max_extents



mapscript.markerCacheMemberObj
class  mapscript.markerCacheMemberObj
An individual marker. The markerCacheMemberObj class is associated with labelCacheObj.

Overview
The markerCacheMemberObj has the following relationships:


Attributes

bounds	rectObj immutable Bounds of the marker- CacheMemberObjid	int immutable Corresponding labelthisown	The membership flag
Methods
  init  ()

mapscript.outputFormatObj
class mapscript.outputFormatObj(driver: char const, name: char = None)
The OUTPUTFORMAT object

Overview
The outputFormatObj has the following relationships:


Attributes

bandsint The number of bands in the raster, normally set via the BAND_COUNT formatoption - this field should be considered read-only Only used for the "raw" modes, MS_IMAGEMODE_BYTE, MS_IMAGEMODE_INT16,	and MS_IMAGEMODE_FLOAT32driverchar See DRIVERextensionchar See EXTENSIONimagemodeint An Image mode constant - see IMAGEMODEinmapfileint Boolean value indicating if the format is in the
Mapfilecontinues on next page



Table 21 - continued from previous page
mimetypechar See MIMETYPEnamechar See NAMEnumformatoptionsint immutable The number of option values set on
this format - can be used to iterate over the op- tions array in conjunction with outputFormatObj. getOptionAt()rendererint A render mode constant - normally set internally
based on the driver and some other setting in the con- structor.thisownThe membership flagtransparentint See TRANSPARENT
Methods
  init  (driver: char const, name: char = None)
Create new instance. If name is not provided, the value of driver is used as a name.
attachDevice(device: void) ? void
Set the device property of the output format
getOption(*args) ? char
Return the format option at key or defaultvalue if key is not a valid hash index.
getOptionAt(i: int) ? char
Returns the option at idx or NULL if the index is beyond the array bounds. The option is returned as the original KEY=VALUE string. The number of available options can be obtained via outputFormatObj. numformatoptions
setExtension(extension: char const) ? void
Set file extension for output format such as 'png' or 'jpg'. Method could probably be deprecated since the extension attribute is mutable. Not in Java extension.
setMimetype(mimetype: char const) ? void
Set mimetype for output format such as image/png or image/jpeg. Method could probably be deprecated since the mimetype attribute is mutable. Not in Java extension
setOption(key: char const, value: char const) ? void
Set the format option at key to value. Format options are mostly driver specific.
validate() ? int
Checks some internal consistency issues, and returns MS_TRUE if things are OK and MS_FALSE if there are problems. Some problems are fixed up internally. May produce debug output if issues encountered.

mapscript.pointObj
class mapscript.pointObj(x: double = 0.0, y: double = 0.0, z: double = 0.0, m: double = -2e+38)
A pointObj has an x, y, z and m values. A pointObj instance may be associated with a lineObj.

Attributes

m	double The m (measure) of the point, used for linear
referencingcontinues on next page



Table 22 - continued from previous page
thisown	The membership flagx	double The x coordinate of the pointy	double The y coordinate of the pointz	double The z (height) coordinate of the point
Methods
  init  (x: double = 0.0, y: double = 0.0, z: double = 0.0, m: double = -2e+38)
Create new instance. Easting, northing, and measure arguments are optional. Java pointObj constructors are in java/javaextend.i See https://github.com/mapserver/mapserver/issues/1106
distanceToPoint(point: pointObj) ? double Returns the distance to point.
distanceToSegment(a: pointObj, b: pointObj) ? double
Returns the minimum distance to a hypothetical line segment connecting point1 and point2.
distanceToShape(shape: shapeObj) ? double Returns the minimum distance to shape.
draw(map: mapObj, layer: layerObj, image: imageObj, classindex: int, text: char) ? int
Draw the point using the styles defined by the classindex class of layer and labelled with string text. Returns
MS_SUCCESS or MS_FAILURE
project(*args) ? int
Overload 1: Reproject point from proj_in to proj_out.	Transformation is done in place.	Returns
MS_SUCCESS or MS_FAILURE




Overload 2: Reproject point given a reprojection object.  Transformation is done in place.  Returns
MS_SUCCESS or MS_FAILURE
setXY(x: double, y: double, m: double = -2e+38) ? int
Set spatial coordinate and, optionally, measure values simultaneously. The measure will be set only if the value of m is greater than the ESRI measure no-data value of -1e38. Returns MS_SUCCESS or MS_FAILURE
setXYZ(x: double, y: double, z: double, m: double = -2e+38) ? int
Set spatial coordinate and, optionally, measure values simultaneously. The measure will be set only if the value of m is greater than the ESRI measure no-data value of -1e38. Returns MS_SUCCESS or MS_FAILURE
setXYZM(x: double, y: double, z: double, m: double) ? int
Set spatial coordinate and, optionally, measure values simultaneously. The measure will be set only if the value of m is greater than the ESRI measure no-data value of -1e38. Returns MS_SUCCESS or MS_FAILURE
toShape() ? shapeObj
Convert to a new shapeObj
toString() ? char
Return a string formatted like: { 'x':	%f , 'y':	%f, 'z':	%f } with the coordinate values sub- stituted appropriately. Python users can get the same effect via the pointObj  str  method:







mapscript.projectionObj
class mapscript.projectionObj(proj4: char)
The PROJECTION object MapServer's Maps and Layers have Projection attributes, and these are C projec- tionObj structures, but are not directly exposed by the mapscript module

Overview
The pointObj has the following relationships:


Attributes

generation_number	unsigned short immutable To be incremented when the content of the object changes, so that a reprojector can be invalidatednumargs	int immutable Actual number of projection argsthisown	The membership flagwellknownprojection	int One of wkp_none 0, wkp_lonlat 1, or
wkp_gmerc 2
Methods
  init  (proj4: char)
Create new instance of projectionObj.	Input parameter proj4 is a PROJ definition string such as 'init=EPSG:4269'
getUnits() ? int
Returns the units of a projection object. Returns -1 on error.
setWKTProjection(wkt: char) ? int
Update the projectionObj using an OGC WKT definition Returns MS_SUCCESS or MS_FAILURE

mapscript.queryMapObj
class  mapscript.queryMapObj
The QUERYMAP object. Instances of querymapObj are always are always embedded inside the mapObj.

Attributes

color	colorObj See COLORcontinues on next page



Table 24 - continued from previous page
height	int See SIZEmap	mapObj immutable Reference to parent mapObjstatus	int See STATUSstyle	int HILITE, SELECTED or NORMAL - see STYLEthisown	The membership flagwidth	int See SIZE
Methods
  init  ()
convertToString() ?  char
Saves the object to a string. Provides the inverse option for queryMapObj.updateFromString().
updateFromString(snippet: char) ? int
Update a querymap from a string snippet. Returns MS_SUCCESS or MS_FAILURE

mapscript.rectObj
class mapscript.rectObj(minx: double = -1.0, miny: double = -1.0, maxx: double = -1.0, maxy: double = -1.0, imageunits: int = 0)
A rectObj represents a rectangle or bounding box. A rectObj may be a lone object or an attribute of another object and has no other associations.

Attributes

maxx	double Maximum eastingmaxy	double Maximum northingminx	double Minimum eastingminy	double Minimum northingthisown	The membership flag
Methods
 init (minx: double = -1.0, miny: double = -1.0, maxx: double = -1.0, maxy: double = -1.0, imageunits: int = 0)
Create new instance. The four easting and northing arguments are optional and default to -1.0. Note the new optional fifth argument which allows creation of rectangles in image (pixel/line) units which are also tested for validity.
draw(map: mapObj, layer: layerObj, image: imageObj, classindex: int, text: char) ? int
Draw rectangle into img using style defined by the classindex class of layer. The rectangle is labeled with the string text. Returns MS_SUCCESS or MS_FAILURE
fit(width: int, height: int) ? double
Adjust the rect to fit the width and height. Returns cellsize of rect.
getCenter() ? pointObj
Return the center point of the rectangle.
project(*args) ? int
Overload 1: Reproject rectangle from proj_in to proj_out. Transformation is done in place. Returns
MS_SUCCESS or MS_FAILURE






Overload 2: Reproject rectangle given a reprojection object. Transformation is done in place. Returns
MS_SUCCESS or MS_FAILURE
toPolygon() ? shapeObj
Convert to a polygon of five vertices.
toString() ? char
Return a string formatted like: { 'minx':	%f , 'miny':	%f , 'maxx':	%f , 'maxy':	%f }
with the bounding values substituted appropriately. Python users can get the same effect via the rectObj
  str  method:



mapscript.referenceMapObj
class  mapscript.referenceMapObj
The REFERENCE object

Overview
The referenceMapObj has the following relationships:


Attributes

color	colorObj Color of reference box - see COLORextent	rectObj Spatial extent of reference in units of parent
map - see EXTENTheight	int Height of reference map in pixels - see SIZEimage	char Filename of reference map image - see IMAGEmap	mapObj immutable Reference to parent mapObjmarker	int Index of a symbol in the map symbol set to use
for marker - see MARKERmarkername	char Name of a symbol - see MARKERmarkersize	int Size of marker - see MARKERSIZEmaxboxsize	int In pixels - see MAXBOXSIZEminboxsize	int In pixels - see MINBOXSIZEoutlinecolor	colorObj Outline color of reference box - see OUT-
LINECOLORstatus	int MS_ON or MS_OFF - see STATUSthisown	The membership flagwidth	int Width of reference map in pixels - see SIZE


Methods
  init  ()
convertToString() ?  char
Saves the object to a string. Provides the inverse option for referenceMapObj.updateFromString().
updateFromString(snippet: char) ? int
Update a reference map from a string snippet. Returns MS_SUCCESS or MS_FAILURE

mapscript.reprojectionObj
class mapscript.reprojectionObj(_in: projectionObj, out: projectionObj)
A holder object for projection coordinate transformations, introduced in RFC 126. This allows caching of repro- jections improving performance.

Attributes

generation_number_in	unsigned short A counter that is incremented when the input projectionObj changesgeneration_number_out	unsigned short A counter that is incremented when
the output projectionObj changesthisown	The membership flag
Methods
  init  (_in: projectionObj, out: projectionObj)
Create new instance of reprojectionObj. Input parameters are two projectionsObj's - in and out.

mapscript.resultCacheObj
class  mapscript.resultCacheObj
A cached result object

Attributes

bounds	rectObj immutable Bounding box of query resultsnumresults	int immutable Length of result setthisown	The membership flag
Methods
  init  ()
getResult(i: int) ? resultObj
Returns the result at index i, like layerObj.getResult(), or NULL if index is outside the range of results.



mapscript.resultObj
class mapscript.resultObj(shapeindex: long)
The result object is a handle, of sorts, for a feature of the layer

Attributes

classindex	int immutable The class index of the resultresultindex	int immutable The index of the resultshapeindex	long immutable The shape index of the resultthisown	The membership flagtileindex	int immutable The tile index of the result
Methods
  init  (shapeindex: long)
The result object is a handle, of sorts, for a feature of the layer, having shapeindex and tileindex
attributes that can be used as arguments to getFeature

mapscript.scaleTokenEntryObj
class  mapscript.scaleTokenEntryObj
An individual value within the SCALETOKEN object

Attributes

maxscale	double The maximum scale for the replacementminscale	double The minimum scale for the replacementthisown	The membership flagvalue	char The token replacement value
Methods
  init  ()

mapscript.scaleTokenObj
class  mapscript.scaleTokenObj
The SCALETOKEN object

Attributes

n_entries	int The number of values within the scaletokenname	char The name of the token to replace in the DATA
statementthisown	The membership flagtokens	scaleTokenEntryObj A reference to the values


Methods
  init  ()

mapscript.scalebarObj
class  mapscript.scalebarObj
The SCALEBAR object

Overview
The scalebarObj has the following relationships:



Attributes

align	int See ALIGNbackgroundcolor	colorObj Scalebar background color - see BACK-
GROUNDCOLORcolor	colorObj Scalebar foreground color - see COLORheight	int Height in pixels - see SIZEimagecolor	colorObj Background color of scalebar - see IM-
AGECOLORintervals	int Number of intervals - see INTERVALSlabel	labelObj Scalebar label - see LABELoffsetx	int See OFFSEToffsety	int See OFFSEToutlinecolor	colorObj Foreground outline color - see OUTLINE-
COLORposition	int For embedded scalebars - see POSITION -
MS_UL, MS_UC, MS_UR , MS_LL, MS_LC, or MS_LRpostlabelcache	int See POSTLABELCACHE - MS_TRUE or
MS_FALSEstatus	int ON, OFF or EMBED - see STATUS - MS_ON,
MS_OFF, or MS_EMBED.style	int 0 or 1 - see STYLEthisown	The membership flagtransparent	int Allows transparency for an embedded scalebar -
see TRANSPARENTunits	int See UNITSwidth	int Height in pixels - see SIZE


Methods
  init  ()
convertToString() ?  char
Saves the object to a string. Provides the inverse option for updateFromString.
updateFromString(snippet: char) ? int
Update a scalebar from a string snippet. Returns MS_SUCCESS or MS_FAILURE

mapscript.shapeObj
class mapscript.shapeObj(type: int = <MagicMock id='140156786764128'>)
Each feature of a layer's data is a shapeObj. Each part of the shape is a closed lineObj.

Overview
The shapeObj has the following relationships:


Attributes

bounds	rectObj Bounding box of shapeclassindex	int The class index for features of a classified layerindex	long Feature index within the layeritemdefinitionsnumlines	int immutable Number of partsnumvalues	int immutable Number of shape attributesresultindex	int Index within a query result setscratch	int TODO Add documentationtext	char Shape annotationthisown	The membership flagtileindex	int Index of tiled file for tile-indexed layerstype	int	MS_SHAPE_POINT,  MS_SHAPE_LINE,
MS_SHAPE_POLYGON, or MS_SHAPE_NULL
Methods
Union(shape: shapeObj) ? shapeObj
Returns the union of the existing and supplied shape. Shapes must be of the same type. Requires GEOS support. Returns NULL/undef on failure.
  init  (type: int = <MagicMock id='140156786764128'>)
Return a new shapeObj of the specified type. See the type attribute. No attribute values created by default. initValues should be explicitly called to create the required number of values. Each feature of a layer's data is a shapeObj. Each part of the shape is a closed lineObj
add(line: lineObj) ? int
Add line (i.e. a part) to the shape. Returns MS_SUCCESS or MS_FAILURE



boundary() ? shapeObj
Returns the boundary of the existing shape. Requires GEOS support. Returns NULL/undef on failure.
buffer(width: double) ? shapeObj
Returns a new buffered shapeObj based on the supplied distance (given in the coordinates of the existing shapeObj). Requires GEOS support. Returns NULL/undefined on failure.
clone() ? shapeObj
Return an independent copy of the shape.


contains(*args) ? int
Overload 1: Returns MS_TRUE if shape2 is entirely inside the shape, returns -1 on error and MS_FALSE
otherwise. Requires GEOS support.




Overload 2: Returns MS_TRUE if the point is inside the shape, MS_FALSE otherwise
convexHull() ? shapeObj
Returns the convex hull of the existing shape. Requires GEOS support. Returns NULL/undef on failure.
copy(dest: shapeObj) ? int
Copy the shape to shape_copy. Returns MS_SUCCESS or MS_FAILURE
crosses(shape: shapeObj) ? int
Returns MS_TRUE if shape2 crosses the shape, returns -1 on error and MS_FALSE otherwise. Requires GEOS support.
difference(shape: shapeObj) ? shapeObj
Returns the computed difference of the supplied and existing shape. Requires GEOS support. Returns NULL/undef on failure.
disjoint(shape: shapeObj) ? int
Returns MS_TRUE if shape and shape2 are disjoint, returns -1 on error and MS_FALSE otherwise. Requires GEOS support.
distanceToPoint(point: pointObj) ? double Returns the distance to point.
distanceToShape(shape: shapeObj) ? double Returns the minimum distance to shape.
draw(map: mapObj, layer: layerObj, image: imageObj) ? int
Draws the individual shape using layer. Returns MS_SUCCESS or MS_FAILURE
equals(shape: shapeObj) ? int
Returns MS_TRUE if shape and shape2 are equal (geometry only), returns -1 on error and MS_FALSE other- wise. Requires GEOS support.



static fromWKT(wkt: char) ? shapeObj
Returns a new shapeObj based on a well-known text representation of a geometry. Requires GEOS support. Returns NULL/undef on failure.
get(i: int) ? lineObj
Returns a reference to part at index. Reference is valid only during the life of the shapeObj.
getArea() ? double
Returns the area of the shape (if applicable). Requires GEOS support.
getCentroid() ? pointObj
Returns the centroid for the existing shape. Requires GEOS support. Returns NULL/undef on failure.
getLabelPoint() ? pointObj
Given a shape, return a point object suitable for labeling it.
getLength() ? double
Returns the length (or perimeter) of the shape. Requires GEOS support.
getValue(i: int) ? char
Return the shape attribute at index i.
initValues(numvalues: int) ? void
Allocates memory for the requested number of values.
intersection(shape: shapeObj) ? shapeObj
Returns the computed intersection of the supplied and existing shape. Requires GEOS support. Returns NULL/undef on failure.
intersects(shape: shapeObj) ? int
Returns MS_TRUE if shape and shape2 intersect, and MS_FALSE otherwise. Does not require GEOS support but will use GEOS functions if available.
overlaps(shape: shapeObj) ? int
Returns MS_TRUE if shape2 overlaps shape, returns -1 on error and MS_FALSE otherwise. Requires GEOS support.
project(*args) ? int
Overload 1: Reproject shape from proj_in to proj_out. Transformation is done in place. Returns
MS_SUCCESS or MS_FAILURE




Overload 2: Reproject shape given a reprojection object. Transformation is done in place. Returns
MS_SUCCESS or MS_FAILURE
setBounds() ? void
Must be called to calculate new bounding box after new parts have been added. TODO: should return int and set msSetError.
setValue(i: int, value: char) ? int
Set the shape value at index i to value.
simplify(tolerance: double) ? shapeObj
Given a tolerance, returns a simplified shape object or NULL on error. Requires GEOS support (>=3.0).



symDifference(shape: shapeObj) ? shapeObj
Returns the computed symmetric difference of the supplied and existing shape. Requires GEOS support. Returns NULL/undef on failure.
toWKT() ? char
Returns the well - known text representation of a shapeObj. Requires GEOS support.Returns NULL / undefined on failure.
topologyPreservingSimplify(tolerance: double) ? shapeObj
Given a tolerance, returns a simplified shape object or NULL on error. Requires GEOS support (>=3.0).
touches(shape: shapeObj) ? int
Returns MS_TRUE if shape and shape2 touch, returns -1 on error and MS_FALSE otherwise. Requires GEOS support.
within(shape: shapeObj) ? int
Returns MS_TRUE if shape is entirely within shape2, returns -1 on error and MS_FALSE otherwise. Requires GEOS support.

mapscript.shapefileObj
class mapscript.shapefileObj(filename: char, type: int = -1)
An object representing a Shapefile. There is no write access to this object using MapScript.

Attributes

boundsrectObj immutable Extent of shapesnumshapesint immutable Number of shapesthisownThe membership flagtypeint immutable Shapefile type - see mapshape.h for
values of type
Methods
  init  (filename: char, type: int = -1)
Create a new instance. Omit the type argument or use a value of -1 to open an existing shapefile.
Type should be one of MS_SHAPEFILE_POINT, MS_SHAPEFILE_ARC, MS_SHAPEFILE_POLYGON or
MS_SHAPEFILE_MULTIPOINT
add(shape: shapeObj) ? int
Appends a shape to the open shapefile. Returns MS_SUCCESS or MS_FAILURE
addPoint(point: pointObj) ? int
Appends a point to the open shapefile. Returns MS_SUCCESS or MS_FAILURE
get(i: int, shape: shapeObj) ? int
Get the shapefile feature from index i and store it in shape. Returns MS_SUCCESS or MS_FAILURE
getDBF() ? DBFInfo
Returns a DBFInfo object containing information on the associated DBF
getExtent(i: int, rect: rectObj) ? void
Retrieve a shape's bounding box by index and stores it in rect.



getPoint(i: int, point: pointObj) ? int
Returns the point feature at index i and store it in pointObj.
getShape(i: int) ? shapeObj
Returns the shapefile feature at index i. More efficient than get.
getTransformed(map: mapObj, i: int, shape: shapeObj) ? int
Returns the feature at index i, simplify it, and store it in shape. Uses the map extent and cellsize for simplification. Returns MS_SUCCESS or MS_FAILURE

mapscript.styleObj
class mapscript.styleObj(parent_class: classObj = None)
The STYLE object. An instance of styleObj is associated with one instance of classObj.

Overview
The styleObj has the following relationships:


Attributes

angledouble Angle, given in degrees, to draw the line work, default is 0, for symbols of Type HATCH, this is the angle of the hatched lines - see ANGLEantialiasedint See ANTIALIASautoangleint If the angle is set to AUTO - see ANGLEcolorcolorObj Foreground or fill pen color - see COLORgapdouble See GAP - moved from symbolObj in version
6.0initialgapdouble See INITIALGAPlinecapint See LINECAPlinejoinint See LINEJOIN - moved from symbolObj in ver-
sion 6.0linejoinmaxsizedouble See LINEJOINMAXSIZE - moved from sym-
bolObj in version 6.0maxcolorcolorObj Maximum color in the COLORRANGEmaxscaledenomdouble See MAXSCALEDENOMmaxsizedouble Maximum pen or symbol width for scaling -
see MAXSIZEmaxvaluedouble related to color rangesmaxwidthdouble Maximum width of the symbol - see
MAXWIDTHmincolorcolorObj Minimum color in the COLORRANGEminscaledenomdouble See MINSCALEDENOMminsizedouble Minimum pen or symbol width for scaling
styles - see MINSIZEminvaluedouble related to color rangesminwidthdouble Minimum width of the symbol - see MIN-
WIDTHcontinues on next page



Table 35 - continued from previous page
offsetxdouble Draw with pen or symbol offset from map
data, for shadows, hollow symbols, etc - see OFFSEToffsetydouble Draw with pen or symbol offset from map
data, for shadows, hollow symbols, etc - see OFFSETopacityint See OPACITYoutlinecolorcolorObj Outline pen color - see OUTLINECOLORoutlinewidthdouble See OUTLINEWIDTHpatternpattern : list Python Onlypatternlengthint immutable Number of elements in the pattern at-
tributepolaroffsetangledouble Specified the angle - see POLAROFFSETpolaroffsetpixeldouble Specifies the radius/distance - see PO-
LAROFFSETrangeitemchar Attribute/field that stores the values for the
Color Range Mapping - see RANGEITEMrangeitemindexint The index of the range item - see RANGEITEMrefcountint immutable number of references to this objectsizedouble Pixel width of the style's pen or symbol - see
SIZEsizeunitsint Supersedes class's SIZEUNITS to allow fine-
grained sizing for improved SLD (RFC 124)symbolint The index within the map symbolset of the style's
symbol - see SYMBOLsymbolnamechar immutable Name of the style's symbol - see sym-
bolnamethisownThe membership flagwidthdouble Width refers to the thickness of line work
drawn, in pixels - default is 1, for symbols of type HATCH, the with is how thick the hatched lines are - see WIDTH
Methods
  init  (parent_class: classObj = None)
Returns new default styleObj instance. The parent_class is optional.
clone() ? styleObj
Return an independent copy of the style with no parent class.


convertToString() ?  char
Saves the object to a string. Provides the inverse option for styleObj.updateFromString()
getBinding(binding: int) ? char const
Get the attribute binding for a specified style property. Returns NULL if there is no binding for this property.
getGeomTransform() ? char
Get the GEOMTRANSFORM for the style.



pattern_get() ? void
Python Only** Get the pattern for the style.
pattern_set(nListSize: int) ? void
Python Only** Set the pattern for the style.
removeBinding(binding: int) ? int
Remove the attribute binding for a specified style property.
setBinding(binding: int, item: char const) ? int
Remove the attribute binding for a specified style property.
setGeomTransform(transform: char) ? void Set the GEOMTRANSFORM for the style.
setSymbolByName(map: mapObj, symbolname: char) ? int
Setting the symbol of the styleObj given the reference of the map object and the symbol name.
updateFromString(snippet: char) ? int
Update a style from a string snippet. Returns MS_SUCCESS or MS_FAILURE

mapscript.symbolObj
class mapscript.symbolObj(symbolname: char, imagefile: char const = None)
The SYMBOL object

Overview
The symbolObj has the following relationships:


Attributes

anchorpoint_xdouble See ANCHORPOINTanchorpoint_ydouble See ANCHORPOINTcharacterchar For TrueType symbols - see CHARACTERfilledint MS_TRUE or MS_FALSE - see FILLEDfontchar For TrueType symbols - see FONTimagepathchar immutable Path to pixmap file - see IMAGEinmapfileint Boolean value for writing - if set to TRUE, the sym-
bol will be saved inside the Mapfile.maxxdouble MS_SYMBOL_VECTOR and
MS_SYMBOL_ELLIPSE optionmaxydouble MS_SYMBOL_VECTOR and
MS_SYMBOL_ELLIPSE optionminxdouble MS_SYMBOL_VECTOR and
MS_SYMBOL_ELLIPSE optionminydouble MS_SYMBOL_VECTOR and
MS_SYMBOL_ELLIPSE optionnamechar Symbol name - see NAMEcontinues on next page



Table 36 - continued from previous page
numpointsint immutable Number of points of a vector symbolrefcountint immutable Reference countersizexdouble MS_SYMBOL_VECTOR and
MS_SYMBOL_ELLIPSE optionsizeydouble MS_SYMBOL_VECTOR and
MS_SYMBOL_ELLIPSE optionthisownThe membership flagtransparentint TODO Removetransparentcolorint TODO Removetypeint See TYPE
Methods
  init  (symbolname: char, imagefile: char const = None)
Create new default symbolObj named symbolname. If imagefile is specified, then the symbol will be of type MS_SYMBOL_PIXMAP.
getImage(input_format: outputFormatObj) ? imageObj
Returns a pixmap symbol's imagery as an imageObj.
getPoints() ? lineObj
Returns the symbol points as a lineObj.
setImage(image: imageObj) ? int
Set a pixmap symbol's imagery from image. Returns MS_SUCCESS or MS_FAILURE
setImagepath(imagefile: char const) ? int
Sets the imagefile path for a MS_SYMBOL_PIXMAP. Returns MS_SUCCESS or MS_FAILURE
setPoints(line: lineObj) ? int
Sets the symbol points from the points of line. Returns the updated number of points.

mapscript.symbolSetObj
class mapscript.symbolSetObj(symbolfile: char const = None)
A symbolSetObj is an attribute of a mapObj and is associated with instances of symbolObj.

Overview
The symbolSetObj has the following relationships:


Attributes

filenamechar Symbolset filenameimagecachesizeint Symbols in the cachemaxsymbolsint immutable Maximum number of allowed symbolsnumsymbolsint immutable Number of symbols in the setthisownThe membership flag


Methods
  init  (symbolfile: char const = None)
Create new symbolSetObj instance. If symbolfile is specified, symbols will be loaded from the file.
appendSymbol(symbol: symbolObj) ? int
Add a copy of symbol to the symbolset and return its index.
getSymbol(i: int) ? symbolObj
Returns a reference to the symbol at index.
getSymbolByName(symbolname: char) ? symbolObj
Returns a reference to the symbol named name.
index(symbolname: char) ? int
Return the index of the symbol named name or -1 in the case that no such symbol is found.
removeSymbol(index: int) ? symbolObj
Remove the symbol at index and return a copy of the symbol.
save(filename: char const) ? int
Save symbol set to a file. Returns MS_SUCCESS or MS_FAILURE

mapscript.webObj
class  mapscript.webObj
The WEB object. Has no other existence than as an attribute of a mapObj. Serves as a container for various run-time web application definitions like temporary file paths, template paths, etc.

Attributes

browseformatchar See BROWSEFORMATemptychar See EMPTYerrorchar Error handling - see ERRORfooterchar Path to footer document - see FOOTERheaderchar Path to header document - see HEADERimagepathchar Filesystem path to temporary image location -
see IMAGEPATHimageurlchar URL to temporary image location - see
IMAGEURLlegendformatchar See LEGENDFORMATmapmapObj immutable Reference to parent mapObjmaxscaledenomdouble Minimum map scale - see MAXSCALEDE-
NOMmaxtemplatechar See MAXTEMPLATEmetadatahashTableObj immutable Metadata hash table - see
METADATAminscaledenomdouble Maximum map scale - see MINSCALEDE-
NOMmintemplatechar See MINTEMPLATEqueryformatchar See QUERYFORMAT /* what format is the
query to be returned, given as a MIME typetemplatechar Path to template document - see TEMPLATEtemppathchar See TEMPPATH


Table 38 - continued from previous page
thisown	The membership flagvalidation	hashTableObj immutable See VALIDATION
Methods
  init  ()
Instances of webObj are always are always embedded inside the mapObj. Has no other existence than as an attribute of a mapObj. Serves as a container for various run-time web application definitions like temporary file paths, template paths, etc.
convertToString() ?  char
Output the WEB object as a Mapfile string. Provides the inverse option for webObj. updateFromString().
updateFromString(snippet: char) ? int
Update a webObj from a string snippet. Returns MS_SUCCESS or MS_FAILURE

MapScript Functions

add_dll_path(pth)Allow Python to access the directory containing the MapServer DLL (for Python on Windows only)fromstring(data[, mappath, configpath])Creates map objects from mapfile strings.msCleanup()Attempts to recover all dynamically allocated resources
allocated by MapServer code and dependent libraries.msConnPoolCloseUnreferenced()Some memory leaks can be avoided by closing any un-
referenced connections from time to time.msFreeImage(img)Generic function to free a imageObjmsGetErrorObj()Get the MapServer error objectmsGetErrorString(delimiter)Return a string of all errorsmsGetVersion()Returns a string containing MapServer version informa-
tion, and details on what optional components are built
in - the same report as produced by mapserv -vmsGetVersionInt()Returns the MapServer version number (x.y.z) as an in-
teger (x*10000 + y*100 + z) e.g. V7.4.2 would return 70402.msIO_getAndStripStdoutBufferMimeHeaders()Strip off all MIME headers and return them in a
hashTableObjmsIO_getStdoutBufferBytes()Fetch the current stdout buffer contents as a binary
buffer.msIO_getStdoutBufferString()Fetch the current stdout buffer contents as a string.msIO_installStdinFromBuffer()Installs a mapserver IO handler directing future stdin
reading (i.e. post request capture) to come from a buffer.msIO_installStdoutToBuffer()Installs a mapserver IO handler directing future stdout
output to a memory buffer.msIO_resetHandlers()Resets the default stdin and stdout handlers in place of
buffer based handlers.msIO_stripStdoutBufferContentHeaders()Strip all Content-* headers off the stdout buffer if it has
any.msIO_stripStdoutBufferContentType()Strip the Content-type header off the stdout buffer if it
has one, and if a content type is found it is returned (oth- erwise NULL/None/etc).


Table 39 - continued from previous page
msLoadMapFromString(buffer, new_mappath, config)Sets up string-based mapfile loading and calls loadMap-
Internal to do the workmsResetErrorList()Clear the list of error objectsmsSaveImage(map, img, filename)Saves a map image to a filemsSetup()Sets up threads and font cache - called when MapScript
is initialized
MapScript Constants Align

• mapscript.
MS_ALIGN_DEFAULT 0
• mapscript.MS_ALIGN_LEFT 1
Allocations

• mapscript. MS_DEFAULT_LABEL_PRIORITY 1
• mapscript.
MS_LABEL_ALLOCSIZE 2
• mapscript.
MS_LABEL_FORCE_GROUP 2
• mapscript.
MS_STYLE_ALLOCSIZE 4
• mapscript.
MS_MAX_LABEL_FONTS 5
• mapscript.
MS_CLASS_ALLOCSIZE 8

Comparison

• mapscript. MS_TOKEN_COMPARISON_EQ 320
• mapscript. MS_TOKEN_COMPARISON_NE 321
• mapscript. MS_TOKEN_COMPARISON_GT 322
• mapscript. MS_TOKEN_COMPARISON_LT 323
• mapscript. MS_TOKEN_COMPARISON_LE 324


• mapscript.
MS_ALIGN_CENTER  2





• mapscript.
MS_MAXPATTERNLENGTH  10
• mapscript. MS_MAX_LABEL_PRIORITY 10
• mapscript.
MS_POSITIONS_LENGTH 14
• mapscript.MS_HASHSIZE 41
• mapscript.ROUTINELENGTH 64




• mapscript. MS_TOKEN_COMPARISON_GE 325
• mapscript. MS_TOKEN_COMPARISON_IEQ 326
• mapscript. MS_TOKEN_COMPARISON_RE 327
• mapscript. MS_TOKEN_COMPARISON_IRE 328
• mapscript. MS_TOKEN_COMPARISON_IN 329
• 
mapscript.
MS_ALIGN_RIGHT 3





TODO Add
documentation
• mapscript. MS_DEFAULT_CGI_PARAMS 100
• mapscript.
SHX_BUFFER_PAGE  1024
TODO Add
documentation
• mapscript.MESSAGELENGTH 2048
TODO Add
documentation



• mapscript. MS_TOKEN_COMPARISON_LIKE 330
• mapscript. MS_TOKEN_COMPARISON_INTERSECTS 331
• mapscript. MS_TOKEN_COMPARISON_DISJOINT 332
• mapscript. MS_TOKEN_COMPARISON_TOUCHES 333
• mapscript. MS_TOKEN_COMPARISON_OVERLAPS 334




• mapscript. MS_TOKEN_COMPARISON_CROSSES 335
• mapscript. MS_TOKEN_COMPARISON_WITHIN 336


• mapscript. MS_TOKEN_COMPARISON_CONTAINS 337
• mapscript. MS_TOKEN_COMPARISON_EQUALS 338


• mapscript. MS_TOKEN_COMPARISON_BEYOND 339
• mapscript. MS_TOKEN_COMPARISON_DWITHIN 340


Compop


• mapscript.
MS_COMPOP_CLEAR 0
• mapscript.MS_COMPOP_SRC 1
• mapscript.MS_COMPOP_DST 2
• mapscript.
MS_COMPOP_SRC_OVER 3
• mapscript.
MS_COMPOP_DST_OVER 4
• mapscript.
MS_COMPOP_SRC_IN  5
• mapscript.
MS_COMPOP_DST_IN  6
• mapscript.
MS_COMPOP_SRC_OUT 7
• mapscript.
MS_COMPOP_DST_OUT 8
• mapscript.
MS_COMPOP_SRC_ATOP 9
• mapscript.
MS_COMPOP_DST_ATOP 10
• 
mapscript.MS_COMPOP_XOR 11
• mapscript.
MS_COMPOP_PLUS 12
• mapscript.
MS_COMPOP_MINUS 13
• mapscript.
MS_COMPOP_MULTIPLY 14
• mapscript.
MS_COMPOP_SCREEN 15
• mapscript.
MS_COMPOP_OVERLAY  16
• mapscript.
MS_COMPOP_DARKEN  17
• mapscript.
MS_COMPOP_LIGHTEN 18
• mapscript. MS_COMPOP_COLOR_DODGE 19
• mapscript.
MS_COMPOP_COLOR_BURN 20
• mapscript.
MS_COMPOP_HARD_LIGHT 21
• 
mapscript.
MS_COMPOP_SOFT_LIGHT  22
• mapscript.
MS_COMPOP_DIFFERENCE 23
• mapscript.
MS_COMPOP_EXCLUSION 24
• mapscript.
MS_COMPOP_CONTRAST 25
• mapscript.
MS_COMPOP_INVERT 26
• mapscript.
MS_COMPOP_INVERT_RGB 27
• mapscript.
MS_COMPOP_HSL_HUE 28
• mapscript. MS_COMPOP_HSL_LUMINOSITY 29
• mapscript. MS_COMPOP_HSL_SATURATION 30
• mapscript.
MS_COMPOP_HSL_COLOR 31


Config


• mapscript.
MS_CONFIG_SECTION 3000
• mapscript. MS_CONFIG_SECTION_ENV 3001
Connection

• mapscript.MS_INLINE 0
• mapscript.
MS_TILED_SHAPEFILE  2
• mapscript.MS_UNUSED_2 3


• mapscript. MS_CONFIG_SECTION_MAPS 3002




• mapscript.MS_OGR 4
• mapscript.MS_UNUSED_1 5
• mapscript.MS_POSTGIS 6
• mapscript.MS_WMS  7
• 
mapscript. MS_CONFIG_SECTION_PLUGINS 3003





• mapscript.
MS_ORACLESPATIAL  8
• mapscript.MS_WFS 9
• mapscript.MS_GRATICULE 10




• mapscript.MS_MYSQL  11
• mapscript.MS_RASTER 12
• mapscript.MS_PLUGIN 13
• mapscript.MS_UNION 14


• mapscript.MS_UVRASTER 15
• mapscript.MS_CONTOUR  16
• mapscript.
MS_KERNELDENSITY 17


• mapscript.MS_IDW 18
• mapscript.MS_FLATGEOBUF 19


Db Connection


• mapscript.MS_DB_XBASE 0
• mapscript.MS_DB_CSV 1
• 
mapscript.MS_DB_MYSQL  2
• mapscript.MS_DB_ORACLE 3


• mapscript.
MS_DB_POSTGRES 4



Dbf Fields

• mapscript.FTString 0
TODO Add
documentation
• mapscript.FTInteger  1



TODO Add
documentation
• mapscript.FTDouble 2
TODO Add



documentation
• mapscript.FTInvalid  3
TODO Add
documentation


Debug


• mapscript. MS_DEBUGLEVEL_ERRORSONLY 0
• mapscript.
MS_DEBUGLEVEL_DEBUG 1
• 
mapscript.
MS_DEBUGLEVEL_TUNING 2
• mapscript.
MS_DEBUGLEVEL_V 3
• mapscript.
MS_DEBUGLEVEL_VV 4


• mapscript.
MS_DEBUGLEVEL_VVV 5
• mapscript. MS_DEBUGLEVEL_DEVDEBUG 20


Error


• mapscript.MS_NOERR 0
• mapscript.MS_IOERR  1
• mapscript.MS_MEMERR 2
• mapscript.MS_TYPEERR 3
• mapscript.MS_SYMERR  4
• mapscript.MS_REGEXERR  5
• mapscript.MS_TTFERR 6
• mapscript.MS_DBFERR 7
• mapscript.MS_IDENTERR 9
• mapscript.MS_EOFERR 10
• mapscript.MS_PROJERR 11
• mapscript.MS_MISCERR 12
• mapscript.MS_CGIERR 13
• mapscript.MS_WEBERR  14
• mapscript.MS_IMGERR 15
• 
mapscript.MS_HASHERR 16
• mapscript.MS_JOINERR  17
• mapscript.MS_NOTFOUND 18
• mapscript.MS_PARSEERR 20
• mapscript.MS_UNUSEDERR 21
• mapscript.MS_OGRERR 22
• mapscript.MS_QUERYERR 23
• mapscript.MS_WMSERR 24
• mapscript.MS_WMSCONNERR 25
• mapscript.
MS_ORACLESPATIALERR 26
• 
mapscript.MS_WFSERR 27
• mapscript.MS_WFSCONNERR 28
• mapscript.
MS_MAPCONTEXTERR  29
• mapscript.MS_HTTPERR 30
• mapscript.MS_CHILDERR 31
• mapscript.MS_WCSERR  32
• mapscript.MS_GEOSERR 33
• mapscript.MS_RECTERR 34
• mapscript.MS_TIMEERR 35
• mapscript.MS_GMLERR  36
• mapscript.MS_SOSERR 37
• mapscript.
MS_NULLPARENTERR 38









File

mapscript.
MS_RENDERERERR 42
mapscript.MS_V8ERR 43 mapscript.MS_OGCAPIERR 44


• mapscript.MS_FGBERR 45
• mapscript.
MS_NUMERRORCODES 46


• mapscript.MS_FILE_MAP 0	• mapscript.
MS_FILE_SYMBOL 1
Font Type

• mapscript.MS_TRUETYPE 0	• mapscript.MS_BITMAP 1

Function


• mapscript. MS_TOKEN_FUNCTION_LENGTH 350
• mapscript. MS_TOKEN_FUNCTION_TOSTRING 351
• mapscript. MS_TOKEN_FUNCTION_COMMIFY 352
• mapscript. MS_TOKEN_FUNCTION_AREA 353
• mapscript. MS_TOKEN_FUNCTION_ROUND 354
• mapscript. MS_TOKEN_FUNCTION_FROMTEXT 355
• mapscript. MS_TOKEN_FUNCTION_BUFFER 356
• 
mapscript. MS_TOKEN_FUNCTION_DIFFERENCE 357
• mapscript. MS_TOKEN_FUNCTION_SIMPLIFY 358
• mapscript. MS_TOKEN_FUNCTION_SIMPLIFYPT 359
• mapscript. MS_TOKEN_FUNCTION_GENERALIZE 360
• mapscript. MS_TOKEN_FUNCTION_SMOOTHSIA 361
• mapscript. MS_TOKEN_FUNCTION_CENTERLINE 362
• mapscript. MS_TOKEN_FUNCTION_DENSIFY 363
• 
mapscript. MS_TOKEN_FUNCTION_OUTER 364
• mapscript. MS_TOKEN_FUNCTION_INNER 365
• mapscript. MS_TOKEN_FUNCTION_JAVASCRIPT 366
• mapscript. MS_TOKEN_FUNCTION_UPPER 367
• mapscript. MS_TOKEN_FUNCTION_LOWER 368
• mapscript. MS_TOKEN_FUNCTION_INITCAP 369
• mapscript. MS_TOKEN_FUNCTION_FIRSTCAP 370



Geos


• mapscript.
MS_GEOS_EQUALS 0
• mapscript.
MS_GEOS_DISJOINT  1
• mapscript.
MS_GEOS_TOUCHES 2
• mapscript.
MS_GEOS_OVERLAPS 3


• mapscript.
MS_GEOS_CROSSES  4
• mapscript.
MS_GEOS_INTERSECTS 5
• mapscript.
MS_GEOS_WITHIN 6
• 
mapscript.
MS_GEOS_CONTAINS 7
• mapscript.
MS_GEOS_BEYOND 8
• mapscript.
MS_GEOS_DWITHIN  9



Image Mode


• mapscript.
MS_IMAGEMODE_PC256 0
• mapscript.
MS_IMAGEMODE_RGB  1
• mapscript.
MS_IMAGEMODE_RGBA 2
• 
mapscript.
MS_IMAGEMODE_INT16  3
• mapscript.
MS_IMAGEMODE_FLOAT32 4
• mapscript.
MS_IMAGEMODE_BYTE  5
• 
mapscript.
MS_IMAGEMODE_FEATURE 6
• mapscript.
MS_IMAGEMODE_NULL  7


Join


• mapscript.
MS_JOIN_ONE_TO_ONE 0
• 
mapscript.
MS_JOIN_ONE_TO_MANY 1


Label Binding


• mapscript.
MS_LABEL_BINDING_SIZE 0
• mapscript. MS_LABEL_BINDING_ANGLE 1
• mapscript. MS_LABEL_BINDING_COLOR 2
• mapscript.


• mapscript. MS_LABEL_BINDING_PRIORITY 5
• mapscript. MS_LABEL_BINDING_POSITION 6
• mapscript.
MS_LABEL_BINDING_SHADOWSIZEX
• 
mapscript. MS_LABEL_BINDING_OFFSET_X 9
• mapscript. MS_LABEL_BINDING_OFFSET_Y 10
• mapscript. MS_LABEL_BINDING_ALIGN 11

MS_LABEL_BINDING_OUTLINECOLOR  7
• 
mapscript.

3
• mapscript.
MS_LABEL_BINDING_FONT 4

Label Offset

• mapscript.
• 
mapscript. MS_LABEL_BINDING_SHADOWSIZEY 8



• mapscript.

MS_LABEL_BINDING_LENGTH 12

MS_LABEL_PERPENDICULAR_OFFSET
-99

MS_LABEL_PERPENDICULAR_TOP_OFFSET 99


Label Size


• mapscript.MS_TINY 5
• mapscript.MS_SMALL 7
• 
mapscript.MS_MEDIUM  10
• mapscript.MS_LARGE 13
• 
mapscript.MS_GIANT 16


Layer


• mapscript.
MS_LAYER_POINT 0
• mapscript.MS_LAYER_LINE 1


• mapscript.
MS_LAYER_POLYGON 2
• 
mapscript.
MS_LAYER_RASTER 3
• mapscript.
MS_LAYER_ANNOTATION 4





• mapscript.
MS_LAYER_QUERY 5
• mapscript.
MS_LAYER_CIRCLE 6
Legend

• mapscript. MS_LEGEND_KEYSPACING_MIN 0
• mapscript.
MS_LEGEND_KEYSIZE_MIN 5
Limiters

• mapscript.
MS_IMAGECACHESIZE 6


• mapscript.
MS_LAYER_TILEINDEX 7
• mapscript.
MS_LAYER_CHART 8




• mapscript. MS_LEGEND_KEYSPACING_MAX 50




• mapscript.
MS_MAXVECTORPOINTS 100


• mapscript.
MS_LAYER_ALLOCSIZE  64





• mapscript. MS_LEGEND_KEYSIZE_MAX 200


Line Join


• mapscript.MS_CJC_NONE 0
• mapscript.MS_CJC_BEVEL 1
• mapscript.MS_CJC_BUTT 2



Logical Control

• mapscript.MS_UNKNOWN -1
• mapscript.MS_FALSE 0
• mapscript.MS_NO 0
• mapscript.MS_OFF 0
• 
mapscript. MS_CJC_DEFAULT_JOIN_MAXSIZE 3
• mapscript.MS_CJC_MITER 3
• mapscript.MS_CJC_ROUND 4


• mapscript.MS_ON 1
• mapscript.MS_TRUE 1
• mapscript.MS_YES 1
• mapscript.MS_DEFAULT 2


• mapscript.MS_CJC_SQUARE 5
• mapscript.
MS_CJC_TRIANGLE 6





• mapscript.MS_EMBED  3
• mapscript.MS_DELETE 4


Measure Shape


• mapscript.MS_SHP_POINTZ 11
• mapscript.MS_SHP_ARCZ 13
• mapscript.
MS_SHP_POLYGONZ 15


Missing
• 
mapscript.
MS_SHP_MULTIPOINTZ 18
• mapscript.MS_SHPERR 19
• mapscript.MS_SHP_POINTM 21
• mapscript.MS_SHP_ARCM 23


• mapscript.
MS_SHP_POLYGONM  25
• mapscript.
MS_SHP_MULTIPOINTM  28




• mapscript.
MS_NUM_CHECK_NONE 0
• mapscript.
MS_NUM_CHECK_RANGE 1


• mapscript.
MS_NUM_CHECK_GT  2
• mapscript.
MS_NUM_CHECK_GTE  3


• mapscript.
MS_RESOLUTION_MIN  10
• mapscript.
MS_RESOLUTION_MAX 1000


Parse


• mapscript.
MS_PARSE_TYPE_BOOLEAN  0
• mapscript.
MS_PARSE_TYPE_STRING 1
Position


• mapscript.
MS_PARSE_TYPE_SHAPE 2
• 
mapscript.
MS_PARSE_TYPE_SLD 3


• mapscript.MS_UL101• mapscript.MS_CL106• mapscript.MS_XY 111• mapscript.MS_LR102• mapscript.MS_UC107• mapscript.MS_NONE 112• mapscript.MS_UR103• mapscript.MS_LC108• mapscript.MS_AUTO2 113• mapscript.MS_LL104• mapscript.MS_CC109• mapscript.MS_FOLLOW  114• mapscript.MS_CR 105	• mapscript.MS_AUTO 110

Projections


• mapscript.wkp_none 0
TODO Add
documentation
• 
mapscript.wkp_lonlat  1
TODO Add
documentation
• 
mapscript.wkp_gmerc 2
TODO Add
documentation


Query Mode

• mapscript.MS_NORMAL 0	• mapscript.MS_HILITE 1	• mapscript.MS_SELECTED 2

Query Type


• mapscript.
MS_QUERY_IS_NULL 0
• mapscript.
MS_QUERY_SINGLE  0
• mapscript.MS_SINGLE  0
• mapscript.MS_MULTIPLE 1


Render

• mapscript.
MS_RENDER_WITH_SWF 2
• mapscript. MS_RENDER_WITH_RAWDATA 3
• 
mapscript.
MS_QUERY_BY_POINT 1
• mapscript.
MS_QUERY_MULTIPLE 1
• mapscript.
MS_QUERY_BY_RECT 2
• mapscript.
MS_QUERY_BY_SHAPE 3



• mapscript. MS_RENDER_WITH_IMAGEMAP 5


• mapscript.
MS_QUERY_BY_ATTRIBUTE  4
• mapscript.
MS_QUERY_BY_INDEX 5
• mapscript.
MS_QUERY_BY_FILTER 6




• mapscript. MS_RENDER_WITH_TEMPLATE 8
• mapscript.
MS_RENDER_WITH_OGR 16





• mapscript. MS_RENDER_WITH_PLUGIN 100
• mapscript. MS_RENDER_WITH_CAIRO_RASTER 101
• mapscript. MS_RENDER_WITH_CAIRO_PDF 102
Render Mode

• mapscript. MS_FIRST_MATCHING_CLASS 0



• mapscript. MS_RENDER_WITH_CAIRO_SVG 103
• mapscript.
MS_RENDER_WITH_OGL 104
• mapscript.
MS_RENDER_WITH_AGG 105




• mapscript. MS_ALL_MATCHING_CLASSES 1


• mapscript.
MS_RENDER_WITH_KML 106
• mapscript. MS_RENDER_WITH_UTFGRID 107
• mapscript.
MS_RENDER_WITH_MVT 108


Request Type


• mapscript.
MS_GET_REQUEST 0
• 
mapscript.
MS_POST_REQUEST  1


Return Codes

• mapscript.MS_SUCCESS 0	• mapscript.MS_FAILURE 1	• mapscript.MS_DONE 2

Scalebar


• mapscript.
MS_SCALEBAR_OFFSET_MIN
-50
• mapscript. MS_SCALEBAR_INTERVALS_MIN 1
• mapscript. MS_SCALEBAR_HEIGHT_MIN 2
Shapefile

• mapscript.MS_SHAPEFILE 1
• mapscript.
MS_SHAPEFILE_POINT  1


• mapscript.
MS_SCALEBAR_WIDTH_MIN 5
• mapscript. MS_SCALEBAR_OFFSET_MAX 50
• mapscript. MS_SCALEBAR_HEIGHT_MAX 100


• mapscript.
MS_SHAPEFILE_ARC 3
• mapscript.
MS_SHAPEFILE_POLYGON  5


• mapscript. MS_SCALEBAR_INTERVALS_MAX 100
• mapscript. MS_SCALEBAR_WIDTH_MAX 1000





• mapscript. MS_SHAPEFILE_MULTIPOINT 8


Shape Type




• mapscript.
MS_SHAPE_POINT 0
• mapscript.MS_SHAPE_LINE 1
Style Binding

• mapscript.
MS_STYLE_BINDING_SIZE  0
• mapscript. MS_STYLE_BINDING_WIDTH 1


• mapscript.
MS_SHAPE_POLYGON 2





• mapscript. MS_STYLE_BINDING_SYMBOL 5
• mapscript.


• mapscript.MS_SHAPE_NULL 3





• mapscript. MS_STYLE_BINDING_OFFSET_Y 9
• mapscript.
MS_STYLE_BINDING_POLAROFFSET_PIXEL

• mapscript.

MS_STYLE_BINDING_OUTLINEWIDTH 10

MS_STYLE_BINDING_ANGLE 2
• mapscript. MS_STYLE_BINDING_COLOR 3
• mapscript.

6
• mapscript. MS_STYLE_BINDING_OPACITY 7
• mapscript.
MS_STYLE_BINDING_OFFSET_X
• 
mapscript. MS_STYLE_BINDING_POLAROFFSET_ANGLE 11
• mapscript. MS_STYLE_BINDING_LENGTH 12

MS_STYLE_BINDING_OUTLINECOLOR 8
4
Style Offset


• mapscript.
MS_STYLE_DOUBLE_SIDED_OFFSET
-999
• 
mapscript.
MS_STYLE_SINGLE_SIDED_OFFSET
-99


Symbol


• mapscript.
MS_SYMBOL_ALLOCSIZE 64
• mapscript.
• 
mapscript.
MS_SYMBOL_ELLIPSE 1002
• mapscript.
• 
mapscript.
MS_SYMBOL_HATCH  1005
• mapscript.MS_SYMBOL_SVG

MS_SYMBOL_SIMPLE1000MS_SYMBOL_PIXMAP 10031006• mapscript.
MS_SYMBOL_VECTOR
1001• mapscript.
MS_SYMBOL_TRUETYPE 1004
Token Binding


• mapscript. MS_TOKEN_BINDING_DOUBLE 380
• mapscript. MS_TOKEN_BINDING_INTEGER 381
• mapscript. MS_TOKEN_BINDING_STRING 382


• mapscript. MS_TOKEN_BINDING_TIME 383
• mapscript. MS_TOKEN_BINDING_SHAPE 384
• 
mapscript. MS_TOKEN_BINDING_MAP_CELLSIZE 385
• mapscript. MS_TOKEN_BINDING_DATA_CELLSIZE 386



Token Literal


• mapscript. MS_TOKEN_LITERAL_NUMBER 310
• mapscript. MS_TOKEN_LITERAL_STRING 311
• 
mapscript. MS_TOKEN_LITERAL_TIME 312
• mapscript. MS_TOKEN_LITERAL_SHAPE 313
• 
mapscript. MS_TOKEN_LITERAL_BOOLEAN 314


Token Logical


• mapscript. MS_TOKEN_LOGICAL_AND 300
• 
mapscript.
MS_TOKEN_LOGICAL_OR 301
• 
mapscript. MS_TOKEN_LOGICAL_NOT 302


Transform


• mapscript.
MS_TRANSFORM_NONE  0
• mapscript.
MS_TRANSFORM_ROUND 1


Units

• mapscript.MS_INHERIT -1
• mapscript.MS_INCHES 0
• mapscript.MS_FEET 1
• mapscript.MS_MILES  2
• 
mapscript. MS_TRANSFORM_SNAPTOGRID 2
• mapscript. MS_TRANSFORM_FULLRESOLUTION 3



• mapscript.MS_METERS 3
• mapscript.MS_KILOMETERS 4
• mapscript.MS_DD 5
• mapscript.MS_PIXELS 6


• mapscript.
MS_TRANSFORM_SIMPLIFY  4






• mapscript.
MS_PERCENTAGES 7
• mapscript.
MS_NAUTICALMILES  8


Version


• mapscript.
MS_VERSION_MINOR 0
• mapscript.
MS_VERSION_REV 1

5.1.2 PHP MapScript


• mapscript.
MS_VERSION_MAJOR 8
• 
mapscript.
MS_VERSION_NUM 80001




WarningSince the MapServer 8.0.0 release PHP support is only available through MapServer's SWIG API. The unmaintained
native PHP MapScript support (referred to in this section of the documentation) was removed.
PHP MapScript
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last updated
2019-05-25

WarningAs of the MapServer 8.0.0 release PHP support is only available through MapServer's SWIG API. The unmaintained
native PHP MapScript support (referred to in this section of the documentation) was removed.
Introduction
This is a PHP module that makes MapServer's MapScript functionalities available in a PHP Dynamically Loadable Library. In simple terms, this module will allow you to use the powerful PHP scripting language to dynamically create and modify map images in MapServer.

Versions Supported
PHP 5.2.0 or more recent is required; As of MapServer 7.4.0, PHP 7 is available through the SWIG API, and all existing MapServer users are encouraged to update their scripts for the new SWIG syntax; see the MapServer Migration Guide for example syntax.
Support for PHP 4, PHP 5.0 and PHP 5.1 was dropped as of MapServer 6.0. PHP MapScript was originally developed for PHP 3.0.14, and after MapServer 3.5 support for PHP 3 was dropped.
The module has been tested and used on Linux, Solaris, *BSD, and Windows.







Windows Binaries
PHP 7+ mapscript is included in MS4W, the popular installer maintained by GatewayGeo. You can also see user- contributed PHP 7 scripts through the SWIG API, on the MS4W wiki.

How to Get More Information on PHP MapScript
• For installation questions regarding the PHP MapScript module, see PHP MapScript Installation.
• The MapServer Wiki has information on this module, that was contributed by users.
• New PHP MapScript users should read the By Example document.
• The project's home is the PHP/MapScript page on MapTools.org.
• Also, see the MapScript, and the Mapfile sections of this site.
• Refer to the main PHP site for their official documentation.

Memory Management
Normally, you should not have to worry about the memory management because php has a garbage collector and will free resources for you. If you write only small scripts that don't do a lot of processing, it's not worth to care about that. Everything will be freed at the end of the script.
However, it may be useful to free resources during the execution if the script executes many tasks. To do so, you'll have to call the free() method of the mapscript objects and unset the php variables. The purpose of the free methods is to break the circular references between an object and its properties to allow the zend engine to free the resources.
Here's an example of a script (using the legacy syntax, not the SWIG API syntax) that doesn't free things during the execution:

and the same script that frees resources as soon as it can








(continues on next page)



(continued from previous page)

PHP MapScript API
Author
Daniel Morissette
Contact
dmorissette at mapgears.com
Author
Yewondwossen Assefa
Author
Alan Boudreault
Contact
aboudreault at mapgears.com
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com




Contents• PHP MapScript API
- Important Note
- Constants
- Functions
- Classes
* classObj




Important Note
• Constant names and class member variable names are case-sensitive in PHP.

Constants
The following MapServer constants are available:
Boolean values
MS_TRUE, MS_FALSE, MS_ON, MS_OFF, MS_YES, MS_NO
Map units



MS_INCHES, MS_FEET, MS_MILES, MS_METERS, MS_KILOMETERS, MS_DD, MS_PIXELS, MS_NAUTICALMILES
Layer types
MS_LAYER_POINT,	MS_LAYER_LINE,	MS_LAYER_POLYGON,	MS_LAYER_RASTER, MS_LAYER_ANNOTATION (deprecated since 6.2), MS_LAYER_QUERY, MS_LAYER_CIRCLE, MS_LAYER_TILEINDEX, MS_LAYER_CHART
Layer/Legend/Scalebar/Class Status
MS_ON, MS_OFF, MS_DEFAULT, MS_EMBED, MS_DELETE
Layer alpha transparency
allows alpha transparent pixmaps to be used with RGB map images MS_GD_ALPHA
Label positions
MS_UL, MS_LR, MS_UR, MS_LL, MS_CR, MS_CL, MS_UC, MS_LC, MS_CC, MS_XY, MS_AUTO, MS_AUTO2, MS_FOLLOW, MS_NONE
Bitmap font styles
MS_TINY , MS_SMALL, MS_MEDIUM, MS_LARGE, MS_GIANT
Shape types
MS_SHAPE_POINT, MS_SHAPE_LINE, MS_SHAPE_POLYGON, MS_SHAPE_NULL
Shapefile types
MS_SHP_POINT, MS_SHP_ARC, MS_SHP_POLYGON, MS_SHP_MULTIPOINT
Query/join types
MS_SINGLE, MS_MULTIPLE
Querymap styles
MS_NORMAL, MS_HILITE, MS_SELECTED
Connection Types
MS_INLINE, MS_SHAPEFILE, MS_TILED_SHAPEFILE, MS_SDE, MS_OGR, MS_TILED_OGR, MS_POSTGIS, MS_WMS, MS_ORACLESPATIAL, MS_WFS, MS_GRATICULE, MS_RASTER, MS_PLUGIN, MS_UNION
Error codes
MS_NOERR, MS_IOERR, MS_MEMERR, MS_TYPEERR, MS_SYMERR, MS_REGEXERR, MS_TTFERR, MS_DBFERR, MS_GDERR, MS_IDENTERR, MS_EOFERR, MS_PROJERR, MS_MISCERR, MS_CGIERR, MS_WEBERR, MS_IMGERR, MS_HASHERR, MS_JOINERR, MS_NOTFOUND, MS_SHPERR, MS_PARSEERR, MS_SDEERR, MS_OGRERR, MS_QUERYERR, MS_WMSERR, MS_WMSCONNERR, MS_ORACLESPATIALERR, MS_WFSERR, MS_WFSCONNERR, MS_MAPCONTEXTERR, MS_HTTPERR, MS_WCSERR
Symbol types
MS_SYMBOL_SIMPLE, MS_SYMBOL_VECTOR, MS_SYMBOL_ELLIPSE, MS_SYMBOL_PIXMAP, MS_SYMBOL_TRUETYPE
Image Mode types (outputFormatObj)
MS_IMAGEMODE_PC256,		MS_IMAGEMODE_RGB,	MS_IMAGEMODE_RGBA, MS_IMAGEMODE_INT16,	MS_IMAGEMODE_FLOAT32,	 MS_IMAGEMODE_BYTE, MS_IMAGEMODE_FEATURE, MS_IMAGEMODE_NULL
Style/Attribue binding
MS_STYLE_BINDING_SIZE, MS_STYLE_BINDING_ANGLE, MS_STYLE_BINDING_COLOR, MS_STYLE_BINDING_OUTLINECOLOR,	MS_STYLE_BINDING_SYMBOL, MS_STYLE_BINDING_WIDTH



Label/Attribute binding
MS_LABEL_BINDING_SIZE,	MS_LABEL_BINDING_ANGLE,	MS_LABEL_BINDING_COLOR, MS_LABEL_BINDING_OUTLINECOLOR,		MS_LABEL_BINDING_FONT, MS_LABEL_BINDING_PRIORITY, MS_LABEL_BINDING_POSITION, MS_LABEL_BINDING_SHADOWSIZEX, MS_LABEL_BINDING_SHADOWSIZEY
Alignment
MS_ALIGN_LEFT, MS_ALIGN_CENTER, MS_ALIGN_RIGHT
OwsRequest
MS_GET_REQUEST, MS_POST_REQUEST

Functions
string ms_GetVersion()
Returns the MapServer version and options in a string. This string can be parsed to find out which modules were compiled in, etc.
int ms_GetVersionInt()
Returns the MapServer version number (x.y.z) as an integer (x*10000 + y*100 + z). (New in v5.0) e.g. V5.4.3 would return 50403.
int ms_iogetStdoutBufferBytes()
Writes the current buffer to stdout. The PHP header() function should be used to set the documents's content- type prior to calling the function. Returns the number of bytes written if output is sent to stdout. See MapScript Wrappers for WxS Services for more info.
void ms_iogetstdoutbufferstring()
Fetch the current stdout buffer contents as a string. This method does not clear the buffer.
void ms_ioinstallstdinfrombuffer()
Installs a mapserver IO handler directing future stdin reading (ie. post request capture) to come from a buffer.
void ms_ioinstallstdouttobuffer()
Installs a mapserver IO handler directing future stdout output to a memory buffer.
void ms_ioresethandlers()
Resets the default stdin and stdout handlers in place of "buffer" based handlers.
string ms_iostripstdoutbuffercontenttype()
Strip the Content-type header off the stdout buffer if it has one, and if a content type is found it is return. Otherwise return false.
void ms_iostripstdoutbuffercontentheaders()
Strip all the Content-* headers off the stdout buffer if it has some.
array ms_TokenizeMap(string map_file_name)
Preparses a mapfile through the MapServer parser and return an array with one item for each token from the mapfile. Strings, logical expressions, regex expressions and comments are returned as individual tokens.
errorObj ms_GetErrorObj()
Returns a reference to the head of the list of errorObj.
void ms_ResetErrorList()
Clear the current error list. Note that clearing the list invalidates any errorObj handles obtained via the $error-
>next() method.



Classes
The following class objects are available through PHP MapScript.

classObj Constructor
Class Objects can be returned by the layerObj class, or can be created using:

or using the old constructor

The second argument class is optional. If given, the new class created will be a copy of this class.

Members


TypeNameNotestringgroupstringkeyimagelabelObjlabelRemoved (6.2) - use addLabel, getLabel, . . .doublemaxscaledenomhashTableObjmetadatadoubleminscaledenomstringnameintnumlabelsread-only (since 6.2)intnumstylesread-onlyintstatusMS_ON, MS_OFF or MS_DELETEstringtemplatestringtitleinttype
Methods
int addLabel( labelObj label)
Added in version 6.2.
Add a labelObj to the classObj and return its index in the labels array.
string convertToString()
Saves the object to a string. Provides the inverse option for updateFromString.
imageObj createLegendIcon(int width, int height)
Draw the legend icon and return a new imageObj.
int deletestyle(int index)
Delete the style specified by the style index. If there are any style that follow the deleted style, their index will decrease by 1.
int drawLegendIcon(int width, int height, imageObj im, int dstX, int dstY)
Draw the legend icon on im object at dstX, dstY. Returns MS_SUCCESS/MS_FAILURE.



void free()
Free the object properties and break the internal references. Note that you have to unset the php variable to free totally the resources.
string getExpressionString()
Returns the expression string for the class object.
labelObj getLabel(int index)
Added in version 6.2.
Return a reference to the labelObj at index in the labels array.
See the labelObj section for more details on multiple class labels.
int getMetaData(string name)
Fetch class metadata entry by name. Returns "" if no entry matches the name. Note that the search is case sensitive.


styleObj getStyle(int index)
Return the style object using an index. index >= 0 && index < class->numstyles.
string getTextString()
Returns the text string for the class object.
int insertStyle( styleObj style [, int index=-1 ] )
Insert a copy of style into the styles array at index index. Default is -1, or the end of the array. Returns the index at which the style was inserted.
int movestyledown(int index)
The style specified by the style index will be moved down into the array of classes. Returns MS_SUCCESS or MS_FAILURE. ex class->movestyledown(0) will have the effect of moving style 0 up to position 1, and the style at position 1 will be moved to position 0.
int movestyleup(int index)
The style specified by the style index will be moved up into the array of classes. Returns MS_SUCCESS or MS_FAILURE. ex class->movestyleup(1) will have the effect of moving style 1 up to position 0, and the style at position 0 will be moved to position 1.
labelObj removeLabel(int index)
Added in version 6.2.
Remove the labelObj at index from the labels array and return a reference to the labelObj. numlabels is decre- mented, and the array is updated.
int removeMetaData(string name)
Remove a metadata entry for the class. Returns MS_SUCCESS/MS_FAILURE.
int set(string property_name, new_value)
Set object property to a new value.
int setExpression(string expression)
Set the expression string for the class object.
int setMetaData(string name, string value)
Set a metadata entry for the class. Returns MS_SUCCESS/MS_FAILURE.



int settext(string text)
Set the text string for the class object.
int updateFromString(string snippet)
Update a class from a string snippet. Returns MS_SUCCESS/MS_FAILURE.


clusterObj Constructor
Instance of clusterObj is always embedded inside the layerObj.

Members


TypeNamedoublebufferdoublemaxdistancestringregion
Methods
string convertToString()
Saves the object to a string. Provides the inverse option for updateFromString.
string getFilterString()
Returns the expression for this cluster filter or NULL on error.
string getGroupString()
Returns the expression for this cluster group or NULL on error.
int setFilter(string expression)
Set layer filter expression.
int setGroup(string expression)
Set layer group expression.

colorObj Constructor
Instances of colorObj are always embedded inside other classes.

Members


TypeNameintredintgreenintblueintalpha


Methods
int setRGB(int red, int green, int blue, int alpha = 255)
Set red, green, blue and alpha values. Returns MS_SUCCESS.
string toHex()
Added in version 7.0.0.
Get the color as a hex string "#rrggbb" or (if alpha is not 255) "#rrggbbaa".
int setHex(string hex)
Added in version 7.0.0.
Set red, green, blue and alpha values. The hex string should have the form "#rrggbb" (alpha will be set to 255) or "#rrggbbaa". Returns MS_SUCCESS.

errorObj
Instances of errorObj are created internally by MapServer as errors happen. Errors are managed as a chained list with the first item being the most recent error. The head of the list can be fetched using ms_GetErrorObj(), and the list can be cleared using ms_ResetErrorList()

Members


TypeNameintcode //See error code constants abovestringmessagestringroutine
Method
errorObj next()
Returns the next errorObj in the list, or NULL if we reached the end of the list.

Example
This example draws a map and reports all errors generated during the draw() call, errors can potentially come from multiple layers.


gridObj Constructor
The grid is always embedded inside a layer object defined as a grid (layer->connectiontype = MS_GRATICULE) (for more docs : https://github.com/MapServer/MapServer/wiki/MapServerGrid)



A layer can become a grid layer by adding a grid object to it using : ms_newGridObj(layerObj layer)


Members


TypeNamestringlabelformatdoublemaxacrsdoublemaxintervaldoublemaxsubdividedoubleminarcsdoubleminintervaldoubleminsubdivide
Methods
int set(string property_name, new_value)
Set object property to a new value.

hashTableObj Constructor
Instance of hashTableObj is always embedded inside the classObj, layerObj, mapObj and webObj. It is uses a read only.


Methods
void clear()
Clear all items in the hashTable (To NULL).
string get(string key)
Fetch class metadata entry by name. Returns "" if no entry matches the name. Note that the search is case sensitive.
string nextkey(string previousKey)
Return the next key or first key if previousKey = NULL. Return NULL if no item is in the hashTable or end of hashTable is reached
int remove(string key)
Remove a metadata entry in the hashTable. Returns MS_SUCCESS/MS_FAILURE.
int set(string key, string value)
Set a metadata entry in the hashTable. Returns MS_SUCCESS/MS_FAILURE.



imageObj Constructor
Instances of imageObj are always created by the mapObj class methods.

Members


TypeNameNoteintwidthread-onlyintheightread-onlyintresolutionread-onlyintresolutionfactorread-onlystringimagepathstringimageurl
Methods
void pasteImage(imageObj srcImg, int transparentColorHex [[, int dstX, int dstY], int angle])
Copy srcImg on top of the current imageObj. transparentColorHex is the color (in 0xrrggbb format) from srcImg that should be considered transparent (i.e. those pixels won't be copied). Pass -1 if you don't want any transparent color. If optional dstx,dsty are provided then it defines the position where the image should be copied (dstx,dsty
= top-left corner position). The optional angle is a value between 0 and 360 degrees to rotate the source image counterclockwise. Note that if an angle is specified (even if its value is zero) then the dstx and dsty coordinates specify the CENTER of the destination area. Note: this function works only with 8 bits GD images (PNG or GIF).
int saveImage([string filename, MapObj oMap])
Writes image object to specified filename. Passing no filename or an empty filename sends output to stdout. In this case, the PHP header() function should be used to set the document's content-type prior to calling saveIm- age(). The output format is the one that is currently selected in the map file. The second argument oMap is not manadatory. It is usful when saving to formats like GTIFF that needs georeference information contained in the map file. On success, it returns either MS_SUCCESS if writing to an external file, or the number of bytes written if output is sent to stdout.
string saveWebImage()
Writes image to temp directory. Returns image URL. The output format is the one that is currently selected in the map file.

labelcacheMemberObj
Accessible only through the mapObj (map->getLabel()).



Members


TypeNameNoteintclassindexread-onlyintfeaturesizeread-onlyintlayerindexread-onlyintmarkeridread-onlyintnumstylesread-onlyintshapeindexread-onlyintstatusread-onlystringtextread-onlyinttileindexread-only
Method
None

labelcacheObj
Accessible only through the mapObj (map->labelcache). This object is only used to give the possibility to free the label cache (map->labelcache->freeCache())

Methods
boolean freeCache()
Free the label cache. Always returns MS_SUCCESS. Ex : map->labelcache->freeCache();

labelObj Constructor
labelObj are always embedded inside other classes.


Members


TypeNameintaligndoubleangleintanglemodeintantialiasintautominfeaturesizecolorObjbackgroundcolor (deprecated since 6.0)colorObjbackgroundshadowcolor (deprecated since 6.0)intbackgroundshadowsizex (deprecated since 6.0)intbackgroundshadowsizey (deprecated since 6.0)intbuffercolorObjcolorstringencodingcontinues on next page



Table 40 - continued from previous page
TypeNamestringfontintforceintmaxlengthintmaxsizeintmindistanceintminfeaturesizeintminlengthintminsizeintnumstylesintoffsetxintoffsetycolorObjoutlinecolorintoutlinewidthintpartialsintpositionintpriorityintrepeatdistancecolorObjshadowcolorintshadowsizexintshadowsizeyintsizeintwrap
Methods
string convertToString()
Saves the object to a string. Provides the inverse option for updateFromString.
int deleteStyle(int index)
Delete the style specified by the style index. If there are any style that follow the deleted style, their index will decrease by 1.
void free()
Free the object properties and break the internal references. Note that you have to unset the php variable to free totally the resources.
string getBinding(mixed labelbinding)
Get the attribute binding for a specified label property. Returns NULL if there is no binding for this property. Example:

string getExpressionString()
Returns the label expression string.
styleObj getStyle(int index)
Return the style object using an index. index >= 0 && index < label->numstyles.
string getTextString()
Returns the label text string.
int insertStyle( styleObj style [, int index=-1 ] )
Insert a copy of style into the styles array at index index. Default is -1, or the end of the array. Returns the index



at which the style was inserted.
int moveStyleDown(int index)
The style specified by the style index will be moved down into the array of classes. Returns MS_SUCCESS or MS_FAILURE. ex label->movestyledown(0) will have the effect of moving style 0 up to position 1, and the style at position 1 will be moved to position 0.
int moveStyleUp(int index)
The style specified by the style index will be moved up into the array of classes. Returns MS_SUCCESS or MS_FAILURE. ex label->movestyleup(1) will have the effect of moving style 1 up to position 0, and the style at position 0 will be moved to position 1.
int removeBinding(mixed labelbinding)
Remove the attribute binding for a specfiled style property. Example:
int set(string property_name, new_value)
Set object property to a new value.
int setBinding(mixed labelbinding, string value)
Set the attribute binding for a specified label property. Example:
This would bind the color parameter with the data (ie will extract the value of the color from the field called "FIELD_NAME_COLOR"
int setExpression( string expression )
Set the label expression.
int setText( string text )
Set the label text.
int updateFromString(string snippet)
Update a label from a string snippet. Returns MS_SUCCESS/MS_FAILURE.

layerObj Constructor
Layer Objects can be returned by the mapObj class, or can be created using:

A second optional argument can be given to ms_newLayerObj() to create the new layer as a copy of an existing layer. If a layer is given as argument then all members of a this layer will be copied in the new layer created.

Members


TypeNameNoteintannotatehashTableObjbindvalscontinues on next page



Table 41 - continued from previous page
TypeNameNotestringclassgroupstringclassitemclusterObjclusterstringconnectionintconnectiontyperead-only, use setConnectionType()
to set itstringdataintdebugintdumpdeprecated since 6.0stringfilteritemstringfootergridObjgridonly available on a layer defined as
grid (MS_GRATICULE)stringgroupstringheaderintindexread-onlyintlabelcachestringlabelitemdoublelabelmaxscaledenomdoublelabelminscaledenomstringlabelrequiresstringmaskintmaxfeaturesdoublemaxscaledenomhashTableObjmetadatadoubleminscaledenomstringnameintnum_processingintnumclassesread-onlycolorObjoffsiteintopacityprojectionObjprojectionintpostlabelcachestringrequiresintsizeunitsintstartindexintstatusMS_ON, MS_OFF, MS_DEFAULT
or MS_DELETEstringstyleitemdoublesymbolscaledenomstringtemplatestringtileindexstringtileitemdoubletoleranceinttoleranceunitsinttransforminttype


Methods
int addFeature(shapeObj shape)
Add a new feature in a layer. Returns MS_SUCCESS or MS_FAILURE on error.
int applySLD(string sldxml, string namedlayer)
Apply the SLD document to the layer object. The matching between the sld document and the layer will be done using the layer's name. If a namedlayer argument is passed (argument is optional), the NamedLayer in the sld that matchs it will be used to style the layer. See SLD HowTo for more information on the SLD support.
int applySLDURL(string sldurl, string namedlayer)
Apply the SLD document pointed by the URL to the layer object. The matching between the sld document and the layer will be done using the layer's name. If a namedlayer argument is passed (argument is optional), the NamedLayer in the sld that matchs it will be used to style the layer. See SLD HowTo for more information on the SLD support.
void clearProcessing()
Clears all the processing strings.
void close()
Close layer previously opened with open().
string convertToString()
Saves the object to a string. Provides the inverse option for updateFromString.
int draw(imageObj image)
Draw a single layer, add labels to cache if required. Returns MS_SUCCESS or MS_FAILURE on error.
int drawQuery(imageObj image)
Draw query map for a single layer.
string executeWFSGetfeature()
Executes a GetFeature request on a WFS layer and returns the name of the temporary GML file created. Returns an empty string on error.
void free()
Free the object properties and break the internal references. Note that you have to unset the php variable to free totally the resources.
string generateSLD()
Returns an SLD XML string based on all the classes found in the layer (the layer must have STATUS on).
classObj getClass(int classIndex)
Returns a classObj from the layer given an index value (0=first class)
int getClassIndex(shape [, classgroup, numclasses])
Get the class index of a shape for a given scale. Returns -1 if no class matches. classgroup is an array of class ids to check (Optional). numclasses is the number of classes that the classgroup array contains. By default, all the layer classes will be checked.
rectObj getExtent()
Returns the layer's data extents or NULL on error. If the layer's EXTENT member is set then this value is used, otherwise this call opens/closes the layer to read the extents. This is quick on shapefiles, but can be an expensive operation on some file formats or data sources. This function is safe to use on both opened or closed layers: it is not necessary to call open()/close() before/after calling it.
string getFilterString()
Returns the expression for this layer or NULL on error.
array getGridIntersectionCoordinates()
Returns an array containing the grid intersection coordinates. If there are no coordinates, it returns an empty array.



array getItems()
Returns an array containing the items. Must call open function first. If there are no items, it returns an empty array.
int getMetaData(string name)
Fetch layer metadata entry by name. Returns "" if no entry matches the name. Note that the search is case sensitive.


int getNumResults()
Returns the number of results in the last query.
array getProcessing()
Returns an array containing the processing strings. If there are no processing strings, it returns an empty array.
string getProjection()
Returns a string representation of the projection. Returns NULL on error or if no projection is set.
resultObj getResult(int index)
Returns a resultObj by index from a layer object with index in the range 0 to numresults-1. Returns a valid object or FALSE(0) if index is invalid.
rectObj getResultsBounds()
Returns the bounding box of the latest result.
shapeObj getShape(resultObj result])
If the resultObj passed has a valid resultindex, retrieve shapeObj from a layer's resultset. (You get it from the resultObj returned by getResult() for instance). Otherwise, it will do a single query on the layer to fetch the shapeindex

string getWMSFeatureInfoURL(int clickX, int clickY, int featureCount, string infoFormat)
Returns a WMS GetFeatureInfo URL (works only for WMS layers) clickX, clickY is the location of to query in pixel coordinates with (0,0) at the top left of the image. featureCount is the number of results to return. infoFor- mat is the format the format in which the result should be requested. Depends on remote server's capabilities. MapServer WMS servers support only "MIME" (and should support "GML.1" soon). Returns "" and outputs a warning if layer is not a WMS layer or if it is not queriable.
boolean isVisible()
Returns MS_TRUE/MS_FALSE depending on whether the layer is currently visible in the map (i.e. turned on, in scale, etc.).
int moveclassdown(int index)
The class specified by the class index will be moved down into the array of layers. Returns MS_SUCCESS or MS_FAILURE. ex layer->moveclassdown(0) will have the effect of moving class 0 up to position 1, and the class at position 1 will be moved to position 0.



int moveclassup(int index)
The class specified by the class index will be moved up into the array of layers. Returns MS_SUCCESS or MS_FAILURE. ex layer->moveclassup(1) will have the effect of moving class 1 up to position 0, and the class at position 0 will be moved to position 1.
int open()
Open the layer for use with getShape(). Returns MS_SUCCESS/MS_FAILURE.
shapeObj nextShape()
Called after msWhichShapes has been called to actually retrieve shapes within a given area. Returns a shape object or NULL on error.

int queryByAttributes(string qitem, string qstring, int mode)
Query layer for shapes that intersect current map extents. qitem is the item (attribute) on which the query is performed, and qstring is the expression to match. The query is performed on all the shapes that are part of a CLASS that contains a TEMPLATE value or that match any class in a layer that contains a LAYER TEMPLATE value. Note that the layer's FILTER/FILTERITEM are ignored by this function. Mode is MS_SINGLE or MS_MULTIPLE depending on number of results you want. Returns MS_SUCCESS if shapes were found or MS_FAILURE if nothing was found or if some other error happened (note that the error message in case nothing was found can be avoided in PHP using the '@' control operator).
int queryByFeatures(int slayer)
Perform a query set based on a previous set of results from another layer. At present the results MUST be based on a polygon layer. Returns MS_SUCCESS if shapes were found or MS_FAILURE if nothing was found or if some other error happened (note that the error message in case nothing was found can be avoided in PHP using the '@' control operator).
int queryByPoint(pointObj point, int mode, double buffer)
Query layer at point location specified in georeferenced map coordinates (i.e. not pixels). The query is performed on all the shapes that are part of a CLASS that contains a TEMPLATE value or that match any class in a layer that contains a LAYER TEMPLATE value. Mode is MS_SINGLE or MS_MULTIPLE depending on number of results you want. Passing buffer -1 defaults to tolerances set in the map file (in pixels) but you can use a constant buffer (specified in ground units) instead. Returns MS_SUCCESS if shapes were found or MS_FAILURE if nothing was found or if some other error happened (note that the error message in case nothing was found can be avoided in PHP using the '@' control operator).
int queryByRect(rectObj rect)
Query layer using a rectangle specified in georeferenced map coordinates (i.e. not pixels). The query is performed on all the shapes that are part of a CLASS that contains a TEMPLATE value or that match any class in a layer that contains a LAYER TEMPLATE value. Returns MS_SUCCESS if shapes were found or MS_FAILURE if nothing was found or if some other error happened (note that the error message in case nothing was found can be avoided in PHP using the '@' control operator).
int queryByShape(shapeObj shape)
Query layer based on a single shape, the shape has to be a polygon at this point. Returns MS_SUCCESS if shapes were found or MS_FAILURE if nothing was found or if some other error happened (note that the error message in case nothing was found can be avoided in PHP using the '@' control operator).



classObj removeClass(int index)
Removes the class indicated and returns a copy, or NULL in the case of a failure. Note that subsequent classes will be renumbered by this operation. The numclasses field contains the number of classes available.
int removeMetaData(string name)
Remove a metadata entry for the layer. Returns MS_SUCCESS/MS_FAILURE.
int set(string property_name, new_value)
Set object property to a new value.
int setConnectionType(int connectiontype [,string plugin_library])
Changes the connectiontype of the layer and recreates the vtable according to the new connection type. This method should be used instead of setting the connectiontype parameter directly. In the case when the layer.connectiontype = MS_PLUGIN the plugin_library parameter should also be specified so as to select the library to load by MapServer. For the other connection types this parameter is not used.
int setFilter(string expression)
Set layer filter expression.
int setMetaData(string name, string value)
Set a metadata entry for the layer. Returns MS_SUCCESS/MS_FAILURE.
int setProcessing(string)
Add the string to the processing string list for the layer. The layer->num_processing is incremented by 1. Returns MS_SUCCESS or MS_FAILURE on error.

int setProjection(string proj_params)
Set layer projection and coordinate system. Parameters are given as a single string of comma-delimited PROJ.4 parameters. Returns MS_SUCCESS or MS_FAILURE on error.
int setWKTProjection(string proj_params)
Same as setProjection(), but takes an OGC WKT projection definition string as input.


int updateFromString(string snippet)
Update a layer from a string snippet. Returns MS_SUCCESS/MS_FAILURE.

int whichshapes(rectobj)
Performs a spatial, and optionally an attribute based feature search. The function basically prepares things so that candidate features can be accessed by query or drawing functions (eg using nextshape function). Returns MS_SUCCESS, MS_FAILURE or MS_DONE. MS_DONE is returned if the layer extent does not overlap the rectObj.



legendObj Constructor
Instances of legendObj are always are always embedded inside the mapObj.

Members


TypeNameNoteintheightcolorObjimagecolorintkeysizexintkeysizeyintkeyspacingxintkeyspacingylabelObjlabelcolorObjoutlinecolorColor of outline of box, -1 for no outlineintpositionfor embedded legends, MS_UL, MS_UC, . . .intpostlabelcacheMS_TRUE, MS_FALSEintstatusMS_ON, MS_OFF, MS_EMBEDstringtemplateintwidth
Methods
string convertToString()
Saves the object to a string. Provides the inverse option for updateFromString.
void free()
Free the object properties and break the internal references. Note that you have to unset the php variable to free totally the resources.
int set(string property_name, new_value)
Set object property to a new value.
int updateFromString(string snippet)
Update a legend from a string snippet. Returns MS_SUCCESS/MS_FAILURE.

lineObj Constructor

or using the old constructor


Members


TypeNameNoteintnumpointsread-only


Methods
int add(pointObj point)
Add a point to the end of line. Returns MS_SUCCESS/MS_FAILURE.
int addXY(double x, double y [, double m])
Add a point to the end of line. Returns MS_SUCCESS/MS_FAILURE.


int addXYZ(double x, double y, double z [, double m])
Add a point to the end of line. Returns MS_SUCCESS/MS_FAILURE.


PointObj point(int i)
Returns a reference to point number i.
int project(projectionObj in, projectionObj out)
Project the line from "in" projection (1st argument) to "out" projection (2nd argument).	Returns MS_SUCCESS/MS_FAILURE.

mapObj Constructor

or using the old constructors
mapObj ms_newMapObj(string map_file_name [, string new_map_path])
Returns a new object to deal with a MapServer map file.
mapObj ms_newMapObjFromString(string map_file_string [, string new_map_path])
Construct a new mapObj from a mapfile string. Returns a new object to deal with a MapServer map file.


Members


TypeNameNotedoublecellsizeintdebugcontinues on next page



Table 42 - continued from previous page
TypeNameNotedoubledefresolutionpixels per inch, defaults to 72rectObjextent;stringfontsetfilenameread-only, set by setFontSet()intheightsee setSize()colorObjimagecolorintkeysizexintkeysizeyintkeyspacingxintkeyspacingylabelcacheObjlabelcacheno members. Used only to free
the label cache (map->labelcache-
>free()legendObjlegendstringmappathintmaxsizehashTableObjmetadatastringnameintnumlayersread-onlyoutputformatObjoutputformatintnumoutputformatsread-onlyprojectionObjprojectionquerymapObjquerymapreferenceMapObjreferencedoubleresolutionpixels per inch, defaults to 72scalebarObjscalebardoublescaledenomread-only, set by drawMap()stringshapepathintstatusstringsymbolsetfilenameread-only, set by setSymbolSet()intunitsmap units typewebObjwebintwidthsee setSize()
Methods
int applyconfigoptions()
Applies the config options set in the map file. For example setting the PROJ_LIB using the setconfigoption only modifies the value in the map object. applyconfigoptions will actually change the PROJ_LIB value that will be used when dealing with projection.
int applySLD(string sldxml)
Apply the SLD document to the map file. The matching between the sld document and the map file will be done using the layer's name. See SLD HowTo for more information on the SLD support.
int applySLDURL(string sldurl)
Apply the SLD document pointed by the URL to the map file. The matching between the sld document and the map file will be done using the layer's name. See SLD HowTo for more information on the SLD support.
string convertToString()
Added in version 6.4. Saves the object to a string.






imageObj draw()
Render map and return an image object or NULL on error.
int drawLabelCache(imageObj image)
Renders the labels for a map. Returns MS_SUCCESS or MS_FAILURE on error.
imageObj drawLegend()
Render legend and return an image object.
imageObj drawQuery()
Render a query map and return an image object or NULL on error.
imageObj drawReferenceMap()
Render reference map and return an image object.
imageObj drawScaleBar()
Render scale bar and return an image object.
int embedLegend(imageObj image)
embeds a legend. Actually the legend is just added to the label cache so you must invoke drawLabelCache() to ac- tually do the rendering (unless postlabelcache is set in which case it is drawn right away). Returns MS_SUCCESS or MS_FAILURE on error.
int embedScalebar(imageObj image)
embeds a scalebar. Actually the scalebar is just added to the label cache so you must invoke drawLabel- Cache() to actually do the rendering (unless postlabelcache is set in which case it is drawn right away). Returns MS_SUCCESS or MS_FAILURE on error.
void free()
Free the object properties and break the internal references. Note that you have to unset the php variable to free totally the resources.
void freeQuery(layerindex)
Frees the query result on a specified layer. If the layerindex is -1, all queries on layers will be freed.
string generateSLD()
Returns an SLD XML string based on all the classes found in all the layers that have STATUS on.
array getAllGroupNames()
Return an array containing all the group names used in the layers. If there are no groups, it returns an empty array.
array getAllLayerNames()
Return an array containing all the layer names. If there are no layers, it returns an empty array.
colorObj getColorbyIndex(int iCloIndex)
Returns a colorObj corresponding to the color index in the palette.
string getConfigOption(string key)
Returns the config value associated with the key. Returns an empty sting if key not found.
labelcacheMemberObj getLabel(int index)
Returns a labelcacheMemberObj from the map given an index value (0=first label). Labelcache has to be enabled.


(continues on next page)



(continued from previous page)
layerObj getLayer(int index)
Returns a layerObj from the map given an index value (0=first layer)
layerObj getLayerByName(string layer_name)
Returns a layerObj from the map given a layer name. Returns NULL if layer doesn't exist.
array getLayersDrawingOrder()
Return an array containing layer's index in the order which they are drawn. If there are no layers, it returns an empty array.
array getLayersIndexByGroup(string groupname)
Return an array containing all the layer's indexes given a group name. If there are no layers, it returns an empty array.
int getMetaData(string name)
Fetch metadata entry by name (stored in the WEB object in the map file). Returns "" if no entry matches the name.


int getNumSymbols()
Return the number of symbols in map.
string getProjection()
Returns a string representation of the projection. Returns NULL on error or if no projection is set.
int getSymbolByName(string symbol_name)
Returns the symbol index using the name.
symbolObj getSymbolObjectById(int symbolid)
Returns the symbol object using a symbol id. Refer to the symbol object reference section for more details.
int insertLayer( layerObj layer [, int nIndex=-1 ] )
Insert a copy of layer into the Map at index nIndex. The default value of nIndex is -1, which means the last possible index. Returns the index of the new Layer, or -1 in the case of a failure.
int loadMapContext(string filename [, boolean unique_layer_name])
Available only if WMS support is enabled. Load a WMS Map Context XML file into the current mapObj. If the map already contains some layers then the layers defined in the WMS Map context document are added to the current map. The 2nd argument unique_layer_name is optional and if set to MS_TRUE layers created will have a unique name (unique prefix added to the name). If set to MS_FALSE the layer name will be the the same name as in the context. The default value is MS_FALSE. Returns MS_SUCCESS/MS_FAILURE.
int loadOWSParameters(OwsrequestObj request, string version)
Load OWS request parameters (BBOX, LAYERS, &c.) into map. Returns MS_SUCCESS or MS_FAILURE. 2nd argument version is not mandatory. If not given, the version will be set to 1.1.1
int loadQuery(filename)
Loads a query from a file. Returns MS_SUCCESS or MS_FAILURE. To be used with savequery.
int moveLayerDown(int layerindex)
Move layer down in the hierarchy of drawing. Returns MS_SUCCESS or MS_FAILURE on error.



int moveLayerUp(int layerindex)
Move layer up in the hierarchy of drawing. Returns MS_SUCCESS or MS_FAILURE on error.
int offsetExtent(double x, double y)
Offset the map extent based on the given distances in map coordinates.	Returns MS_SUCCESS or MS_FAILURE.
int owsDispatch(OwsrequestObj request)
Processes and executes the passed OpenGIS Web Services request on the map. Returns MS_DONE (2) if there is no valid OWS request in the req object, MS_SUCCESS (0) if an OWS request was successfully processed and MS_FAILURE (1) if an OWS request was not successfully processed. OWS requests include WMS, WFS, WCS and SOS requests supported by MapServer. Results of a dispatched request are written to stdout and can be captured using the msIO services (ie. ms_ioinstallstdouttobuffer() and ms_iogetstdoutbufferstring())
imageObj prepareImage()
Return a blank image object.
void prepareQuery()
Calculate the scale of the map and set map->scaledenom.
string processLegendTemplate(array params)
Process legend template files and return the result in a buffer.

See alsoprocesstemplate
string processQueryTemplate(array params, boolean generateimages)
Process query template files and return the result in a buffer. Second argument generateimages is not mandatory. If not given it will be set to TRUE.

See alsoprocesstemplate
string processTemplate(array params, boolean generateimages)
Process the template file specified in the web object and return the result in a buffer. The processing consists of opening the template file and replace all the tags found in it. Only tags that have an equivalent element in the map object are replaced (ex [scaledenom]). The are two exceptions to the previous statement :
• [img], [scalebar], [ref], [legend] would be replaced with the appropriate url if the parameter generateimages is set to MS_TRUE. (Note : the images corresponding to the different objects are generated if the object is set to MS_ON in the map file)
• the user can use the params parameter to specify tags and their values. For example if the user have a specific tag call [my_tag] and would like it to be replaced by "value_of_my_tag" he would do

int queryByFeatures(int slayer)
Perform a query based on a previous set of results from a layer. At present the results MUST be based on a polygon layer. Returns MS_SUCCESS if shapes were found or MS_FAILURE if nothing was found or if some other error happened (note that the error message in case nothing was found can be avoided in PHP using the '@' control operator).



int queryByIndex(layerindex, tileindex, shapeindex[, addtoquery])
Add a specific shape on a given layer to the query result. If addtoquery (which is a non mandatory argument) is set to MS_TRUE, the shape will be added to the existing query list. Default behavior is to free the existing query list and add only the new shape.
int queryByPoint(pointObj point, int mode, double buffer)
Query all selected layers in map at point location specified in georeferenced map coordinates (i.e. not pixels). The query is performed on all the shapes that are part of a CLASS that contains a Templating value or that match any class in a layer that contains a LAYER TEMPLATE value. Mode is MS_SINGLE or MS_MULTIPLE depending on number of results you want. Passing buffer -1 defaults to tolerances set in the map file (in pixels) but you can use a constant buffer (specified in ground units) instead. Returns MS_SUCCESS if shapes were found or MS_FAILURE if nothing was found or if some other error happened (note that the error message in case nothing was found can be avoided in PHP using the '@' control operator).
int queryByRect(rectObj rect)
Query all selected layers in map using a rectangle specified in georeferenced map coordinates (i.e. not pixels). The query is performed on all the shapes that are part of a CLASS that contains a Templating value or that match any class in a layer that contains a LAYER TEMPLATE value. Returns MS_SUCCESS if shapes were found or MS_FAILURE if nothing was found or if some other error happened (note that the error message in case nothing was found can be avoided in PHP using the '@' control operator).
int queryByShape(shapeObj shape)
Query all selected layers in map based on a single shape, the shape has to be a polygon at this point. Returns MS_SUCCESS if shapes were found or MS_FAILURE if nothing was found or if some other error happened (note that the error message in case nothing was found can be avoided in PHP using the '@' control operator).
layerObj removeLayer( int nIndex )
Remove a layer from the mapObj. The argument is the index of the layer to be removed. Returns the removed layerObj on success, else null.
int removeMetaData(string name)
Remove a metadata entry for the map (stored in the WEB object in the map file). Returns MS_SUCCESS/MS_FAILURE.
int save(string filename)
Save current map object state to a file. Returns -1 on error. Use absolute path. If a relative path is used, then it will be relative to the mapfile location.
int saveMapContext(string filename)
Available only if WMS support is enabled. Save current map object state in WMS Map Context format. Only WMS layers are saved in the WMS Map Context XML file. Returns MS_SUCCESS/MS_FAILURE.
int saveQuery(string filename[, int results])
Save the current query in a file. Results determines the save format - MS_TRUE (or 1/true) saves the query results (tile index and shape index), MS_FALSE (or 0/false) the query parameters (and the query will be re-run in loadquery). Returns MS_SUCCESS or MS_FAILURE. Either save format can be used with loadquery. See RFC 65 and ticket #3647 for details of different save formats.
int scaleExtent(double zoomfactor, double minscaledenom, double maxscaledenom)
Scale the map extent using the zoomfactor and ensure the extent within the minscaledenom and maxscaledenom domain. If minscaledenom and/or maxscaledenom is 0 then the parameter is not taken into account. Returns MS_SUCCESS or MS_FAILURE.
int selectOutputFormat(string type)
Selects the output format to be used in the map. Returns MS_SUCCESS/MS_FAILURE.






int appendOutputFormat(outputFormatObj outputFormat)
Appends outputformat object in the map object. Returns the new numoutputformats value.
int removeOutputFormat(string name)
Remove outputformat from the map. Returns MS_SUCCESS/MS_FAILURE.
outputFormatObj getOutputFormat(int index)
Returns the outputformat at index position.
int set(string property_name, new_value)
Set map object property to new value.
int setCenter(pointObj center)
Set the map center to the given map point. Returns MS_SUCCESS or MS_FAILURE.
int setConfigOption(string key, string value)
Sets a config parameter using the key and the value passed
void setExtent(double minx, double miny, double maxx, double maxy)
Set the map extents using the georef extents passed in argument. Returns MS_SUCCESS or MS_FAILURE on error.
int setFontSet(string fileName)
Load and set a new FONTSET .
boolean setLayersDrawingOrder(array layeryindex)
Set the layer's order array. The argument passed must be a valid array with all the layer's index. Returns MS_SUCCESS or MS_FAILURE on error.
int setMetaData(string name, string value)
Set a metadata entry for the map (stored in the WEB object in the map file).	Returns MS_SUCCESS/MS_FAILURE.
int setProjection(string proj_params, boolean bSetUnitsAndExtents)
Set map projection and coordinate system. Returns MS_SUCCESS or MS_FAILURE on error.
Parameters are given as a single string of comma-delimited PROJ.4 parameters. The argument : bSetUnit- sAndExtents is used to automatically update the map units and extents based on the new projection. Possible values are MS_TRUE and MS_FALSE. By default it is set at MS_FALSE.
int setRotation(double rotation_angle)
Set map rotation angle. The map view rectangle (specified in EXTENTS) will be rotated by the indicated angle in the counter- clockwise direction. Note that this implies the rendered map will be rotated by the angle in the clockwise direction. Returns MS_SUCCESS or MS_FAILURE.
int setSize(int width, int height)
Set the map width and height. This method updates the internal geotransform and other data structures re- quired for map rotation so it should be used instead of setting the width and height members directly. Returns MS_SUCCESS or MS_FAILURE.
int setSymbolSet(string fileName)
Load and set a symbol file dynamically.



int setWKTProjection(string proj_params, boolean bSetUnitsAndExtents)
Same as setProjection(), but takes an OGC WKT projection definition string as input. Returns MS_SUCCESS or MS_FAILURE on error.


int zoomPoint(int nZoomFactor, pointObj oPixelPos, int nImageWidth, int nImageHeight, rectObj oGeorefExt)
Zoom to a given XY position. Returns MS_SUCCESS or MS_FAILURE on error.
Parameters are
• Zoom factor : positive values do zoom in, negative values zoom out. Factor of 1 will recenter.
• Pixel position (pointObj) : x, y coordinates of the click, with (0,0) at the top-left
• Width : width in pixel of the current image.
• Height : Height in pixel of the current image.
• Georef extent (rectObj) : current georef extents.
• MaxGeoref extent (rectObj) : (optional) maximum georef extents. If provided then it will be impossible to zoom/pan outside of those extents.
int zoomRectangle(rectObj oPixelExt, int nImageWidth, int nImageHeight, rectObj oGeorefExt)
Set the map extents to a given extents. Returns MS_SUCCESS or MS_FAILURE on error. Parameters are :
• oPixelExt (rect object) : Pixel Extents
• Width : width in pixel of the current image.
• Height : Height in pixel of the current image.
• Georef extent (rectObj) : current georef extents.
int zoomScale(double nScaleDenom, pointObj oPixelPos, int nImageWidth, int nImageHeight, rectObj oGeorefExt [, rectObj oMaxGeorefExt])
Zoom in or out to a given XY position so that the map is displayed at specified scale. Returns MS_SUCCESS
or MS_FAILURE on error. Parameters are :
• ScaleDenom : Scale denominator of the scale at which the map should be displayed.
• Pixel position (pointObj) : x, y coordinates of the click, with (0,0) at the top-left
• Width : width in pixel of the current image.
• Height : Height in pixel of the current image.
• Georef extent (rectObj) : current georef extents.
• MaxGeoref extent (rectObj) : (optional) maximum georef extents. If provided then it will be impossible to zoom/pan outside of those extents.



outputformatObj Constructor
Instance of outputformatObj is always embedded inside the mapObj. It is uses a read only. No constructor available (coming soon, see ticket 979)
Members


TypeNameNotestringdriverstringextensionintimagemodeMS_IMAGEMODE_* value.stringmimetypestringnameintrendererinttransparent
Methods
string getOption(string property_name)
Returns the associated value for the format option property passed as argument. Returns an empty string if property not found.
int set(string property_name, new_value)
Set object property to a new value.
void setOption(string property_name, string new_value)
Add or Modify the format option list. return true on success.

int validate()
Checks some internal consistency issues, Returns MS_SUCCESS or MS_FAILURE. Some problems are fixed up internally. May produce debug output if issues encountered.

OwsrequestObj Constructor

or using the old constructor

Create a new ows request object.



Members


TypeNameintnumparams (read-only)inttype (read-only): MS_GET_REQUEST or MS_POST_REQUEST
Methods
int addParameter(string name, string value)
Add a request parameter, even if the parameter key was previousely set. This is useful when multiple parameters with the same key are required. For example :

string getName(int index)
Return the name of the parameter at index in the request's array of parameter names.
string getValue(int index)
Return the value of the parameter at index in the request's array of parameter values.
string getValueByName(string name)
Return the value associated with the parameter name.
int loadParams()
Initializes	the OWSRequest	object from	the	cgi environment	variables	REQUEST_METHOD, QUERY_STRING and HTTP_COOKIE. Returns the number of name/value pairs collected.
int setParameter(string name, string value)
Set a request parameter. For example :


pointObj Constructor

or using the old constructor


Members


TypeNameNotedoublexdoubleydoublezused for 3d shape files. set to 0 for other typesdoublemused only for measured shape files - set to 0 for other types


Methods
double distanceToLine(pointObj p1, pointObj p2)
Calculates distance between a point ad a lined defined by the two points passed in argument.
double distanceToPoint(pointObj poPoint)
Calculates distance between two points.
double distanceToShape(shapeObj shape)
Calculates the minimum distance between a point and a shape.
int draw(mapObj map, layerObj layer, imageObj img, int class_index [, string text])
Draws the individual point using layer. The class_index is used to classify the point based on the classes defined for the layer. The text string is used to annotate the point. (Optional) Returns MS_SUCCESS/MS_FAILURE.
int project(projectionObj in, projectionObj out)
Project the point from "in" projection (1st argument) to "out" projection (2nd argument).	Returns MS_SUCCESS/MS_FAILURE.
int setXY(double x, double y [, double m])
Set X,Y coordinate values.


int setXYZ(double x, double y, double z [, double m])
Set X,Y,Z coordinate values.


projectionObj Constructor

or using the old constructor

Creates a projection object based on the projection string passed as argument.

will create a geographic projection class.
The following example will convert a lat/long point to an LCC projection:



(continues on next page)



(continued from previous page)

Methods
int getUnits()
Returns the units of a projection object. Returns -1 on error.

querymapObj Constructor
Instances of querymapObj are always are always embedded inside the mapObj.

Members


TypeName	NotecolorObjcolorintheightintwidthintstyle	MS_NORMAL, MS_HILITE, MS_SELECTED
Methods
string convertToString()
Saves the object to a string. Provides the inverse option for updateFromString.
void free()
Free the object properties and break the internal references. Note that you have to unset the php variable to free totally the resources.
int set(string property_name, new_value)
Set object property to a new value.
int updateFromString(string snippet)
Update a queryMap object from a string snippet. Returns MS_SUCCESS/MS_FAILURE.

rectObj Constructor
rectObj are sometimes embedded inside other objects. New ones can also be created with:

or using the old constructor







Members


TypeNamedoubleminxdoubleminydoublemaxxdoublemaxy
Methods
int draw(mapObj map, layerObj layer, imageObj img, int class_index [, string text])
Draws the individual rectangle using layer. The class_index is used to classify the rectangle based on the classes defined for the layer. The text string is used to annotate the rectangle. (Optional) Returns MS_SUCCESS/MS_FAILURE.
double fit(int width, int height)
Adjust extents of the rectangle to fit the width/height specified.
int project(projectionObj in, projectionObj out)
Project the rectangle from "in" projection (1st argument) to "out" projection (2nd argument).	Returns MS_SUCCESS/MS_FAILURE.
int set(string property_name, new_value)
Set object property to a new value.
void setextent(double minx, double miny, double maxx, double maxy)
Set the rectangle extents.

referenceMapObj Constructor
Instances of referenceMapObj are always embedded inside the mapObj.



Members


TypeNameColorObjcolorintheightrectObjextentstringimageintmarkerstringmarkernameintmarkersizeintmaxboxsizeintminboxsizeColorObjoutlinecolorintstatusintwidth
Methods
string convertToString()
Saves the object to a string. Provides the inverse option for updateFromString.
void free()
Free the object properties and break the internal references. Note that you have to unset the php variable to free totally the resources.
int set(string property_name, new_value)
Set object property to a new value.
int updateFromString(string snippet)
Update a referenceMap object from a string snippet. Returns MS_SUCCESS/MS_FAILURE.

resultObj Constructor

or using the layerObj's getResult() method.

Members


TypeNameNoteintclassindexread-onlyintresultindexread-onlyintshapeindexread-onlyinttileindexread-only


Method
None

scalebarObj Constructor
Instances of scalebarObj are always embedded inside the mapObj.

Members


TypeNameNoteintaligncolorObjbackgroundcolorcolorObjcolorintheightcolorObjimagecolorintintervalslabelObjlabelcolorObjoutlinecolorintpositionfor embedded scalebars, MS_UL, MS_UC, . . .intpostlabelcacheintstatusMS_ON, MS_OFF, MS_EMBEDintstyleintunitsintwidth
Methods
string convertToString()
Saves the object to a string. Provides the inverse option for updateFromString.
void free()
Free the object properties and break the internal references. Note that you have to unset the php variable to free totally the resources.
int set(string property_name, new_value)
Set object property to a new value.
int setImageColor(int red, int green, int blue)
Sets the imagecolor property (baclground) of the object. Returns MS_SUCCESS or MS_FAILURE on error.
int updateFromString(string snippet)
Update a scalebar from a string snippet. Returns MS_SUCCESS/MS_FAILURE.

shapefileObj Constructor

or using the old constructor





Opens a shapefile and returns a new object to deal with it. Filename should be passed with no extension. To create a new file (or overwrite an existing one), type should be one of MS_SHP_POINT, MS_SHP_ARC, MS_SHP_POLYGON or MS_SHP_MULTIPOINT. Pass type as -1 to open an existing file for read-only access, and type=-2 to open an existing file for update (append).

Members


TypeNameNoterectObjboundsread-onlyintnumshapesread-onlystringsourceread-onlyinttyperead-only
Methods
int addPoint(pointObj point)
Appends a point to an open shapefile.
int addShape(shapeObj shape)
Appends a shape to an open shapefile.
void free()
Free the object properties and break the internal references. Note that you have to unset the php variable to free totally the resources.


rectObj getExtent(int i)
Retrieve a shape's bounding box by index.
shapeObj getPoint(int i)
Retrieve point by index.
shapeObj getShape(int i)
Retrieve shape by index.
shapeObj getTransformed(mapObj map, int i)
Retrieve shape by index.

shapeObj Constructor

or using the old constructor





'type' is one of MS_SHAPE_POINT, MS_SHAPE_LINE, MS_SHAPE_POLYGON or MS_SHAPE_NULL

Creates new shape object from WKT string.

Members


TypeNameNoterectObjboundsread-onlyintclassindexintindexintnumlinesread-onlyintnumvaluesread-onlyinttileindexread-onlystringtextinttyperead-onlyarrayvaluesread-only
The values array is an associative array with the attribute values for this shape. It is set only on shapes obtained from layer->getShape(). The key to the values in the array is the attribute name, e.g.


Methods
int add(lineObj line)
Add a line (i.e. a part) to the shape.
shapeObj boundary()
Returns the boundary of the shape. Only available if php/mapscript is built with GEOS library.
shapeObj buffer(width)
Returns a new buffered shapeObj based on the supplied distance (given in the coordinates of the existing shapeObj). Only available if php/mapscript is built with GEOS library.
int containsShape(shapeObj shape2)
Returns true if shape2 passed as argument is entirely within the shape. Else return false. Only available if php/mapscript is built with GEOS library.
shapeObj convexhull()
Returns a shape object representing the convex hull of shape. Only available if php/mapscript is built with GEOS library.
boolean contains(pointObj point)
Returns MS_TRUE if the point is inside the shape, MS_FALSE otherwise.
int crosses(shapeObj shape)
Returns true if the shape passed as argument crosses the shape. Else return false. Only available if php/mapscript is built with GEOS library.



shapeObj difference(shapeObj shape)
Returns a shape object representing the difference of the shape object with the one passed as parameter. Only available if php/mapscript is built with GEOS library.
int disjoint(shapeObj shape)
Returns true if the shape passed as argument is disjoint to the shape. Else return false. Only available if php/mapscript is built with GEOS library.
int draw(mapObj map, layerObj layer, imageObj img)
Draws the individual shape using layer. Returns MS_SUCCESS/MS_FAILURE.
int equals(shapeObj shape)
Returns true if the shape passed as argument is equal to the shape (geometry only). Else return false. Only available if php/mapscript is built with GEOS library.
void free()
Free the object properties and break the internal references. Note that you have to unset the php variable to free totally the resources.
double getArea()
Returns the area of the shape (if applicable). Only available if php/mapscript is built with GEOS library.
pointObj getCentroid()
Returns a point object representing the centroid of the shape. Only available if php/mapscript is built with GEOS library.
pointObj getLabelPoint()
Returns a point object with coordinates suitable for labelling the shape.
double getLength()
Returns the length (or perimeter) of the shape. Only available if php/mapscript is built with GEOS library.
pointObj getMeasureUsingPoint(pointObj point)
Apply only on Measured shape files. Given an XY Location, find the nearest point on the shape object. Return a point object of this point with the m value set.
pointObj getPointUsingMeasure(double m)
Apply only on Measured shape files. Given a measure m, retun the corresponding XY location on the shapeobject.
string getValue(layerObj layer, string filedname)
Returns the value for a given field name.
shapeObj intersection(shapeObj shape)
Returns a shape object representing the intersection of the shape object with the one passed as parameter. Only available if php/mapscript is built with GEOS library.
boolean intersects(shapeObj shape)
Returns MS_TRUE if the two shapes intersect, MS_FALSE otherwise.
LineObj line(int i)
Returns a reference to line number i.
int overlaps(shapeObj shape)
Returns true if the shape passed as argument overlaps the shape. Else returns false. Only available if php/mapscript is built with GEOS library.
int project(projectionObj in, projectionObj out)
Project the shape from "in" projection (1st argument) to "out" projection (2nd argument).	Returns MS_SUCCESS/MS_FAILURE.
int set(string property_name, new_value)
Set object property to a new value.



int setBounds()
Updates the bounds property of the shape. Must be called to calculate new bounding box after new parts have been added.
shapeObj simplify(double tolerance)
Given a tolerance, returns a simplified shape object or NULL on error. Only available if php/mapscript is built with GEOS library (>=3.0).
shapeObj symdifference(shapeObj shape)
Returns the computed symmetric difference of the supplied and existing shape. Only available if php/mapscript is built with GEOS library.
shapeObj topologyPreservingSimplify(double tolerance)
Given a tolerance, returns a simplified shape object or NULL on error. Only available if php/mapscript is built with GEOS library (>=3.0).
int touches(shapeObj shape)
Returns true if the shape passed as argument touches the shape. Else return false. Only available if php/mapscript is built with GEOS library.
string toWkt()
Returns WKT representation of the shape's geometry.
shapeObj union(shapeObj shape)
Returns a shape object representing the union of the shape object with the one passed as parameter. Only available if php/mapscript is built with GEOS library
int within(shapeObj shape2)
Returns true if the shape is entirely within the shape2 passed as argument. Else returns false. Only available if php/mapscript is built with GEOS library.

styleObj Constructor
Instances of styleObj are always embedded inside a classObj or labelObj.

or using the old constructor (do not support a labelObj at first argument)

The second argument 'style' is optional. If given, the new style created will be a copy of the style passed as argument.



Members


TypeNameNotedoubleangleintantialiascolorObjbackgroundcolorcolorObjcolordoublemaxsizedoublemaxvaluedoublemaxwidthdoubleminsizedoubleminvaluedoubleminwidthintoffsetxintoffsetyintopacityonly supported for the AGG drivercolorObjoutlinecolorstringrangeitemdoublesizeintsymbolstringsymbolnamedoublewidth
Methods
string convertToString()
Saves the object to a string. Provides the inverse option for updateFromString.
void free()
Free the object properties and break the internal references. Note that you have to unset the php variable to free totally the resources.
string getBinding(mixed stylebinding)
Get the attribute binding for a specfiled style property. Returns NULL if there is no binding for this property.

string getGeomTransform()
int removeBinding(mixed stylebinding)
Remove the attribute binding for a specfiled style property. Added in MapServer 5.0.

int set(string property_name, new_value)
Set object property to a new value.
int setBinding(mixed stylebinding, string value)
Set the attribute binding for a specfiled style property. Added in MapServer 5.0.

This would bind the color parameter with the data (ie will extract the value of the color from the field called "FIELD_NAME_COLOR"



int setGeomTransform(string value)
int updateFromString(string snippet)
Update a style from a string snippet. Returns MS_SUCCESS/MS_FAILURE.

symbolObj Constructor

or using the old constructor

Creates a new symbol with default values in the symbolist.


If a symbol with the same name exists, it (or its id) will be returned. To get a symbol object using the old constructor, you need to use a method on the map object:


Members


TypeNameNoteintantialiasstringcharacterintfilledstringfontstringimagepathread-onlyintinmapfileIf set to TRUE, the symbol will be saved inside the mapfile.intpatternlengthread-onlyintpositionstringnameintnumpointsread-onlydoublesizexdoublesizeyinttransparentinttransparentcolor
Methods
void free()
Free the object properties and break the internal references. Note that you have to unset the php variable to free totally the resources.



array getPatternArray()
Returns an array containing the pattern. If there is no pattern, it returns an empty array.
array getPointsArray()
Returns an array containing the points of the symbol. Refer to setpoints to see how the array should be interpreted. If there are no points, it returns an empty array.
int set(string property_name, new_value)
Set object property to a new value.
int setImagePath(string filename)
Loads a pixmap symbol specified by the filename. The file should be of either Gif or Png format.
int setPattern(array int)
Set the pattern of the symbol (used for dash patterns). Returns MS_SUCCESS/MS_FAILURE.
int setPoints(array double)
Set the points of the symbol. Note that the values passed is an array containing the x and y values of the points. Returns MS_SUCCESS/MS_FAILURE. Example:


Example of usage
1) create a symbol to be used as a dash line

2) Create a TrueType symbol




webObj Constructor
Instances of webObj are always are always embedded inside the mapObj.

Members


TypeNameNotestringbrowseformatstringemptyread-onlystringerrorread-onlyrectObjextentread-onlystringfooterstringheaderstringimagepathstringimageurlstringlegendformatstringlogdoublemaxscaledenomstringmaxtemplatehashTableObjmetadatadoubleminscaledenomstringmintemplatestringqueryformatstringtemplatestringtemppath
Methods
string convertToString()
Saves the object to a string. Provides the inverse option for updateFromString.
void free()
Free the object properties and break the internal references. Note that you have to unset the php variable to free totally the resources.
int set(string property_name, new_value)
Set object property to a new value.
int updateFromString(string snippet)
Update a web object from a string snippet. Returns MS_SUCCESS/MS_FAILURE.

PHP MapScript Migration Guide
Author
Alan Boudreault
Contact
aboudreault at mapgears.com
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com



Last updated
2019-05-25


Introduction
This document describes the changes that must be made to PHP MapScript applications when migrating from one MapServer version to another (i.e. backwards incompatibilities), as well as information on some of the new features.

WarningAs of the MapServer 8.0.0 release PHP support is only available through MapServer's SWIG API. The unmaintained
native PHP MapScript support was removed.
Migrating to 7.4's new SWIG API and PHP 7
As of the MapServer 7.4.0 release, users are recommended to switch to MapServer's new SWIG API support of PHP 7+ (reason for recommendation: as we saw with the breaking PHP 7 changes, managing PHP through SWIG will be easier on the MapServer maintainers in the long run). Some important SWIG notes:
• you will require at least SWIG-3.0.11 (but 4.0.0 is recommended).
• if you notice any missing functions that were available in the old native PHP MapScript API, first please check the SWIG API reference document for an alternative function to use, and if there is nothing similar available then file a ticket for each function that you require.



• all of your PHP scripts (that leverage MapServer objects and functions) must now always first include the gener- ated mapscript.php file containing MapServer constants:

• take note of the change in how to declare your new objects:

instead of the former way:


Migrating 5.6 to 6.0 PHP Version Required
PHP 5.2.0 or more recent is required. The support for earlier versions has been dropped.

Error Reporting
PHP MapScript now uses exceptions for error reports. All errors are catchable. There are no more fatal errors reported via the standard uncatchable PHP system (Only Warnings).

Manipulating Objects
• Object properties can be set like all other PHP objects.


• Objects can be created with the PHP "new" operator.









• Cloneable objects should be cloned with the PHP clone keyword. There is no more clone methods.

Class Properties
Class properties that have been removed:
• classObj: maxscale, minscale
• layerObj: labelsizeitem, labelangleitem, labelmaxscale, labelminscale, maxscale, minscale, symbolscale, trans- parency
• legendObj: interlace, transparent
• mapObj: imagetype, imagequality, interlace, scale, transparent
• scalebarObj: interlace, transparent
• symbolObj: gap, stylelength
• webObj: minscale, maxscale

Class Methods
Class methods that have been removed:
• imageObj: free
• layerObj: getFilter, getShape
• lineObj: free
• pointObj: free
• projectionObj: free
• rectObj: free
• shapeObj: union_geos
• symbolObj: getstylearray
• classObj: clone
• styleObj: clone
• mapObj: clone
• outputFormatObj: getformatoption, setformatoption

layerObj
layerObj->clearProcessing() method now returns void.

mapObj
mapObj->queryByIndex(): default behavior for the addToQuery parameter was not ok, now it is.



referenceMapObj
referenceMapObj has new properties: marker, markername, markersize, maxboxsize, minboxsize.

shapeFileObj
shapeFileObj is automatically closed/writed on destroy. (At the end of the script or with an explicit free(), unset())

labelCacheObj
To free the cache, you'll have to call the method freeCache() rather than free().

Methods that now return MS_SUCCESS/MS_FAILURE
• layerObj: setProcessing, addFeature, draw
• mapObj: moveLayerUp, moveLayerDown, zoomRectangle, zoomScale, setProjection, setWKTProjection, set- LayersDrawingOrder
• outputFormatObj: validate
• scalebarObj: setImageColor
• symbolObj: setPoints, setPattern

Methods that now return NULL on failure
• classObj: clone
• mapObj: clone, draw, drawQuery getLayerByName, getProjection
• layerObj: nextShape, getExtent
• styleObj: clone

Methods that now return an empty array
• layerObj: getItems, getProcessing, getGridIntersectionCoordinates
• mapObj: getLayersIndexByGroup, getAllGroupNames, getLayersDrawingOrder, getAllLayerNames
• symbolObj: getPatternArray

By Example
Author
Vinko Vrsalovic
Contact
el at vinko.cl
Last Updated
2005-12-12

Contents• By Example




WarningAs of the MapServer 8.0.0 release PHP support is only available through MapServer's SWIG API. The unmaintained
native PHP MapScript support was removed.


Introduction
The purpose of this document is to be a step by step explanation of the PHP MapScript API with practical examples for each of them. It is assumed a basic knowledge of MAP and MapServer, and familiarity with the PHP (scripting) and HTML (markup) languages . This document was originally created for MapServer v4.0, but the examples still apply to more recent versions.
Let's Begin. . .
Hello, kind reader. I am Tut, thank you for downloading me. I am sorry, but I am just a technical manual so I cannot answer any questions. The maintainer, a handsome, very nice and lazy guy according to what I saw from the other side of the screen, maybe will be able to answer your question(s). I am currently here to tell you about MapScript in its PHP incarnation. At my current age, I will be more useful to beginners than advanced users, even though I hope that some day I will be sufficiently old to be useful to advanced MapScript programmers.
Let's hope I live long enough. . . sigh.
But enough with my personal problems, let myself begin. My duty is to familiarize you with MapScript, and in par- ticular with PHP MapScript. When I end, you are expected to understand what MapScript is, and to be able to write applications to display and navigate that is, zooming and panning over shapefiles via a web browser.
What follows are the questions you must answer affirmatively before accompanying me through the rest of this journey (I apologize for my maintainer's lack of literary taste).

Do you have running somewhere. . .
• a web server capable of running PHP as a CGI (Apache will do)?
• the PHP language configured as a CGI, version 4.1.2 or higher? I recommend 4.3 onwards.
• PHP MapScript, version 4.0 or later? PHP MapScript Installation



Can you. . .
• code PHP or are willing to learn how to?
• write and understand HTML documents? (Note that Javascript is a plus)
• tell somebody what on earth is a shapefile [or a PostGIS table]?

Outline of this Document
• A general overview of MapScript, in a language independent way
• A trivial example
• A simple example
• Conclusion
You can also go to each part directly through my table of contents located at the top, if you wish to skip some sections.

MapScript overview
Ok, now I'm at last arriving at a point I will enjoy. This overview intends to clear some common misconceptions beginners encounter when first facing MapScript and to give a general overview about MapScript's internals. For now, just look at the following diagram (I apologize again for the maintainer's lack of graphic design taste).

It all starts as everything on the Web. A browser requests a certain URL through HTTP. The request arrives at the web server, which, in turn, delivers a file or executes a program and then delivers its output back to the browser. Yes, I know you knew that, but I have been told to be as complete as possible, and I will try to.
In MapScript's case, the server executes a certain script, which contains standard language functionality, that is, the same functionality you would have in that language without MapScript, plus access to almost all of the MapServer C



API, the level of completeness of MapServer API support varies a bit with the language you choose, but I think it is my duty to tell you almost every available flavor of MapScript is usable. This API, exposed now in your scripting language through the MapScript module, allows you to do many GIS-like operations on spatial data, including read-write access to shapefiles, reprojection of data, and many others. For more information on the API, click over the link above. For other flavors, you can check their own documentation, you will see there is not much difference.
The CGI version of MapServer is not required to run MapScript applications, just as you don't need a particular Map- Script module to run the CGI. The CGI version has many features out-of-the-box, MapScript is just an API, so with MapScript you must start from scratch or with some of the examples available. Think of the CGI as of a MapScript ap- plication written directly in C, with direct access to the MapServer C API. Sometimes the out-of-the-box functionality has some limits which can be surpassed by MapScript, but not embedded within the CGI. In other words, the CGI is not scriptable, but you can program all the CGI and more with MapScript. This may seem a strange thing to clarify, but is a common misconception, just check the list archives if you are not inclined to believe me.
As with MapServer itself, MapScript can be configured using only map files, but, unlike the CGI, also includes the pos- sibility of dynamically create maps or modify existing ones and to (and here is the key to the flexibility that MapScript has) mix this information with other sources of non GIS data, such as user input, non spatial and spatial databases, text files, etc. and that you can use every single module your language provides. The power of this approach is tremendous, and the most restrictive limit is your imagination. As always, flexibility comes with a price, performance. It's generally slower to use a scripting language instead of C, but nowadays this shouldn't be a big worry. And you can still program directly in C (there are not much documents about how to do it, though you might want to check the mapserver-dev list) if you would like to.
The input and output formats MapScript can handle are exactly the same as the ones configured when you build MapServer/MapScript. But one of the most important things to remember is that, basically, you feed geographic data and relevant user input (for instance clicks over the map image) to MapScript and as a result get one or more file(s), typically standard image files such as a PNG or JPEG. So you can apply anything you've seen in any server side scripted web application, DHTML, Java applets, CSS, HTML templates, sessions, you name it.

Our first application
In this first example, I will tell you how to display a shapefile on a web page using a map file.

The Map File
Here's the map file:

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18
(continues on next page)



(continued from previous page)
19

20

21

22

23

24

25

26

27

28


Here I have shown a map with a single layer, where the europe.shp, europe.shx and europe.dbf files must be located in the subdirectory called data. The symbols are located in the symbols subdirectory. All this locations are relative from the place the map file is, but better safe than sorry, I guess. The web section is used to define where will the images be saved and in what URL will they be available.

Displaying the map with MapScript
To display a map the following MapScript objects and methods will be used:
• MapObj object
   • imageObj object MapObj methods:
• The constructor method: MapObj ms_newMapObj(string map_file_name[,string new_map_path])
   • The draw method: imageObj draw() imageObj methods:
   • The saveWebImage method: string saveWebImage() The code looks like this:
1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20



The code I will present through the rest of this document will follow the following rule:
• Every non empty line is numbered
This code will render an image corresponding to the shapefile europe and display it on a HTML page.

Code Explanation
• In line 2 it is loaded the MapScript extension (you may not need it if your php.ini file is configured to automatically load it).
• Line 3 declares a variable that holds the absolute path for the mapfile.
• Line 4 creates an instance of the MapObj object using the constructor. As you can see, the constructor receives the location of the map file as its only required parameter, and the map file received the europe.map name.
• Afterwards the draw method of the map object is called to render the image defined by the map file (line 5). The result (an imageObj) is saved in the $image variable.
• Line 6 calls the saveWebImage method to generate the image file, it returns a string which represents the URL as defined in the mapfile (in this case, /tmp/filename.png).
• The rest of the lines are pure HTML, except line 13, that defines the source URL of the image will be the value stored in $image_url.
You should test the application on your system, to check that it really works and to solve the problems that may arise on your particular configuration before moving on to the more complex examples.

Output
The output (using the europe shapefile) should look like this:




Zooming and Panning
Now I will tell you how to add zoom and pan capabilities to the code. Here goes the list of new methods and objects called.
New Objects:
• pointObj
• rectObj
New Methods and Members called:
• The zoompoint method of the map object: void zoompoint(int nZoomFactor, pointObj oPixelPos, int nIm- ageWidth, int nImageHeight, rectObj oGeorefExt).
• The setextent method of the map object: $map->setextent(double minx, double miny, double maxx, double maxy);.
• The extent, width and height members of the map object.
• The constructors of RectObj and PointObj: $point = ms_newPointObj(); $rect = ms_newRectObj();
• The setXY method of the point object: $point->setXY(double x_coord, double y_coord);
• The setextent method of the rectangle object: $rect->setextent(double minx, double miny, double maxx, double maxy);
The .map file remains the same as the one presented in the previous example.

PHP/MapScript Code
Here I present the new code.

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

24

25
(continues on next page)





26	$my_extent = ms_newrectObj();
27
28	$my_extent->setextent($extent_to_set[0],$extent_to_set[1],

(continued from previous page)

29

30

31

32

33

34

35

36

37

38

39

40

41

42

43

44

45

46

47

48

49

50

51
52	}
53

54

$extent_to_set[2],$extent_to_set[3]);
$zoom_factor  =  $_POST["zoom"]*$_POST["zsize"];
if ($zoom_factor == 0) {
$zoom_factor = 1;
$check_pan = "CHECKED";
$check_zout = "";
$check_zin = "";
} else if ($zoom_factor < 0) {
$check_pan = "";
$check_zout = "CHECKED";
$check_zin = "";
} else {
$check_pan = "";
$check_zout = "";
$check_zin = "CHECKED";
}
$val_zsize = abs($zoom_factor);
$map->zoompoint($zoom_factor,$my_point,$map->width,$map->height,
$my_extent);

55	$image=$map->draw();
56	$image_url=$image->saveWebImage();
57
58	$extent_to_html = $map->extent->minx." ".$map->extent->miny." "
59	.$map->extent->maxx." ".$map->extent->maxy;
60
61	?>
62	<HTML>
63	<HEAD>
64	<TITLE>Map 2</TITLE>
65	</HEAD>
66	<BODY>
67	<CENTER>
68	<FORM  METHOD=POST  ACTION=<?php  echo  $HTTP_SERVER_VARS['PHP_SELF']?>>
69	<TABLE>
70	<TR>
71	<TD>
72	<INPUT TYPE=IMAGE NAME="mapa" SRC="<?php echo $image_url?>">
73	</TD>
74	</TR>
75	<TR>
76	<TD>
77	Pan
(continues on next page)



(continued from previous page)
78	</TD>
79	<TD>
80	<INPUT TYPE=RADIO NAME="zoom" VALUE=0 <?php echo $check_pan?>>
81	</TD>
82	</TR>
83	<TR>
84	<TD>
85	Zoom In
86	</TD>
87	<TD>
88	<INPUT TYPE=RADIO NAME="zoom" VALUE=1 <?php echo $check_zin?>>
89	</TD>
90	</TR>
91	<TR>
92	<TD>
93	Zoom Out
94	</TD>
95	<TD>
96	<INPUT TYPE=RADIO NAME="zoom" VALUE=-1 <?php echo $check_zout?>>
97	</TD>
98	</TR>
99	<TR>
100	<TD>
101	Zoom Size
102	</TD>
103	<TD>
104	<INPUT TYPE=TEXT NAME="zsize" VALUE="<?php echo $val_zsize?>"
105	SIZE=2>
106	</TD>
107	</TR>
108	<TR>
109	<TD>
110	Full Extent
111	</TD>
112	<TD>
113	<INPUT TYPE=SUBMIT NAME="full" VALUE="Go"
114	SIZE=2>
115	</TD>
116	</TABLE>
117	<INPUT TYPE=HIDDEN NAME="extent" VALUE="<?php echo $extent_to_html?>">
118	</FORM>
119	</CENTER>
120	</BODY>
121	</HMTL>

This code will zoom out, zoom in, pan, and restore to full extent the image displayed in the previous example.
It looks much more complicated than it really is, much of the lines are the HTML code, and much of the remaining PHP code is just to deal with the forms and such.
You should try it and look at how it works first. Try it in your own server by copying and pasting the code. Now it's time for you to play with it a little and look at the source in your browser to check how it changes. Done?, now let's start the explanation with the HTML part.



Code Explanation - HTML
Line 49 declares a form, and line 53 declares the image generated by MapScript to be part of that form, so when you click on it, the X and Y coordinates of the click (in pixels) will be sent along with the other data for the PHP code to process.
If you are familiar with HTML and PHP, the rest of the HTML code should be straightforward for you to understand with the exception of line 98, that will be explained in due time.

Code Explanation - PHP
Now look at the PHP code, it's almost the same code used in example 1, with the addition of lines 9 to 37. What do these lines do?
Line 9 checks the relevant variables from the form have been set. 'mapa_x' and 'mapa_y' represent the X and Y coordinates of the click over the image, and 'full' represents the click on the 'Full Extent' button.
The first time the page is displayed the code between the if statement doesn't get executed, but the rest of the code does. Lines 40 and 41 set the '$extent_to_html' variable with the values of the extent defined in the map file separated by spaces; that value will be put in the HTML variable 'extent' in line 98.
Now look at line 11 and 12. We are inside the if statement, that means the form has been submitted at least once. We grab the extent stored in the previous execution (the 'extent' HTML variable) of the code and set the extent of the map to be that last extent. This allows to zoom or pan with respect of the previous extent, not the extent that is set in the map file.
From that last paragraph you can deduce that all the default values are set in the map file, and anything that you change through MapScript and would like to remain in your code, must be stored somehow. In this case it is done through hidden variables in a form. For more advanced applications you could use session variables or a database.
Now you should be able to see why the 'Full Extent' button works. If you check line 10, it says that if you haven't pressed the button, skip the code in the if statement, so the extent is reset to the value that the map file has. You should also see that it isn't necessarily a full extent (in case the extent in the map file is not full extent).
Lines 14 and 15 declare a new point object and initialize it with the values the user clicked on. You should not forget that those values are in pixels, not in georeferenced coordinates.
Lines 16 through 18 create a new rectangle object and set it with the extent of the previous image, just like it is done on line 12. In fact this would work too: $my_extent = $map->extent;.
To do all the zooming and panning, the zoompoint function in called on line 35, but first the arguments it receives must be prepared. You can determine the point the user clicked on, and the extent of the image ($my_point and $my_extent, respectively), but now you have to determine the zoom factor. That's what lines 19 to 33 do. If you wondered why the values of the radio buttons where 0, -1, and 1 for pan, zoom in and zoom out, now you will know the reason.
A zoom factor of 1 tells zoompoint that the operation is pan, a negative value indicates zoom out and a positive value indicates zoom in. So, by means of multiplying the value received for the radio buttons (HTML variable 'zoom') by the size of the zoom the user entered the zoom factor is calculated. If that value is 0, that means the user selected the pan operation, so '$zoom_factor' is set to 1, otherwise the result of the multiplication is the zoom factor zoompoint needs to receive. The other lines are to preserve the button the user clicked on the next time. Line 34 tries to preserve the value of the zoom size the user entered (It doesn't do that all the time, when and why that line fails? That's for you to find out).
And finally, line 34 calls the zoompoint method with the zoom factor obtained, the point built from the pixel coordinates (I insist on that issue because zoompoint is almost the only method that receives the coordinates in pixels, for the other methods you must convert pixels to georeferenced coordinates on your own), the height and width of the image, and the extent.
After calling zoompoint, the extent of the image is changed accordingly to the operation performed (or, better put, the zoom factor). So then the image is drawn and the current extent saved (after the zooming) for use in the next iteration.



Conclusions
Well, it's time for me to go recharge my batteries. So I will use this last energy to share some final words. The examples I have managed to present here are very basic but you should now be able to devise ways to improve them and suit things to your needs. Keep in mind that you can preprocess, store, read, write data from any source you can usually read through PHP, plus all the sources MapServer can handle for GIS data. You can even process some GIS data with PHP only if the need would arise (SQL sources are a good example of this). You can also do hybrid approaches where some script prepares data which is then shown through the CGI interface to MapServer, or create data on the fly based on input from a GPS, etc, etc. The possibilities are just too many to enumerate completely. As I already said your imagination is the limit. The next version of this document will include examples that include more than one layer, with different datasources (not just shapefiles) and creation of dynamic layers and classes. If you have a better idea or would like to see some other thing here first, please drop a note to my maintainer.
In the meantime, if you need bigger examples you can refer to the original "GMap demo" (you can download the source here), or the MapTools site (for the older MapLab, Chameleon applications, which were built on PHPMapScript). Goodbye, and thanks for reading this far.

5.1.3 Python MapScript Appendix
Author
Sean Gillies
Author
Seth Girvin
Contact
sethg at geographika.co.uk
Last Updated
2021-05-24


Introduction
The Python MapScript module contains some class extension methods that have not yet been implemented for other languages.

Classes
References to sections below will be added here as the documentation grows.

imageObj
Pillow (a fork of the Python Imaging Library), https://pillow.readthedocs.io/, is an indispensable tool for image manip- ulation. The extensions to imageObj are all geared towards better integration of Pillow in MapScript applications.



imageObj Extended Methods
• imageObj.write() - write image data to a Python file-like object. Default is stdout.

See MapScript Image Generation for further examples.

pointObj pointObj Methods
  str  ()
[string] Return a string formatted like

with the coordinate values substituted appropriately. Usage example:

Note that the return value can be conveniently eval'd into a Python dictionary:


rectObj
rectObj Methods
  contains  ( pointObj point )
[boolean] Returns True if point is inside the rectangle, otherwise returns False.

  str  ()
[string] Return a string formatted like

with the bounding values substituted appropriately. Usage example:

Note that the return value can be conveniently eval'd into a Python dictionary:






Exception Handling
The Python MapScript module maps a few MapServer errors into Python exceptions. Attempting to load a non-existent mapfile raises an 'IOError', for example

The message of the error is written by 'msSetError' and so is the same message that CGI mapserv users see in error logs.

5.1.4 MapScript Image Generation
Author
Sean Gillies
Author
Seth Girvin
Contact
sethg at geographika.co.uk
Last Updated
2021-05-22


Introduction
The MapScript HowTo docs are intended to complement the API reference with examples of usage for specific subjects. All examples in this document refer to the Mapfile and testing layers distributed with MapServer and found in source control under Mapserver/tests.



The examples below are written in Python. All MapScript languages use the same API, but will need to be rewritten using the relevant language's syntax.

Imagery Overview
The most common use of MapServer and MapScript is to create map imagery using the built-in format drivers such as AGG/PNG, AGG/JPEG, and CAIRO/PNG. This imagery might be saved to a file on disk or be streamed directly to another device.

The imageObj Class
Imagery is represented in MapScript by the imageObj class.

Creating imageObj from a mapObj
The mapObj class has two methods that return instances of imageObj: mapObj.draw(), and mapObj. prepareImage(). The first returns a full-fledged map image just as one would obtain from the mapserv CGI program:

A properly sized and formatted blank image, without any layers, symbols, or labels, will be generated by mapObj. prepareImage():


Creating a new imageObj
The imageObj class constructor creates new instances without need of a map:

and can even initialize from a file on disk:


Image Output Creating files on disk
Imagery is saved to disk by using the 'save' method. By accessing the 'extension' attribute of an image's format, the proper file extension can be used without making any assumptions

If the image is using a GDAL/GTiff-based format, a GeoTIFF file can be created on disk by adding a mapObj as a second optional argument to 'save'




Direct Output
An image can be dumped to an open filehandle using the mapObj.write() method. By default, the filehandle is 'stdout':

This method is not fully functional for all SWIG MapScript languages. See the SWIG API reference for more details.

Images and Symbols
The symbolObj.getImage() method will return an instance of imageObj: for pixmap symbols:

There is a symmetric symbolObj.setImage() method which loads imagery into a symbol, allowing pixmap symbols to be created dynamically:


5.1.5 Mapfile Manipulation
Author
Sean Gillies
Author
Seth Girvin
Contact
sethg at geographika.co.uk
Last Updated
2021-05-22




Introduction
The MapScript HowTo docs are intended to complement the API reference with examples of usage for specific subjects. All examples in this document refer to the Mapfile and testing layers distributed with MapServer and found in source control under Mapserver/tests.
The examples below are written in Python. All MapScript languages use the same API, but will need to be rewritten using the relevant language's syntax.

Mapfile Overview
By "Mapfile" here, I mean all the elements that can occur in (nearly) arbitrary numbers within a MapScript mapObj: Layers, Classes, and Styles.

The mapObj Class
An instance of mapObj is a parent for zero to many layerObj children.

New instances
The mapfile path argument to the mapObj constructor is optional. The following generates a default mapObj with no layers.

A mapObj is initialized from a Mapfile on disk in the usual manner:





Cloning
An independent copy, less result and label caches, of a mapObj can be produced by the mapObj.clone() method:





Saving
A mapObj can be saved to disk using the save method:


Children of mapObj
There is a common parent/child object API for Layers, Classes, and Styles in MapServer.

Referencing a Child
References to Layer, Class, and Style children are obtained by "getChild"-like methods of their parent:

These references are for convenience only. MapScript doesn't have any reference counting, and you are certain to run into trouble if you try to use these references after the parent mapObj has been deleted and freed from memory.

Cloning a Child
A completely independent Layer, Class, or Style can be created using the clone methods of layerObj, classObj, and
styleObj:

This instance has no parent, and is self-owned.

New Children
Uninitialized instances of layerObj, classObj, and styleObj can be created with the new constructors:

They are added to a parent object using "insertChild"-like methods of the parent which returns the index at which the child was inserted:

The insert* methods create a completely new copy of the object and stores it in the parent with all ownership taken on by the parent. See the SWIG API reference for more details.

Backwards Compatibility
The old style child object constructors with the parent object as a single argument remain in MapServer:






Removing Children
Child objects can be removed with "removeChild"-like methods of parents, which return independent copies of the removed object:


Metadata
Map, Layer, and Class metadata are the other arbitrarily numbered elements (well, up to the built-in limit of 41) of a mapfile.
The metadata attributes of webObj, layerObj, and classObj are instances of hashTableObj, a class which functions like a limited dictionary:

You can iterate over all keys in a class:hashTableObj as follows:

Note in Python the hashTableObj can be treated as a dictionary. See Python MapScript Appendix.

5.1.6 Querying
Author
Sean Gillies
Author
Seth Girvin
Contact
sethg at geographika.co.uk
Last Updated
2021-05-22





Introduction
The MapScript HowTo docs are intended to complement the API reference with examples of usage for specific subjects. All examples in this document refer to the mapfile and testing layers distributed with MapServer and found in source control under Mapserver/tests.
The examples below are written in Python. All MapScript languages use the same API, but will need to be rewritten using the relevant language's syntax. Querying Overview

The Query Result Set
Map layers can be queried to select features using spatial query methods or the attribute query method. Ignoring for the moment whether we are executing a spatial or attribute query, results are obtained like so:

In the case of a failed query or query with zero results, layerObj.getResults() returns NULL.

Result Set Members
Individual members of the query results are obtained like:

This mapscript.resultObj is a handle, of sorts, for a feature of the layer, having resultObj.shapeindex and
resultObj.tileindex attributes that can be used as arguments to layerObj.getShape().

Resulting Features
The previous example code can now be extended to the case of obtaining all queried features:






(continues on next page)



(continued from previous page)

Attribute Queries By Attributes
Use layerObj.queryByAttributes() for querying by attribute. Note attributes are strings.


Spatial Queries By Rectangle
Use layerObj.queryByRect() for querying using a bounding-box. MS_MULTIPLE is set by default.


By Point
Use layerObj.queryByPoint() for querying using a point. The point can also be buffered.


By Shape
Use layerObj.queryByShape() for querying using a shape.




By Selection
Use layerObj.queryByFeatures() for querying using results from another layer.


CHAPTER
SIX



MAPCACHE


6.1 MapCache 1.14.1
Author
Thomas Bonfort
Contact
tbonfort at terriscope.fr
Author
Jérome Boué
MapCache is a server that implements tile caching to speed up access to WMS layers. The primary objectives are to be fast and easily deployable, while offering the essential features (and more!) expected from a tile caching solution.

6.1.1 Compilation & Installation
Author
Thomas Bonfort
Contact
tbonfort at terriscope.fr
Author
Alan Boudreault
Contact
aboudreaut at magears.com
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Author
Mathieu Coudert
Contact
mathieu.coudert at gmail.com
Author
Seth Girvin
Contact
sgirvin at compass.ie



Last Updated
2023-01-30


Getting the Source
The MapCache project is located at https://github.com/MapServer/mapcache, and can be checked out with either:


Linux Instructions
These instructions target a Debian/Ubuntu setup, but should apply with few modifications to any Linux installation. MapCache requires a number of library headers in order to compile correctly:
• apache / apr / apr-util / apx2: these are included in the apache2-prefork-dev or apache2-threaded-dev packages, depending on which Apache MPM you are running. This package will pull in the necessary APR headers that
you would have to manually install if you are not building an Apache module (libaprutil1-dev and libapr1-dev)
• png: libpng12-dev
• jpeg: libjpeg62-dev
• curl: libcurl4-gnutls-dev
The following libraries are not required, but recommended:



• pcre: libpcre3-dev. This will give you more powerful regular expression syntax when creating validation ex- pressions for dimensions
• pixman: libpixman-1-dev. The pixel manipulation library is used for scaling and alpha-compositing images. MapCache ships with some code to perform these tasks, but Pixman is generally faster as it includes code opti- mized for modern CPUs (SSE2, MMX, etc. . . )
The following libraries are not required, but needed to enable additional functionalities:
• fcgi: libfcgi-dev. Needed to build a FastCGI program if you don't want to run MapCache as an Apache module
• gdal / geos: libgdal1-dev libgeos-dev. Needed to enable advanced seeding options (for only seeding tiles that intersect a given geographical feature)
• sqlite: libsqlite3-dev. For enabling the SQLite backend storages
• tiff: libtiff4-dev. For enabling the TIFF backend storages
• berkeley db libdb4.8-dev : For enabling the Berkeley DB backend storages
• lmdb liblmdb-dev : For enabling the Lightning Memory-Mapped Database backend storages (available since MapCache 1.14.0 release)


For Unix users installing all packages to the default locations, the compilation process should continue with:



Apache Module Specific Instructions
The make install above installs the Apache module, but if you specifically need to install only the Apache module you can do the following:

The installation script takes care of putting the built module in the Apache module directory. The process for activating a module is usually distro specific, but can be resumed by the following snippet that should be present in the Apache configuration file ( e.g. /usr/local/httpd/conf/httpd.conf or /etc/apache2/sites-available/default ):





Next, a MapCache configuration is mapped to the server URL with the following snippet: For Apache < 2.4:
For Apache >= 2.4:

Before you restart, copy the example mapcache.xml file to the location specified in your Apache configuration:

Finally, restart Apache to take the modified configuration into account

If you have not disabled the demo service, you should now have access to it on http://myserver/mapcache/demo

nginx Specific Instructions


WarningWorking with nginx is still somewhat experimental. The following workflow has only been tested on the develop- ment version, i.e. nginx-1.1.x
For nginx support you need to build MapCache's nginx module against the nginx source. Download the nginx source code:

Run the configure command with the flag -add-module. This flag must point to MapCache's nginx child directory. Assuming that MapServer source was cloned or un tarred into to /usr/local/src, an example configure command for nginx would look like this:





Then build nginx:

Due to nginx's non-blocking architecture, the MapCache nginx module does not perform any operations that may lead to a worker process being blocked by a long computation (i.e.: requesting a (meta)tile to be rendered if not in the cache, proxying a request to an upstream WMS server, or waiting for a tile to be rendered by another worker): It will instead issue a 404 error. This behavior is essential so as not to occupy all nginx worker threads, thereby preventing it from responding to all other incoming requests. While this isn't an issue for completely seeded tilesets, it implies that these kinds of requests need to be proxied to another MapCache instance that does not suffer from these starvation issues (i.e. either a FastCGI MapCache, or an internal proxied Apache server). In this scenario, both the nginx MapCache instance and the Apache/FastCGI MapCache instance should be running with the same mapcache.xml configuration file.
MapCache supplies an nginx.conf in its nginx child directory. The conf contains an example configuration to load MapCache. The most relevant part of the configuration is the location directive that points the ^/mapcache URI to the mapcache.xml path. You will need to change this path to point to your own mapcache.xml in the MapCache source.
The basic configuration without any proxying (which will return 404 errors on unseeded tile requests) is:

If proxying unseeded tile requests to a MapCache instance running on an Apache server, we will proxy all 404 Map- Cache errors to a mapcache.apache.tld server listening on port 8080, configured to respond to MapCache requests on the /mapcache location.

If using FastCGI instances of MapCache, spawned with e.g. spawn-fcgi or supervisord on port 9001 (make sure to enable FastCGI when building MapCache, and to set the MAPCACHE_CONFIG_FILE environment variable before spawning):










(continues on next page)



(continued from previous page)
Copy the relevant sections of nginx.conf from MapCache's nginx directory into nginx's conf file (in this case
/usr/local/nginx/conf/nginx.conf ). You should now have access to the demo at http://myserver/mapcache/demo

CGI/FastCGI Specific Instructions
A binary CGI/FastCGI is located in the mapcache/ subfolder, and is named "mapcache". Activating FastCGI for the MapCache program on your web server is not part of these instructions; more details may be found on the FastCGI page or on more general pages across the web.
The MapCache FastCGI program looks for its configuration file in the environment variable called MAP- CACHE_CONFIG_FILE, which must be set by the web server before spawning the MapCache processes.

See alsoConfiguration File
Apache with mod_cgi

For Apache with mod_fcgid:

If you have not disabled the demo service, you should now have access to it on http://myserver/fcgi-bin/mapcache/ demo, assuming your fcgi processes are accessed under the fcgi-bin alias.
With a working mod_fcgid Apache instance, the full httpd.conf snippet to activate MapCache could be:

The MapCache service would then be accessible at http://myserver/map.fcgi{[}/demo]



IIS and FastCGI
First ensure FastCGI has been installed - see the notes on configuring MapServer in IIS. MapCache relies on the MAPCACHE_CONFIG_FILE environment variable to be set in IIS. See the MapServer further configuration on how to set this.
To create the variable from the command line you can use the following (which requires administrator privileges):

Often you will want to use different MapCache configuration files for different web applications on the same server. To set these up you need to set a unique argument that will be passed to mapcache.fcgi.exe.



FastCGI configurations are stored in C:\Windows\System32\inetsrv\config\applicationHost.config. The commands creates the following XML:

Now we have set MAPCACHE_CONFIG_FILE we can configure a web application to use MapCache. This can all be done through the web application's web.config file. Below is a sample configuration:




Key points to note are:
• allowPathInfo must be set to true so IIS handles the PATH_INFO in the same way as other web servers (otherwise IIS duplicates the SCRIPT_NAME in PATH_INFO breaking how MapCache handles URLs).
• scriptProcessor should be set to match the fullPath set when creating the FastCGI configuration. The
|cache2 should match the argument for the FastCGI application, separated from the path with a pipe (|) character.
• If you have a FastCGI application without any arguments (when running a single instance of MapCache) you do not need to add the pipe and argument to scriptProcessor.
The MapCache service should then be accessible at http://localhost/mapcache/demo/

Customizing the Build, Or If Something Went Wrong
Depending on which packages are available in the default locations of your system, the "cmake .." step will most probably have failed with messages indicating missing dependencies (by default, MapCache has some of those). The error message that CMake prints out should give you a rather good idea of what steps you should take next, depending on whether the failed dependency is a feature you require in your build.
mod_mapcache requires Apache, libcurl, libjpeg and libpng development headers. The CMake script will try to locate them in default system locations, but these locations can be overridden or specified with -D switches. For example, if you get a message such as 'Could NOT find APR ', you can use a command such as (assuming that APR is at
/usr/local/apr) :

If you don't want e.g. fcgi, you can disable the dependency by re-running CMake with -DWITH_DEPENDENCY=0, e.g.


Options Supported By the MapCache CMake Builder
Here is a list of supported options that can be enabled/disabled at build.





















(continues on next page)



(continued from previous page)
• Pixman (recommended, from 0.5 onwards)

Pixman is a pixel manipulation library used to assemble image tiles when responding to non-tiled WMS requests. Pixman support is recommended as it is highly optimized and will take advantage of recent processor extensions (MMX, SSE2, etc.) to speed up blending and resampling operations. If the Pixman library is not found, MapCache will fall back to internal pixel operations that are slower.
• SQLite (optional, from 0.5 onwards)

SQLite is used to enable the SQLite and MBTiles cache backend. Version 3.5.0 or newer is required.
• GDAL (optional, from 0.4 onwards, also requires geos)

GDAL (actually OGR) is used by the seeding utility to allow the seeding of tiles only intersecting a given polygon, e.g. to preseed all the tiles of a given country.
• GEOS (optional, from 0.5 onwards)

Along with GDAL/OGR, GEOS is needed by the seeder to test for the intersection of tiles with geographical features. A sufficiently recent version of GEOS (with support for prepared geometries) is required (but not enforced by the configure script, so you'll end up with compilation errors if a too old GEOS version is used).
• PCRE (optional)

PCRE (Perl Compatible Regular Expressions) can be used instead of POSIX regular expressions for validating WMS dimensions. They are more powerful than POSIX REs (and might be slower). You don't need this if you aren't planning on using WMS dimension support with regex validation, or if your validation needs are covered by posix REs.


• FastCGI Support (optional)





MapCache can run as a FastCGI executable. Note that the overhead of FastCGI is non-negligible with respect to the throughput you may obtain with a native Apache module. The FastCGI build is less tested, and may lag behind the Apache module version on some minor details. YMMV.
• TIFF read/write Cache Support (optional) Use TIFFs as a cache backend (READONLY) :

TIFF write support (for creating new TIFF files and adding tiles to existing TIFF files) is still ex- perimental and disabled by default. There is a risk of ending up with corrupt TIFF files if they are placed on a filesystem that does not honor file locking, as in that case multiple processes might end up writing to the same file. File locking across concurrent threads is also problematic, although Map- Cache tries to detect this situation and apply sufficient locking workarounds. To stay on the safe side, write support should for now only be enabled on local filesystems, with a prefork MPM or FastCGI MapCache install.

When writing TIFF files, MapCache can also optionally add georeferencing information if compiled with libtiff support. GeoTiff writing does not produce the full tags needed for defining which preo- jection the grid is in, but will only produce those defining the pixel scale and the tiepoints (i.e. the equivalent information found in the accompanying .tfw files).



• Memcached Cache Support (optional)

The memcached cache backend is disabled by default. You can optionally enable it as it does not depend on other external libraries (support is obtained through apr-util).


• Apache Module Options
You can disable the Apache module building if you only plan on using the FastCGI executable or the seeder.

MapCache adds itself to the version string reported by the Apache server. This can be disabled with:





• Native MapServer Mode (experimental options)
MapCache is by default not linked to MapServer in any way, and communicates through the WMS protocol only. For improved performance, it is possible to directly use the MapServer C library and avoid an HTTP request and an image compression/decompression. This integration is still experi- mental and should be used cautiously.

This will use the libmapserver.so from MapServer's install directory. MapServer itself should be compiled with thread-safety enabled, unless you plan to use the prefork MPM or FastCGI, and you do not plan to use the seeder. For thread safety on the MapServer side, you might want to have a look at tickets #4041 and #4044.
• Debug Mode (work in progress)


It enables some extra tests inside the code, and prints out many more debugging messages to the server logs. you should probably not enable this unless you want to track down a problem happening inside MapCache.

Windows Instructions

WarningThe following instructions are outdated. Windows builds are now handled identically to the Unix ones with CMake.
These instructions target a Windows 7 setup with an Apache httpd compiled from source. The Apache MapCache module has been successfully built with with Microsoft Visual Studio C++ versions 2003, 2008 and 2010.

Dependencies
Required:
• Apache / APR / APR-UTIL: included with Apache httpd installation
These can be installed manually, or using the appropriate Windows SDK from: http://www.gisinternals.com/sdk/
• PNG
• JPEG
• CURL
Recommended:
    • PCRE: ftp://ftp.gnu.org/pub/gnu/regex/regex-0.12.tar.gz Optional:
• FCGI: Needed to build a FastCGI program if you don't want to run MapCache as an Apache module



• GDAL / GEOS: Needed to enable advanced seeding options (for only seeding tiles that intersect a given geo- graphical feature)
• SQLITE: For enabling the SQLite backend storages
• TIFF: For enabling the TIFF backend storages
Configure Your Makefile
Open nmake.opt and modify the paths to point to the various libraries.

Compilation

If successful, the resulting libraries and executables will be generated in their associated directories:
apache/
Apache module (mod_mapcache.dll)

cgi/ util/

FastCGI MapCache executable (mapcache.exe) MapCache utilities (mapcache_seed.exe)

Move the Module Into the Apache Directory
Copy the mod_mapcache.dll file into one of your Apache subdirectories.


Configure Your Installed Apache
• Modify your httpd.conf file to load the module:

• Next, configure your MapCache directory with the following snippet:

• Configure your mapcache.xml file (see the Configuration section for help).




WarningIf you receive an error such as "cache disk: host system does not support file symbolic linking" you should comment out the line "<symlink_blank/>" in your mapcache.xml file, such as the following:
• Finally, restart your Apache. You should see a message in Apache's error.log with a message similar to:


Test Your MapCache Module
• In your web browser, visit the local MapCache demo page: http://127.0.0.1/mapcache/demo/. You should see a clickable list of demo links:

• Click on one of the demos (such as http://127.0.0.1/mapcache/demo/wmts). A map viewer should load, similar to the image below.




• Zoom in a few times.	Your configured cache location should be generating tiles (in this case inside D:/ms4w/tmp/ms_tmp/cache/).



6.1.2 Configuration File
Author
Thomas Bonfort
Contact
tbonfort at terriscope.fr
The configuration file determines how mod-mapcache will serve incoming requests. It is an XML file comprising a list of entries, as outlined here:



Source
A source is a service mod-mapcache can query to obtain image data. This is typically a WMS server accessible by a URL. (There are currently only WMS, WMTS and mapfile as sources, though others may be added later if the need arises, see Data Sources).























(continues on next page)



(continued from previous page)
<url>http://vmap0.tiles.osgeo.org/wms/vmap0</url>

<!--
HTTP headers added to the request. Make sure you know what you are doing when adding headers here, as they take precedence over any default headers curl will be adding to the request.

Typical headers that can be added here are User-Agent and Referer.

When adding a <key>value</key> element here, the request to the WMS source will contain the

key: value\r\n HTTP header.
You may also forward a header from the incoming client request using the <MyHeader>{X-Header-To-Forward}<MyHeader> syntax.
-->
<headers>
<User-Agent>mod-mapcache/r175</User-Agent>
<Referer>http://www.mysite.com?param=2&amp;par=4</Referer>
</headers>

<!-- Timeout in seconds before bailing out from a request -->
<connection_timeout>30</connection_timeout>
</http>
</source>

The name and type attributes are straightforward: type is "wms", and name is the key by which this source will be ref- erenced; <url> is the HTTP location where the service can be accessed; and <wmsparams> is a list of parameters that will be added to the WMS request. You should probably at the very least add the FORMAT and LAYERS parameters. By convention(?), WMS parameters are uppercase, and you should respect this convention in your configuration file.
This is where you can also override some default WMS parameters if needed. By default, the parameters that will be used are: <REQUEST>GetMap</REQUEST> <SERVICE>WMS</SERVICE> <STYLES></STYLES> <VER- SION>1.1.0</VERSION>

Cache
A cache is a location where received tiles will be stored.












(continues on next page)



(continued from previous page)
<!-- symlink_blank

Enable blank (i.e. uniform color) tile detection. Blank tiles will be detected at creation time and linked to a single blank tile on disk to preserve disk space.
-->
<symlink_blank/>
</cache>

<cache name="tmpl" type="disk" layout="template">
<!-- template

String template that will be used to map a tile (by tileset, grid name, dimension, format, x, y, and z) to a filename on the filesystem.

The following replacements are performed:

- {tileset}	: the tileset name
- {grid}	: the grid name
- {dim}	: string concatenating the tile's dimension
- {ext}	: tile's image-format filename extension
- {x},{y},{z}	: tile's x,y,z values
- {inv_x},{inv_y},{inv_z} : inverted x,y,z values

(For inverted x,y,z values, (inv_x = level->maxx - x - 1). This is mainly used to support grids where one axis is inverted (e.g. the Google schema) and you want to create on offline cache.)

* Note that this type of cache does not support blank-tile detection and symlinking.

* Warning: It is up to you to make sure that the template you choose creates a unique filename for your given tilesets (e.g. do not omit the {grid} parameter if your tilesets reference multiple grids.) Failure to do so will result in filename collisions!

-->
<template>/tmp/template-test/{tileset}#{grid}#{dim}/{z}/{x}/{y}.{ext}</template>
</cache>

<!-- memcache cache

Entry accepts multiple <server> entries.

Requires a fairly recent apr-util library and headers.
-->
<cache name="memcache" type="memcache">
<server>
<host>localhost</host>
<port>11211</port>
</server>
</cache>
(continues on next page)



(continued from previous page)

Format
A format is an image format that will be used to return tile data to clients, and to store tile data on disk.
<format name="PNGQ_FAST" type ="PNG">

<!-- compression

PNG compression: best or fast

Note that "best" compression is CPU intensive for little gain over the default default compression obtained by leaving out this tag.
-->
<compression>fast</compression>

<!-- colors

If supplied, this enables PNG quantization which reduces the number of colors in an image to attain higher compression. This operation is destructive, and can cause artifacts in the stored image.

The number of colors can be between 2 and 256.
-->
<colors>256</colors>
</format>
<format name="myjpeg" type ="JPEG">

<!-- quality

JPEG compression quality, ranging from 0 to 100.

95 produces high quality images with few visual artifacts. Values under around 80 produce small images but with visible artifacts.
(continues on next page)



(continued from previous page)

Grid
A grid is the matrix that maps tiles onto an area, and consists of a spatial reference, a geographic extent, resolutions, and tile sizes.

Mandatory Configuration Options
• <size>: The width and height of an individual tile, in pixels. Must be specified as positive integers separated by a space character. The most common tile size is:

• <extent>: The geographical extent covered by the grid, in ground units (e.g. meters, degrees, feet, etc.). Must be specified as 4 floating point numbers separated by spaces, ordered as minx, miny, maxx, maxy.
MapCache expects all of its extents to be given in lonlat, and does the translation to latlon at request time if needed.
The (minx,miny) point defines the origin of the grid, i.e. the pixel at the bottom left of the bottom-left most tile is always placed on the (minx,miny) geographical point.
The (maxx,maxy) point is used to determine how many tiles there are for each zoom level.

• <srs>: The projection of the grid, usually given by it EPSG identifier. This value isn't used directly by MapCache to compute reprojections; it is only used to look up which grid to use when receiving WMS requests.







• <units>: The ground units used by the grid's projection. This entry is not used directly by MapCache aside from calculating scales for the WMTS capabilities document. Allowed values are:
- m : meters
- dd : decimal degrees
- ft : feet

• <resolutions>: This is a list of resolutions for each of the zoom levels defined by the grid. This must be supplied as a list of positive floating point values, separated by spaces and ordered from largest to smallest. The largest value will correspond to the grid's zoom level 0. Resolutions are expressed in "units-per-pixel", depending on
the unit used by the grid (e.g. resolutions are in meters per pixel for most grids used in webmapping).


Optional Configuration Options
• <srsalias>: This tag can be specified multiple times, and allows the user to add multiple SRS entries for a given grid. This is especially useful if the EPSG id for a given projection has evolved over time, or to support catalogs other than the EPSG one (which is the only catalog supported by the WMS specification).

• <metadata>:
- <title>: The name of the grid, in human readable form. Appears in the capabilities documents.

- <WellKnownScaleSet>: See the WMTS keyword. This will add a WellKnownScaleSet entry to the WMTS capabilities document. It is up to the user to make sure that the supplied resolutions for the grid actually match the pre-defined WellKnownScaleSet.

• <origin>: Specifies the origin of the grid. Valid values are top-left, bottom-left, top-right and bottom-right. If not used, the grid will have the bottom-left corner as reference point.




Preconfigured Grids
There are three predefined grids you can use without defining them in the mapcache.xml file:
• The "WGS84" grid corresponds to a grid where the whole world is rendered on two 256x256-pixel tiles at level 0 (i.e. the (-180,-90,180,90) extent fits on a 512x256 image). It goes down to zoom level 17.

• The "g" grid may be used to overlay tiles on top of GoogleMaps, and is the default tiling scheme used in webmap- ping applications. This grid goes down to zoom level 18. Level 0 is a single 256x256 tile. This grid's default SRS is EPSG:900913, which is non-standard but in wider use than than its official EPSG:3857 entry.

• The "GoogleMapsCompatible" grid is nearly identical to the "g" grid, except that its default SRS is EPSG:3857 instead of EPSG:900913.




(continues on next page)



(continued from previous page)

Tileset
A tileset is the essential configuration item for mod-mapcache, and corresponds to a set of tiles coming from a source, stored in a cache, and returned to the client in a given format.
































(continues on next page)



(continued from previous page)
This is better than using a grid with a limited extent, as in this way the tiles that are already cached are not invalidated should you want to modify the restricted extent in the future. When using the restricted_extent attribute, you should give the corresponding information to the client that will be using the service.

You can also limit the zoom levels that are cached/accessible by using the `minzoom` and `maxzoom` attributes.

Moreover, a tolerance of five tiles is added by default to the specified restricted_extent. This tolerance can be manually set with
`tolerance` attribute.

A grid may reference a ruleset to impose certain behaviour:

<grid ruleset="rules">4326</grid>

NOTE: When adding a <grid> element, you *MUST* make sure that the source you have selected is able to return images in the grid's SRS.
-->
<grid restricted_extent="-10 40 10 50" minzoom="4" maxzoom="17">WGS84</grid>
<grid ruleset="rules">4326</grid>
<grid>g</grid>

<!-- You may store hidden intermediate levels of tiles to enable higher quality output when reassembling tiles. This may be needed when caching maps containing labels to avoid the text from becoming too small or too blurry when requesting resolutions that are far away from the native grid resolutions.

Supposing grid "mygrid" consists of 256x256 pixel tiles, with resolutions r1,r2,r3,r4,...rn, MapCache will populate a hidden grid called "mygrid_intermediate_0.5" containing tiles of size 256+256*0.5=384 with resolutions r1+(r2-r1)*0.5, r2+(r3-r2)*0.5, ... r(n-1)+(r(n)-r(n-1)*0.5. That is, a tile with a given extent will be stored once in a 256x256 tile, and once in a 384x384 one.





-->

This intermediate grid is private to MapCache and will not be exposed to tiled requests. It will only be used for WMS requests that require horizontal assembling.

<grid use_wms_intermediate_resolutions="true">mygrid</grid>

<!-- metadata

Optional metadata tags used for responding to GetCapabilities requests. You can put anything here, but only the title, abstract,?
??wgs84boundingbox and
keywords tags are currently used to populate the GetCapabilities document.
-->
<metadata>
(continues on next page)



(continued from previous page)
<title>vmap0 map</title>
<abstract>blabla</abstract>
<!-- Sets the extent of the tileset. Used by GIS to zoom to the layer. Order is?
??Lon/Lat (example extent
is the region around London). Will be translated to
<ows:WGS84BoundingBox>
<ows:LowerCorner>-0.837 51.058</ows:LowerCorner>
<ows:UpperCorner>0.57  51.834</ows:UpperCorner>
</ows:WGS84BoundingBox>
-->
<wgs84boundingbox>-0.837 51.058 0.57 51.834</wgs84boundingbox>
<keywords>
<keyword>foo</keyword>
<keyword>bar</keyword>
</keywords>
</metadata>

<!-- watermark

Optional tag to add a watermark to the tiles *before* storing them to cache. The supplied image MUST be exactly the same size as the size as the tiles configured in the <grid>.

The supplied image is read when the configuration is loaded. If you make changes to the image, they will NOT be reflected in tiles already stored in the cache, nor on newly stored tiles, until the server is restarted.
-->
<watermark>/path/to/static/watermark.png</watermark>

<!-- format

(Optional) format to use when storing a tile. This should be a format with high compression, e.g. PNG with compression "best", as the compression operation is only done once at tile creation time. If omitted, no recompression is applied to the image and mod-mapcache will store the exact image received from the <source>.





-->

Note that the <format> tag is mandatory if <metatile>, <metabuffer> or
<watermark> are supplied, as in those cases recompression must be done.

<format>PNG</format>

<!-- metatile




-->

Number of columns and rows to use for metatiling. See http://geowebcache.org/docs/current/concepts/metatiles.html

<metatile>5 5</metatile>

(continues on next page)



(continued from previous page)
<!-- metabuffer








-->

Area around the tile or metatile that will be cut off to prevent some edge artifacts. If this is specified, the configured source must be instructed not to put any labels inside this area, as otherwise labels will be truncated. (For MapServer, use the "labelcache_map_edge_buffer" "-10" metadata entry, along with label PARTIALS FALSE.)

<metabuffer>10</metabuffer>

<!-- expires







-->

Optional tile expiration value in seconds. This is expressed as number of seconds after creation date of the tile. This is the value that will be set in the HTTP Expires and Cache-Control headers, and has no effect on the actual expiration of tiles in the caches (see
<auto_expire> for that). Defaults to 300 if unset.

<expires>3600</expires>

<!-- auto_expire

Tiles older (in seconds) than this value will be re-requested and updated in the cache. Note that this will only delete tiles from the cache when they are accessed: You cannot use this configuration to limit the size of the created cache. Note that, if set, this value overrides the value given by <expires>. By default tiles don't expire.
-->
<auto_expire>86400</auto_expire>

<!-- cache-control

Optional Cache-Control HTTP header directives.
These directives apply to all tiled responses (TMS, WMTS, ...). The "max-age=" directive is always set based on the <expires> and <auto_expire> configuration parameters.

The specified value is passed verbatim without any validation whatsoever. Please refer to the HTTP header documentation for valid usage: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control








-->

For instance, for historic maps that are not expected to change,
set the <expires> option to "31556926" (one year) and <cache-control> to "immutable" (do not check until expired). On clients supporting the "immutable" directive (e.g., Firefox), data will be loaded directly from a local cache without issuing any requests
to the server to revalidate it.

<cache-control>immutable</cache-control>

<!-- dimensions
(continues on next page)



(continued from previous page)

Optional dimensions that should be cached.







-->

The order of the <dimension> tags inside the <dimensions> block is important, as it is used to create the directory structure for the disk cache. That is, if you change the order of these values, any tiles that have been previously cached are invalidated: They are not removed from the cache, but they no longer exist for mod-mapcache.

<dimensions>
<!-- values dimension

The example here creates a DIM1 dimension.

* WMS and WMTS clients can now add a &DIM1=value to their request string. If they don't specify this key/value, the default will be to use DIM1=foobar.
* The allowed values for DIM1= are foobar (it is important to add the default value to the allowed values entry), foobarbaz, foo and bar.
* The value specified for DIM1 will be forwarded to the WMS source.
* The produced tile will be stored in the file base/gridname/DIM1/value/xx/xx/xx/xx/xx/xx.png. That is, there are as many different caches created as there are values in the
<values> tag.
-->
<dimension type="values" name="DIM1" default="foobar">foobar,foobarbaz,foo,bar</
??dimension>

<!-- regex dimension

The following creates a MAPFILE dimension, for using the same mod-mapcache tileset with different MapServer mapfiles. The name of the mapfiles need not be known to mod-mapcache, and can therefore be created even after mod-mapcache has been started.

When a user passes a MAPFILE=/path/to/mapfile, the string "/path/to/mapfile" is validated against the supplied (PCRE) regular expression. The one in this example allows a name composed of aphanumeric characters separated by slashes (/) and ending in ".map" ( [a-zA-Z0-9\./]*\.map$ ), but will fail if there are two consecutive dots (..) in the path, to prevent filesystem traversal ( (?!.*\.\.) ).
-->
<dimension  type="regex"  name="MAPFILE"  default="/path/to/mapfile.map">^(?!.*\.\.
??)[a-zA-Z0-9\./]*\.map$</dimension>

<!-- intervals dimension

The syntax is the same as common-ows, i.e. a comma-separated list of "min/max/resolution" entries, e.g:
(continues on next page)



(continued from previous page)

Services
Services are the type of request that mod-mapcache will respond to. You should, of course, enable at least one.
<service type="wms" enabled="true">
<!--
This service should actually be called "ogc". It is different from the other services as it does not listen on the /wms endpoint, but directly on /. It will intercept WMS GetMap requests that can be satisfied from configured tilesets, and can optionally forward all the rest to (an)other server(s).

TODO: This needs way more documenting.

<forwarding_rule name="foo rule">
<append_pathinfo>true</append_pathinfo>
<http>
<url>http://localhost/mapcacheproxy</url>
</http>
</forwarding_rule>
-->

<!-- full_wms

Configure response to WMS requests that are not aligned to a tileset's grids. Responding to requests that are not in the SRS of a configured grid is not supported, but this should never happen as only the supported SRSs are publicized in the capabilities document.

Allowed values are:

- error	: Return a 404 error (default).
- assemble : Build the full image by assembling cached tiles.
- forward	: Forward the request to the configured source.
-->
<full_wms>assemble</full_wms>

<!-- resample mode

Filter applied when resampling tiles for full WMS requests. Can be
(continues on next page)



(continued from previous page)

Ruleset
A ruleset contains a set of rules to impose certain behaviour on zoom levels. It is referenced from a grid element inside a tileset. See tileset for more information.
It is possible to define rules that:
• Puts limits on the visible extent of zoom levels.
























(continues on next page)



(continued from previous page)

Miscellaneous

























(continues on next page)



(continued from previous page)

For specific information about locking, read this.







Metadata
The MapCache metadata section contains source contact information for the MapCache WMTS service. This informa- tion maps to specific attributes in the WMTS GetCapabilities response returned by the server. See OGC WMTS Docs for more on WMTS. The entire MapCache metadata section is optional.
• <metadata>:

- <title>: Title of this resource, normally used for display to humans.

- <abstract>: Brief narrative description of this resource, normally used for display to humans.

- <keyword>: Commonly used or formalised word(s) or phrase(s) used to describe the subject. Multiple allowed, will appear under <ows:Keywords>.

- <fees>: Statement of fess required to use this service.

- <accessconstraints>: Statement of fees required to use this service.


- <providername>: A unique identifier for the service provider organization.

- <providerurl>: Reference to the most relevant web site of the service provider.





- <contactorganization>: Address line for the location. FYI: This MapCache metadata element is very poorly named, and maps to <ows:DeliveryPoint>.

- <contactcity>: City of the location of the service provider.

- <contactstateorprovince>: State or Province of the location of the service provider.

- <contactpostcode>: Zip or other postal code of the service provider.

- <contactcountry>: Country of the physical address of the service provider.

- <contactelectronicmailaddres>: Address of the electronic mailbox of the responsible organization or individual.

- <contactname>: Name of the responsible person.

- <contactposition>: Role or position of the responsible person.

- <contactphone>: Telephone number by which individuals can speak to the responsible organization or individual.

- <contactfacsimile>: Telephone number of a facsimile machine for the responsible organization or individ- ual.


- <inspire_profile>: Enables INSPIRE extended capabilities. Required for other INSPIRE elements to work.





- <inspire_metadataurl>: External XML document or service that provides such an XML document con- taining metadata for the service.

- <defaultlanguage>: The default language of the service.


6.1.3 Supported Tile Services
Author
Thomas Bonfort
Contact
tbonfort at terriscope.fr
Author
Stephen Woodbridge
MapCache has the ability to serve tiles using a variety of different request protocols and tile-naming conventions. This document describes these. The various services must be turned on in the mapcache.xml file for MapCache to respond to these specific requests.
All services are available on the demo interface, from which you are highly encouraged to copy/paste the JavaScript code to get started when creating your own pages accessing the MapCache tiles.
The following notation is used on this page and refers to object names in the mapcache.xml configuration file.
• <tileset_name> - name of a configured tileset
• <grid_name> - name of explicitly or implicitly defined grid
• <quadkey> - specific to the Virtual Earth tile service
• <z> - zoom level in zxy naming scheme
• <y> - row number in zxy naming scheme
• <x> - column number in zxy naming scheme

TMS Service
The TMS service uses a z/x/y tile naming scheme where:
• z is the zoom level
• x is the column number
• y is the row number
To activate the TMS service, add these lines to the mapcache.xml configuration file:

A "capabilities" document can be fetched via:





Tiles are requested using this scheme:

For EPSG:3857, EPSG:900913, or GoogleMapsCompatible grids, with cell = [z/x/y]: z0:

z1:

z2:

etc. . .
For EPSG:4326 or WGS84 grids:


z0:

z1:

z2:

etc.

KML Service
The KML service produces Super-Overlays for tilesets that are aligned to the WGS84 / EPSG:4326 grids. A Super- Overlay is a KML file that links to an image URL, and to a set of other KML URLs corresponding to neighboring resolutions. The KML service uses a z/x/y tile naming scheme where:
• z is the zoom level



• x is the column number
• y is the row number


To activate the KML service, add these lines to the mapcache.xml configuration file:

Tiles are requested using this scheme:


OGC WMTS Service
To activate the WMTS service, add these lines to the mapcache.xml configuration file:

This service follows the standard OGC WMTS requests and supports both the classical OGC-style key-value-pair encoded and REST-style requests.

The capabilities are obtained through:



See alsoFeatureInfo Requests

See alsoTileset Dimensions
OGC WMS Service
MapCache responds to WMS version 1.1.1 requests, and has limited support for version 1.3.0 ones.










See alsoFeatureInfo Requests

See alsoTileset Dimensions

See alsoTile Assembling
WMS requests follow the classical key-value-pair encoded style:

The capabilities document is returned by:


Optional WMS Configuration Options Untiled GetMap Support
Support for untiled (non WMS-C) GetMap requests can be enabled or disabled:








(continues on next page)



(continued from previous page)

GetMap Image Format
You may explicitly set which image format should be returned to the client for an untiled WMS request (i.e. whenever the tile data cannot be served directly from the caches but needs to go through a decompression/recompression phase).

If the allow_client_override attribute is set to true, then MapCache will honor the FORMAT=... parameter sent by the client. By default MapCache ignores this parameter and uses its configured image format.

Image Resampling Quality


GoogleMaps XYZ Service

Prerequisites: Your WMS should be capable of producing images in the EPSG:900913 or EPSG:3857 SRS, i.e. it should reference the "g" or "GoogleMapsCompatible" grid.
This is the minimal HTML page that should get you going. The important bits are in the urlTemplate (for V2) and getTileURL (for V3) variables:
• /mapcache is the Apache path where MapCache handles requests.
• test@g is the tileset and grid name to use, joined by a '@' - the {Z}/{X}/{Y} should be left alone.
• The final extension should be changed to "jpg" if you are using a JPEG format with your tileset.



V2 API

<!DOCTYPE html
PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<title>Google/MapServer Tile Example</title>
<script   src="http://maps.google.com/maps?file=api&v=2&key=ABQIAAAAnfs7bKE82qgb3Zc2YyS-
??oBT2yXp_ZAY8_ufC3CFXhHIE1NvwkxSySz_REpPq-4WZA27OwgbtyR3VcA"
type="text/javascript"></script>
<script  type="text/javascript">
function load() {
if (GBrowserIsCompatible()) {
var urlTemplate = '/mapcache/gmaps/test@g/{Z}/{X}/{Y}.png';
var myLayer = new GTileLayer(null,0,18,{
tileUrlTemplate:urlTemplate, isPng:true,
opacity:0.8 });
var map = new GMap2(document.getElementById("map")); map.addControl(new GLargeMapControl()); map.addControl(new GMapTypeControl()); map.setCenter(new GLatLng(0, 0), 1); map.addOverlay(new GTileLayerOverlay(myLayer));
}
}

</script>
</head>
<body onload="load()" onunload="GUnload()">
<div id="map" style="width: 500px; height: 500px"></div>
</body>
</html>

V3 API
The previous JavaScript for the V2 example should be slightly changed to:




Virtual Earth tile service
Tiles are organized in one of two different layouts depending on whether they are using a Spherical Mercator projection, like EPSG:3857 or EPSG:900913, or if they are using a geographical projection, like EPSG:4326.
Tiles are requested using this scheme:

For EPSG:3857, EPSG:900913, or GoogleMapsCompatible grids, <quadkey> are arranged: z0:

z1:


For EPSG:4326 or WGS84 grids, <quadkey> are arranged: z1:

z2:




6.1.4 Seeder
Author
Thomas Bonfort
Contact
tbonfort at terriscope.fr
Author
Mathieu Coudert
Contact
mathieu.coudert at gmail.com
Mod-mapcache ships with an advanced seeding tool, whose main features are:
• configurable number of seeding threads, to speed up the rendering
• ability to reseed tiles older than a certain timestamp
• ability to seed tiles given a shapefile/OGR datasource

Usage
The seeding utility is named mapcache_seed, and is located under your install directory (default is /usr/local/bin).

Commandline Options
Options are available in short and long versions (e.g. -c or -config).
-b | -non-interactive: (added in MapCache 1.12.0) print progress messages on new lines.
-c | -config [file]: path to the mapcache.xml configuration file that contains the tilesets that need to be seeded.
-C | -cache [override]: Override cache used by selected tileset (useful for selectively seeding fallback/multitier caches).
-D | -dimension "DIMENSION=VALUE": used to specify which dimension to use if the tileset supports dimensions. Can be used multiple times to set multiple dimensions, e.g. -D "DIM1=VAL1" -D "DIM2=VAL2".
-e | -extent minx,miny,maxx,maxy: bounding box of the area to seed.
-f | -force: force recreation of existing tiles.
-g | -grid [grid]: name of the grid that must be seeded (the selected tileset must reference the given grid).
-h | -help: show help.
-H | -header "HEADER=VALUE": (added in MapCache 1.12.0) used to specify a key-value pair to set an HTTP header in a forwarding rule or HTTP request. Can be used multiple times to set multiple headers, e.g. -H "CUSTOM- HEADER1=VAL1" -H "CUSTOM-HEADER2=VAL2".
-i | -iteration-mode: either "drill-down" or "scanline". Default is to use drill-down for g, WGS84 and GoogleMap- sCompatible grids, and scanline for others. Use this flag to override. (scanline was formerly referred to as "level-by- level")
-L | -log-failed [file]: Log failed tiles to file.
-m | -mode: the mode to use the seeder: "seed", "delete" or "transfer". Default is seed (mode: seed).
-M | -metasize: override metatile size while seeding, e.g. 8,8.
-n | -nthreads: number of parallel threads that should be used to request tiles from the WMS source. The default is 1, but can be set higher if the WMS server can withstand parallel requests. (As a rule of thumb, the value chosen here should never be much higher than the number of CPUs on the WMS server.)






-o | -older [timestamp|now]: only seed tiles that are older than the given value. The value can either be the string "now", or a date formatted like year/month/day hour:minute, e.g. "2011/01/31 20:45".


-p | -nprocesses: number of parallel processes that should be used to request tiles from the WMS source.



WarningWhen working with multiple processes (-p switch) and SQLite cache backends, some errors may appear under high concurrency when writing to the SQLite database (error: SQL logic error or missing database (1)). Upgrading to SQLite >= 3.7.15 seems to resolve this issue.
-P | -percent [number]: Percent of failed requests allowed from the last 1000 before we abort (default: 1%, set to 0 to abort on first error).
-q | -quiet: don't print progress messages to the standard output.
-R | -retry-failed [file]: Retry failed requests logged to file by -log-failed.
-t | -tileset [tileset]: name of the tileset that must be seeded.
-v | -verbose: print verbose debugging info (if compiled in).
-x | -transfer: the tileset to transfer when seeder is run in transfer mode.
-z | -zoom minzoom,maxzoom: start and end zoom levels that must be seeded.

Optional Commandline Options When Using OGR/GEOS
At compile time, if OGR and GEOS are found on the system, the seeder tool will support additional options to seed only the tiles that cover an arbitrary geographical area. Important: Note that, for the time being, the OGR datasource should be in the same projection as the grid you are seeding, as there is no automatic reprojection from the datasource projection to the grid projection.
-d | -ogr-datasource [ogr_datasource]: OGR connection to the spatial source. Consult the OGR documentation for all that is supported. In the simplest case (e.g. a Shapefile), this is just the full filename of the shapefile.
-l | -ogr-layer [ogr_layer]: for datasources that contain multiple layers (e.g. PostGIS, with multiple tables), determines which layer will be used.
-s | -ogr-sql [ogr_sql]: OGR SQL expression that can be applied (see OGR SQL).



-w | -ogr-where [ogr_where]: SQL "where" expression to filter out returned values. This would typically be used to select only the geometry of a given country if the datasource contains all the world contours.

Important Note
The seeding utility must be run under the same user account as the user running the webserver. This is required so the permissions on the tiles created by the seeder are accessible by the webserver, and conversely so the seeder has the rights to write files to directories created by the webserver.
A sample seeding session goes like this:


Examples
Seed the "osm" tileset with the "g" (Google / Web Mercator) grid:

Seed levels 0 through 12:

Given a shapefile that contains the world country contours, seed only the areas that are covered by land (i.e. skip the oceans). Also, use 4 request threads in parallel:

Same as beforehand, but only seed the USA (notice the quote usage, required to create valid SQL with a single-quoted 'US':

Reseed levels 0 to 12 (this could also be done by deleting the cache for levels 0 to 12 and doing a classic seed, but doing so this way does not slow down access from web clients):


6.1.5 Cache Types
Author
Thomas Bonfort
Contact
tbonfort at terriscope.fr

Table of Contents



This document details the different cache backends that can be used to store tiles.

Disk Caches
The disk based cache is the simplest cache to configure, and the one with the the fastest access to existing tiles. It is ideal for small tile repositories, but will often cause trouble for sites hosting millions of tiles, as the number of files or directories may rapidly overcome the capabilities of the underlying filesystem. Additionally, the block size chosen for the filesystem must closely match the mean size of a stored tile: ideally, any given tile should just fit inside a filesystem block, so as not to waste storage space inside each block, and not have to use up multiple blocks per tile.
The location of the files/directories has to be readable and writable by the user running the tile server.

Common Configuration
Disk caches are added via

All caches except the "template" one support the <symlink_blank/> option which (depending on platform availability) will detect tiles of uniform color and create a symbolic link to a single uniform color tile instead of storing the actual blank data in the tile's file.
All caches support the <creation_retry> option, which specifies the number of times MapCache should retry if it failed to create a tile's file or symlink. The default is to fail immediately: You may want to set this to a positive value if using a network mounted filesystem where transient errors are common.

Default Structure
The default disk cache stores tiles in a structure nearly identical to the file/directory hierarchy used by TileCache. The only change is that a top level directory structure corresponding to the name of the grid and the eventual value of the tileset's dimensions is added.
This cache is capable of detecting blank (i.e. uniform color) tiles and using a symbolic link to a single blank tile to gain disk space.





The only two configuration keys are the root directory where the tiles will be stored, and a key to activate the symbolic linking of blank tiles.

Arcgis Compatible Structure

This layout creates a tile structure compatible with an arcgis exploded cache. Tiles will be stored in files that resemble
/tmp/{tileset}/{grid}/{dimension}/L{z}/R{y}/C{x}.{ext}

Worldwind Compatible Structure

This layout creates a tile structure compatible with a worldwind cache. Tiles will be stored in files that resemble
/tmp/{tileset}/{grid}/{dimension}/{z}/{y}/{y}_{x}.ext

Template Structure
The template based disk cache allows you to create (or reuse an existing) tile structure that you define in advance. The
<template> parameter takes a string argument where various template entries will be replaced at runtime by the correct value for each tile to store.



















(continues on next page)



(continued from previous page)

Berkeley DB Caches
The Berkeley DB cache backend stores tiles in a key-value flat-file database, and therefore does not have the disad- vantages of disk caches with regards to the number of files stored on the filesystem. As the image blobs are stored contiguously, the block size chosen for the filesystem has no influence on the storage capacity of the volume.
Note that for a given bdb cache, only a single database file is created, which will store the tiles of its associated tilesets (i.e. there is not a database file created per tileset, grid, and/or dimension). If you need to store different tilesets to different files, then use multiple dbd cache entries. It is not possible to use multiple database files for tileset grids or dimensions.
The Berkeley DB based caches are a bit faster than the disk based caches during reads, but may be a bit slower during concurrent writes if a high number of threads all try to insert new tiles concurrently.


Lightning Memory-Mapped Database Caches
Added in version 1.14.0.
The Lightning Memory-Mapped Database (LMDB) cache backend is similar to the Berkeley DB backend. It stores tiles in a key-value flat-file database, and therefore does not have the disadvantages of disk caches with regards to the number of files stored on the filesystem.
Note that for a given LMDB cache, only a single database file is created, which will store the tiles of its associated tilesets (i.e. there is not a database file created per tileset, grid, and/or dimension). If you need to store different tilesets



to different files, then use multiple LMDB cache entries. It is not possible to use multiple database files for tileset grids or dimensions.
LMDB is a memory-mapped database thus it will show up as a memory used by the process. Note that LMDB might not work with remote file systems as they must support flock(), memory map sync etc. and should not be accessed from multiple hosts.
<cache name="lmdb" type="lmdb">
<!-- base (required)
absolute filesystem path where the LMDB database file is to be stored. this directory must exist, and be writable
-->
<base>/tmp/foo/</base>

<!-- key_template (optional)
string template used to create the key for a tile entry in the database. defaults to the value below. you should include {tileset}, {grid} and {dim} here unless you know what you are doing, or you will end up with mixed tiles
<key_template>{tileset}-{grid}-{dim}-{z}-{y}-{x}.{ext}</key_template>
-->
<!-- max_size (optional)
maximum size of database in thousands of _SC_PAGESIZE.
defaults to 64 that equals 250MiB on most of systems with 4k pagesize. database can only be grown larger (requires a restart).
when db size will reach the max_size setting, any write attempt will result in an error message.
<max_size>64</max_size>
-->
<!-- max_readers (optional)
maximum simultaneous reader count. should be higher than web server process / thread count.
defaults to 126.
<max_readers>126</max_readers>
-->
</cache>

SQLite Caches
There are two different SQLite caches that vary by the database schema they create and query. SQLite caches have the advantage that they store tiles as blobs inside a single database file, and therefore do not have the disadvantages of disk caches with regards to the number of files stored. As the image blobs are stored contiguously, the block size chosen for the filesystem has no influence on the storage capacity of the volume.
The SQLite based caches are a bit slower than the disk based caches, and may have write-locking issues at seed time if a high number of threads all try to insert new tiles concurrently.

Default Schema
Tiles are stored in the configured SQLite file created by MapCache with





(continues on next page)



(continued from previous page)

You may also add custom SQLite pragmas that will be executed when first connecting to a SQLite db, e.g. to override some compiled-in SQLite defaults

<pragma> entries will result in a call to


Custom Schema
This cache can use any database schema: It is up to you to supply the SQL that will be executed to select or insert a new tile.
In order to use such functionality you should supply the SQL queries that will be used against your custom schema. It is up to you to make sure your queries are correct and will return the correct data for a given tileset, dimension, grid, x, y and z.

Note that for the <get> query that returns data for a given tile, the first returned argument is considered to be the image blob, and the second optional one a timestamp representing the creation timestamp for that tile.



Blank Tile Detection
MapCache's SQLite caches support the detection and storage of blank (i.e. uniform color) tiles, and will store a quadru- plet of the rgba color component in the data blob instead of the compressed image data itself. That quadruplet will be transformed on-the-fly to a 1-bit palleted PNG before being returned to the client.



Using Multiple SQLite Database Files
You may want to split an SQLite cache into multiple files, for organisational purposes, or to keep the size of each file to a reasonable limit if caching large amounts of data.
In order to do so you may use a template to determine which file should be used for a given file:

You may also limit the x and y number of tiles to be stored inside a single database file:

In this case you should include the {x}, {y} and {z} replacements in the template determining the file to use. In the pre- vious example, tile (z,x,y)=(15,3024,1534) would be stored in a file named /path/to/g/mytileset/15/3000-1000.sqlite3 and tile (5,2,8) would be stored in a file named /path/to/g/mytileset/5/0-0.sqlite3
The following template keys are available for operating on the given tile's x,y, and z:
• {z} is replaced by the zoom level.
• {x} is replaced by the x value of the leftmost tile inside the SQLite file containing the requested tile.
• {inv_x} is replaced by the x value of the rightmost tile.
• {y} is replaced by the y value of the bottommost tile.
• {inv_y} is replaced by the y value of the topmost tile.
• {div_x} is replaced by the index of the SQLite file starting from the left of the grid (i.e. {div_x} = {x}/<xcount>).
• {inv_div_x} same as {div_x} but starting from the right.
• {div_y} is replaced by the index of the SQLite file starting from the bottom of the grid (i.e. {div_y} =
{y}/<ycount>).
• {inv_div_y} same as {div_y} but starting from the top.








In some cases, it may be desirable to have a precise hand on the filename to use for a given x,y,z tile lookup, e.g. to look for a file named Z03-R00003-C000009.sqlite3 instead of just Z3-R3-C9.sqlite3. The <dbfile> entry supports formatting attributes, following the Unix printf syntax ( c.f.: https://linux.die.net/man/3/printf ), by suffixing each template key with "_fmt", e.g.:



Using Multiple pyramids in multiple SQLite database files (Z-top)
Another way of structuring SQLite caches consists in organizing them in multiple pyramids: one single pyramid on lowest zoom levels, then as many pyramids as tiles at a given zoom level, e.g. 8, referred to as top zoom level. Each of these pyramids starts with one tile at that top zoom level, then four tiles at next zoom level and so on. Of course the top zoom level value is configurable.
The main advantage of this structure is when a user wants to work offline with only a subset of the World: Only two (relatively small) SQLite files have to be copied.
Following is a figure illustrating this cache structure.




From a configuration point of view, a multi-SQLite cache of class ztop is specified with a <top> tag defining the top zoom level. Templates keys are needed to determine SQLite files to use.

The following template keys are available:
• {top} is replaced by the top zoom level.
• {top_x} is replaced by the x value of the tile index at top zoom level, starting from left
• {top_y} is replaced by the y value of the tile index at top zoom level, starting from bottom
• {inv_top_x} is replaced by the x value of the tile index at top zoom level, starting from right
• {inv_top_y} is replaced by the y value of the tile index at top zoom level, starting from top
The following formatting attributes are available: top_fmt, top_x_fmt, top_y_fmt, inv_top_x_fmt, inv_top_y_fmt. They default to "%d".



MBTiles Caches
This cache type is a shortcut to the previous custom schema SQLite cache, with pre-populated SQL queries that corre- spond to the MBTiles specification.
Although the default MBTiles schema is very simple, MapCache uses the same multi- table schema found in most downloadable MBTiles files, notably to enable storing blank (i.e. uniform) tiles without duplicating the encoded image data (in the same way the disk cache supports tile symlinking).
The MBTiles schema is created with:







WarningWhen working with multiple processes (-p switch) and SQLite cache backends, some errors may appear under high concurrency when writing to the SQLite database (error: SQL logic error or missing database (1)). Upgrading to SQLite >= 3.7.15 seems to resolve this issue.
Memcache Caches
This cache type stores tiles to an external memcached server running on the local machine or accessible on the network. This cache type has the advantage that memcached takes care of expiring tiles, so the size of the cache will never exceed what has been configured in the memcache instance.
Memcache support requires a rather recent version of the apr-util library. Note that under very high loads (usually only attainable on synthetic benchmarks on localhost), the memcache implementation of apr-util may fail and start dropping connections for some intervals of time before coming back online afterwards.
You can add multiple <server> entries.



To limit the memory used by blank tiles inside the memcache instance, you may enable blank tile detection, in which case a #rgba quadruplet will be stored to the cache instead of the actual image data. MapCache will convert that on-the-fly to a 1-bit palleted PNG image before returning it to the client.


(Geo)TIFF Caches
TIFF caches are the most recent addition to the family of caches, and use the internal tile structure of the TIFF specifi- cation to access tile data. Tiles can be stored in JPEG only (TIFF does not support PNG tiles).
As a single TIFF file may contain many tiles, there is a drastic reduction in the number of files that have to be stored on the filesystem, which solves the major shortcomings of the disk cache. Another advantage is that the same TIFF files can be used by programs or WMS servers that only understand regular GIS raster formats, and be served up with high performance for tile access.
The TIFF cache should be considered read-only for the time being. Write access is already possible but should be considered experimental as there might be some file corruption issues, notably on network filesystems. Note that until all the tiles in a given TIFF file have been seeded/created, the TIFF file is said to be "sparse" in the sense that it is missing a number of JPEG tiles. As such, most non-GDAL based programs will have problems opening these incomplete files.



Note that the TIFF tile structure must exactly match the structure of the grid used by the tileset, and the TIFF file names must follow strict naming rules.

Defining the TIFF File Sizes
The number of tiles stored in each of the horizontal and vertical directions must be defined:
• <xcount> the number of tiles stored along the x (horizontal) direction of the TIFF file
• <ycount> the number of tiles stored along the y (vertical) direction of the TIFF file


Setting Up the File Naming Convention
The <template> tag sets the template to use when looking up a TIFF file name given the x,y,z of the requested tile

The following template keys are available for operating on the given tile's x,y, and z:
• {x} is replaced by the x value of the leftmost tile inside the TIFF file containing the requested tile.
• {inv_x} is replaced by the x value of the rightmost tile.
• {y} is replaced by the y value of the bottommost tile.
• {inv_y} is replaced by the y value of the topmost tile.
• {div_x} is replaced by the index of the TIFF file starting from the left of the grid (i.e. {div_x} = {x}/<xcount>).
• {inv_div_x} same as {div_x} but starting from the right.
• {div_y} is replaced by the index of the TIFF file starting from the bottom of the grid (i.e.  {div_y} =
{y}/<ycount>).
• {inv_div_y} same as {div_y} but starting from the top.


Customizing the Template Keys
In some cases, it may be desirable to have a precise hand on the filename to use for a given x,y,z tile lookup, e.g. to look for a file named "Z03-R00003-C000009.tif" instead of just "Z3-R3-C9.tif". The <template> entry supports formatting attributes, following the Unix printf syntax ( c.f.: http://linux.die.net/man/3/printf ), by suffixing each template key with "_fmt", e.g.:







Setting JPEG Compression Options
An additional optional parameter defines which JPEG compression should be applied to the tiles when saved into the TIFF file:
• <format> the name of the (JPEG) format to use

See alsoJPEG Format
In this example, assuming a grid using 256x256 tiles, the files that are read to load the tiles are tiled TIFFs with JPEG compression, whose size are 16384x16384. The number of files to store on disk is thus reduced 4096 times compared to the basic disk cache.

Using a Specific Locker
MapCache needs to create a lock when writing inside a TIFF file to ensure that no two instances are updating the same file concurrently. By default the global MapCache locker will be used; you can, however, configure a different locking mechanism or behavior by configuring it inside the TIFF cache itself.




See alsoLocking Mechanisms

GeoTIFF Support
If compiled with GeoTIFF and write support, MapCache will add referencing information to the TIFF files it creates, so that the TIFF files can be used in any GeoTIFF-enabled software. Write support does not produce full GeoTIFFs with the definition of the projection used, but only the pixel scale and tie-points, i.e. what is usually found in .tfw files.
For reference, here is the gdalinfo output on a TIFF file created by MapCache when compiled with GeoTIFF support:


REST Caches
The following cache types store and retrieve tiles through standard HTTP GET and PUT operations, and can be used to store tiles in popular cloud storage providers.

Pure REST Cache
This cache type can be used to store tiles to a WebDAV enabled server. You must provide a template URL that should be used when accessing a tile with a given x,y,z, etc. . .




Specifying HTTP Headers
You can customize which headers get added to the HTTP request, either globally for every HTTP request, or specifically for a given type of request (i.e. when getting, setting or deleting a tile):
<cache name="myrestcache" type="rest">
<url>https://myserver/webdav/{tileset}/{grid}/{z}/{x}/{y}.{ext}</url>
<headers>
<Host>my-virtualhost-alias.domain.com</Host>
</headers>
<operation  type="put">
<headers>
<X-my-specific-put-header>foo</X-my-specific-put-header>
</headers>
</operation>
<operation  type="get">
<headers>
<X-my-specific-get-header>foo</X-my-specific-get-header>
</headers>
</operation>
<operation  type="head">
<headers>
<X-my-specific-head-header>foo</X-my-specific-head-header>
</headers>
</operation>
<operation  type="delete">
<headers>
<X-my-specific-delete-header>foo</X-my-specific-delete-header>
</headers>
</operation>
</cache>

Amazon S3 REST Caches
The REST cache has been specialized to enable access to Amazon S3, in order to add the layer of authentica- tion/authorization needed for that platform.

The <id> <secret> and <region> tags are required and are obtained and configured through your Amazon management



console. You should read the documentation as to what headers you want to be adding to your requests depending on your use case (the supplied example hosts tiles on cheaper storage, and allows them to be publicly accessible).

Microsoft Azure REST Caches
The REST cache has been specialized to enable access to Azure storage, in order to add the layer of authentica- tion/authorization needed for that platform.

The <id> <secret> and <container> tags are required and are obtained and configured through your management con- sole. You should read the documentation as to what headers you want to be adding to your requests depending on your use case.

Google Cloud Storage REST Caches
The REST cache has been specialized to enable access to Google Cloud Storage, in order to add the layer of authenti- cation/authorization needed for that platform.

The <access> and <secret> tags are required and are obtained and configured through your management console. You should read the documentation as to what headers you want to be adding to your requests depending on your use case. Note that support for Google Cloud Storage uses its Amazon compatibility layer.

Meta Caches
These cache types do not store tiles themselves, but rather delegate the storage of a tile to a number of child caches based on a set of rules or behaviors. These caches are mostly useful for large MapCache deployments across multiple instances, with shared cache backends (i.e. dedicated memcache servers, and network mounted filer filesystems).

Composite Caches
This cache uses different child caches depending on the tile's zoom level, and can be used for example to store low zoom-level tiles to permanent storage, and higher zoom-level tiles to a temporary (i.e. memcache) cache.





For each tile, the caches are tested in the order in which they have been defined in the configuration file, and the first one to satisfy the min/max zoom and grids constraints is used. It's up to the user to make sure the succession of min/max zoom values and grids makes sense, e.g.:


Fallback Caches
These cache types will return tiles from the first configured subcache that does not return an error. They can be used when one of the caches is prone to error conditions (e.g. remote REST caches, memcache)

When writing a tile to such a cache, it will be written to all the child caches.

Multitier Caches
These cache types can be used to combine fast/expensive caches with slow/cheap ones.

If a given tile isn't found in the first child cache, it will be read from the second child cache and copied into the first child cache for subsequent accesses. This cache type is meant to be used when the first cache does automatic pruning of the least recently used tiles (i.e. a memcache one).
When writing a tile to such a cache, it will be written to the last child.

Cache Combinations
All these meta caches can be combined together to fine tune the availability and performance depending on storage costs, time to recreate missing tiles, etc. . .





In the previous example, all tiles are primarily accessed from a memcache instance, however the lower zoom level tiles are backed up to a permanent SQLite cache which will be used to populate the fast memcache cache e.g. on restarts.

Riak Caches
requires https://github.com/trifork/riack


6.1.6 Image Formats
Author
Thomas Bonfort
Contact
tbonfort at terriscope.fr
Author
Jérome Boué
Contact
jbo-ads at mailo.com
MapCache allows you to configure how the image should be saved to a cache once it has been requested from a source. The JPEG format should mostly be used for raster imagery, whereas the PNG format is most useful for vector based imagery where there are large uniform areas. Moreover a RAW format exists when nothing is known about the source format other than a file extension and MIME type.

JPEG Format
The JPEG format saves tiles to JPEG. You can configure the JPEG compression level (from 1 to 100) and the colorspace that should be used (RGB or YCbCr)





• quality: This is the typical JPEG quality setting. Values under 50 produce lighter images but with notable compression artifacts. 100 should be avoided as it produces very heavy images.
• photometric: By default the YCbCr colorspace is used as it produces images that tend to be 2 to 3 times lighter. Use RGB if you don't want the default.

PNG Format
The PNG format creates PNG images, with optional quantization (reduction of the number of colors to create an 8-bit palleted PNG).

• compression: Choose which zlib compression to apply to the image data. Recognized values are "fast" and "best". Omit the key to use the default zlib compression.
• colors: Number of colors to use for quantization. Omit this key to produce 24 or 32 bit RGB/RGBA PNGs, or set to a value between 2 and 256 to create an 8-bit palleted PNG. The quantization step is destructive: There is no guarantee that pixels will not have a noticeable shift in color in the case when the tile contains many colors.

Mixed Format
There is a third special format which mixes JPEG and PNG compression depending on the contents of the image. This format allows creation of caches for raster imagery using JPEG compression (which is more efficient) on zones with imagery data, and PNG compression (which supports transparency) on zones with no imagery or on a boundary between imagery and emptiness.

• opaque: The format to use when the image has only fully opaque pixels
• transparent: The format to use when the image has some transparent or semi-opaque pixels.

RAW Format
The RAW format shall be used when no information is known other than MIME type and a file extension. This format has been introduced in order to support Mapbox Vector Tile format, but can be used in other contexts (see rfc119). As a result features like metatile support and symbolic links for blank tiles are not supported. One bonus is that this image format can also be used for UTFGrids generated by MapServer - and presumably other sources.




• extension: The file extension of the raw tiles saved in cache
• mime_type: The MIME type to request from the source

6.1.7 Tileset Dimensions
Author
Thomas Bonfort
Contact
tbonfort at terriscope.fr
Author
Seth Girvin
Contact
sgirvin at compass.ie
Author
Jerome Boue
Last Updated
2020-05-25


Introduction
WMS layers in MapServer can support dimensions, see WMS Dimension for details. MapCache also supports dimen- sions for tilesets.
Storing separate tile caches for different dimensions has several practical use cases such as creating caches for different spatial boundaries, elevations, or time periods. It also provides a mechanism for dynamically switching mapfiles based on a dimension value.
MapCache uses Dimensions to:
• create the directory structure of disk and SQLite caches, using the template structure with {dim} replacement entry, see Template Structure in Disk Caches and Using Multiple SQLite Database Files in SQLite Caches.
• create the database structure of SQLite caches, using custom schema with :dim replacement entry, see Custom Schema in SQLite Caches.
• build requests to WMS sources: any dimensions specified for a tileset will be forwarded on to their WMS source whenever a cache miss occurs.



Enabling Dimension Support in MapCache
Dimensions are enabled in the configuration file at the Tileset level. Each tileset may define its own dimensions with a
<dimensions> section which includes one or several <dimension> elements.

Dimension Attributes
Several attributes are defined for the <dimension> element.
• name (required): The name by which the dimension is referred to in a WMS request (minus the dim_ prefix as specified in WMS 1.1.1 Specification).
• default (required): The default value for the dimension if none is explicitly provided in the WMS request.
• type (required): MapCache defines several ways for specifying a dimension: values, regex, sqlite, postgresql, elasticsearch and time. They are described in the following sections.
• unit (optional): dimension unit. This information is used only in the GetCapabilities response.

Dimension Types
Several types of dimensions are supported by MapCache: Values, Regex, SQLite, PostgreSQL, ElasticSearch and Time. They can be classified into two groups depending on how dimension values are defined:
• First level dimension types: Values and Regex. Dimensions values are statically specified in the configuration file.
• Second level dimensions types: SQLite, PostgreSQL, ElasticSearch and Time. Dimensions values are stored in a dynamic backend (SQLite file, PostgreSQL database or ElasticSearch index) so that an update in the dimension values does not involve a server restart.

First Level Dimensions
First level dimensions define values in the configuration file.

Values Dimensions
A Values type dimension lists all possible dimension values. The name of the dimension is used as the key in a query string when accessing through a WMS or WMTS service, for example &DIM1=foobarbaz.
If a client does not provide the dimension as a key value pair the default will be used (in this example foobar).




Regex Dimensions
An alternative to the hard-coded list of values is to use regular expressions.
The following example creates a MAPFILE dimension, for using the same MapCache tileset with different MapServer mapfiles. The name of the mapfiles need not be known to MapCache, and can therefore be created even after MapCache has been started.
When a user passes a MAPFILE=/path/to/mapfile, the string /path/to/mapfile is validated against the supplied (PCRE) regular expression. The one in this example allows a name composed of alphanumeric characters separated by slashes (/) and finishing with ".map" ( [a-zA-Z0-9./]*.map$ ) , but will fail if there are two consecutive dots (..) in the path, to prevent file-system traversal.


Second Level Dimensions
Second level dimensions store values in a dynamic back-end, a SQLite file, a PostgreSQL database or an ElasticSearch index. This allows for adding new dimension values without modifying MapCache configuration file, which otherwise would need to restart the server.

SQLite Dimensions
In a SQLite dimension, dimension values are stored in a SQLite file. Moreover, each value references a list of internal, or sub-dimension values which are used to query cache.
For example, let's define a "sensor" dimension whose allowed values represent various Earth observation spacecrafts. A WMS request with that dimension may contain, e.g.: . . .&dim_sensor=spot&... In this example, each sensor refer- ences several data along an internal "product" sub-dimension. An example of the "sensor" dimension back-end contents is represented in the following table:

Sensor dimensionProduct sub-dimensionspotspot-img1spotspot-img2phrphr-img1phrphr-img2phrphr-img3
The WMS request occurs at the "sensor" dimension level. The cache query is performed at the "product" sub-dimension level. In case of a cache miss, the "product" sub-dimension values are used to query the data source.
Querying the back-end may then result in returning multiple sub-dimension values, each of which referencing distinct tiles. Assembling these tiles is described in Tile Assembly Policies section below.
A SQLite dimension is configured by specifying three elements:
• <dbfile>: Location of the SQLite file implementing the dimension
• <list_query>: SQL query returning all sub-dimension values for the dimension, e.g. spot-img1, spot-img2, phr-img1, phr-img2 and phr-img3 in the "sensor" dimension example.
• <validate_query>: SQL query returning the list of sub-dimension values for a given dimension value, e.g. spot- img1 and spot-img2 for the spot dimension value in the "sensor" dimension example.





As illustrated in this example with :dim placeholder, queries can contain template entries. See Templating dimension queries section below.

PostgreSQL Dimensions
PostgreSQL dimensions are very similar to SQLite dimensions. In particular, the sub-dimension feature described in the section above is also available with PostgreSQL dimensions. They differ only in the back-end implementation which is a PostgreSQL database, and in the way they are configured. A PostgreSQL dimension is configured by specifying three elements:
• <connection>: Connection information of the PostgreSQL database implementing the dimension, as expected by the PQconnectdb() function of the libpq - C library.
• <list_query>: SQL query returning all sub-dimension values for the dimension, e.g. spot-img1, spot-img2, phr-img1, phr-img2 and phr-img3 in the "sensor" dimension example.
• <validate_query>: SQL query returning the list of sub-dimension values for a given dimension value, e.g. spot- img1 and spot-img2 for the spot dimension value in the "sensor" dimension example.









(continues on next page)



(continued from previous page)
As illustrated in this example with :dim placeholder, queries can contain template entries. See Templating dimension queries section below.

ElasticSearch Dimensions
ElasticSearch dimensions are similar to SQLite or PostgreSQL dimensions. In particular, the sub-dimension feature de- scribed in the section above is also available with ElasticSearch dimensions. ElasticSearch main difference with SQLite and PostgreSQL is its query language, Query-DSL, based on JSON instead of SQL. Therefore, <list_query> and <val- idate_query> elements shall contain queries expressed in that language. Inserting JSON data in XML configuration may need to encapsulate it in a <![CDATA[ . . . ]]> element.
In addition, the complex structure of ElasticSearch responses, also expressed in JSON, raises the need for extraction instructions to get sub-dimension values from query responses.
For example, let's assume that this ElasticSearch query:

returns this response:















(continues on next page)



(continued from previous page)
The expected sub-dimension values are then:

This list is obtained by extracting the aggregations item from the outer dictionary, then distinct_product , then buckets. Finally the key item is to be extracted from each dictionary of the bucket list. The extraction instructions take the form of a path-like list of keywords to be used to extract sub-dimension values from JSON response provided by ElasticSearch:

This is specified in the MapCache configuration file by way of new XML elements, namely <list_response> and
<validate_response>, containing extraction instructions respectively for <list_query> and <validate_query> queries. An ElasticSearch dimensions is defined by specifying five elements:
• <http>: Connection information of the ElasticSearch index implementing the dimension. This element contains two sub-elements:
- <url>: Search URL of the ElasticSearch index
- <headers>: HTTP headers needed to access the ElasticSearch index. It must contain the tag: <Content- Type>application/json</Content-Type>.
• <list_query>: Query DSL query for getting all sub-dimension values for the dimension. This query is expressed in JSON format and may need to be escaped in a <![CDATA[ . . . ]]> tag.
• <validate_query>: Query DSL query for getting the list of sub-dimension values for a given dimension value. This query is expressed in JSON format and may need to be escaped in a <![CDATA[ . . . ]]> tag.
• <list_response>: List of successive keywords needed to extract actual sub-dimension values from the raw Elas- ticSearch response to the <list_query> query.
• <validate_response>: List of successive keywords needed to extract actual sub-dimension values from the raw ElasticSearch response to the <validate_query> query.




















(continues on next page)



(continued from previous page)
As illustrated in this example with :dim placeholder, queries can contain template entries. See Templating dimension queries section below.

Time Dimensions
MapCache supports WMTS and WMS requests that include a TIME parameter, for both timestamps and time intervals. See MS RFC 96: Time Dimension Support in MapCache Tilesets initial proposal for further details.
Up to Mapcache 1.6.1, defining a Time dimension involves a SQLite back-end. Two elements must be provided:
• <dbfile>: Location of the SQLite file implementing the time dimension
• <query>: SQL query returning the list of available timestamp values within a given time interval. In that query, start time and end time are represented by the respective placeholders :start_timestamp and :end_time_stamp.
Returned values shall be in yyyy-mm-ddThh:mm:ssZ time format, as specified in RFC 3339, but restricted to UTC.
From MapCache 1.8 on, dynamic back-ends for Time dimensions can be PostgreSQL databases or ElasticSearch indices in addition to SQLite files. Configuring a Time dimension with a specific back-end is made by setting a time="true" attribute within a SQLite, PostgreSQL or ElasticSearch dimension configuration.
Still, MapCache keeps an (almost) backward compatible configuration of Time dimension with an implicit SQLite back-end. Example in the following section highlights differences.
Time values used to query the dynamic back-end are expressed in Unix time, i.e. the number of seconds that have elapsed since January 1, 1970 (midnight UTC). Returned times should be MapServer compatible strings (see the WMS



Time documentation for details).
Querying the back-end with an interval may result in returning multiple timestamp values, each of which referencing distinct tiles. Assembling these tiles is described in Tile Assembly Policies section below.

Configuring a Time Dimension using a default SQLite back-end



<!-- "time" dimension
<!-- "time" dimensionThis example defines a "time"?This example defines a "time"???dimension whose possible values??dimension whose possible valuesare stored in the /path/to/mapcache-are stored in the /path/to/mapcache-??time.sqlite SQLite file. The??time.sqlite SQLite file. Thedefault value is "2010".default value is "2010".A WMS request with that dimension?A WMS request with that dimension???may contain, e.g.	"...??may contain, e.g.	"...&time=1999-08-11T11:03:07Z/2001-09-&time=1999-08-11T11:03:07Z/2001-09-??21T08:17:56Z& ..."??21T08:17:56Z& ..."-->--><dimension type="time" name="time"?<dimension type="time" name="time"???default="2010">??default="2010"><dbfile>/path/to/mapcache-time.sqlite<dbfile>/path/to/mapcache-time.sqlite??</dbfile>??</dbfile>	<query>		<validate_query>	SELECT strftime("%Y-%m-%dT%H:%M:SELECT strftime("%Y-%m-%dT%H:%M:??%SZ",ts) FROM time??%SZ",ts) FROM timeWHERE ts &gt;= datetime(:start_WHERE ts &gt;= datetime(:start_??timestamp,"unixepoch")??timestamp,"unixepoch")AND ts &lt;= datetime(:end_AND ts &lt;= datetime(:end_??timestamp,"unixepoch")??timestamp,"unixepoch")ORDER BY ts DESCORDER BY ts DESC	</query>	</validate_query><list_query>SELECT strftime("%Y-%m-%dT</dimension>??%H:%M:%SZ", ts) FROM time</list_query></dimension>Up to MapCache 1.6.1From MapCache 1.8 on
Configuring a Time dimension using an explicit back-end












(continues on next page)

MapServer Documentation, Release 8.6.0


(continued from previous page)






















(continues on next page)



(continued from previous page)

Templating dimension queries
<validate_query> and <list_query> can contain template entries that will be replaced at runtime by correct values. Valid template entries are:
• :dim Dimension value as provided in incoming HTTP request
• :tileset Tileset name
• :gridsrs Grid SRS
• :minx, :miny, :maxx, :maxy Parameters for rectangular extent
• :start_timestamp, :end_timestamp Parameters for time interval

Tile Assembly Policies
When several time or sub-dimension values are returned from a dimension back-end query, the resulting tile is an assembly of all simple tiles matching each value. The way simple tiles are assembled is set with the <assembly_type> tag of the <dimensions> element. Currently only two values are implemented in MapCache:
• none: No assembly is performed, the resulting tile is the first retrieved simple tile. This is the default value.
• stack: Every pixel of the resulting tile is filled with the first opaque pixel found in all simple tiles in their retrieval order, e.g.:



Table 1: Assembly type: stack


The resulting tile may or may not be cached depending on the value of the <store_assemblies> tag of the <dimensions>
element. The two possible values are true and false. Default is true.
The <subdimensions_read_only> tag of the <dimensions> element indicates whether data source shall be queried in case of cache miss. The two possible values are true and false. Default is false.


Tile Fetching Policies
MapCache can be configured to fetch all subtiles to assemble either within a single thread or with as many threads as subtiles to fetch. This is set with the <assembly_threaded_fetching> tag of the <dimensions> element. This tag has an optional maxzoom attribute to specify that multi-threaded fetching should be disabled from a given zoom level.


Querying Dimensions at map level
By default, MapCache runs <validate_query> of second level dimensions for every requested tile of a map. When this involves slow remote PostgreSQL or ElasticSearch servers, it may be desirable to send the query only once for the whole map. A configuration option at the <dimension> level exists to enable this behaviour:


Storing Dimensions
When  using  a  disk  based  cache  tiles  will  be  stored  in  a  folder  structure  similar  to
base/gridname/DIM1/value/xx/xx/xx/xx/xx/xx.png (where DIM1 is the dimension value).
The order of the <dimension> tags inside the <dimensions> tag is important as it is used to create the directory structure for the disk cache. If you change the order of these values, any tiles that have been previously cached are invalidated (they will be unavailable to MapCache but not deleted).
Templates can be used to change the folder structure for example:





Templates can also be used to change Sqlite database names e.g.


Accessing Tile Caches with Dimensions
To retrieve a tile with a specific dimension, add the dimension name and value to the request query string e.g.
&DIM1=value
Only WMS and WMTS clients support passing dimensions to MapCache. Other tile services such as gmaps (GoogleMaps), tms, and KML do not support dimensions. WMTS however does allow access using a x,y,z addressing scheme, so by using URL rewriting on the web server tile-based clients (for example an OpenLayers ol.source.XYZ layer) can load a dimension-based tileset.


Seeding Tile Caches with Dimensions
The MapCache seeding tool allows specific dimensions to be seeded with the following syntax:


6.1.8 HTTP Requests
HTTP configuration blocks are used in multiple places in the MapCache configuration.

Specifying the URL
The simplest HTTP configuration block requires a single <url> child element:


Timeouts
You may configure the timeouts after which an HTTP request is abandoned:






Headers
You can insert custom headers in the request, or forward headers received from the client request:


Authorization
To access resources protected by a username and password, provide the <auth> element. Currently, only basic au- thentication is supported. Given that usernames and passwords are stored in unencrypted form, exercise caution when handling the configuration file (e.g., avoid committing it to a public repository and set restrictive file access permis- sions). The same precautions should be taken with the memory of the mapcache process (e.g., core files).

Both the username and password are processed verbatim. Ensure not to include any extra symbols (e.g., space, newline). If there is no username or no password, simply leave the respective element empty.



6.1.9 FeatureInfo Requests
Author
Thomas Bonfort
Contact
tbonfort at terriscope.fr
TBD

6.1.10 Proxying Unsupported Requests
Author
Thomas Bonfort
Contact
tbonfort at terriscope.fr


MapCache has the ability to forward any incoming request that it cannot natively respond to (either by returning a tile directly, by merging multiple tiles, etc.).
This setup allows MapCache to be placed transparently in front of an existing OGC-service supplying server to ac- celerate tiled or GetMap requests for a selected number of grids, while maintaining service compatibility for, e.g., unsupported grids, WFS requests, . . .


The configuration for this behavior is activated by a succession of entries inside the <forwarding_rule> element of the wms <service>. Rules are tested for in the order in which they appear in the mapcache.xml configuration file, and the first one that matches is used. If no rules are defined, or if no rule matches the incoming request, an error is returned to the user.

A <forwarding_rule> consists of a set of matching rules and an <http> block defining where the request should be forwarded to.



Parameter Filtering
The rules apply to the key-value pair parameters received in the incoming request, and are added with the <param> keyword:

The "type" attribute is the same as what is allowed for first level dimensions, i.e. allowed values are "values" and "regex". In the previous example, the rule would match any incoming request having . . .&SERVICE=WFS&... or
. . .&SERVICE=WCS&... in its request parameters.

Multiple rules can be used if the filtering has to be done on multiple parameters. In the previous example, the rule would match a WFS or WCS request that concerns the "somelayername" layer only.
A <forwarding_rule> that has no <param> child will match any incoming request that could not be serviced by Map- Cache directly from its cache, and can be used to forward all unsupported request to a full OGC- compliant server so that an un-cached response can be returned to the client.

See alsoTileset Dimensions
Proxy Destination
Once a <forwarding_rule> matches, its <http> child will be used to proxy the request to another server.





See alsoHTTP Requests
6.1.11 Data Sources
Author
Thomas Bonfort
Contact
tbonfort at terriscope.fr
MapCache uses the concept of a "source" as a service that is able to return image data given a set of parameters (namely an extent, an image size, and a projection). Typically, a source is the third-party WMS server that you want to put a tile cache in front of.

WMS Sources
A WMS server is the main upstream server type used by MapCache. When processing a given tile, if it is not found in its cache, MapCache will query a WMS server with a GetMap request, split the returned image data into individual tiles, and store those tiles in its cache for subsequent requests.



See alsoHTTP Requests to configure how the <http> block should be expressed

WarningYou should usually only supply vendor-specific parameters to the <params> block. Never include any hardcoded BBOX, WIDTH, HEIGHT, SRS or any parameters related to dimensions inside this block, as these are calculated by MapCache itself at runtime.
MapFile Sources
Experimental

WMTS Sources
MapCache WMTS source uses GDAL WMTS driver under the hood. Note that GDAL version must be > 2.1 to be able to enable the driver correctly. GDAL WMTS driver documentation can be found on: https://gdal.org/en/stable/ drivers/raster/wmts.html



GDAL WMTS xml file is needed, example command to construct such a file directly from wmts source equipped with basic auth & user/pass is: gdal_translate "WMTS:https://<url to capabilities>,layer=<layer id>" gdal_wmts.xml -of WMTS -config GDAL_HTTP_AUTH BASIC -config GDAL_HTTP_USERPWD <user:pass>
After GDAL WMTS xml file is constructed, it's validity can be checked with command "gdalinfo <name of xml file>". last step is to enable the new WMTS source with following configuration in mapcache.xml.

6.1.12 Tile Assembling
Author
Thomas Bonfort
Contact
tbonfort at terriscope.fr
TBD

6.1.13 Locking Mechanisms
Author
Thomas Bonfort
Contact
tbonfort at terriscope.fr
MapCache sometimes needs exclusive access to a given resource, and provides some mechanisms to ensure that no more than one MapCache instance can operate on that resource. This may happen when:
• Sending a request to a source WMS server for a given metatile. Only a single MapCache instance should be sending that request; other MapCache instances processing a tile from that same metatile should wait for that request to finish rather than sending the same exact request again (in order not to overload the WMS server).
• Writing a tile inside a TIFF cache. The TIFF library does not handle concurrent writes, so MapCache must ensure that only a single instance is accessing a given TIFF file for writing.
A locker is configured with:

When a MapCache instance cannot acquire a lock because it has already been acquired by another instance, it will:
• Check back every <retry> seconds to see if the lock has been released by the other instance.
• Consider that after <timeout> seconds the other instance has failed, and delete the lock before acquiring it itself.

Disk Locks
This locking mechanism places a file somewhere in the filesystem. The filesystem can be a network share in order to synchronize multiple MapCache instances.





The configured directory should be read/write accessible by the MapCache instance.

Memcache Locks
This locking mechanism uses a third-party memcache instance to keep track of the locks.


Fallback Locks
This "meta" locker will fall back to its second configured locker if the first one fails (typically used with a memcache instance if the memcache instance goes down).


6.1.14 Coverage Analyzer
Author
Jerome Boue

NAME
mapcache_detail - Coverage analysis of MapCache SQLite Caches



SYNOPSIS


DESCRIPTION
mapcache_detail main use case is users wanting to use offline a portion of a MapCache cache covering a given geo- graphical region. For that purpose, they need to identify relevant files from an existing cache, check whether tiles are missing from these files (possibly seeding missing parts if necessary), and extract these files to build a new cache of the requested region.
mapcache_detail, helps users with some of these activities. It works with SQLite caches where one single file may contains thousands of tiles. It is able to:
• Determine which SQLite files from the cache are needed to cover a given geographical region at a given zoom level range;
• Count how many tiles are needed to cover the region and how many are already present in each file, giving a coverage ratio on file level, zoom level and global level;
• Estimate data size of missing tiles, which need to be downloaded to entirely cover the requested region, again on file level, zoom level and global level.
mapcache_detail is able to handle all kinds of SQLite caches that MapCache itself handles, namely:
• Single SQLite caches, where only one SQLite database contains the whole cache;
• Multiple SQLite caches, where cache is split into multiple SQLite databases according to a given template;
• Composite SQLite caches, which are a combination of single and multiple SQLite caches depending on zoom levels.
mapcache_detail takes the form of an independent CLI executable using MapCache library. It is proposed as a simple contribution to the MapCache project under a contrib/mapcache_detail/ folder, due to its specific purpose (only SQLite caches are handled).

OPTIONS
Some option have the same syntax and meaning as those of mapcache_seeder utility.

Miscellaneous options
-h, -help
Display help message and exit.
-o, -short-output
(Optional) If this option is present, only Existing SQLite files are reported, missing SQLite files are still taken into account for level and global coverage.

Options for specifying the cache to analyze
-c, -config MapCache configuration file
(Required) Set MapCache configuration file in which cache to analyze is specified.
-t, -tileset tileset name
(Required) Set the tileset to analyze.
-g, -grid grid name
(Required) Set the grid to analyze.



-D, -dimension DIMENSION_NAME=VALUE
(Optional) Set the value of a dimension. This option can be used multiple times for multiple dimensions.
-q, -query <value>
(Optional) Set SQL query for counting tiles in a rectangle. Default value, given below, works with default schema of SQLite caches.


Options for specifying the region to cover
-z, -zoom minzoom[,maxzoom]
(Optional) Set min and max zoom levels to analyze, separated by a comma, eg: 12,15. If maxzoom is absent, only zoom level specified by minzoom is analyzed. Default value is 0.

Rectangular region
-e, -extent minx,miny,maxx,maxy
(Optional) Set the extent to analyze. Default value is the whole grid extent. This option cannot be used with
-ogr-datasource option.

Polygonal region
-d, -ogr-datasource OGR data source
(Optional) Set the OGR data source to get features from. Any OGR Vector Format can be used. If absent, the region is specified using -extent option, possibly its default value. This option cannot be used with -extent option.
-l, -ogr-layer layer
(Optional) Select the layer inside OGR data source. This option works only if -ogr-datasource has been speci- fied. This option cannot be used with -ogr-sql option.
-w, -ogr-where filter
(Optional) Set a filter to apply on OGR layer features. This option works only if -ogr-datasource has been specified. This option cannot be used with -ogr-sql option.
-s, -ogr-sql SQL query
(Optional) SQL query to filter inside OGR data source. This option works only if -ogr-datasource has been specified. This option cannot be used with -ogr-layer or -ogr-where.

COUNTING TILES
To illustrate the process, here is an example of a fictional grid. Tiles are represented by the smallest squares on the grid. Larger squares of 25 tiles each represent SQLite files. Small indices denote tile coordinates whereas large indices denote databases coordinates. Colored rectangle represents requested region for cache extraction. Darker tiles represent tiles present in cache.

MapServer Documentation, Release 8.6.0


Expressed in tiles, region coordinates (xmin, ymin, xmax, ymax) are (11, 7, 27, 20). Expressed in SQLite files, these coordinates are (2, 1, 5, 4). All files whose coordinates are comprised between (2, 1) and (5, 4) included shall be part of the cache extraction. All tiles whose coordinates are comprised between (11, 7) and (27, 20) included shall be counted for the region coverage.
Following table gives tile count and coverage ratio of requested region, according to tool's process:

SQlit (2,1) file(2,2)(2,3)(2,4)(3,1)(3,2)(3,3)(3,4)(4,1)(4,2)(4,3)(4,4)(5,1)(5,2)(5,3)(5,4)To- talTiles 043049804630200043presincachandcov-er-ingre-gionTiles 122020415252551525255915153238neetofullycoverre-gionCov- 0
er- age0.20.1500.260.360.3200.260.240.1200.220000.181


OUTPUT REPORT
Tool's output, in JSON format, provides user with SQLite file list to be extracted from cache. Details are given on the number of tiles contributing to region coverage. A synthesis is also given for each zoom level and at a global level.
Following is a fictional example describing information present in tool's output.
{
"layer": "example",	| Report starts with general information "grid": "local",	| on cache and requested region
"unit": "m", "region": {
"bounding_box": [ 11, 7, 27, 20 ], "geometry": {
"type": "Polygon",
"coordinates": [[ [11,7], [11,20], [27,20], [27,7], [11,7] ]]
}
},

"zoom-levels": [ {
"level": 1,
"files": [ {



| For each file, output report gives:
| its name, its size, its bounding box
| and intersection of that bounding box
| with requested region


"file_name": "/path/to/cache/example/1/2-1.sqlite", "file_size": 54632,
"file_bounding_box": [ 10, 5, 14, 9 ], "region_in_file": {
"bounding_box": [ 11, 7, 14, 9 ], "geometry": {
"type": "Polygon", "coordinates":
[[ [11,7], [11,9], [14,9], [14,7], [11,7] ]]
}
},
"nb_tiles_in_region": { 	
| Measures associated to a SQLite file
| are: number of tiles belonging to
| requested region and present in file,
| number of tiles belonging to region
| present or not in file, and resulting
| coverage ratio




}
}, {

"cached_in_file": 0,
"max_in_file": 12,
"coverage": 0


} ],

"file_name": ...
...

"nb_tiles_in_region": { 	
(continues on next page)



(continued from previous page)
| Measures associated to a zoom level
| are the sum of the ones for each SQLite
| file of that level





}, {

"cached_in_level": 43,
"max_in_level": 238,
"coverage": 0.1807
}


} ],

"level": 2,
...

"nb_tiles_in_region": {			 "cached_in_cache": 43,	| Global measures are the sum of all "max_in_cache": 238,	| zoom level measures
"coverage": 0.1807
},
"sizes": {		
| At global level estimations about
| cache size to be extracted for a full
| region coverage are also given. These
| estimations are based on the mean size
| of a tile obtained from all SQLite file
| sizes and how many tiles they contain

"total_size_of_files":   1599442,
"total_nb_tiles_in_files": 60,
"average_tile_size":  26658,
"estimated_max_cache_size": 6344604,
"estimated_cached_cache_size": 1146294,
"estimated_missing_cache_size": 5198310
}
}

EXAMPLES
Analyze tile coverage of tileset osm with the g grid. Default extent is the whole world and default zoom level is 0:

Same as beforehand, with explicit zoom levels 9 to 12 and explicit extent covering Switzerland:





See alsoMapCache presentation slides at FOSS4G2011
6.1.15 Features
• services WMS, WMTS, TMS, VirtualEarth/Bing and Google Maps requests: Supported Tile Services
• ability to respond to untiled WMS requests by merging tiles from the cache or forwarding them to the WMS source: Tile Assembling
• responds to WMS/WMTS GetFeatureInfo requests (forwarded to source service)
• KML superoverlay generation
• data provided by WMS backends (GDAL supported sources planned)
• cache types:
- Disk
- SQLite
- Memcached
- Tiled TIFFs
- REST (S3, Azure, Google)
- Riak
- Combined caches
- Berkeley DB
- LMDB
• configurable metatiling
• on-the-fly tile merging for combining multiple tiles into a single image
• image post-processing (recompression and quantization) when arriving from a backend
• interprets and produces cache control headers: Last-Modified, If-Modified-Since, Expires
• multithreaded seeding utility that can seed specific zoom levels or specific areas (e.g. seed levels 0 to 12 of all tiles intersecting Colorado)
• ability to add a custom watermark on stored tiles
• produces a CGI/FastCGI executable for use with webservers other than Apache
• configurable symbolic linking of blank tiles to save disk space
• configurable error reporting: plain HTTP error code, textual message, or empty (blank) image
• ability to specify vendor parameters or dimensions to be forwarded to the WMS backend (and to build a cache that takes these parameters into account): Tileset Dimensions


CHAPTER
SEVEN



MIGRATION GUIDE



7.1 MapServer Migration Guide
Last Updated
2025-11-19


7.1.1 MapServer 8.4 to 8.6 Migration
• You can now enable an automatically generated index page, that lists all of your OGC services and endpoints, for each mapfile that you defined in your CONFIG file. To enable the index, add MS_INDEX_TEMPLATE_DIRECTORY to your environment variables section of the CONFIG file, such as:


(continues on next page)

523



(continued from previous page)



See alsoIndex Page & rfc140
• A new IDENTIFY object can be used in a mapfile to control how features are found through queries, to account for the actual symbol being used for that CLASS. This could be useful for WMS GetFeatureInfo requests.



















(continues on next page)



(continued from previous page)


See alsooriginal Pull Request #7318
• FALLBACK has been added to the CLASS object, to allow that class to be used if no other class can be applied.



See alsooriginal Pull Request #7309
• OGC API : Features has been enhanced to allow the appending of additional query parameters to all URLs generated through the API, by defining the ows_extra_params parameter in the mapfile's WEB.METADATA object.




(continues on next page)



(continued from previous page)
All subsequent URLs available through OGCAPI: Features will contain that token=123, such as:




See alsooriginal Pull Request #7360
7.1.2 MapServer 8.2 to 8.4 Migration
• The 8.4.1 release includes a fix for a security flaw for WFS filter requests to an OGR backend connection (see CVE record: CVE-2025-59431, or MapServer's Security Advisory)
• you can now build against the PCRE2 library (WITH_PCRE2=ON)
• reminder that since the PROJ 9.1 release, the former PROJ_LIB variable has been replaced with PROJ_DATA

See alsoSetting the location of PROJ files in PROJECTION .





7.1.3 MapServer 8.0 to 8.2 Migration
• The 8.2 release includes a fix for a security flaw for regex validation (CVE has been requested)
• The GitHub repository has been restructured to move all source code into the /src folder
• The unused sym2img commandline utility has been removed
• support for GDAL < 3 has been removed
• support for PROJ < 6 has been removed
7.1.4 MapServer 7.6 to 8.0 Migration
• The former shp2img commandline utility has been renamed to map2img
• Every MapServer installation as of the 8.0.0 release will require a CONFIG file.




• Old native PHP MapScript has been removed, in place of PHPNG (SWIG) MapScript. Follow the MapScript
SWIG API documentation. Compiling SWIG master from GitHub is recommended.


• To follow the WMS specification, the STYLES parameter will now be required for GetMap requests. To bypass this requirement, you can set wms_allow_getmap_without_styles in your WMS Server mapfile, such as:









(continues on next page)



(continued from previous page)
• Several deprecated mapfile parameters have been removed, and will throw an error if you still specify them now. The following are specific examples to be aware of (but be sure to review the full list), taken from the MS4W migration guide:
- DUMP TRUE
Instead, you can configure querying of your layer by using METADATA instead, such as:

- OPACITY at the LAYER-level
Instead it must be inside a COMPOSITE object:

- COLOR at the CLASS-level
Instead it must be inside the class' STYLE object:

• Direct changing of mapfile parameters through the URL has been removed as of the 8.0.0 release. You can still however handle this through Run-time Substitution, but with a more limited list of supported mapfile parameters (see related discussion). Here is an example CGI request pre-8.0 release:

• Using the LABEL WRAP parameter with MAXLENGTH 0 to always wrap at the wrap character is no longer supported (as there are more strict checks in MapServer >= 8 for negative or zero values), so instead you can remove (or comment) that MAXLENGTH 0 line, and MapServer will wrap at the character, such as:





so the label will appear in the map image as:



• Reminder: every mapfile LAYER should include a NAME parameter. The NAME should not contain special characters, or spaces, or begin with a number. This simple name is important for your downstream users (such as through OGC services).


7.1.5 MapServer 7.4 to 7.6 Migration
• MapServer now requires at least CMake version 3.0 for compiling
• PointZM data support (X,Y,Z,M coordinates) is now enabled by default
• the PROJ 6 API is now supported. Read about the many changes in PROJ since the PROJ 6.0 release. Note that older PROJ versions such as 5.2.0 will still work with MapServer.







• CONNECTIONOPTIONS parameter has been added in the mapfile LAYER, to take advantage of GDAL/OGR driver options. (see RFC 125) such as:

• new processing directive RENDERMODE (added through RFC 124 SLD changes) to enable a 'painters model' where all classes for a layer are drawn at once with a ALL_MATCHING_CLASSES setting, such as:

More information in issue 5839.


• WMS client layers can be set to essential, with the new wms_essential metadata item, which will cause MapServer to fail and report an error (normally MapServer would just ignore that layer).




Here is an example of the new wms_essential parameter:

• Windows users can now use umlauts (special characters such as ä ö ü) in their directory paths and filenames, such as:


7.1.6 MapServer 7.2 to 7.4 Migration
• PHP 7 MapScript support: users are recommended to switch to MapServer's new SWIG API support of PHP 7+ (reason for recommendation: as we saw with the breaking PHP 7 changes, managing PHP through SWIG will be easier on the MapServer maintainers in the long run.) Some important SWIG notes:
- you will require at least SWIG-3.0.11 (but 4.0.0 is recommended).
- if you notice any missing functions that were available in the old native PHP MapScript API, first please check the SWIG API reference document for an alternative function to use, and if there is nothing similar available then file a ticket for each function that you require.
- all of your PHP scripts (that leverage MapServer objects and functions) must now always first include the generated mapscript.php file containing MapServer constants:

- take note of the change in how to declare your new objects:

instead of the former way:



7.1.7 MapServer 7.0 to 7.2 Migration
• LABEL->PARTIALS now defaults to "FALSE" instead of "TRUE" which implies that by default labels that do not fully fit in the map image will be discarded.

7.1.8 MapServer 6.4 to 7.0 Migration
• The predefined field names for the union and cluster layers have been changed. Colons in the field names have been replaced with underscores to avoid producing invalid GetFeatureInfo results. The field names in the mapfiles should be modified according to this change.
• Layer FILTERs must use MapServer expression syntax only. Drivers will attempt to translate from MapServer syntax to native syntax (e.g. SQL). Native expressions can still be set either using: 1) sub-selects in the DATA statement or 2) using the new NATIVE_FILTER processing key.

• MapServer attribute queries (e.g. mode=item[n]query) must be specified using MapServer expression syntax (qstring and qitem (opt)). For RDBMS backends you no longer send SQL snippets, rather the underlying driver will attempt to translate the expression to native syntax (e.g. SQL). If translation fails (or the driver doesn't
support translation) then MapServer will evaluate the expression instead.
• Layer opacity is now deprecated a result of RFC 113 - Layer Compositing. The mapfile parser and MapScript getter/setter functions will continue to function but unpredictable results will occur if used in conjunction with COMPOSITE blocks. For more information see https://mapserver.org/development/rfc/ms-rfc-113.html.

• Handling of non UTF-8 encoded datasources has changed with RFC103. Mapfiles now must be saved in UTF-8 encoding, and requests returned by MapServer will always be UTF-8 encoded. Various "xxx_encoding" metadata entries used to hack around non UTF-8 encoded datasources are now obsolete, and have been replaced by a
LAYER-level ENCODING keyword.
• Native ESRI SDE layers are no longer supported (see https://github.com/MapServer/MapServer/pull/5068).



OGR remains an alternative for those that really need it although the OGR/SDE driver suffers from the same issues that prompted the removal from MapServer.
• GD graphics library support was removed (https://mapserver.org/development/rfc/ms-rfc-99.html) and had been optional since 6.2.
- GIF output cannot be produced from MapServer although 8-bit PNG output can be be produced using the AGG/PNG8 driver.
- Bitmap fonts have been replaced with an embedded TrueType font (see https://mapserver.org/development/ rfc/ms-rfc-104.html)
• RFC 98 - Label/Text Rendering Overhaul (https://mapserver.org/development/rfc/ms-rfc-98.html) may result in subtle label/character placement changes. Support for negative MAXLENGTH that implied forced linebreaks is not supported anymore, workaround implies pre-processing such labels to include linebreaks or wrap characters.
• ExternalGraphics added through SLD must now validate against the "sld_external_graphic" entry of the MAP-
>WEB->VALIDATION block


7.1.9 MapServer 6.2 to 6.4 Migration
• The "ows_extent" layer metadata is not used anymore to obtain georeferencing information for unreferenced raster data. Please use the "extent" layer key instead

• Validation patterns cannot be specified in metadata blocks (i.e. using xxx_validation_pattern and default_xxx metadata entries), use VALIDATION blocks. see #4596 #4604 #4608 or Run-time Substitution
• Build has changed after the switch to cmake. Build instructions are included in the INSTALL.CMAKE file in the source directory. You will need to have cmake installed on your system. Users of mapscripts (except php) will also need swig to be installed.
• WFS paging parameter startIndex changed to base on 0 instead of 1 (0 is the first feature). See #4180 for external references.
• Template substitution tags were case-sensitive, they are now case-insensitive.

7.1.10 MapServer 6.0 to 6.2 Migration
This section documents the changes that must be made to MapServer applications when migrating from version 6.0.x (or earlier versions) to 6.2 (i.e. backwards incompatibilities), as well as information on some of the new features.



Build system changes
If you are building MapServer from source, then the following may be of interest to you:
• Use of libtool: In version 6.2, the Unix/Linux build scripts and Makefiles were converted to use libtool. One impact of this change is that the 'mapserv' file in the main source tree is a libtool wrapper script and not the actual binary. To use 'mapserv' you actually have to use 'make install' and then point to the installed binary. More info
is available in the Compiling on Unix document at https://mapserver.org/installation/unix.html#installation
• The -with-php configure option has been changed to point directly to the php-config script instead of to the directory where the PHP headers are located.

CGI Changes
• Changing MIN/MAXSCALE or MIN/MAXSCALEDENOM via URL is no longer supported.
• The syntax for changing a LABEL with CGI commands has changed along with the ability to support mul- tiple labels The previous syntax . . .&map.layer[0].class[0]=label+color+255+0+0+end&. . . is replaced with
. . .&map.layer[0].class[0].label[0]=color+255+0+0&. . . Note that cgi label modifications are/were broken in
6.2.0 and fixed in 6.2.1

Rendering changes
• STYLE->GAP interpretation Starting in 6.2, STYLE->GAP specifies the gap between the symbols using the centre to centre distance. In earlier versions of MapServer, GAP was used as the approximate distance between the symbol boundaries. See ticket #3867 for more information.
In order to get the same effect with 6.2 as with 6.0, STYLE->GAP must be increased with the size of the symbol.
• Removal of one pixel gap between symbols In earlier versions of MapServer, an extra gap of one pixel was added between the symbols (in addition to the gap specified in STYLE->GAP). This has been discontinued in 6.2. See ticket #3868 for more information.
In order to get the same effect with 6.2 as with 6.0, STYLE->GAP must be increased with one pixel.
• STYLE->INITIALGAP introduced Support for more powerful line styling has been provided with the introduc- tion of STYLE->INITIALGAP. See ticket #3879 and the documentation for more information.
• SYMBOL->ANCHORPOINT introduced A symbol anchorpoint has been introduced to facilitate precise posi- tioning of symbols. See ticket #4066 and the documentation for more information.
• Change in vector symbol size calculation. In 6.2, vector symbol coordinates are shifted to get rid of negative x and y coordinate values. See ticket #4116 for more information.
In order to get the shifting effect that could be obtained using negative coordinate values, SYMBOL-
>ANCHORPOINT should be used instead.

7.1.11 MapServer 5.6 to 6.0 Migration
This section documents the changes that must be made to MapServer applications when migrating from version 5.6.x (or earlier versions) to 6.0 (i.e. backwards incompatibilities), as well as information on some of the new features.

Mapfile Changes - Expression Parsing
Version 6.0 features an extensive reworking of the expression parsing capabilities. While this adds functionality it also introduces a couple of regressions:
Logical Expressions
• a regex is now delineated as a string (e.g. '^a' rather than /^a/)
• the regex operator is ~ for case sensitive comparisons and ~* for case insensitive



• case insensitive string comparison operator is =*
Class text expressions are true expressions in 6.0. This allows for fancy formatting of numeric data but also means string operators must be used to concatenate attribute values and string literals.
• Old/bad: TEXT ([area] acres)
• New (option 1)/good: TEXT ('[area]' + ' acres')
• New (option 2)/good: TEXT '[area] acres'
On the plus side you can now control the number of decimal places, round and even commify the area value for display.
See https://mapserver.org/development/rfc/ms-rfc-64.html and https://github.com/MapServer/MapServer/issues/ 3736 for more information.

Mapfile Changes - Label Styles
As the need for more and more control of label drawing increased it became apparent that we couldn't extend labelObj's endlessly. In 6.0 we introduce the idea of label styles, that is, a styleObj inside a labelObj. The styles can be used to add accompanying markers or bounding box elements to a label- kinda like annotation layers. The big benefit is that it's done in one pass. So you can draw complex roadwork and shields all at the same time. Pretty neat huh? Plus you can do attribute binding for any of the styleObj attributes that support it.
As a result the parameters BACKGROUNDCOLOR, BACKGROUNDSHADOWCOLOR, BACKGROUNDSHAD-
OWSIZE are no more. To draw a label "box" in 6.0 you'd do:

More verbose but much more flexible in the long run.

Mapfile Changes - Label MAXOVERLAPANGLE
RFC60 introduced a new MAXOVERLAPANGLE keyword to filter out ANGLE FOLLOW labels in which characters overlap. This new option is enabled by default in 6.0 with a default value for MAXOVERLAPANGLE of 22.5 degrees.
As per RFC60, it is possible to set MAXOVERLAPANGLE to 0 to fall back on pre-6.0 behavior which was to use hardcoded maxoverlapangle = 0.4*MS_PI (40% of 180 degrees = 72 degrees).

Core Changes - Rendering Overhaul
The rendering backends for MapServer have been refactored for version 6 to allow us to support all features across all rendering drivers (GD,AGG,PDF,SVG, etc. . . ).
• PDF support is output through the cairo library. The dependency on the non-free pdflib library has been removed.
• SVG support is output through the cairo library. The native mapserver SVG driver has been removed.



• AGG support is compiled in by default (no external dependency) and is the default renderer for png and jpeg outputs.
• GD support is limited to PC256 imagemodes, i.e. png or gif. It is the default renderer for gif output.
• SWF (flash) support has been dropped.
• Header files for libpng, libjpeg and giflib are now required for building MapServer. Install the -devel packages of these libraries.
• All symbols now rotated anticlockwise following the ANGLE parameter. Previous versions rotated vector sym- bols clockwise.
• Polygon fills with vector symbols will not cleanly join at tile boundaries. For hatching type symbology, use the HATCH symbol instead of a diagonal vector symbol.
• Some inconsistencies between renderers have been ironed out. People relying on precise symbol placement should check those, as there may have been some subtle changes in symbol sizes and widths, or spacing between symbols on lines.
• Style blocks with no associated symbol on point layers will produce no output, as opposed to a single pixel in previous versions. Use an ellipse symbol instead.

Mapfile Changes - line styling
All line styling must now be specified in class STYLEs in the layer definition. The following parameters/keywords have been moved from SYMBOL to STYLE:
PATTERN POSITION GAP LINECAP LINEJOIN LINEJOINMAXSIZE
The SYMBOL STYLE parameter/keyword was renamed to PATTERN in version 5. The SYMBOL TYPE cartoline has been removed.
LINECAP triangle is not supported by AGG or Cairo, and is no longer available. The triangle line end effect can be achieved using GEOMTRANSFORM start and end with a (filled) vector triangle symbol and ANGLE AUTO. This will only work for the line ends, and not for dashes.

CGI Changes
Runtime substitution now requires a validation pattern be present before the substitution will take place (this had been optional). This can be done via a layer metadata tag as before or within layer or web VALIDATION blocks. See ticket #3522 for more information.
All of the query map related modes (e.g. NQUERYMAP, ITEMQUERYMAP, etc. . . ) have been removed in favor of using the "qformat" parameter. That parameter takes an output format name or mime/type as a value and uses that to process a set of query results. For example:
. . .&mode=nquerymap&. . . would become . . .&mode=nquery&qformat=png24&. . .

OGC Web Services
All OGC Web Services are now disabled by default. If you want to enable them as they were in MapServer 5.6 and older releases, add the following metadata in the MAP::WEB section:

See also:  https://mapserver.org/development/rfc/ms-rfc-67.html



Mapfile Changes - WCS Metadata
To avoid confusion only "wcs_*" and "ows_*" prefixed metadata entries are evaluated in OGC WCS services. Previous versions used "wms_*" prefixed entries as fallback which is dropped in version 6.0 in favor of forcing explicit decisions.

Mapfile Changes - OGC requests - DUMP parameter removed
The DUMP LAYER parameter has been removed. To enable output of geometries in WMS getfeatureinfo requests - GML (INFO_FORMAT=application/vnd.ogc.gml), LAYER METADATA is used instead:


Mapfile Changes - Ability to escape single/double quotes
We can now escape single and double quotes in strings and logical expressions. Examples:

NOTE: The escape character (backslash) will only work if the following character is ", ' or .
For Windows users: if you have a path string delimited by single/double quotes that ends with , you will have to escape the last backslash.


PHP MapScript Changes
• PHP 5.2.0 or more recent is required.
• PHP/MapScript now uses exceptions for error report. All errors are catchable.
• Object properties can be set like all other php object. ie. myObj->myProperty = 10; NOTE: The set/setProperty methods are still available.
• All object constructors throw an exception on failure
• Objects can be created with the php "new" operator. ie. $myShape = ms_newShapeObj(MS_SHAPE_LINE); // or $myShape = new shapeObj(MS_SHAPE_LINE);
NOTE: "ms_newSymbolObj()" and "new symbolObj" are different:
- ms_newSymbolObj() returns the id of the new/existing symbol.
- new symbolObj() returns the symbolObj. You don't need to
get it with getSymbolObjectById().
• Cloneable objects should be cloned with the PHP clone keyword. There is no more clone methods.
• Class properties that have been removed
- mapObj: imagetype, imagequality, interlace, scale, transparent



- classObj: maxscale, minscale
- layerObj: labelsizeitem, labelangleitem, labelmaxscale, labelminscale,
maxscale, minscale, symbolscale, transparency
- legendObj: interlace, transparent
- scalebarObj: interlace, transparent
- symbolObj: gap, stylelength
- webObj: minscale, maxscale
• Class methods that have been removed
- projectionObj: free
- lineObj: free
- pointObj: free
- rectObj: free
- shapeObj: free, union_geos
- symbolObj: free, getstylearray
- imageObj: free
- outputFormatObj: getformatoption, setformatoption
- shapefileObj: free
- layerObj: getFilter, getShape
• referenceMapObj has new properties: marker, markername, markersize, maxboxsize, minboxsize
• shapeFileObj is automatically closed/written on destroy. (At the end of the script or with an explicit unset())
• layerObj->clearProcessing() method now returns void.
• mapObj->queryByIndex(): default behavior for the addToQuery parameter was not ok, now it is.
• Methods that now return MS_SUCCESS/MS_FAILURE:
- symbolObj: setPoints, setPattern
- scalebarObj: setImageColor
- outputFormatObj: validate
- layerObj: setProcessing, addFeature, draw
- mapObj: moveLayerUp, moveLayerDown, zoomRectangle, zoomScale, setProjection,
setWKTProjection, setLayersDrawingOrder
• Methods that now return NULL on failure:
- classObj: clone
- styleObj: clone
- layerObj: nextShape, getExtent
- mapObj: clone, draw, drawQuery getLayerByName, getProjection,
• Methods that now return an empty array
- symbolObj: getPatternArray
- layerObj: getItems, getProcessing, getGridIntersectionCoordinates



- mapObj: getLayersIndexByGroup, getAllGroupNames, getLayersDrawingOrder, getAllLayerNames

MapScript (All Flavors)
The layer query result handing has been re-worked (again) to address some issues introduced in the 5.4/5.6 versions. Gone are resultsGetShape and getFeature methods. You should now use a refactored getShape method to access layer shapes. That method takes a resultObj and returns a shapeObj. Typical use would be (in Perl):

A resultObj encapsulates the data used to manage a result set.
To access shapes independently of a query use the new resultObj class:
      $layer->open(); $shape = $layer->getShape(new mapscript::resultObj(1)); $layer->close(); See https://mapserver.org/development/rfc/ms-rfc-65.html for more information.
OUTPUTFORMAT
The OUTPUTFORMAT parameter validation when reading from the mapfile will now trigger an error on some prob- lems that in the past were silently fixed up. For instance using RGBA IMAGEMODE with JPEG format now triggers an error instead of switching to IMAGEMODE RGB silently.
The default outputformats names, drivers and mimetypes have been significantly reorganized:
• png : AGG/PNG (image/png)
• jpeg : AGG/JPEG (image/jpeg)
• gif : GD/GIF (image/gif)
• png8 : AGG/PNG8 (same as AGG/PNG, but with 256 color quantization applied) (image/png; mode=8bit)
• png24 : AGG/PNG (for backwards compatibility) (image/png; mode=24bit)
• pdf : CAIRO/PDF (application/x-pdf)
• svg : CAIRO/SVG (image/svg+xml)
• GTiff : GDAL/GTiff (image/tiff)
• kml : KML (application/vnd.google-earth.kml++xml)
• kmz : KMZ (application/vnd.google-earth.kmz)

Rasters
• The support for rendering rasters without GDAL has been removed. Now RASTER layers (or WMS layers) require that MapServer be built against the GDAL library.
• The above change also means there is no longer support for EPPL raster layers.



Deprecated features
• Support for Flash/SWF output has been removed as part of the rendering overhaul because it was no longer compatible with the new architecture. Support for Flash/SWF could be reintroduced but would require a non trivial amount of work (i.e. would require funding).
• Support for "CONNECTIONTYPE MyGIS" has been dropped since it was no longer being maintained and there are better ways to use MySQL data sources theses days, going through OGR for instance.

7.1.12 MapServer 5.4 to 5.6 Migration
This section documents the changes that must be made to MapServer applications when migrating from version 5.4.x (or earlier versions) to 5.6 (i.e. backwards incompatibilities), as well as information on some of the new features.

MapScript changes related to single pass queries
In RFC-52, MapServer was modified to perform queries using a single pass on the data instead of two passes. This is transparent for CGI applications, but MapScript scripts must be modified to use the layer.resultsGetShape() method instead of layer.getShape().
See also:  https://mapserver.org/development/rfc/ms-rfc-52.html
(Note: the new resultsGetShape() method is not yet available for PHP MapScript in 5.6.0-beta1)

WFS 1.1 axis orientation
The axis order in previous versions of the WFS specifications was to always use easting (x or lon ) and northing (y or lat). WFS 1.1 specifies that, depending on the particular SRS, the x axis may or may not be oriented West-to-East, and the y axis may or may not be oriented South-to-North. The WFS portrayal operation shall account for axis order. This affects some of the EPSG codes that were commonly used such as ESPG:4326. The current implementation makes sure that coordinates returned to the server for the GetFeature request reflect the inverse axis orders for EPSG codes between 4000 and 5000.

Change of mime-type for the imagemap outputformat
RFC 36 added support for templated outptformats, but this new feature was not available for WMS GetFeatureInfo output (see ticket #3024). In MapServer 5.6 this has been resolved by implementing lookup of output formats for query templates by mime-type. However this caused a conflict for the text/html mime-type between the actual text/html query templates and the preconfigured imagemap outputformat which also used the text/html mime-type.
In order to resolve this conflict, the mime-type of the imagemap outputformat has been changed to "text/html; driver=imagemap". This is unlikely to cause much side-effects to existing applications, but the change is documented here just in case.

7.1.13 MapServer 5.2 to 5.4 Migration
This section documents the changes that must be made to MapServer applications when migrating from version 5.2. (or earlier versions) to 5.4 (i.e. backwards incompatibilities), as well as information on some of the new features.

New requirements for mapfiles, symbolsets and templates
Due to some potential security vulnerabilities that were uncovered in previous versions of MapServer, RFC-56 intro- duced a number of changes to tighten access control on mapfiles and templates and limit the risk of leaking arbitrary file contents. These changes were introduced in version 5.4.0, and were also backported to v5.2.2 and 4.10.4.
The new requirements are as follows:
• The MAP and SYMBOLSET keywords must be added to any mapfile and symbolset that did not contain them already.



• All MapServer templates must be updated to contain the "MapServer Template" magic string on the first line. This string can be embedded in a comment depending on the template format and the whole line will be skipped in the output generation. e.g.
- In HTML: <!- MapServer Template ->
- In JavaScript: // MapServer Template
See also:  https://mapserver.org/development/rfc/ms-rfc-56.html

7.1.14 MapServer 4.10 to 5.0 Migration
This section documents the changes that must be made to MapServer applications when migrating from version 4.10.x (or earlier versions) to 5.x (i.e. backwards incompatibilities), as well as information on some of the new features.

Mapfile changes
Attribute Bindings: In an effort to stem the tide of keyword overload and add functionality MapServer 5.0 supports a new method of binding feature attributes to STYLE and LABEL properties. In the past keywords like ANGLEITEM or LABELSIZEITEM were used, now you denote the attribute in the context of the property being bound. For example, to bind an attribute to a label size you'd do:

The []'s denote a binding (as with logical expressions). The following keywords are no longer supported and their presence will throw an error:
• Layer: LABELANGLEITEM, LABELSIZEITEM
• Style: ANGLEITEM, SIZEITEM
The following properties can accept bindings:
• Style: angle, color, outlinecolor, size, symbol
• Label: angle, color, outlinecolor, size, font, priority
Colors may be given as a hex value (e.g. #FFFFFF) or an RGB triplet (e.g. 255 255 255).
Layer Transparency: The values for the TRANSPARENCY parameter have always been backwards and in an effort to resolve that the parameter has been renamed OPACITY. TRANSPARENCY is still recognized by the mapfile parser but is deprecated and should be avoided.
Scale Parameters: MapServer's handling of scale has long been a source for confusion. The values use in a layer MINSCALE are really the denominators from a representative fraction (e.g. 1:24000). To help clarify this all scale parameters are now end with DENOM. So MINSCALE => MINSCALEDENOM, SYMBOLSCALE => SYMBOL- SCALEDENOM, and so on. The mapfile parser still recognizes the older keywords but they are deprecated and should be avoided.

Symbol file changes
Symbol Style: STYLEs are used within a symbol definition to store dash patterns for line symbolization. However, there is potential confusion with the style object that is used within class definitions. To resolve that confusion the symbol STYLE parameter has been renamed PATTERN. The symbol file parser will still recognize the STYLE keyword but it is deprecated and should be avoided.



Styling/Symbology changes
Prior to MapsServer 5.0, if a pixmap symbol was used in style on a Line Layer, the symbol was used as a brush to draw the line. In MapServer 5.0, it is possible to draw the pixmap symbol along the line (Note that this was available using a true type symbol). To achieve this, the user needs to use the parameter GAP with it's pixmap symbol definition in the symbol file. The GAP represents the distance between the symbols. If the GAP is not given, the pixmap symbol will be used as a brush.

AGG rendering changes
see the AGG rendering specifics for the changes relating to the addition of the Antigrain Geometry rendering engine.

URL configuration changes
Previous versions of the MapServer CGI program allowed certain parameters to be changed via a URL using a cum- bersome syntax such as map_layer_0_class_0_color=255+0+0 which changes the color in one classObj. Not only was this cumbersome for users but also from a code maintenance perspective since we had to maintain separate loaders for URL-based config and file-based config. RFC-31 attempts to streamline both by migrating to a single object loading function that can be used with strings (either in MapScript or via URL) or with files.
So, in the past you have to change parameters one-at-a-time. Now you can pass chunks of mapfiles (with security restrictions) to the CGI interface. The map_object notation is still necessary to identify which object you want to modify but you can change multiple properties at one time. Note that you can use either a '_' or a '.' to separate identifiers.
Example 1, changing a scalebar object:

Example 2, changing a presentation style:

Example 3, creating a new feature

The variable identifies an object uniquely (by name or index in the case of layerObj's and classObj's). The value is a snippet of a mapfile. You cannot create new objects other than inline features at this point.

Validation patterns for mapserv attribute queries
Attribute queries (qstring) done via the mapserv CGI could theoretically be used for SQL injection.
No exploit has been reported, but in order to mitigate the risk, a new validation pattern mechanism has been added in 5.0.
In the case of qstring attribute queries, the qstring_validation_pattern layer-level metadata is required for qstring queries to work. The metadata value is a regular expression that the qstring value must match otherwise mapserv produces a fatal error. A fatal error is also produced if qstring is used but qstring_validation_pattern is not provided.
Note that similar validation pattern mechanism has been available for %variable% substitutions since version 4.10, but in this case it is optional. The pattern for %myvar% is provided via a metadata called myvar_validation_pattern.



SWIG MapScript (Python, Perl, CSharp, Java) changes
Layer Transparency: The layerObj transparency parameter is now called opacity. Scripts setting that value in code must be updated.
Symbol Style: the symbolObj style parameter is now called pattern. MapScript does not allow direct modification of that parameter. In Swig-based languages the symbolObj method setStyle is now called setPattern. In PHP/MapScript, the methods setStyle and getStyle are now called setPattern and getPattern.
A new msGetVersionInt() function returning the current MapServer version in integer format has been added to facilitate version checks in the future. Given version x.y.z, it returns (x*0x10000 + y*0x100 + z). For instance, for v5.0.0 it will return 0x050000 (note the hexadecimal notation).

CSharp related changes
The MapScript C# classes are now placed into the OSGeo.MapServer namespace The scripts should use the fully qualified names of the classes or apply the

or the corresponding language equivalent.

PHP/MapScript changes
Layer Transparency: The layerObj transparency parameter is now called opacity. The old "transparency" name is deprecated and will be removed in a future release. Scripts getting/setting that value in code must be updated.
All occurrences of scale, minscale, maxscale, etc. . . parameters have been deprecated and renamed with a "denom" suffix (e.g. minscale becomes minscaledenom, etc.). The deprecated parameters will be removed in a future release. Scripts getting/setting them must be updated.
SymbolObj style has been renamed pattern. The old "stylelength" parameter and setStyle() and getStyleArray() methods have been deprecated and "patternlength", setPattern() and getPatternArray() should be used instead. They will be removed in a future release.
layer.getShape(int tileindex, int shapeindex)) has been deprecated and renamed to layer.getFeature(int shapeindex [, int tileindex = -1]) to match the SWIG MapScript equivalent. Note that the order of the arguments is reversed since tileindex is optional in getFeature().
class.getExpression() and layer.getFilter() have been deprecated and renamed to class.getExpressionString() and layer.getFilterString() to match what we have in SWIG MapScript. The String suffix in the function name also more clearly indicates that the return value is not an object but a string representation of it.
A new ms_GetVersionInt() function returning the current MapServer version in integer format has been added to facil- itate version checks in the future. Given version x.y.z, it returns (x*0x10000 + y*0x100 + z). For instance, for v5.0.0 it will return 0x050000 (note the hexadecimal notation).

OGC Web Map Service (WMS)
Required Parameters for GetMap and GetFeatureInfo: previously, MapServer did not check for the following parameters when responding to an OGC:WMS GetMap or GetFeatureInfo request:
• SRS
• FORMAT
• WIDTH
• HEIGHT
• STYLES or SLD / SLD_BODY



• BBOX
That is, a GetMap request would process without error if these were not passed by the WMS client.
A compliant OGC:WMS 1.1.0 and 1.1.1 REQUIRES these parameters. This may affect OGC:WMS client requests who were not passing these values. Ticket 1088 fully documents this issue. In addition to WMS compliance, this was also decided that by adding this constraint, if an OGC client request (as described earlier) breaks something, people should fix their client anyway since if they change WMS vendor, they will have problems as well.

OGC Web Feature Service (WFS)
OGC Sensor Observation Service (SOS)
• The format of MAP/LAYER/METADATA/sos_describesensor_url has been changed such that users now must format the value per:
"sos_describesensor_url" "http://example.org/sml/%procedure%.xml"
This change has been made to clarify and unify the meaning of procedure within SOS Server's context of a DescribeSensor request.
• Metadata associated with an observedProperty element's swe:component value have been changed to support a URN scheme, instead of the previous "sos_componenturl" metadata. The "sos_componenturl" metadata is no
longer supported. Instead, "sos_observedproperty_authority" and "sos_observedproperty_version" should be used to format the swe:component value.

Build Changes
MapServer's main include file has been renamed from "map.h" to "mapserver.h". A new mapserver-config script has been created with the following options:
The shared and static link libraries for MapSserver have been renamed libmapserver.x.y.so and libmapserver.a respec- tively.
The -enable-coverage configure option has been renamed to -enable-gcov since the former name led users to think it might be related to enabling support for WCS or Arc/Info coverages:


Features Heading for Deprecation
Some features present in MapServer are likely to be removed in a future release. Features might be headed for depre- cation because:
• they have been replaced by a superior or more capable solution
• they have stopped being maintained



Users of these features should be prepared for these upcoming changes and start adapting their mapfiles in consequence. If you have strong and motivated objections as to the removal of one or more of these features please open a discussion in the usual MapServer communication channels.
Cartoline symbols: these were a hack to overcome GD weaknesses, and their functionality is now supported by the AGG renderer. They have become poorly supported in current MapServer versions. Keywords allowing for setting the style of line joins and caps will be moved to the STYLE block.
RGB/RGBA output with GD: support for RGB and RGBA image types will likely not be maintained anymore. PC256 will continue to be supported with GD, while RGB and RGBA will likely only be supported with AGG


CHAPTER
EIGHT



INPUT


8.1 Data Input
8.1.1 Vector Data
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Author
Tyler Mitchell
Contact
tmitchell at osgeo.org
Last Updated
2022-08-12
This work is licensed under the Creative Commons Attribution-ShareAlike License. To view a copy of this license, visit: https://creativecommons.org/licenses/by-sa/2.0/ca/
What is vector data? This quote from is a good description of what vector data is:
Vector: "An abstraction of the real world where positional data is represented in the form of coordinates. In vector data, the basic units of spatial information are points, lines and polygons. Each of these units is composed simply as a series of one or more coordinate points. For example, a line is a collection of related points, and a polygon is a collection of related lines. Vector images are defined mathematically as a series of points joined by lines. Vector-based drawings are resolution independent. This means that they appear at the maximum resolution of the output device, such as a printer or monitor. Each object is self-contained, with properties such as color, shape, outline, size, and position on the screen."
From: https://www.coris.noaa.gov/glossary/#!/
The rest of this document is the data format guide. This guide is structured to show the fundamentals of each MapServer supported data format. Each section discusses one format, ranging from one to several pages in length. The sections typically start with a summary of the most important information about the format, followed by examples of file listings, connection methods, ogrinfo usage and MapServer map file syntax examples.
Each section has been designed to stand alone, so you may notice that certain warnings and comments are repeated or redundant. This is intentional. Each format is presented in rough order of popular use, based on a survey of the MapServer community.
The following formats are included:



Data Format Types
Each type of data is made up of a data source and (one or more) layers. These two definitions apply to MapServer and OGR.
Data Source - a group of layers stored in a common repository. This may be a file that handles several layers within it, or a folder that has several files.
Layer - a sub-set of a data source often containing information in one type of vector format (point, line, polygon).
There are three types of data mapping and GIS data formats. Each type is handled differently. Below are the types and some example formats:
• File-based- Shapefiles, Microstation Design Files (DGN), GeoTIFF images
• Directory-based - ESRI ArcInfo Coverages, US Census TIGER
• Database connections - PostGIS, ESRI ArcSDE, MySQL

File-based Data
File-based data consists of one or more files stored in any arbitrary folder. In many cases a single file is used (e.g. DGN) but ESRI Shapefiles, for example, consist of at least 3 files each with a different filename extension: SHP, DBF, SHX. In this case all 3 files are required because they each perform a different task internally.
Filenames usually serve as the data source name and contain layers that may or may not be obvious from the filename. In Shapefiles, for example, there is one data source per shapefile and one layer which has the same name as that of the file.

Directory-based Data
Directory-based data consists of one or more files stored in a particular way within a parent folder. In some cases (e.g. Coverages) they may also require additional folders in other locations in the file tree in order to be accessed. The directory itself may be the data source. Different files within the directory often represent the layers of data available.
For example, ESRI ArcInfo Coverages consist of more than one file with an ADF file extension, within a folder. The PAL.ADF file represents the Polygon data. ARC.ADF holds the arc or line string data. The folder holds the data source and each ADF file is a layer.

Database Connections
Database Connections are very similar to file and directory-based structures in one respect: they provide geographic coordinate data for MapServer to interpret. That may be oversimplifying what is happening inside MapServer, but in essence all you need is access to the coordinates making up the vector datasets.
Database connections provide a stream of coordinate data that is temporarily stored (e.g. in memory) and read by MapServer to create the map. Other attribute or tabular data may also be required, but the focus of this guide is coordinate data.
One important distinction between databases must be made. The databases discuss here are spatial databases, those which can hold geographic data in its own data type. This is opposed to strictly tabular databases which cannot hold geographic coordinates in the same way. It is possible to store some very simple coordinate data in regular tables, but for anything but the most simple use a spatial database is required. There are spatial extensions to many databases (Open Source and commercial). One of the most robust is the PostGIS extension to the PostgreSQL database. This database not only allows the storage of geographic data, but also allows the manipulation of that data using SQL commands. The other Open Source database with spatial capabilities is MySQL.
Connections to databases usually consist of the following pieces of connection information:
Host - Directions to the server or computer hosting the database.



Database name - The name of the database you wish to access that is running on the host.
User name / passwords - Access privileges are usually restricted by user.


Access to specific pieces of coordinate data usually require:
Table/View name - The name of the table or view holding the coordinate data.
Geographic column name - Where the geometry or coordinates are stored.

ArcInfo
ESRI ArcInfo Coverage Files are also known as simply as Coverages and less commonly as ADF files.

File listing
Coverages are made up of a set of files within a folder. The folder itself is the coverage name. The files roughly represent different layers, usually representing different types of topology or feature types.

A folder with the name INFO is also part of the coverage. It sits at the same hierarchical level as the coverage folder itself. Therefore, to copy a coverage (using regular file system tools) the coverage folder and the INFO folder must both be copied. The INFO folder holds some catalogue information about the coverage.


Data Access / Connection Method
• CONNECTIONTYPE OGR must be used. The ability to use coverages is not built into MapServer.
• The path to the coverage folder name is required.
• The layer name (feature type) is specified in the DATA parameter

OGRINFO Examples
The directory is the data source. Layers are found within the directory. Using ogrinfo on a coverage directory:




Using ogrinfo to examine the structure of a layer:

Map File Example:


ArcSDE




WarningMapServer's native SDE driver was removed for the MapServer 7.0 release (see discussion). GDAL's ArcSDE drivers were removed in the GDAL 3.2.0 release.
Spatial Database Engine (SDE) is one of ESRI's products which enables spatial data to be stored, managed, and quickly retrieved from leading commercial database management systems like Oracle, Microsoft SQL Server, Sybase, IBM DB2, and Informix.

Supported ArcSDE Operations
• Versioned queries (query geometry and attributes from a specified version)
• queryByAttributes (select geometry and attributes based on the values of an attribute)
• Limited join support for within-database tables</li>
• queryByRect (select geometry based on an extent)
• Projection on the fly
• SDE for Coverages (a read-only type of SDE for coverage, shapefile, and ArcStorm/ArcLibrarian repositories)
• SDE 8.1, 8.2, 8.3, 9.0, 9.1, and 9.2
• Linux, Windows, and Solaris (platforms that have SDE C API support)

Unsupported ArcSDE Operations
• queryByShape (pass in a shape with MapScript and use it for queries)
• Direct Connect (bypass SDE to connect directly to the database with the SDE C API)

How to make a connection to SDE:
• Install the SDE C API client libraries for your platform (preferably matched to the server version you are using, ie 8.2 client -> 8.2 server, 8.3 client -> 8.3 server)
• Compile MapServer with SDE support MapServer Unix Compilation Howto for specific details)
• Define a LAYER block in a MapFile that uses SDE as the CONNECTIONTYPE
















(continues on next page)



(continued from previous page)

CONNECTION - Order is important!
• sdemachine.iastate.edu - The name of the machine you are connecting to. In some instances, this may need to be the IP address of the machine rather than the name if the server running MapServer is not configured to cascade DNS lookups
• port:5151 - The port number of SDE. The port: is important as SDE expects you to define the service in this slot, and it can be other names like sde:oracle (for direct connect) or esri_sde (for systems with port 5151 defined as esri_sde in /etc/services)
• sde - The database username that the SDE server is using to connect to your database. It is often only important for SDE setups that are connecting to Oracle (and even then, not so important). Just leave it as sde if you don't know what it should be.
• username - The username that will be connecting to SDE. This user must have been granted rights to select the layer that you will be specifying in the DATA directive. You can use ArcCatalog or the SDE command-line utilities to grant the appropriate rights to layers.
• password - Password of the user connecting to SDE. Case Sensitive.
DATA - Order is important!
• HOBU.STATES_LAYER - The layer name you are querying. This the full name of the table in which the layer resides. If you are using Oracle or Microsoft SQL Server as the DB for SDE, the schema name must also be supplied.
• SHAPE - The column that contains the geometry. SDE technically allows for storage of multiple geometry types in the same layer, but in practice this isn't desirable. Also, expect to have problems if there are invalid or null geometries in the layer (or versions of the layer).
• SDE.DEFAULT - As of MapServer 4.2, you can query against a specific version of the layer. SDE supports multi-user editing with versions. If a layer has been Registered with the GeoDatabase and Registered as Versioned (ArcGIS terms), MapServer can query against specified versions of those edits. If not specified, SDE.DEFAULT
will be used for all queries. Case Sensitive.






TEMPLATE
• /where/the/template/file/is/located - A template directive must be specified (can point to a dummy file) in order for MapServer to be able to query attributes from SDE. If you are only going to be drawing layers, this directive is unnecessary and will slow down the query operations of SDE (especially for layers with lots of attribute columns).

PROCESSING
• PROCESSING "QUERYORDER=ATTRIBUTE" - Allows you to force SDE to use the WHERE clause that was defined in your FILTER statement first, without attempting to hit the spatial index. Only in very special cases will you want to do this.
• PROCESSING "OBJECTID=OBJECTID" - If you are having trouble with the SDE driver detecting your unique ID column, you can override it with this processing parameter. Doing so will also have a slight perfor- mance benefit because it will save a couple of extra queries to the database.
• PROCESSING "ATTRIBUTE_QUALIFIED=TRUE" - User can set this option to always use fully qualified attribute names.

Within-database Join Support
MapServer's SDE driver, as of MapServer 5.0, allows you to join a single attribute table that has no geometries to the layer that you are rendering. This feature allows you to use the data in the joined table much as you would in a composite query that was made with something like PostGIS or Oracle Spatial. That is, the columns in the right table of the join are available for CLASSITEM, LABELITEM and so on. The biggest constraint, however, is that fully qualified names must be used or it most likely will not work. The join support is activated through PROCESSING options.
• PROCESSING "JOINTABLE=SDE_MASTER.GEOSERVWRITE.JOINTABLE" - The JOINTABLE
processing option tells the driver which table you are joining the current layer to.
• CLASSITEM "SDE_MASTER.GEOSERVWRITE.JOINTABLE.VAL" - A CLASSITEM or LABELITEM
for a joined table using this mechanism must be fully qualified.
• FILTER "SDE_MASTER.GEOSERVWRITE.JOINTABLE.AQ_TAG=SDE_MASTER.GEOSERVWRITE.JOINTESTL
- An important part of the join is defining how the join is to be made. Use a FILTER to do so.

Contour
1. Overview
MapServer (since version 6.4) can compute and render a contour layer on the fly from a raster source. The raster source is one band of raster data, which represents a digital elevation model (DEM). More info about DEMs at: https:
//en.wikipedia.org/wiki/Digital_elevation_model

2. How it works
CONNECTIONTYPE CONTOUR. The new (to MapServer 6.4) type is a hybrid layer, which has a raster data source as input and vector features as output. Initially, only the line representation of those vector features will be supported. More detailed information about the original implementation can be found in RFC 85.
Since the internal layer is of type vector, queries will be supported and operate on the vectors (not on the raw raster source). In the future we might see a need to add a query mode that queries the raster source, but this is not included in this phase of work.



To render a contour layer, we need to define a layer in the mapfile with the following options:
• Set the layer TYPE to LINE.
• Set CONNECTIONTYPE to CONTOUR.
• Set the DATA to the raster file that contains the elevation band. Starting with MapServer 7.0.1, a TILEINDEX can also be used, together with WMS Time to specify which raster of the tileindex must be used.
• Specify the band to use as elevation using PROCESSING "BANDS", same as regular raster.
   • Specify one or more classes and styles to render the line features. PROCESSING settings:
These options should be specified at layer level:
• CONTOUR_INTERVAL: elevation interval between contours
• CONTOUR_LEVELS: comma-separated list of one or more 'fixed levels' to extract
• CONTOUR_ITEM: provides a name for the item (attribute) in which to put the elevation. (optional)
You can also provide explicit min/max scaledenom in the CONTOUR_iNTERVAL or CON- TOUR_LEVELS values if you wish to use scale-dependent contour spacing. This is done by adding an optional "miscaledenom,maxscaledenom:" prefix to the value or list of values. See the example below.

WarningIf you only set a single CONTOUR_INTERVAL for all scale ranges, MapServer will likely crash at outer scale ranges (first example below). More recent GDAL versions (such as 3.2.0) will output an error message such as: "Input values and/or interval settings would lead to too many levels". To avoid this, set multiple CON- TOUR_INTERVAL lines to handle various scale ranges (see the working Copernicus DEM example below, with output map images).
Example of a simple layer definition:

Example of a layer definition with scale-dependent contour ranges:





Example of a layer definition with a tile index and WMS TIME support:

Example of a layer definition with scale-dependent contour ranges & Copernicus EU DEM data:





Figure: contours zoomed-out to coastline (Corsica island) generated from Copernicus EU DEM








Figure: contours zoomed-in (Corsica island) generated from Copernicus EU DEM





2.1 Data cellsize
The data produced by the gdal contour algorithm are generally in high resolution. A lot of point are used to generated contours with precision. You might want to generalize/simplify the line in some cases (ie. Shape Smoothing). The [data_cellsize] attribute binding represents the cellsize of the extend fetched from the raster file. This is different than the map cellsize.
In the following example, I generalize my shape with a tolerance of 25% of the data cellsize to produce smooth contours at all scales:




DGN
File listing
Data are encapsulated in a single file, usually with the suffix .dgn.


Data Access / Connection Method
• Access is available in MapServer through OGR.
• The CONNECTIONTYPE OGR parameter must be used.
• The path to the dgn file is required, file extension is needed.
• All types of features in a DGN file are held in one "layer" of data. The layer is called elements and is the first and only layer.
• The type of feature to be read from the DGN depends on the TYPE parameter in the map file.
• DGN files typically contain POINT, LINE, POLYGON and ANNOTATION feature types.
• DGN files contain "styling" information - how to color and present the data. This is used, optionally, by specifying the STYLEITEM "AUTO" parameter.


OGRINFO Examples
Using ogrinfo on a single DGN file:



DGN files are not really GIS data files. They evolved from drafting formats used by computer aided drafting/design (CADD) programs.
They carry a few key attributes which are usually consistent across all DGN files. Most of the attributes relate to graphical styling of features for map presentation, such as ColorIndex, Style, etc.
Spatial reference system information is not always encoded into DGN files. This can be a major problem when trying to adequately reference the DGN data in another mapping program.



Measurement units can be a problem. In some cases the features could be located in kilometers or feet even though it is not obvious from the output of ogrinfo. Sometimes the only way to identify or correct a problem with units is to open the file in Microstation software.
Using ogrinfo to examine the structure of the file/layer:

Map File Example:


ESRI File Geodatabase
ESRI File Geodatabases exist in a file folder and offer improved performance and size limitations. For more information see the ESRI description page.






File listing
File geodatabases are made up of a set of files within a folder. The files are made up of geographic data, attribute data, index files, and lock files. A better description of the file contents can be found here.

Data Access / Connection Method
File geodatabase access is available through OGR. See the OGR driver page for FileGDB for specific driver information. The driver is available for GDAL >= 1.9.0. You may also see the the OGR driver page for OpenFileGDB which provides read-only access and does not require an external SDK to compile.


The CONNECTION parameter must be used to point to the name of the file folder, and the DATA parameter should be the name of the spatial table (or OGR layer).



OGRINFO Examples
First you should make sure that your GDAL/OGR build contains the file geodatabase "FileGDB" driver (or the "Open- FileGDB" driver), by using the '-formats' command:

If you don't have the driver, see GDAL's Building from source page for compiling the driver.
Once you have the FileGDB driver you are ready to try an ogrinfo command on your database to get a list of spatial tables. In the example below our folder is named us_states.gdb:





Now use ogrinfo to get information on the structure of the statesp020 table:


Mapfile Example





















(continues on next page)



(continued from previous page)

ESRI Personal Geodatabase (MDB)
ESRI Personal Geodatabases are basically Microsoft Access files that contain spatial information. For more information see the ESRI description page.

File listing
Similar to other database formats, the mdb file consists of several tables. The geometry is held in a BLOB table column.

Data Access / Connection Method
Personal geodatabase access is available through OGR. See the OGR driver page for specific driver information. The driver is standard in any win32 build of GDAL/OGR version 1.3.2 or later. For Linux/Unix, MDBTools ODBC drivers can be used for this (with some difficulty).
OGR uses the names of spatial tables within the personal geodatabase (tables with a Shape column) as layers.
The CONNECTION parameter must include the mdb extension, and the DATA parameter should be the name of the spatial table (or OGR layer).


OGRINFO Examples
First you should make sure that your GDAL/OGR build contains the personal geodatabase "PGeo" driver, by using the '-formats' command:

If you don't have the driver, you might want to try the FWTools or MS4W packages, which include the driver.
Once you have the PGeo driver you are ready to try an ogrinfo command on your database to get a list of spatial tables:

Now use ogrinfo to get information on the structure of the spatial table:





Note that you can also use an ODBC connection to access all of the tables in your geodatabase:

(where "testDSN" is the name of your System DSN)

Mapfile Example Direct Access to MDB












(continues on next page)



(continued from previous page)

Through an ODBC Connection


ESRI Shapefiles (SHP)
Also known as just 'Shapefiles', or ESRI ArcView Shapefiles. Esri is the software company that introduced this format. ArcView was the first product to use shapefiles.

File listing
Shapefiles are made up of a minimum of three similarly named files, with different suffixes:


Data Access / Connection Method
Shapefile access is built directly into MapServer. It is also available through OGR, but direct access without OGR is recommended and discussed here. The path to the shapefile is required (relative to the SHAPEPATH). Specifying the ".shp" extension is recommended. Shapefiles only hold one layer of data, therefore no distinction needs to be made (as is required for other OGR vector formats that can contain many layers).

OGRINFO Examples
• The directory can serve as a data source.
• Each shapefile in a directory serves as a layer.
   • A shapefile can also be a data source. In this case the layer has the same prefix as the shapefile. Using ogrinfo on a directory with multiple shapefiles:





Using ogrinfo on a single shapefile:

Using ogrinfo to examine the structure of the file/layer:

Map File Example:












(continues on next page)



(continued from previous page)

FlatGeobuf
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2022-08-12

FlatGeobuf is an optimized binary encoding for vectors based on Flatbuffers, that focuses on read/query performance by leveraging a Packed Hilbert R-Tree spatial index, that enables fast bounding box spatial filtering. FlatGeobuf per- formance has helped make it become one of the chosen formats for streaming spatial data through HTTP / "the cloud".




More Information
More information about FlatGeobuf is available at https://github.com/flatgeobuf/flatgeobuf

File listing
FlatGeobuf files are usually a single binary file with a FGB filename extension, such as:



Data Access / Connection Method
Here are some rudimentary map draw speed results, with the MapServer 8.0 release code (running on Windows with MS4W):


Method 1: Direct connection (native access)


See alsorfc137
Native access is available since the MapServer 8.0.0 release, that uses code within the MapServer source to access the FGB file directly, as follows:





Method 2: Connect through OGR
FlatGeobuf access is also available in MapServer through OGR's FlatGeobuf driver. You must use GDAL version 3.1.0 or later for FlatGeobuf access.
OGR uses the names of spatial layers within the FlatGeobuf file as layers.
The CONNECTION parameter must include the .fgb extension, and the DATA parameter should be the name of the OGR layer.



Step 1: Use ogrinfo to examine
First you should make sure that your local GDAL/OGR build contains the "FlatGeobuf" driver, by using the -formats
command:

Once you have confirmed that you have the FlatGeobuf driver, you are ready to try an ogrinfo command on your file to get a list of spatial layers:

Now use ogrinfo to get information on the structure of the spatial 'countries' layer:



(continued from previous page)
Extent: (-180.000000, -90.000000) - (180.000000, 83.645130)
Layer SRS WKT:
GEOGCRS["WGS 84",
ENSEMBLE["World Geodetic System 1984 ensemble", MEMBER["World Geodetic System 1984 (Transit)"], MEMBER["World Geodetic System 1984 (G730)"], MEMBER["World Geodetic System 1984 (G873)"], MEMBER["World Geodetic System 1984 (G1150)"], MEMBER["World Geodetic System 1984 (G1674)"], MEMBER["World Geodetic System 1984 (G1762)"], MEMBER["World Geodetic System 1984 (G2139)"], ELLIPSOID["WGS 84",6378137,298.257223563,
    LENGTHUNIT["metre",1]], ENSEMBLEACCURACY[2.0]],
PRIMEM["Greenwich",0, ANGLEUNIT["degree",0.0174532925199433]],
CS[ellipsoidal,2],
AXIS["geodetic latitude (Lat)",north, ORDER[1], ANGLEUNIT["degree",0.0174532925199433]],
AXIS["geodetic longitude (Lon)",east, ORDER[2], ANGLEUNIT["degree",0.0174532925199433]],
USAGE[
SCOPE["Horizontal component of 3D system."], AREA["World."],
    BBOX[-90,-180,90,180]], ID["EPSG",4326]]
Data axis to CRS axis mapping: 2,1 featurecla: String (0.0)
scalerank: Integer (0.0)
labelrank: Integer (0.0)
sovereignt: String (0.0)
sov_a3: String (0.0)
adm0_dif: Integer (0.0)
level: Integer (0.0)
type: String (0.0)
...

Step 2: Add the layer in your mapfile Method 1: Direct connection (native access)
Available since the 8.0.0 release, MapServer can access the FGB file directly, as follows:



(continued from previous page)

Method 2: Connect through OGR
For OGR connections, it is always recommended to set CONNECTIONTYPE, CONNECTION, and DATA, as follows:


Step 3: Test your Mapfile with map2img
Use the MapServer commandline utility map2img to verify that your mapfile creates a valid map image, and also display draw times, such as:













Optional: Configure your WFS service to Output FlatGeoBuf



Since MapServer 6.0, you can configure an OUTPUTFORMAT for your WFS (or WMS) service, for an OGR connec- tion. See the OGR Output document for more information.
First, you must specify the OUTPUTFORMAT in your mapfile, for FlatGeobuf such as:

Next, you must specify that OUTPUTFORMAT using the wfs_getfeature_formatlist metadata parameter, at the LAYER level, such as:



(continues on next page)



(continued from previous page)
Verify that OUTPUTFORMAT through a GetCapilities request, and look for the GetFeature/ResultFormat section, such as:

Which gives a response containing:

Once we see the OGRFLATGEOBUF in the GetCapabilities response, then we can add &OUTPUTFOR- MAT=OGRFLATGEOBUF to the end of any WFS GetFeature request, such as:






(continues on next page)



(continued from previous page)
and a file named result.fgb will be returned.

GML
Also known as Geographic Markup Language and GML/XML. GML is a text-based, XML format that can represent vector and attribute data. This is an Open Geospatial Consortium specification for data interchange. More information is available at https://www.ogc.org/standards/gml

File listing
GML files are usually a single text file with a GML filename extension. Some may use XML as the filename extension:

XML schema documents often accompany GML files that have been translated from some other format (e.g. using the ogr2ogr utility).
GML uses sets of nested tags to define attributes and geometry coordinates. Example of text in a GML file:


Data Access / Connection Method
• GML access is available in MapServer through OGR. More information on OGR GML support is available at https://gdal.org/drivers/vector/gml.html
• The CONNECTIONTYPE OGR parameter must be used.
• The path to the GML file is required, including file extension. There can be multiple layers in a GML file, including multiple feature types.



OGRINFO Examples
Using ogrinfo on a single GML file:

Using ogrinfo to examine the structure of one layer:

Map File Example:




GeoJSON
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2021-09-15
GeoJSON is a text-based, open standard format that can represent vector points, lines, polygons, and multi-part collec- tions. Officially, it is a geospatial data interchange format based on JavaScript Object Notation (JSON). GeoJSON is a specification as part of the Internet Engineering Task Force (IETF).

More Information
More information about GeoJSON is available at:
• Official page: https://geojson.org/
• Specification: https://datatracker.ietf.org/doc/html/rfc7946

File listing
GeoJSON files are usually a single text file with a JSON filename extension, such as:

You can open that file in a text editor, and it will look something like:










Data Access / Connection Method
• GeoJSON access is available in MapServer through OGR's GeoJSON driver.
• The CONNECTIONTYPE OGR parameter must be used.
• The path to the GeoJSON file is required, including the file extension.


Step 1: Use ogrinfo to examine
Using ogrinfo on the GeoJSON file:

Using ogrinfo to examine the structure of the countries layer:
> ogrinfo countries.json countries -summary
INFO: Open of 'countries.json'
using driver 'GeoJSON' successful.

Layer name: countries Geometry: Multi Polygon Feature Count: 177
Extent: (-180.000000, -90.000000) - (180.000000, 83.645130)
Layer SRS WKT:
GEOGCS["WGS 84", DATUM["WGS_1984",
SPHEROID["WGS 84",6378137,298.257223563, AUTHORITY["EPSG","7030"]],
AUTHORITY["EPSG","6326"]],
PRIMEM["Greenwich",0, AUTHORITY["EPSG","8901"]],
UNIT["degree",0.0174532925199433, AUTHORITY["EPSG","9122"]],
AUTHORITY["EPSG","4326"]]
featurecla: String (0.0)
scalerank: Integer (0.0)
labelrank: Integer (0.0)
sovereignt: String (0.0)
sov_a3: String (0.0)
adm0_dif: Integer (0.0)
(continues on next page)



(continued from previous page)

Step 2: Add the layer in your mapfile
For OGR connections, it is always recommended to set CONNECTIONTYPE, CONNECTION, and DATA, as follows:


Step 3: Test your Mapfile with map2img
Use the MapServer commandline utility map2img to verify that your mapfile creates a valid map image, and also display draw times, such as:















GeoPackage
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2022-04-25
GeoPackage, also written as "GPKG", is a standards-based wrapper for the file-based SQLite database. GPKG is an encoding standard adopted by the Open Geospatial Consortium back in 2014, and has since gained popularity for distributing both vector & raster data, inside one compact file.





More Information
More information about GPKG is available at:
• Official page: https://www.geopackage.org/
• OGC's GeoPackage Encoding Standard: https://www.ogc.org/standards/geopackage

File listing
Similar to other database formats, the .gpkg file consists of several tables. The geometry is held in a BLOB table column.


Data Access / Connection Method
GPKG access is available in MapServer through OGR's GPKG driver. It is recommended to use GDAL/OGR version
2.2 or later for GPKG access.
OGR uses the names of spatial tables within the GPKG database (tables with a geometry column that are registered in the geometry_columns table) as layers.
The CONNECTION parameter must include the .gpkg extension, and the DATA parameter should be the name of the spatial table (or OGR layer).







Step 1: Use ogrinfo to examine
First you should make sure that your local GDAL/OGR build contains both the "GPKG" driver & the "SQLite / Spa- tialite" driver, by using the -formats command:

Once you have confirmed that you have the GPKG driver you are ready to try an ogrinfo command on your database to get a list of spatial tables:

Now use ogrinfo to get information on the structure of the spatial 'countries' table:

























(continues on next page)



(continued from previous page)
You can also use ogrinfo to verify that your GPKG table's geometry has a spatial index, which is very important for performance (look for HasSpatialIndex (Integer) = 1 to confirm that the spatial index exists) :

If you need to create add a spatial index to your GPKG, you can also use ogrinfo :

If you are going to have MapServer filter or query a specific field in your GPKG, you should also consider adding an attribute index for that field:


Step 2: Add the layer in your mapfile
For OGR connections, it is always recommended to set CONNECTIONTYPE, CONNECTION, and DATA, as follows:




Step 3: Test your Mapfile with map2img
Use the MapServer commandline utility map2img to verify that your mapfile creates a valid map image, and also display draw times, such as:









GPS Exchange Format (GPX)
GPX (the GPS Exchange Format) is a light-weight XML data format containing GPS data (waypoints, routes, and tracks). For more information see the official GPX site.

File listing
All waypoints, routes, and tracks are stored in a single .gpx file.

Data Access / Connection Method
• GPX access is available through OGR. See the OGR driver page for specific driver information.
• A relative path to the .gpx file can be used in the mapfile LAYER's CONNECTION string.
• The feature type is specified in the DATA parameter



- the "tracks" feature type will usually be the track line
- the "track_points" feature type will usually be the points that make up the track line

OGRINFO Examples
First you should make sure that your GDAL/OGR build contains the "GPX" driver, by using the '-formats' command:

If you don't have the driver, you might want to try the FWTools or MS4W packages, which include the driver. Once you have the GPX driver you are ready to try an ogrinfo command on your file to get a list of feature types:

Now use ogrinfo to get information on one of the feature types:






















(continues on next page)



(continued from previous page)

Mapfile Example
Since you have confirmed that OGR can read your GPX file, now you can create a MapServer layer:


Inline
Inline features refer to coordinates entered directly into the map file. They are not a file or database format and do not require any DATA or CONNECTION parameters. Instead they use a FEATURE section to define the coordinates.
Inline features can be used to define points, lines and polygons as if taken from an external file. This requires direct entry of coordinate pairs in the mapfile using a particular syntax.

Data Access / Connection Method
This is a native MapServer option that doesn't use any external libraries to support it.

Mapfile Example Points
• Each FEATURE..END section defines a feature.
• Multiple points can be defined in a FEATURE section. If multiple points are defined in the same layer, they will have the same CLASS settings, e.g. for colours and styles.



• Coordinates are entered in the units set in the layer's projection. In this case it is assuming the mapfile projection is using decimal degrees.













69.4335.1571.2137.9572.0238.60











Lines
Lines are simply a list of points strung together, but the layer must be TYPE LINE instead of TYPE POINT.








72.3633.8270.8534.3269.4335.1570.8236.0870.9037.0571.2137.95





(continues on next page)



(continued from previous page)

Polygons
Polygons are the same as the line example, just a list of points. They require the TYPE POLYGON parameter. Polygons also require the final coordinate pair to be the same as the first, making it a closed polygon.

KML - Keyhole Markup Language

Keyhole Markup Language (KML) is an XML-based language for managing the display of 3D geospatial data. KML is a standard maintained by the Open Geospatial Consoritum (OGC).

Links to KML-Related Information
• Google's KML Reference
• OGC's KML Specification
• KML Validator

Data Access / Connection Method
KML access in MapServer is available through OGR. See the OGR driver page for specific driver information. Read support was initially added to GDAL/OGR version 1.5.0. A more complete KML reader was added to GDAL/OGR in version 1.8.0, through the libKML driver (including the ability to read multigeometry, and KMZ files).
The CONNECTION parameter must include the kml or kmz extension, and the DATA parameter should be the name of the layer.




Example 1: Displaying a .KML file OGRINFO
First you should make sure that your GDAL/OGR build contains the "KML" driver, by using the '-formats' command:

If you don't have the driver, you might want to try the FWTools or MS4W packages, which include the driver.
Once you have the KML driver you are ready to try an ogrinfo command on your file to get a list of available layers:

Now use ogrinfo to get information on the structure of the layer:




Mapfile Example


Example 2: Displaying a .KMZ file OGRINFO
First you should make sure that your GDAL/OGR build contains the "LIBKML" driver, by using the '-formats' com- mand:

If you don't have the driver, you might want to try the FWTools or MS4W packages, which include the driver. Or you can follow the Building from source for libKML and GDAL/OGR.
Once you have the LIBKML driver you are ready to try an ogrinfo command on your file to get a list of available layers:




Now use ogrinfo to get information on the structure of the layer:
>ogrinfo Lunenburg_Municipality.kmz Lunenburg_Municipality -summary
INFO: Open of 'Lunenburg_Municipality.kmz'
using driver 'LIBKML' successful.

Layer name: Lunenburg_Municipality Geometry: Unknown (any)
Feature Count: 1
Extent: (-64.946433, 44.133207) - (-64.230281, 44.735125)
Layer SRS WKT:
GEOGCS["WGS 84", DATUM["WGS_1984",
SPHEROID["WGS 84",6378137,298.257223563, AUTHORITY["EPSG","7030"]],
TOWGS84[0,0,0,0,0,0,0],
AUTHORITY["EPSG","6326"]],
PRIMEM["Greenwich",0, AUTHORITY["EPSG","8901"]],
UNIT["degree",0.0174532925199433, AUTHORITY["EPSG","9108"]],
AUTHORITY["EPSG","4326"]]
Name: String (0.0)
description: String (0.0)
timestamp: DateTime (0.0)
begin: DateTime (0.0)
end: DateTime (0.0)
altitudeMode: String (0.0)
tessellate: Integer (0.0)
extrude: Integer (0.0)
visibility: Integer (0.0)

Mapfile Example




Example 3: Displaying a "Superoverlay" KML file
A superoverlay is a KML file that contains tiled data, that is broken up into "regions"; this is an efficient way to display large images. For more background on superoverlays see the Google Developers KML Tutorial.
MapServer can access superoverlays through GDAL.


GDALINFO
First you should make sure that your GDAL/OGR build contains the "KMLSUPEROVERLAY" driver, by using the '-formats' command:

If you don't have the driver, you might want to check if your platform has a ready-to-use package/installer (Windows users please see MS4W), which include the driver.


Now use gdalinfo to get information on the structure of the layer:















(continues on next page)



(continued from previous page)
AUTHORITY["EPSG","9122"]],
AUTHORITY["EPSG","4326"]]
Origin = (-122.129312658577720,37.439803353779496) Pixel Size = (0.000004270647777,-0.000004095141704)
Metadata:
DESCRIPTION=The original is a 7008 x 6720 DOQQ of Mountain View in 1991. (Source: http://gis.ca.gov/). This is a Region NetworkLink hierarchy of 900+
GroundOverlays each of 256 x 256 pixels arranged in a hierarchy such that more detailed images are loaded and shown as the viewpoint nears.
Enable the "Boxes" NetworkLink to see a LineString for
each Region. Tour the "Boxes" to visit each tile. Visit the "A" and "B" Placemarks to see multiple levels of
hierarchy together. Use the slider on various images in the hierarchy to see how the resolution varies and of the entire hierarchy to see the imagery below. (Find the Google Campus...).

  NAME=SuperOverlay: MV DOQQ Image Structure Metadata:
INTERLEAVE=PIXEL
Corner Coordinates:
Upper Left (-122.1293127, 37.4398034) (122d 7'45.53"W, 37d26'23.29"N) Lower Left (-122.1293127, 37.3727086) (122d 7'45.53"W, 37d22'21.75"N) Upper Right (-122.0593424, 37.4398034) (122d 3'33.63"W, 37d26'23.29"N) Lower Right (-122.0593424, 37.3727086) (122d 3'33.63"W, 37d22'21.75"N) Center   (-122.0943275, 37.4062560) (122d 5'39.58"W, 37d24'22.52"N)
Band 1 Block=256x256 Type=Byte, ColorInterp=Red
Overviews: 8192x8192, 4096x4096, 2048x2048, 1024x1024, 512x512, 256x256
Mask Flags: PER_DATASET ALPHA
  Overviews of mask band: 8192x8192, 4096x4096, 2048x2048, 1024x1024, 512x512, 256x256 Band 2 Block=256x256 Type=Byte, ColorInterp=Green
Overviews: 8192x8192, 4096x4096, 2048x2048, 1024x1024, 512x512, 256x256
Mask Flags: PER_DATASET ALPHA
  Overviews of mask band: 8192x8192, 4096x4096, 2048x2048, 1024x1024, 512x512, 256x256 Band 3 Block=256x256 Type=Byte, ColorInterp=Blue
Overviews: 8192x8192, 4096x4096, 2048x2048, 1024x1024, 512x512, 256x256
Mask Flags: PER_DATASET ALPHA
  Overviews of mask band: 8192x8192, 4096x4096, 2048x2048, 1024x1024, 512x512, 256x256 Band 4 Block=256x256 Type=Byte, ColorInterp=Alpha
Overviews: 8192x8192, 4096x4096, 2048x2048, 1024x1024, 512x512, 256x256

Mapfile Example
Finally, access the superoverlay image through a MapServer layer with TYPE RASTER, as you would other rasters, such as:







(continues on next page)



(continued from previous page)

Test Your Mapfile with the map2img Command
The easiest way to test your superoverlay mapfile is with the MapServer map2img utility.

The following map image should be generated:










See alsoDebugging MapServer
MapInfo File listing
The following files are also associated with .TAB files: .DAT, .ID, .MAP. An example is:

The term MID/MIF refers to files with .MID and .MIF extension.

Data Access / Connection Method
TAB and MID/MIF access is available in MapServer through OGR.
• The CONNECTIONTYPE OGR parameter must be used.
• The path to the (*.tab or *.mif) file is required, and the file extension is needed.
• The path may be relative to the SHAPEPATH
• MapInfo files already contain styling information. This styling information can be used optionally by specifying the STYLEITEM "AUTO" parameter in the LAYER object of the map file.




OGRINFO Examples
Using ogrinfo on a single TAB file

Using ogrinfo to examine the structure of the file/layer


MapFile Example




MSSQL
Author
Tamas Szekeres
Contact
szekerest at gmail.com
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Author
Seth Girvin
Contact
sethg at geographika.co.uk
Last Updated
2024-09-22


Introduction
Microsoft SQL Server supports storing spatial data by using the built-in geometry/geography data types. MapServer can connect to MSSQL through either: 1) an OGR connectiontype, or 2) a driver that accesses these tables containing spatial columns, which is compiled as a plugin ("msplugin_mssql2008.dll").






More Information:
• OGR MSSQL Spatial driver page (describes the OGR MSSQL support)
• ogr2ogr application (describes the ogr2ogr commandline application)
• Vector Data (MapServer Vector Data Access Guide)

Creating Spatial Data Tables in MSSQL
There are several ways to create spatial data tables in MSSQL. You can easily upload existing data to an MSSQL table by using the ogr2ogr command line tool and the OGR's MSSQL Spatial driver. Here is an example that uploads a shapefile (province.shp) into an MSSQL instance:


Connecting to Spatial Data in MSSQL
In order to connect to a MSSQL spatial database you should set up a valid connection string to the database like the following examples:



If you don't specify Driver in the connection string, it uses the "SQL Server" driver (sqlsrv32.dll) which was last updated in 2010. To use a newer driver you can specify this in the connection string:

The "SQL Server Native Client" drivers are also supported.

OPTION 1: Connect Through OGR
GDAL/OGR (and therefore MapServer) can read spatial tables in MSSQL 2008 through the MSSQLSpatial driver.

Verify Local Support for MSSQLSpatial
Use the command ogrinfo --formats to verify that your local GDAL is built with support for MSSQL; the response should contain "MSSQLSpatial" such as:






Test OGR Connection Parameters
Use the ogrinfo command line utility to test your connection through the MSSQLSpatial driver, such as:


Create MapServer Layer using CONNECTIONTYPE OGR
Your layer should contain a CONNECTIONTYPE OGR statement, as well as a CONNECTION. The connection should also contact a "tables=" parameter, and also the name of the geometry column in brackets. You do not need to specify the DATA parameter unless you define an SQL select statement starting with the 'WHERE' keyword. For example:







OPTION 2: Connect Through MapServer Plugin
As of MapServer 8.0 plugins can only be used when referenced in the MapServer CONFIG file. The PLUGINS section needs to contain a key - a name for the driver, and a the path to the DLL. For example:

The key mssql can then be used in any mapfile to refer to this DLL. Controlling which DLLs are loaded by MapServer in the CONFIG file prevents mapfiles from loading potentially dangerous DLLs.

Create MapServer Layer
Once the connection can be established to the server the layer can be configured to access MSSQL as follows:

The DATA parameter is used to perform the SQL select statement to access your table in MSSQL. The geometry column is required in the select statement; in the above example the ogr_geometry column is the geometry column in the rivers table. The table should also have an unique column (ogr_fid) which is provided for random access to the features in the feature query operations.
The DATA section should also contain the spatial reference id (SRID) of the features in the data table The SRID is used when specifying the search shapes during the intersect operations which should match with the SRID of the features otherwise no features are returned in a particular query. If you omit specifying the SRID value in the DATA section the diver will use SRID=0 when defining the search shapes.

Selecting the Type of the Geometry Column
For the geometry columns MSSQL supports 2 data types: "geometry" and "geography". By default the driver considers the type of the geometry column is "geometry". In case if the type of the geometry column is "geography" we must specify the data type in the DATA section explicitly, like:




Expected Location of the MSSQL Plugin
On Windows platforms the DLLs needed by the program are searched for in the following order:
1) The directory from which the application loaded.
2) The current directory.
3) The system directory. Use the GetSystemDirectory function to get the path of this directory.
4) The 16-bit system directory.
5) The Windows directory. Use the GetWindowsDirectory function to get the path of this directory.
6) The directories that are listed in the PATH environment variable.

Binaries Containing the MSSQL Plugin
Currently the following binary distributions contain msplugin_mssql2008.dll:
• GISInternals
• MS4W

Using Spatial Indexes
In order to speed up the access to the features a spatial index should be created to the geometry column which could easily be done with the OGR MSSQL Spatial driver like:

In general we can safely rely on the query optimizer to select the most appropriate index in the SQL query operations. In some cases - however - we should force the optimizer to use the spatial index by specifying the index hint in the DATA section like:


Layer Processing Options
We can control the behaviour of the MSSQL driver by using the following PROCESSING options:
• CLOSE_CONNECTION=DEFER - This is where you can enable connection pooling for certain layer types. Connection pooling will allow MapServer to share the handle to an open database or layer connection throughout a single map draw process.
• MSSQL_READ_WKB=TRUE - Uses WKB (Well Known Binary) format instead of native format when fetch- ing geometries.

MySQL
Author
David Fawcett
Contact
david.fawcett at moea.state.mn.us
Author
Jeff McKenna



Contact
jmckenna at gatewaygeomatics.com
Last Updated
2021-05-05


Introduction
The following methods connect to MySQL through OGR's MySQL driver, thus avoiding the need to set up an ODBC connection.
More Information:
• OGR Vector Layers Through MapServer (MapServer OGR document)
• Vector Data (MapServer Vector Data Access Guide)
• MySQL wiki page (describes the deprecated mygis support)

Connecting to Spatial Data in MySQL
This section describes how to display a spatial MySQL table (meaning that the table has a column of type geometry) in MapServer. OGR's MySQL driver was expanded in OGR version 1.3.2 to support access to MySQL spatial tables.

Requirements
• MapServer compiled with OGR support
• OGR/GDAL version 1.3.2 or more recent compiled with MySQL support



Verify MySQL Support in OGR Build
You can verify that your local build of OGR contains MySQL support by using the ogrinfo commandline utility, and making sure that "MySQL" is returned:


Test Connection with ogrinfo
MySQL connection strings in OGR are in the following format:

Therefore an example ogrinfo command would be:

which should return a list of all of your tables in the 'test' database:

and you can return a summary of the MySQL spatial layer:




Create MapServer Layer

The DATA parameter is used to perform the SQL select statement to access your table in MySQL. The geometry column is required in the select statement; in the above example the SHAPE column is the geometry column in the province table.

Connecting to non-Spatial Data in MySQL
This section describes how to display a non-spatial MySQL table (meaning the table does not have a column of type geometry) in MapServer.
Support for this functionality is found in GDAL/OGR 1.2.6 and older on Windows and GDAL/OGR 1.3.2 on Linux.

Requirements
• MySQL database containing a table with fields containing x and y coordinates
• .ovf file, a small xml file you will create
• MapServer compiled with OGR version supporting this functionality

Create .ovf file
Here is the .ovf file named aqidata.ovf




(continues on next page)



(continued from previous page)
If you look at the connection string in <SrcDataSource>
• The MySQL database name is 'aqiTest'
• 'testdata' is the table containing the coordinate data
• host and port are for MySQL server
Use the GeometryField element to tell OGR which fields store the x and y coordinate data. Mine are simply named x and y.

Test Connection with ogrinfo

ogrinfo returns

Don't worry about the error, this is just telling you that it is a read-only driver. If it really bugs you, call ogrinfo with the -ro (read only) flag.
To see the actual data


Create MapServer Layer




DATA in the LAYER definition should be the same as the name attribute of the OGRVRTLayer element in the ovf file.
For this to draw, you need to have a SYMBOLSET defined in your mapfile and have a symbol called 'circle' in your symbols.sym file.

NTF
NTF files are mostly used by the United Kingdom Ordnance Survey (OS). For more on the Ordnance Survey, see their website at: https://ordnancesurvey.co.uk/

File listing
NTF files have an NTF extension.

Data Access / Connection Method
• NTF access requires OGR's UK .NTF driver.
• The path to the NTF file is required in the CONNECTION string. It may be relative to the SHAPEPATH setting in the mapfile or the full path.
• The DATA parameter is used to specify the layer to use

OGRINFO Examples
Using ogrinfo on an NTF file to retrieve layer names:

Using ogrinfo to examine the structure of an NTF layer:
















(continues on next page)



(continued from previous page)
Mapfile Example:


OGR Vector Layers Through MapServer
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2021-05-06

Table of Contents• OGR Vector Layers Through MapServer


- Introduction
- What is OGR?
* What Does OGR Add to MapServer?
* What Data Formats are Supported?
* How to Get More Information on the OGR Project
- Obtaining and Compiling MapServer with OGR Support
- Integrating OGR Support with MapServer Applications
* Using OGR Data Sources in the Map File
* Examples of Layer Definitions Using OGR
* How to Use "OGRINFO"
* Queries Through OGR Format
* TILEINDEX with OGR
* Connection Pooling
- STYLEITEM "AUTO" - Rendering Layers Using Style Information from the OGR File
* How to Implement
* Examples
* Important Notes
* Mapping of OGR Style Info to the MapServer CLASS Members
* Accessing OGR STYLEITEMAUTO Label Styles Through MapScript
- Sample Sites Using OGR/MapServer
- FAQ / Common Problems
- Credits


Introduction
MapServer includes the ability to access vector data sets in formats other than Shapefile in their native format using the OGR library. The following document describes the process for implementing OGR support within MapServer applications.
This document assumes that you are already familiar with certain aspects of MapServer:
• MapServer application development and especially setting up .map files.
• Some compilation skills if you don't have ready access to a pre-compiled installation and need to compile your own copy of MapServer with OGR support.
• access to OGR utilities, such as ogrinfo (for Windows users these are included in MS4W).
Readers should also check out the Vector Data Access Guide, which has lots of examples of how to access specific vector formats.



What is OGR?
The OGR Simple Features Library is a C++ Open Source library (and command-line tools) providing read (and some- times write) access to a variety of vector file formats including ESRI Shapefiles, and MapInfo mid/mif and TAB formats.
OGR is actually part of the GDAL library, so you will notice that some references point to GDAL (such as the mailing list).

What Does OGR Add to MapServer?
The OGR Simple Features Library allows MapServer users to display several types of vector data files in their native formats. For example, MapInfo Mid/Mif and TAB data do not need to be converted to ESRI shapefiles when using OGR support with MapServer.

What Data Formats are Supported?



Here is a list of some of the popular vector formats that are supported:
• ArcInfo Binary Coverages
• ArcInfo E00 Coverages
• Atlas BNA (see GDAL extra-drivers)
• Comma Separated Value (.csv)
• DODS/OPeNDAP
• ESRI Personal GeoDatabase
• ESRI Shapefiles
• FMEObjects Gateway
• Géoconcept Export
• GeoJSON
• GeoPackage
• GeoRSS
• GML
• GMT
• GRASS
• GPX
• Informix DataBlade
• INGRES
• INTERLIS
• KML
• MapInfo files



• Memory
• Microstation DGN files
• MySQL
• ODBC
• OGDI Vectors
• Oracle Spatial
• PostgreSQL
• SDTS
• SQLite
• UK.NTF (National Transfer Format)
• US Census TIGER/Line
• VRT - Virtual Datasource
• WFS
• X-Plane/Flighgear aeronautical data (see GDAL extra-drivers)




How to Get More Information on the OGR Project
• As OGR is now merged with GDAL as of GDAL 2.0, the main GDAL site is the best resource.
• The legacy pages on the OGR Simple Features Project can be found on the Wayback Archives.
• The GDAL mailing list can be used for OGR related questions. Always search the list archives before sending new questions.
• The old GDAL Wiki has lots of good information for users and developers.
• The #gdal Matrix (or IRC) channel might also be of help. For info on connecting through Matrix/IRC see the MapServer Matrix/IRC page.
The main developer of the OGR library is currently Even Rouault (with original development by Frank Warmerdam) and the integration of OGR within MapServer was done by Daniel Morissette.



Obtaining and Compiling MapServer with OGR Support
• Follow the instructions on the GDAL page to compile/install OGR/GDAL.
• Obtain the MapServer source.
For UNIX users, see the UNIX Compilation and Installation. If GDAL/OGR is normally installed it should be sufficient to add -DWITH_OGR=ON to the cmake line before (re)building MapServer. Linux users might want to try FGS, a Linux installer for MapServer.
For Windows users, it is recommended to look for a pre-compiled binary on the MapServer site (MS4W is recom- mended). If you want to compile your own then see the README.WIN32 file in the MapServer source.
Starting with MapServer 7.0, 2.5D geometries, when handled by OGR drivers and data sources, can be taken into account by MapServer if it is built with -DWITH_POINT_Z_M=ON.


Integrating OGR Support with MapServer Applications
The only change that is needed to integrate OGR support with a MapServer application is with the .map file. The LAYER's DATA parameter is expanded to three parameters (CONNECTIONTYPE OGR, CONNECTION and DATA).
The syntax for this differs depending on the type of data being used (the Vector Data Access Guide is an excellent resource for this). In OGR, a data source can be either a set of files that share a common basename (e.g. .shp/.shx/.dbf for ArcView Shapefiles, or .tab/.map/.dat/.ind/.id for MapInfo TAB files) or a whole directory of files (e.g. TIGER).
Let's call the former "File-based data sources" and the later "Directory-based data sources". When accessing a file- based data source you specify the filename of one of the files in the set (e.g. roads.shp or roads.tab) and when accessing a directory-based data source you specify the directory name and OGR reads all the files in the directory as a single data source with potentially several layers (e.g. TIGER files).
Some OGR drivers (e.g. SHP, TAB) can have dual behaviors, that is if they're pointed to a single file then they behave as a file-based data source and if they're pointed to a directory then they will behave as a directory-based data source and then every file in the directory becomes a new layer in the data source.
See the OGR formats page for more info on the specific file format you're using. (Click on the format name for more specific driver info on that format)

Using OGR Data Sources in the Map File
The .map file LAYER definition for file-based sources is as follows:

<datasource_name> is the name of the datasource to read from and is prefixed by the CONNECTION keyword. The exact organization depends on the format driver in use. The format driver to use is automatically selected by OGR based on the nature of the string passed as the datasource, and/or the format of the file referenced by it.



• For file based datasources this is the name of the file, including the extension, using an absolute path, or a relative path. Relative paths are interpreted relative to the SHAPEPATH first, if not found then we try again relative to the .map file location.


• For directory based datasources, such as TIGER/Line, or Arc/Info Binary Coverages this is the name of the directory containing the files. If the path is relative it is interpreted relative to the .map file.
• For virtual datasources such as database systems, and OGDI this is the service connection string and is generally not related to the filesystem. For instance, for Oracle Spatial this might be "OCI:warmerda/Password@gdal800.velocet.ca".
<layer_definition> is the name, number or SQL definition of the layer to use from the datasource. It is indicated via the DATA keyword in the map file.
• Layer Name: The (case insenstive) layer name may be used to select a layer.
• Layer Number: The layer number (starting from 0 for the first layer) may be used to select a layer. Generally the layer name is preferred to this since it is more self describing.
• Omitted: If no DATA keyword is provided, this is equivalent to selecting layer 0.
• SQL SELECT: If an SQL SELECT statement is used, it is interpreted in a driver specific manner to try and generate a temporary pseudo-layer. For some formats this a restricted subset of SQL is interpreted within OGR. For RDBMS based drivers (such as PostGIS and Oracle) this is passed through to the underlying database.
The OGRINFO utility can be used to find out the list of layers and their names in a data source.

Examples of Layer Definitions Using OGR
Please see the Vector Data Access Guide for details and examples of each data format supported.
Example 1. MapInfo TAB file

Example 2. Microstation DGN file using <layer_index>
The entire DGN file is represented in OGR as one layer (see the DGN driver page for more details):





(continues on next page)



(continued from previous page)
Example 3. TIGER/Line file using <layer_name>

Example 4. Directory of Shapefiles using SQL JOIN

Example 5. Using an ElasticSearch backend with forwarding of HTTP header Authorization




How to Use "OGRINFO"
OGRINFO is part of the GDAL/OGR distribution (which is included in MS4W for Windows users). It is an executable that can be used to obtain layer information about OGR supported files. The parameters are:
ogrinfo [-ro] [-q] datasource_name [layer [layer...]]
• -ro opens the file as read only (optional)
• -q executes in quiet mode, only the layer idex line will be returned (optional)
• datasource_name is the filename including extension (eg. roads.tab); for TIGER/Line files, data- source_name is the directory containing the TIGER files (eg. ogrinfo TGR25001)
Example 5. To get the list of layers in a file:

which shows that there is one point layer in the popplace.tab file.
Example 6. To get a dump of a specific layer, including field names, projection, etc:
































(continues on next page)



(continued from previous page)
Example 7. To get a list of layers in a TIGER/Line Directory:

The above example shows that there are 14 layers in the TGR25001 directory.
Example 8. To get a summary of a specific TIGER layer, including only field names, projection, and extent




Queries Through OGR Format
OGR layers can be queried the same way as regular shapefiles in MapServer.

TILEINDEX with OGR
OGR layers can utilize tile indexes in a similar fashion to Shapefile based layers. The TILEINDEX keyword should contain the connection string for the tile index file. The tile index file may be any supported OGR format, including shapefiles.
The TILEITEM keyword in the LAYER definition indicates what attribute from the tile index file should be used as the datasource location. If omitted, the default TILEITEM value is "location". The value in the location field should be a connection string the same as would have been used in the CONNECTION field for OGR layers. The CONNECTION keyword is not needed (and will be ignored) for layers using the OGR connection type and having the TILEINDEX keyword.
Tileindex files can be prepared in an external GIS, or using the OGR utility ogrtindex. Details can be found on the OGR Utilities Page.
The following is a simple example of a point layer using a tile index.

OGR tileindex layers should support all normal query and attribute fetching mechanisms, including from MapScript. If auto projection support is used for tileindexed OGR layers, the tileindex is read for the projection (not the component tiles). Problems may (or may not) be encountered if the component tiles have differing schemas (different sets of attributes).
Starting with MapServer 7.2, it is possible to use tileindexes of tiles referenced in different SRS by specifying the TILESRS keyword to be the value of the -src_srs_name option of ogrtindex (as of GDAL 2.2 or later)

Connection Pooling
For some OGR supported formats, connecting to the dataset is quite expensive in terms of CPU use and amount of disk IO. For instance, establishing access to an S-57 dataset results in a complete read into memory of the data files. Connection pooling control aims at reducing this overhead in situations where the same file is used for several different map layers.
To ensure that an OGR supported dataset is only opened once per map render (instead of separately for each map LAYER referencing the dataset, use the CLOSE_CONNECTION PROCESSING option. The default value is for CLOSE_CONNECTION is NORMAL, but if set to DEFER the dataset will be kept open till the map render is complete. It will be reused by any other layers with using the same datasource.



Example 9. Preserve S-57 connection for two layers
In this example, we are using the same dataset (NO410810.000) for two layers. To avoid re-reading the dataset, we mark the first layer to defer closing the connection till layer. In the second (or last) layer we request NORMAL connection handling (though this could have been left out as normal handling is the default).

1. The text of the CONNECTION keyword must match exactly between layers for the connection to be reused.
2. Some dataset connections are quite memory expensive, and keeping them open may result in increased memory use.
3. If all layers rendered for a particular connection defer closing the connection, it will remain open till MapServer terminates. For normal cgi or MapScript use this is likely OK.
4. This use of CLOSE_CONNECTION handling is unique to OGR layers, and may be changed at some point in the future as part of a broader implementation of connection pooling in MapServer.

STYLEITEM "AUTO" - Rendering Layers Using Style Information from the OGR File



In MapServer, ArcView, and other shapefile-based applications, colors and styles are usually defined at the layer level. This means that all the shapes in a given layer are usually rendered using the same color and styles.
On the other hand, some formats supported by OGR such as MapInfo TAB do have color and style information attached to each shape. OGR adds support for the 'STYLEITEM "AUTO"' layer parameter which allows you to request that the shapes in a layer be rendered using colors and styles coming from the data source instead of being driven by CLASSes as was traditionally done with MapServer.



How to Implement
In order to have a layer rendered using colours and styles coming from the OGR data source, your must do the following:
• Your layer definition must contain the STYLEITEM "AUTO" parameter.
• Your layer definition needs to contain at least one CLASS (which may be empty) and optionally a CLASSITEM to match the expressions if your CLASS contains an expression. The empty CLASS in the layer will be updated dynamically at runtime to contain colours and styles coming from the data source for each shape.

Examples
Example 10. Layer Definition Using STYLEITEM "AUTO" without a CLASSITEM

Example 11. Layer Definition Using STYLEITEM "AUTO" with a CLASSITEM

Please Note:
CLASS EXPRESSIONs are still working, so it is still possible to query and classify layers that are using STYLEITEM "AUTO". The only difference is that instead of using static class definitions, the colors and style will be read from the data file.



Important Notes
NOTE 1
Even though MapInfo and other OGR data sources may support layers with mixed geometry types (e.g. points, lines and polygons in the same file) this is not yet supported in MapServer. So you still have to define a layer 'TYPE' and make sure that all the shapes in the OGR data source are compatible with that layer type, otherwise MapServer may produce an error about incompatible geometry types at runtime.
NOTE 2
Due to the dynamic nature of this feature, it is not compatible with the labelcache, so the labelcache is automatically disabled for layers that make use of 'STYLEITEM "AUTO"'.
NOTE 3
When you use STYLEITEM AUTO, MapServer tries to match symbol names returned by OGR to names in your symbol file. For a quick solution, try using the following symbol file:
https://demo.mapserver.org/ogr-demos/yk_demo/etc/symbols_mapinfo.txt
The name of the symbols returned by OGR to MapServer depends on the file format. In the case of MapInfo files, it will be:
• For "old-style" symbols (default MapInfo 3.0 symbols numbered 32 to 67) the symbol name will be 'mapinfo- sym-##' where '##' is the symbol number, e.g. 'mapinfo-sym-32'.
• For "Font Symbols", the symbol name is also 'mapinfo-sym-##' where '##' is the symbol number in the font. In this case, the name of the font itself is ignored by MapServer.
• MapInfo also supports "custom symbols" (bitmap symbols). . . I'm not sure what you would get from OGR for this, but I'm pretty sure that MapServer doesn't do anything useful with them.
The OGRINFO utility can be used to find out exactly which symbol names OGR will return to MapServer. Look at the "Style" string in the ogrinfo output for each shape that is read.

Mapping of OGR Style Info to the MapServer CLASS Members
Here is the list of style parameters that are currently supported from OGR data sources and how they're mapped in MapServer:
Line color
The line colour (PEN.c) is mapped to CLASS.STYLE.COLOR
Line thickness
The line thickness (PEN.w) is mapped to CLASS.STYLE.WIDTH. The default will be 1 pixel line (as it always is with MapServer).
Line pattern
The line pattern (PEN.p) is mapped to CLASS.STYLE.PATTERN. The default is a solid line.
Line cap and join
The line cap (PEN.cap) is mapped to CLASS.STYLE.CAP and the join to CLASS.STYLE.JOIN.
Line offset
The line perpendicular offset (PEN.dp) is mapped to CLASS.STYLE.OFFSET
Line symbol
OGR provides MapServer with symbol names (PEN.id), and if the symbol name returned by OGR to MapServer matches the name of one of the symbols in your symbolset then this symbol will be used.
Polygon background color
Polygon background color (BRUSH.bc) is mapped directly to CLASS.STYLE.BACKGROUNDCOLOR



Polygon fill color
Polygon fill color (BRUSH.fc) is mapped directly to CLASS.STYLE.COLOR
Polygon outline
If a polygon has an outline color (PEN.c) and thickness defined in the data source then the same rule as for line color and thickness above will apply, except that the outline color is mapped to CLASS.STYLE.OUTLINECOLOR
Polygon symbols
OGR provides MapServer with symbol names (BRUSH.id), and if the symbol name returned by OGR to MapServer matches the name of one of the symbols in your symbolset then this symbol will be used.
Polygon symbol color (BRUSH.fc) is directly mapped to CLASS.STYLE.COLOR. Polygon symbol size (BRUSH.s) is directly mapped to CLASS.STYLE.SIZE. Polygon symbol spacing (note the OGR BRUSH.dx and BRUSH?dy parameters mus be equal) is directly mapped to CLASS.STYLE.GAP. Polygon symbol angle (BRUSH.a) is directly mapped to CLASS.STYLE.ANGLE.
Point symbols
Point symbol color (SYMBOL.c) is directly mapped to CLASS.STYLE.COLOR. Point symbol outline color (SYMBOL.c) is directly mapped to CLASS.STYLE.OUTLINECOLOR. Point symbol size (SYMBOL.s) is di- rectly mapped to CLASS.STYLE.SIZE.
If your symbolset contains a symbol called "default-marker" then this symbol will be used, otherwise the default will be CLASS.SYMBOL=0 (i.e. a 1 pixel dot)
It is also possible (with a bit of work) to control which symbol gets used in rendering point symbols. OGR provides MapServer with symbol names (SYMBOL.id), and if the symbol name returned by OGR to MapServer matches the name of one of the symbols in your symbolset then this symbol will be used.
For MapInfo point symbols (numbered 32 to 67 in the MapInfo MIF spec), the name returned by OGR is "mapinfo-sym-X" where X should be replaced with the MapInfo symbol number (e.g. "mapinfo-sym-35" is the star symbol).
If the OGR symbol id is a web reference (http://. . ./mysymbol.png), the symbol will be downloaded and a new symbol entry will be created referring to it.
Text labels
The text string (LABEL.t) is mapped to CLASS.LABEL.TEXT Text color (LABEL.c) is mapped to CLASS.LABEL.COLOR
Text background color (LABEL.b) is mapped to CLASS.LABEL.BACKGROUNDCOLOR Text shadow color (LABEL.h) is mapped to CLASS.LABEL.SHADOWCOLOR
Text outline color (LABEL.h) is mapped to CLASS.LABEL.OUTLINECOLOR Text height (LABEL.s) is mapped to CLASS.LABEL.SIZE
Text angle (LABEL.a) is mapped to CLASS.LABEL.ANGLE
Text anchor position (LABEL.p) is mapped to CLASS.LABEL.POSITION Text font mapping follows the following rules:
1. If TTF fonts are supported:
a. If the native font name (e.g. "Arial") is found in your fontset then this font will be used. The font styles bold and italic are supported as follows: Arial bold fontname maps to arial-bold. Arial italic fontname maps to arial-italic. Arial bold italic fontname maps to arial-bold-italic. If the styles are not available, arial will be used.
b. If 1a. failed and a font called "default" is present in your fontset then this "default" font will be used.

MapServer Documentation, Release 8.6.0


2. If TTF fonts are not supported or if all above cases failed, then BITMAP MEDIUM font will be used.
Starting with MapServer 7.0, multiple OGR tools (i.e. pen, brush, symbols) can be supported per feature. The cor- responding STYLE object are created in the order the OGR tools appear in the OGR FeatureStyle string, i.e. the last one in the string is drawn on top of previous ones. This rule is true except if the priority level parameters (PEN/BRUSH/SYMBOL.l) of OGR tools is defined, in which case it has precedence over the apparition order of the OGR tools.

Accessing OGR STYLEITEMAUTO Label Styles Through MapScript
OGR STYLEITEMAUTO label styles can be accessed through MapScript, such as PHP/MapScript's getshape() or get- value() methods, by setting the LAYER's PROCESSING parameter to "GETSHAPE_STYLE_ITEMS=all". Therefore, the LAYER must contain:

The following label styles are supported:

Label StyleDescriptionMapServer Version Im- plementedOGR:LabelFontComma-delimited list of fonts names5.4OGR:LabelSizeNumeric value with units5.2.0OGR:LabelTextLabel text string5.2.0OGR:LabelAnglRotation angle (in degrees)5.2.0OGR:LabelFColForeground color5.4OGR:LabelBCoBackground color5.4OGR:LabelPlacHow is the text drawn relative to the feature's geometry5.4OGR:LabelAnchA value from 1 to 12 defining the label's position relative to the
point to which it is attached.5.4OGR:LabelDxX offset5.4OGR:LabelDyY offset5.4OGR:LabelPerpPerpendicular offset5.4OGR:LabelBoldBold text5.4OGR:LabelItalicItalic text5.4OGR:LabelUndUnderlined text5.4OGR:LabelPriori Numeric value defining the order in which style parts should be
drawn.5.4OGR:LabelStrike Strike out text (gdal >= 1.4.0)5.4OGR:LabelStretc Stretch factor changes the width of all characters in the font by factor
percent. (gdal >= 1.4.0)5.4OGR:LabelAdjHorizontally adjacent text (gdal >= 1.4.0)5.4OGR:LabelAdjVVertically adjacent text (gdal >= 1.4.0)5.4OGR:LabelHCoShadow color (gdal >= 1.4.0)5.4OGR:LabelOCoOutline color (gdal > 1.6.0)5.4
Please see the OGR Feature Style Specification document for more details on those specific styles. Sample PHP MapScript code to access the "OGR:LabelText" label style follows:






Sample Sites Using OGR/MapServer
The following sites use OGR's STYLEITEM "AUTO" feature:
• https://demo.mapserver.org/ogr-demos/yk_demo/demo_init.html
• https://demo.mapserver.org/ogr-demos/nfld_demo/demo_init.html
The following site uses OGR, as well as MapInfo's 'Seamless Map Layers' feature:
   • https://demo.mapserver.org/ogr-demos/ro_demo/demo_init.html The following site uses OGR to display TIGER 2000 files:
• https://demo.mapserver.org/ogr-demos/tig_demo/demo_init.html

FAQ / Common Problems
Q
What Does "OGR" Stand For?
A
Basically, OGR does not stand for anything. For a detailed explanation of how OGR was named, see GDAL's FAQ at https://gdal.org/en/stable/faq.html.


Q
When using STYLEITEM AUTO, what should I have in my .sym symbols file?
A
When you use STYLEITEM AUTO, MapServer tries to match symbol names returned by OGR to names in your symbol file. For a quick solution, try using the following symbol file:














Credits


https://demo.mapserver.org/ogr-demos/yk_demo/etc/symbols_mapinfo.txt
The name of the symbols returned by OGR to MapServer depends on the file format. In the case of MapInfo files, it will be:
• For "old-style" symbols (default MapInfo 3.0 symbols numbered 32 to 67) the symbol name will be 'mapinfo-sym-##' where '##' is the symbol number, e.g. 'mapinfo-sym-32'.
• For "Font Symbols", the symbol name is also 'mapinfo-sym-##' where '##' is the symbol num- ber in the font. In this case, the name of the font itself is ignored by MapServer.
• MapInfo also supports "custom symbols" (bitmap symbols). . . I'm not sure what you would get from OGR for this, but I'm pretty sure that MapServer doesn't do anything useful with them.
The OGRINFO utility can be used to find out exactly which symbol names OGR will return to MapServer. Look at the "Style" string in the ogrinfo output for each shape that is read.

Improvements in mapping from OGR Feature style to MapServer styling developed for Faunalia (http://www.faunalia.it) with funding from Regione Toscana - Settore SISTEMA INFORMATIVO TERRITORIALE ED AMBIENTALE ( http://www.geografia.toscana.it ) (CIG:Z410C90D94)

Oracle Spatial
Author
Bart van den Eijnden
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2021-05-05

Table of Contents• Oracle Spatial
- Binaries
- Installation
- Two options for using Oracle Spatial with MapServer
* Mapfile syntax for native Oracle Spatial support
* Examples
* Using subselects in the DATA statement
* Additional keywords - [FUNCTION]
* Additional keywords - [VERSION]
* More information
* Example of a LAYER
* Mapfile syntax for OGR Oracle Spatial support



Oracle Spatial is a spatial component for the Oracle database. Remember that all Oracle databases come with Locator, which has less features than Oracle Spatial. The differences between Locator and Spatial can be found in the Oracle Spatial FAQ.
You can also see the original OracleSpatial wiki page that this document was based on.

Binaries
MapServer Windows plugins with Oracle spatial support are included in MS4W. But you need Oracle client software installed on the server on which you are running MapServer. Oracle client software can be obtained for develop- ment purposes from the Oracle website. The ORACLE TECHNOLOGY NETWORK DEVELOPMENT LICENSE AGREEMENT applies to this software. The instant client will be satisfactory, and you can download the instant client. Make sure that your MapServer is compiled against the same version as your Oracle client.

Installation
See Oracle Installation for more configuration and installation information for MapServer's native Oracle support.


Two options for using Oracle Spatial with MapServer
Oracle Spatial layers in MapServer can be used through 2 interfaces:
• The native built-in support through maporaclespatial.c
• OGR, but watch out: GDAL/OGR is not compiled with Oracle Spatial support by default, so it won't work without compiling in OCI (Oracle client) yourself. This requires both recompiling GDAL/OGR as well as recompiling MapServer itself against the new GDAL/OGR !!!!

Mapfile syntax for native Oracle Spatial support
The DATA statement for a LAYER of CONNECTIONTYPE oraclespatial can now have 4 options. This change is backwards compatible, i.e. the old ways of specifying DATA still work. The new options are an extension to the old DATA statements, as they needed to include identification of the primary key to be used for the query modes (UNIQUE).
The following options are valid DATA statements:










(continues on next page)


Note variable binding is supported by using BINDVALS and name value pairs.

Examples Example 1
The most simple DATA statement, in this case you only need to define one geometry column and one table. This option assumes you do not have an SRID defined.


Example 2
It's composed of the first option plus the USING UNIQUE parameter. These new features are necessary when you want to use any query function. When it is used you must pass a numeric column type. This option assumes you do not have an SRID defined.


Example 3
This option is an extension to the first option. In this mode you must define the USING SRID parameter when the SRID value in your data is different from NULL.


Example 4
This option is a combination of examples 2 and 3.




(continues on next page)



Using subselects in the DATA statement
It is possible to define the source of the date as a subselect and not only as a table. As source of data, used in FROM token, you can define any SQL, table, function, or operator that returns a SDO_GEOMETRY. For example:

If the LAYER definition contains a CLASSITEM, LABELITEM or FILTER, it is necessary that the fields used are returned by the query. When you define CLASSITEM you can use an expression without any problems.

Additional keywords - [FUNCTION]
You can add three keywords to the DATA statement for [FUNCTION] option that influence the query which will be executed in Oracle:

USING FILTER

Using this keyword triggers MapServer to use the Oracle Spatial SDO_FILTER operator. This operator executes only the Oracle Spatial primary filter over your query data. In the Oracle User guide they explain: The primary filter compares geometric approximations, it returns a superset of exact result. The primary filter therefore should be as efficient (that is, selective yet fast) as possible. This operator uses the spatial index, so you need to define your spatial index correctly to retrieve an exact result. If the result of the query is not exact you can try the next option.

USING RELATE

Using this keyword triggers MapServer to use the Oracle Spatial SDO_RELATE operator. This operator applies the primary and secondary Oracle Spatial filters. It's performance can be slightly slow but the result is extremely correct. You can use this mode when you want a perfect result or when you can't readjust the spatial index.

USING GEOMRELATE

Using this keyword triggers MapServer to use the geometry function SDO_GEOM.RELATE, a function that searches the relations between geometries. SDO_GEOM.RELATE does not use the spatial index and your performance is more slow than operators but it's very accurate. You can use this mode when you can't use the spatial index or when it doesn't exist.

USING NONE

Using this keyword triggers MapServer to not use any geometry function or spatial operator. So, the internal SQL doesn't restrict, based on the extent, the data from source. All the data from source will be returned to MapServer.



The NONE token is very useful when the source of the data doesn't contain any spatial index. It usually occurs when the source is a function like SDO_BUFFER, SDO_XOR, SDO_INTERSECTION	So this mode is recommended
when you can't use the spatial index or when it doesn't exist.

Additional keywords - [VERSION]
You can define what version of database you are using to improve the internal sql. This is very useful when using geodetic SRIDs and MapServer functions that retrieve the extent from data.

USING VERSION 8i

This indicates MapServer to use a internal SQL that it's compatible with Oracle 8i version.

USING VERSION 9i

The second indicates MapServer to use 9i version, is recommended to use this parameter if you are using 9i version because the internal SQL will use specific spatial functions that is need to retrieve data correctly from 9i Oracle Spatial versions.

USING VERSION 10g

This indicates MapServer to use a internal SQL that it's compatible with Oracle 10g version.

More information
• You can define any PROJECTION to your LAYER without problem, can be used for data with or without an SRID in Oracle.
• The native support for Oracle Spatial supports the defaults definition for SDO_GEOMETRY in database, the Oracle Spatial SDO package.
• Information about the primary and secondary Oracle Spatial filters can be found in the Oracle Spatial User Guide (the "Query Model" section). Information about the SDO_FILTER and SDO_RELATE operators can be found in the "Spatial Operators" section, and information about the SDO_GEOM.RELATE function can be found in
the "Geometry Function" section of the Oracle Spatial User Guide.

Example of a LAYER










(continues on next page)



(continued from previous page)
You can specify the SID for your database, the SID alias needs to be supplied in the tnsnames.ora file of the Oracle client, e.g.
Example for tnsnames.ora:

So after this you can define you layer connection as:


Mapfile syntax for OGR Oracle Spatial support
Syntax for your MAP file:



What MapServer Components are related to Oracle Spatial access



• mode=map
• query modes: query, nquery, itemnquery
• MapScript query functions such as querybyattributes
• OGC:WMS: GetCapabilities, GetMap, GetFeatureInfo, DescribeLayer
• OGC:WFS, GetCapabilities, DescribeFeatureType, GetFeature



PostGIS/PostgreSQL
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2022-04-25


PostGIS/PostgreSQL
PostGIS spatially enables the Open Source PostgreSQL database. The PostGIS wiki page may include additional information.








See alsoVector Data Management & Optimization
Data Access /Connection Method
PostGIS is supported directly by MapServer and must be compiled into MapServer to work.
The PostgreSQL client libraries (libpq.so or libpq.dll) must be present in the system's path environment for functionality to be present.
The CONNECTIONTYPE parameter must be set to POSTGIS.
The CONNECTION parameter is used to specify the parameters to connect to the database. CONNECTION parameters can be in any order. Most are optional. dbname is required. user is required. host defaults to localhost, port defaults to 5432 (the standard port for PostgreSQL).
The DATA parameter is used to specify the data used to draw the map. The form of DATA is "[geometry_column] from [table_name|sql_subquery] using unique [unique_key] using srid=[spatial_reference_id]". The "using unique" and "using srid=" clauses are optional when drawing features, but using them improves performance. If you want to make MapServer query calls to a PostGIS layer, your DATA parameter must include "using unique". Omitting it will cause the query to fail.



WarningOIDs were removed from PostgreSQL as of the PostgreSQL 12.0 release. It is recommended to specify a different unique ID column instead, in your layer's DATA statement, of your mapfile.


Here is a simple generic example:






ourdbpasswor

This example shows specifying the unique key and srid in the DATA line:

This example shows using a SQL subquery to perform a join inside the database and map the result in MapServer. Note the "as subquery" string in the statement - everything between "from" and "using" is sent to the database for evaluation:





id usin
This example shows using a geometry function and database sort to limit the number of features and vertices returned to MapServer:




the_geomlimi
This example shows the use of the !BOX! substitution string to over-ride the default inclusion of the map bounding box in the SQL. By default the spatial box clause is appended to the SQL in the DATA clause, but you can use !BOX! to insert it anywhere you like in the statement. In general, you won't need to use !BOX!, because the PostgreSQL planner will generate the optimal plan from the generated SQL, but in some cases (complex sub-queries) a better plan can be generated by placing the !BOX! closer to the middle of the query:





OGRINFO Examples
OGRINFO can be used to read out metadata about PostGIS tables directly from the database.
First you should make sure that your GDAL/OGR build contains the PostgreSQL driver, by using the '-formats' com- mand:





(continues on next page)



(continued from previous page)
If you don't have the driver, you might want to try the FWTools or MS4W packages, which include the driver. Once you have the driver you are ready to try an ogrinfo command on your database to get a list of spatial tables:

Now use ogrinfo to get information on the structure of the spatial table:
>ogrinfo PG:"host=127.0.0.1 user=postgres password=postgres dbname=canada port=5432"?
??province -summary

INFO: Open of 'PG:host=127.0.0.1 user=postgres password=postgres dbname=canada' using driver 'PostgreSQL' successful.

Layer name: province Geometry: Polygon Feature Count: 1068
Extent: (-2340603.750000, -719746.062500) - (3009430.500000, 3836605.250000)
Layer SRS WKT:
PROJCS["NAD83 / Canada Atlas Lambert", GEOGCS["NAD83",
DATUM["North_American_Datum_1983", SPHEROID["GRS 1980",6378137,298.257222101,
AUTHORITY["EPSG","7019"]],
TOWGS84[0,0,0,0,0,0,0],
AUTHORITY["EPSG","6269"]],
PRIMEM["Greenwich",0, AUTHORITY["EPSG","8901"]],
UNIT["degree",0.0174532925199433, AUTHORITY["EPSG","9122"]],
AUTHORITY["EPSG","4269"]],
PROJECTION["Lambert_Conformal_Conic_2SP"], PARAMETER["standard_parallel_1",49], PARAMETER["standard_parallel_2",77], PARAMETER["latitude_of_origin",49], PARAMETER["central_meridian",-95], PARAMETER["false_easting",0], PARAMETER["false_northing",0], UNIT["metre",1,
    AUTHORITY["EPSG","9001"]], AXIS["Easting",EAST],
AXIS["Northing",NORTH], AUTHORITY["EPSG","3978"]]
FID Column = ogc_fid
Geometry Column = wkb_geometry
...


Mapfile Example

For more info about PostGIS and MapServer see the PostGIS docs: https://postgis.net/documentation/

PostGIS Raster (PGRaster)
Since the PostGIS 2.0 release, PostGIS includes support for raster data, which can be accessed by MapServer (through GDAL).


Load Raster DATA
You must use raster2pgsql to load your raster data into PostGIS (see postgis.net for usage), such as:

The above will create a new lunenburg_colorhillshade table from a GeoTIFF file.
Important points for display in MapServer:
• be sure to set the -t switch to tile the raster
• be sure to set the -I switch to create a GiST index on the raster
• be sure to set the -C switch to apply raster constraints
• be sure to set the -F switch to add a column with the name of the raster file



Connect with GDALINFO
Use the gdalinfo utility to list the available raster tables in your database, such as:

which returns something like:

Next specify the table and column, with the -nomd switch, such as:

which returns a summary of the raster, including its projection (EPSG:2961) :




Mapfile Layer
The mapfile layer is similar to other raster layers, but the PostGIS connection parameters are specified in the DATA
parameter, such as:



Test with map2img










Support for 2.5D geometries
In addition to horizontal coordinates (X,Y or longitude,latitude), PostGIS can support geometries with a vertical com- ponent, often called 2.5D geometries.
As of MapServer 7.0, such 2.5D geometries will be taken into account if MapServer is built with - DWITH_POINT_Z_M=ON.




Support for SQL/MM Curves
PostGIS is able to store circular interpolated curves, as part of the SQL Multimedia Applications Spatial specification (read about the SQL/MM specification).
For more information about PostGIS' support, see the SQL-MM Part 3 section in the PostGIS documentation, such as here.
As of MapServer 6.0, the PostGIS features CircularString, CompoundCurve, CurvePolygon, MultiCurve, and Multi- Surface can be drawn through MapServer directly.



Example#1: CircularString in MapServer
The following is the Well Known Text of the feature loading into PostGIS:

An example MapServer layer might look like:

And testing with map2img should produce a map image of:




Example#2: CompoundCurve in MapServer
The following is the Well Known Text of the feature loading into PostGIS:

An example MapServer layer might look like:










(continues on next page)



(continued from previous page)
And testing with map2img should produce a map image of:





Example#3: CurvePolygon in MapServer
The following is the Well Known Text of the feature loading into PostGIS:

An example MapServer layer might look like:

And testing with map2img should produce a map image of:












Example#4: MultiCurve in MapServer
The following is the Well Known Text of the feature loading into PostGIS:

An example MapServer layer might look like:

And testing with map2img should produce a map image of:















Example#5: MultiSurface in MapServer
The following is the Well Known Text of the feature loading into PostGIS:

An example MapServer layer might look like:

And testing with map2img should produce a map image of:










Using MapServer < 6.0
If you cannot upgrade to MapServer 6.0, then you can use the PostGIS function ST_CurveToLine() in your MapServer LAYER to draw the curves (note that this is much slower however):











SDTS
This is a United States Geological Survey (USGS) format. SDTS has a raster and a vector format. The raster format is not supported in MapServer. Only the vector formats are supported, including VTP and DLG files.


File listing
• SDTS files are often organized into state-sized pieces. For example, all of the state of Maryland (MD), U.S.A.
• Files are also available for multiple types of features including hydrography, transportation and administrative boundaries.
This example uses transportation data, which consists of 35 separate files, each with the suffix DDF:


Data Access / Connection Method
• SDTS access is available in MapServer through OGR's SDTS driver.
• The CONNECTIONTYPE OGR parameter must be used.
• The path (which can be relative) to the catalog file (	CATD.DDF) is required, including file extension.
• There are multiple layers in the SDTS catalog, some of which are only attributes and have no geometries.
• The layer name is specified with the DATA parameter
OGRINFO Examples
Using ogrinfo on a catalog file (note that the first 7 layers do not have geometries):










(continues on next page)



(continued from previous page)
Using ogrinfo to examine the structure of the file/layer:
> ogrinfo /data/sdts/MD/MDTRCATD.DDF LE01 -summary

Had to open data source read-only. INFO: Open of 'MDTRCATD.DDF'
using driver 'SDTS' successful.

Layer name: LE01 Geometry: Line String Feature Count: 780
Extent: (-80.000289, 36.999774) - (-74.999711, 40.000225)
Layer SRS WKT:
GEOGCS["NAD27",
DATUM["North_American_Datum_1927",
SPHEROID["Clarke 1866",6378206.4,294.978698213901]],
PRIMEM["Greenwich",0], UNIT["degree",0.0174532925199433]]
RCID: Integer (0.0)
SNID: Integer (0.0)
ENID: Integer (0.0)
ENTITY_LABEL: String (7.0)
ARBITRARY_EXT: String (1.0)
RELATION_TO_GROUND: String (1.0)
VERTICAL_RELATION: String (1.0)
OPERATIONAL_STATUS: String (1.0)
ACCESS_RESTRICTION: String (1.0)
OLD_RAILROAD_GRADE: String (1.0)
WITH_RAILROAD: String (1.0)
COVERED: String (1.0)
HISTORICAL: String (1.0)
LIMITED_ACCESS: String (1.0)
PHOTOREVISED: String (1.0)
LANES: Integer (2.0)
ROAD_WIDTH: Integer (3.0)
(continues on next page)



(continued from previous page)
Mapfile Example:


S57
Also known as S57. The IHO S-57 format is a vector interchange format used for maritime charts. It was developed by the International Hydrographic Organisation (IHO). For more information about the IHO see: https://iho.int/

File listing
Individual S57 data files have an extension of *.000. For example:


Data Access / Connection Method
• S57 access in MapServer occurs through OGR's S57 driver.
• CONNECTIONTYPE OGR must be specified.
• Specify a full path or a relative path from the SHAPEPATH to the .000 file for the CONNECTION
• Use the DATA parameter to specify the S57 layer name

Special Notes
The underlying OGR code requires two files from your GDAL/OGR installation when reading S57 data in MapServer : s57objectclasses.csv and s57attributes.csv. These files can be found in the /GDAL/data/ folder (unix:
/usr/local/share/gdal Windows: /ms4w/gdaldata). If you receive an error in MapServer such as:

you may have to point MapServer to these files using the CONFIG parameter in the main section of your map file:




OGRINFO Examples
Using ogrinfo on an S57 file to get the layer name:

Using ogrinfo to examine the structure of an S57 layer:

















(continues on next page)







GRUP:Integer(3.0)OBJL:Integer(5.0)RVER:Integer(3.0)AGEN:Integer(2.0)FIDN:Integer(10.0)FIDS:Integer(5.0)












Mapfile Example:

(continued from previous page)




SpatiaLite
SpatiaLite spatially enables the file-based SQLite database. For more information see the SpatiaLite description page.

File listing
Similar to other database formats, the .sqlite file (.db is another common file extension for this) consists of several tables. The geometry is held in a BLOB table column.



Data Access / Connection Method
Spatialite access is available through OGR. See the OGR driver page for specific driver information. The driver is available in GDAL/OGR version 1.7.0 or later.
OGR uses the names of spatial tables within the SpatiaLite database (tables with a geometry column that are registered in the geometry_columns table) as layers.
The CONNECTION parameter must include the sqlite extension, and the DATA parameter should be the name of the spatial table (or OGR layer).


OGRINFO Examples
First you should make sure that your GDAL/OGR build contains the spatialite "SQLite" driver, by using the '-formats' command:

If you don't have the driver, you might want to try the MS4W or OSGeo4W packages, which include the driver.
Once you have confirmed that you have the SQLite driver you are ready to try an ogrinfo command on your database to get a list of spatial tables:

Now use ogrinfo to get information on the structure of the spatial table:














(continues on next page)



(continued from previous page)
SPHEROID["GRS 1980",6378137,298.257222101, AUTHORITY["EPSG","7019"]],
TOWGS84[0,0,0,0,0,0,0],
AUTHORITY["EPSG","6269"]],
PRIMEM["Greenwich",0, AUTHORITY["EPSG","8901"]],
UNIT["degree",0.0174532925199433, AUTHORITY["EPSG","9122"]],
AUTHORITY["EPSG","4269"]],
UNIT["metre",1, AUTHORITY["EPSG","9001"]],
PROJECTION["Transverse_Mercator"], PARAMETER["latitude_of_origin",0], PARAMETER["central_meridian",-93], PARAMETER["scale_factor",0.9996], PARAMETER["false_easting",500000], PARAMETER["false_northing",0], AUTHORITY["EPSG","26915"], AXIS["Easting",EAST],
    AXIS["Northing",NORTH]] FID Column = PK_UID Geometry Column = Geometry AREA: Real (0.0)
PERIMETER: Real (0.0)
COUNTY_ID: Integer (0.0)
FIPS: String (0.0)
...

Mapfile Example Standard connection




Connection utilizing SQL syntax


Connection utilizing joined table for additional attributes


Standard Connection with a filter














(continues on next page)



(continued from previous page)

Filter utilizing SQL syntax


USGS TIGER
TIGER/Line files are created by the US Census Bureau and cover the entire US. They are often referred simply as TIGER files. For more information see: https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file. html.

File listing
TIGER/Line files are text files and directory-based data sources. For example, one county folder TGR06059 contains several associated files:


Data Access / Connection Method
• TIGER/Line access occurs through through OGR's TIGER driver.
• CONNECTIONTYPE OGR must be specified.
• The full path to the directory containing the associated files is required in the CONNECTION string.
• The feature type is specified in the DATA parameter

OGRINFO Examples
Using ogrinfo on a TIGER directory to retrieve feature types:





Using ogrinfo to examine the structure of the TIGER feature type CompleteChain:
> ogrinfo TGR06059 CompleteChain -summary

ERROR 4: Tiger Driver doesn't support update. Had to open data source read-only.
INFO: Open of 'TGR06059'
using driver 'TIGER' successful.

Layer name: CompleteChain Geometry: Line String Feature Count: 123700
Extent: (-118.125898, 33.333992) - (-117.412987, 33.947512)
Layer SRS WKT:
GEOGCS["NAD83",
DATUM["North_American_Datum_1983",
SPHEROID["GRS 1980",6378137,298.257222101]],
PRIMEM["Greenwich",0], UNIT["degree",0.0174532925199433]] MODULE: String (8.0)
TLID: Integer (10.0)
SIDE1: Integer (1.0)
SOURCE: String (1.0)
FEDIRP: String (2.0)
FENAME: String (30.0)
FETYPE: String (4.0)
FEDIRS: String (2.0)
CFCC: String (3.0)
FRADDL: String (11.0)
(continues on next page)



(continued from previous page)
Mapfile Example:


Vector field rendering - UVraster
Added in MapServer 6.2, Vector fields are used for instance in meteorology to store/display wind direction and mag- nitude.




See alsorfc78
The source is two bands of raster data, the first band represents the U component of the vector, and the second band the V component. Using the u,v values at a given location we can compute a rotation and magnitude and use that to draw an arrow of a size proportional to the magnitude and pointing in the direction of the phenomenon (wind, current, etc.)
For more details about vector fields, refer to: Vector field Visual example (rendered with MapServer):

LAYER Description
A vector field LAYER is a hybrid layer, which has a raster data source as input and vector features as output. The output features are represented as points. Queries are not supported.
Since the data source is a raster, all raster processing options can be used (e.g. RESAMPLE). RESAMPLE=AVERAGE generally gives a good result, and the default. This can be overridden by explicitly specifying the type of resampling.
Vector field layers are of TYPE point, and have CONNECTIONTYPE uvraster. The raster data set is specified in DATA. The two bands that define the vector field are specified using PROCESSING BANDS (U first, V second).

LAYER Attributes
The UVraster connection type offers the following attributes:
• [u]: the raw u value
• [v]: the raw v value
• [uv_angle]: the vector angle
• [uv_minus_angle]: the vector angle - opposite direction
• [uv_length]: the vector length (scaled with the UV_SIZE_SCALE optional value)
• [uv_length_2]: half the vector length



• [lon]: longitude in degree (in base geographic CRS of the layer CRS). Added in 8.2
• [lat]: latitude in degree (in base geographic CRS of the layer CRS). Added in 8.2

Optional PROCESSING Settings
• UV_SPACING: The spacing is simply the distance, in pixels, between arrows to be displayed in the vector field. Default is 32.
• UV_SIZE_SCALE: The uv size scale is used to convert the vector lengths (magnitude) of the raster to pixels for a better rendering. Default is 1.

Example of a layer definition










































(continues on next page)



(continued from previous page)

Virtual Spatial Data
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2021-05-05

OGR's VRT driver allows you to connect to databases in MapServer that do not explicitly hold spatial data, as well as flat text files. Your data must have an X and a Y column, and the data may be accessed through an ODBC connection or a direct pointer to a text file.
The original VirtualSpatialData wiki page may contain additional information.



Types of Databases
The VirtualSpatialData OGR extension has been tested with the following databases and should, in theory, support all ODBC data sources.
• Oracle
• MySQL
• SQL Server
• Access
• PostgreSQL

Types of Flat Files
Comma, tab or custom delimited text/flat files work with VirtualSpatialData.

Steps for Display
1. Create the Datasource Name (DSN)
• Specific notes about creating a DSN on Windows and Linux can be found by searching the MapServer reference documents site
• On some Windows systems you must create a SYSTEM DSN.

2. Test your Connection
Test your connection with ogrinfo. The syntax for this command is:

Windows users may not be required to specify a user/password, so the syntax would be:

Example: Accessing a comma separated text file through ODBC using ogrinfo
The following is a snippet of the flat text file coal_dep.txt containing lat/long points:

If the DSN name is Data_txt, the ogrinfo command to see a list of applicable files in the directory is:









(continues on next page)



(continued from previous page)
Username and password may be optional, so the following may also be valid:

Therefore, the command to see more information about one of the specific layers is:


3. Create a Virtual Data File
This is a file with an ovf extension and looks like the following:




More information on ovf files can be found at: https://gdal.org/drivers/vector/vrt.html Example ovf file for coal_dep.txt:

4. Test Virtual Data File with ogrinfo
Use ogrinfo to test your new ovf file, such as:


5. Mapfile Layer
Using an ovf file your layer may look like:














(continues on next page)



(continued from previous page)


Or you may specify the ovf contents inline such as:































(continues on next page)



(continued from previous page)

6. Test your Mapfile
The first thing you should try is to use the map2img utility:

Once you successfully created a map image, then try your application. Note Windows users may come across a problem where map2img works but their application throws an error similar to this:

If that happens you should make sure you have created a System DSN.

WFS
WFS is an Open Geospatial Consortium (OGC) specification. For more information about the format itself, see: https:
//www.ogc.org/standards/wfs
WFS allows a client to retrieve geospatial data encoded in Geography Markup Language (GML) from multiple Web Feature Services. GML is built on the standard web language XML.
WFS differs from the popular Web Map Service (WMS) specification in that WFS returns a subset of the data in valid GML format, not just a graphic image of data.

Capabilities
Requesting the capabilities using the GetCapabilities request to a WFS server returns an XML document showing what layers and projections are available, etc. Example of a WFS GetCapabilities URL:
https://demo.mapserver.org/cgi-bin/wfs?SERVICE=WFS&VERSION=1.0.0&REQUEST=  GetCapabilities
Example of the Resulting XML from GetCapabilties:















(continues on next page)



(continued from previous page)

Data Access / Connection Method
• WFS access is a core MapServer feature. MapServer currently supports WFS version 1.0.0.

See alsoWFS Client
• WFS access is also supported through OGR's WFS driver.
• CONNECTIONTYPE WFS or CONNECTIONTYPE OGR must be used (see the OGR Vector Layers Through MapServer documentation for details on how to use WFS through OGR).
• WFS layers can be requested through a layer in a map file, or you can request the GML directly through the browser with a GetFeature request. You can specify a specific layer with the TypeName request. In a map file the name/value pairs should be put into a METADATA object.
• You can limit the number of features returned in the GML by using the MaxFeatures option (e.g. &MAXFEA- TURES=100).

Example of a WFS Request Directly Through the Browser
The following URL requests the GML for the layer continents. (see the GetCapabilities above for the possible layers available on this test server) . The URL is all one line, broken up here for readability (click here for a working link).


Mapfile Example













(continues on next page)



(continued from previous page)

8.1.2 Raster Data
Author
Frank Warmerdam
Contact
warmerdam at pobox.com
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2022-08-20




Introduction
MapServer supports rendering a variety of raster file formats in maps. The following describes some of the supported formats, and what capabilities are supported with what formats.
This document assumes that you are already familiar with setting up MapServer Mapfile, but does explain the raster specific aspects of mapfiles.

How are rasters added to a Map file?
A simple raster layer declaration looks like this. The DATA file is interpreted relative to the SHAPEPATH, much like vector files.

Though not shown rasters can have PROJECTION, METADATA, PROCESSING, MINSCALE, and MAXSCALE infor- mation. It cannot have labels, CONNECTION, CONNECTIONTYPE, or FEATURE information.

Classifying Rasters
Rasters can be classified in a manner similar to vectors, with a few exceptions.
There is no need to specify a CLASSITEM. The raw pixel value itself ("[pixel]") and, for paletted images, the red, green and blue color associated with that pixel value ("[red]", "[green]" and "[blue]") are available for use in classifications. When used in an evaluated expression the pixel, red, green and blue keywords must be in lower case.

























(continues on next page)



(continued from previous page)
As usual, CLASS definitions are evaluated in order from first to last, and the first to match is used. If a CLASS has a NAME attribute it may appear in a LEGEND. Only the COLOR, EXPRESSION and NAME parameters within a CLASS definition are utilized for raster classifications. The other styling or control information is ignored.
Raster classifications always take place on only one raster band. It defaults to the first band in the referenced file, but this can be altered with the BANDS PROCESSING directive. In particular this means that including even a single CLASS declaration in a raster layer will result in the raster layer being rendered using the one band classification rules instead of other rules that might have applied (such as 3 band RGB rendering).

Classifying Non-8bit Rasters
As of MapServer 4.4 support has been added for classifying non-8bit raster inputs. That is input rasters with values outside the range 0-255. Mostly this works transparently but there are a few caveats and options to provide explicit control.
Classifying raster data in MapServer is accomplished by pre-classifying all expected input values and using that table of classification results to lookup each pixel as it is rendered. This is done because evaluating a pixel value against a series of CLASS definitions is relatively expensive to do for the hundreds of thousands of pixels in a typical rendered image.
For simple 8bit inputs, only 256 input values need to be pre-classified. But for non-8bit inputs more values need to be classified. For 16bit integer inputs all 65536 possible input values are pre-classified. For floating point and other input data types, up to 65536 values are pre-classified based on the maximum expected range of input values.
The PROCESSING directive can be used to override the range of values to be pre-classified, or the number of val- ues (aka Buckets) in that range to classify. The SCALE=min,max PROCESSING directive controls the range. The SCALE_BUCKETS PROCESSING directive controls the number of buckets. In some cases rendering can be acceler- ated considerable by selecting a restricted range of input values and a reduced number of scaling values (buckets).
The following example classifies a floating raster, but only 4 values over the range -10 to 10 are classified. In particular, the values classified would be -7.5, -2.5, 2.5, and 7.5 (the middle of each "quarter" of the range). So those four value are classified, and one of the classification results is selected based on which value is closest to the pixel value being classified.








(continues on next page)



(continued from previous page)

Supported Formats
Since version 6.2, MapServer raster input support is through the GDAL raster library only.


More information on GDAL can be found at https://gdal.org, including the supported formats list. Some of the advanced MapServer raster features, such as resampling, RGB color cube generation and automatic projection capture only work with raster formats used through GDAL. GDAL is normally built and installed separately from MapServer, and then enabled during the build of MapServer using the -with-gdal configuration switch.
To find out if GDAL support is built into a particular MapServer executable, use the -v flag to discover what build options are enabled. To find out what GDAL formats are available, the "gdalinfo -formats" command may be used. For example:













(continues on next page)



(continued from previous page)

Rasters and Tile Indexing
When handling very large raster layers it is often convenient, and higher performance to split the raster image into a number of smaller images. Each file is a tile of the larger raster mosaic available for display. The list of files forming a layer can be stored in a shapefile with polygons representing the footprint of each file, and the name of the files. This is called a 'TILEINDEX' and works similarly to the same feature in vector layers. The result can be represented in the mapfile as one layer, but MapServer will first scan the tile index, and ensure that only raster files overlapping the current display request will be opened.
The following example shows a simple example. No DATA statement is required because MapServer will fetch the filename of the raster files from the Location attribute column in the hp2.dbf file for records associated with polygons in hp2.shp that intersect the current display region. The polygons in hp2.shp should be rectangles representing the footprint of the corresponding file. Note that the files do not have to be all the same size, the formats can vary and they can even overlap (later files will be drawn over earlier ones).
Starting with MapServer 6.4, the files can have different coordinate system (projection). This requires specifying the TILESRS keyword and generating the tileindex with a few additional options. See Tileindexes with tiles in different projections.

The filenames in the tileindex are searched for relative to the SHAPEPATH or map file, not relative to the tileindex. Great care should be taken when establishing the paths put into the tileindex to ensure they will evaluate properly in use. Often it is easiest to place the tileindex in the SHAPEPATH directory, and to create the tileindex with a path relative to the SHAPEPATH directory. When all else fails, absolute paths can be used in tileindex, but then they cannot be so easily moved from system to system.
While there are many ways to produce TILEINDEX shapefiles for use with this command, one option is the gdaltindex program, part of the GDAL utility suite. The gdaltindex program will automatically generate a tile index shapefile from a list of GDAL supported raster files passed on the command line.



Tile Index Notes
• The shapefile (index_file) will be created if it doesn't already exist.
• The default tile index field is 'location'.
• Simple rectangular polygons must be generated in the same coordinate system as the raster layer. If the files in the tileindex are not in the same projection as the raster layer, or are in heterogeneous projections, the TILESRS



keyword must be specified in the LAYER definition. See Tileindexes with tiles in different projections
• Raster filenames will be put in the file exactly as they are specified on the commandline.
• Many problems with tile indexes relate to how relative paths in the tile index are evaluated. They should be evaluated relative to the SHAPEPATH if one is set, otherwise relative to the tileindex file. When in doubt absolute paths may avoid path construction problems.
The gdaltindex program is built as part of GDAL. Prebuilt binaries for GDAL including the gdaltindex program can be downloaded as part of the OSGeo4W, FWTools and MS4W distributions.

See alsoTile Indexes
Raster Warping
MapServer is able to resample GDAL rasters on the fly into new projections. Non-GDAL rasters may only be up or down sampled without any rotation or warping.
Raster warping kicks in if the projection appears to be different for a raster layer than for the map being generated. Warped raster layers are significantly more expensive to render than normal raster layers with rendering time being perhaps 2-4 times long than a normal layer. The projection and datum shifting transformation is computed only at selected points, and generally linearly interpolated along the scanlines (as long as the error appears to be less than
0.333 pixels.
In addition to reprojecting rasters, the raster warping ability can also apply rotation to GDAL rasters with rotational coefficients in their georeferencing information. Currently rotational coefficients won't trigger raster warping unless the map and layer have valid (though matching is fine) projection definitions.

24bit RGB Rendering
Traditionally MapServer has been used to produce 8 bit pseudo-colored map displays generated from 8bit greyscale or pseudocolored raster data. However, if the raster file to be rendered is actually 24bit (a red, green and blue band) then additional considerations come into play. Rendering of 24bit imagery is supported via the GDAL renderer.
If the output is still 8bit pseudo-colored (the IMAGEMODE is PC256 in the associated OUTPUTFORMAT declaration) then the full 24bit RGB colors for input pixels will be converted to a color in the colormap of the output image. By default a color cube is used. That is a fixed set of 175 colors providing 5 levels of red, 7 levels of green and 5 levels of blue is used, plus an additional 32 greyscale color entries. Colors in the input raster are mapped to the closest color in this color cube on the fly. This substantial degrades color quality, especially for smoothly changing images. It also fills up the colors table, limited to 256 colors, quite quickly.
A variation on this approach is to dither the image during rendering. Dithering selects a color for a pixel in a manner that "diffuses error" over pixels. In an area all one color in the source image, a variety of output pixel colors would be selected such that the average of the pixels would more closely approximate the desired color. Dithering also takes advantage of all currently allocated colors, not just those in the color cube. Dithering requires GDAL 1.1.9 or later, and is enabled by providing the PROCESSING "DITHER=YES" option in the mapfile. Dithering is more CPU intensive than using a simple color cube, and should be avoided if possible in performance sensitive situations.
The other new possibility for handling 24bit input imagery in MapServer 4.0 or later, is to produce 24bit output images. The default "IMAGETYPE png24" or "IMAGETYPE jpeg" declaration may be used to produce a 24bit PNG output file, instead of the more common 8bit pseudo-colored PNG file. The OUTPUTFORMAT declaration provides for detailed control of the output format. The IMAGEMODE RGB and IMAGEMODE RGBA options produce 24bit and 32bit (24bit plus 8bit alpha/transparency) for supported formats.



Special Processing Directives
As of MapServer 4.0, the PROCESSING parameter was added to the LAYER of the Mapfile. It is primarily used to pass specialized raster processing options to the GDAL based raster renderer. The following processing options are supported in MapServer 4.0 and newer.
BANDS=red_or_grey[,green,blue[,alpha]]
This directive allows a specific band or bands to be selected from a raster file. If one band is selected, it is treated as greyscale. If 3 are selected, they are treated as red, green and blue. If 4 are selected they are treated as red, green, blue and alpha (opacity).
Starting with MapServer 8, a GDAL mask band attached to the raster (that is not an alpha band) will be automatically used for opacity rendering when BANDS is specified, unless the PROCESSING "USE_MASK_BAND=NO" option is set.
Example:

CLASSIFY_SCALED=YES/NO
This directive (added in 7.6) allows classification to use pre-scaled raster data for 16 bit rasters. In the example below data in the range 0-28 is stretched to the 0-255 range and then classified.
Example:

COLOR_MATCH_THRESHOLD=n
Alter the precision with which colors need to match an entry in the color table to use it when producing 8bit colormapped output (IMAGEMODE PC256). Normally colors from a raster colormap (or greyscale val- ues) need to match exactly. This relaxes the requirement to being within the specified color distance. So a COLOR_MATCH_THRESHOLD of 3 would mean that an existing color entry within 3 (sum of difference in red, green and blue) would be used instead of creating a new colormap entry. Especially with greyscale raster layers, which would normally use all 256 color entries if available, this can be a good way to avoid "stealing" your whole colormap for a raster layer. Normally values in the range 2-6 will give good results.
Example:

DITHER=YES
This turns on error diffusion mode, used to convert 24bit images to 8bit with error diffusion to get better color results.
Example:

EXTENT_PRIORITY=WORLD
Override GDAL with a world file. Example:



GAMMA=<numeric_value>
This directive (MapServer 8.4+) instructs the GDAL reader to apply a gamma correction step. The default value is 1.0 (no gamma correction). It is performed after classification, if any. It does not apply to raw rendering.
Example:

LOAD_FULL_RES_IMAGE=YES/NO
This option affects how image data is loaded for the resampler when reprojecting or otherwise going through complex resampling (as opposed to the fast default image decimation code path). This forces the source image to be loaded at full resolution if turned on (default is NO). This helps work around problems with default image resolution selection in when radical warping is being done. It can result in very slow processing if the source image is large.
LOAD_WHOLE_IMAGE=YES/NO
This option affects how image data is loaded for the resampler (as above). This option, if turned on, will cause the whole source image to be loaded and helps make up for problem identifying the area required, usually due to radical image reprojection near a dateline or projection "horizon". The default is NO. Turning this on can dramatically affect rendering performance and memory requirements.
LUT[_n]=<lut_spec>
This directive (MapServer 4.9+) instructs the GDAL reader to apply a custom LUT (lookup table) to one or all color bands as a form of on the fly color correction. If LUT is used, the LUT is applied to all color bands. If LUT_n is used it is applied to one color band (n is 1 for red, 2 for green, 3 for blue, 4 for alpha).
The LUT can be specified inline in the form:

This essentially establish particular input values which are mapped to particular output values. The list implic- itly begins with 0:0, and 255:255. An actual 256 entry lookup table is created from this specification, linearly interpolating between the values. The in values must be in increasing order.
Starting with MapServer 7.2, the range of input values can go up to 65535. The last point of the curve must be explicitly listed, e.g. for a 12-bit raster, 4095:255. This extended LUT syntax is only properly supported if no SCALE directive is specified, since the purpose of extended LUT is mainly to avoid pre-scaling.
The LUT specification may also be in a text file with the <lut_spec> being the filename. The file contents should be in the same syntax, and the file is searched relative to the mapfile.
Example:

As a special case there is also support for GIMP format curve files. That is the text files written out by the Tools->Color->Curves tool. If this is specified as the filename then it will be internally converted into linear segments based on the curve control points. Note that this will not produce exactly the same results as the GIMP because linear interpolation is used between control points instead of curves as used in the GIMP. For a reasonable number of control points the results should be similar. Also note that GIMP color curve files include an overall "value" curve, and curves for red, green, blue and alpha. The value curve and the appropriate color curve will be composed internally to produce the final LUT.
Example:





OVERSAMPLE_RATIO=double
Default is 2.5. Rendering time will increase with increasing OVERSAMPLE_RATIO. Example:
RESAMPLE=NEAREST/AVERAGE/BILINEAR
This option can be used to control the resampling kernel used sampling raster images. The default (and fastest) is NEAREST. AVERAGE will perform compute the average pixel value of all pixels in the region of the disk file being mapped to the output pixel (or possibly just a sampling of them). BILINEAR will compute a linear interpolation of the four pixels around the target location. This topic is discussed in more detail in rfc4.
Resampling options other than NEAREST result in use of the generalized warper and can dramatically slow down raster processing. Generally AVERAGE can be desirable for reducing noise in dramatically downsampled data, and can give something approximating antialiasing for black and white linework. BILINEAR can be helpful when oversampling data to give a smooth appearance.
Example (chose one):

SCALE[_n]=AUTO or min,max
This directive instructs the GDAL reader to pre-scale the incoming raster data. It is primarily used to scale 16bit or floating point data to the range 0-255, but can also be used to contrast stretch 8bit data. If an explicit min/max are provided then the input data is stretch (or squished) such that the minimum value maps to zero, and the maximum to 255. If AUTO is used instead, a min/max is automatically computed. To control the scaling of individual input bands, use the SCALE_1, SCALE_2 and SCALE_3 keywords (for red, green and blue) instead of SCALE which applies to all bands.
Example:

WORLDFILE=<file>
Specifies an alternative world file (for georeferencing). If a path only is specified, the base name of the dataset will be appended. The suffix (.wld / .tfw / . . . ) can be omitted.
Example:




Raster Labelling
Added in version 8.4.
This is the ability to render labels from raster pixel values, as an alternative or complement to other typical raster rendering (grayscale, classification, etc.). Typical applications are for temperature, wind, humidity, slopes, altitude, noise, pollution, etc.
Visual example:



LAYER Description
A raster labelling layer LAYER is a hybrid layer, which has a raster data source as input and vector features as output. The output features are represented as points. Queries are not supported.
Since the data source is a raster, all raster processing options can be used (e.g. RESAMPLE). RESAMPLE=AVERAGE generally gives a good result, and the default. This can be overridden by explicitly specifying the type of resampling.
Vector field layers are of TYPE point, and have CONNECTIONTYPE rasterlabel. The raster data set is specified in
DATA. The band to label is set through the PROCESSING BANDS option.

LAYER Attributes
The rasterlabel connection type offers the following attribute:
• [value]: the raw value

Optional PROCESSING Settings
• BANDS=<num>: Specify the band to label. Not needed if there is a single band.
• LABEL_SPACING=<num>: The spacing is simply the distance, in pixels, between points to be displayed in the vector field. Default is 32.
• RESAMPLE=NEAREST/AVERAGE/BILINEAR: Defaults to AVERAGE.
• ALLOW_OVERSAMPLE=YES/NO: Whether it is allowed to oversample the raster at a resolution higher than its nominal resolution. Default is NO, meaning that when zooming in beyond the nominal resolution of the raster,



at most one point will be generated for each source pixel. This gives to the user a sense of the resolution of the data it displays.

Example of a layer definition


Raster Query
A new feature added in MapServer 4.4 is the ability to perform queries on rasters in a manner similar to queries against vector layers. Raster queries on raster layers return one point feature for each pixel matching the query. The point features will have attributes indicating the value of different bands at that pixel, the final rendering color and the class name. The resulting feature can be directly access in MapScript, or processed through templates much like normal vector query results. Only raster layers with a query TEMPLATE associated can be queried, even for the query methods that don't actually use the query template (much like vector data).
Raster query supports QueryByPoint, QueryByRect, and QueryByShape. QueryByPoint supports single and multiple result queries. Other query operations such as QueryByIndex, QueryByIndexAdd, QueryByAttributes and Query- ByFeature are not supported for raster layers.
Raster layers do not support saving queries to disk, nor query maps.
Raster queries return point features with some or all of the following attributes:
x
georeferenced X location of pixel.
y
georeferenced Y location of pixel.
value_list
a comma separated list of the values of all selected bands at the target pixel.
value_n
the value for the n'th band in the selected list at this pixel (zero based). There is one value_n entry for each selected band.

class


Name of the class this pixel is a member of (classified layers only).




red


red component of the display color for this pixel.

green
green component of the display color for this pixel.

blue


blue component of the display color for this pixel.

The red, green and blue attribute are intended to be the final color the pixel would be rendered with, but in some subtle cases it can be wrong (ie. classified floating point results). The selected bands are normally the band that would be used to render the layer. For a pure query-only layer BANDS PROCESSING directive can be used to select more bands than could normally be used in a render operation. For instance for a 7 band landsat scene a PROCESSING "BANDS=1,2,3,4,5,6,7" directive could be used to get query results for all seven bands in results to a query operation.
Care should be taken to avoid providing a large query area (selecting a lot of pixels) as each selected pixel requires over 100 bytes of memory for temporary caching. The RASTER_QUERY_MAX_RESULT PROCESSING item can be used to restrict the maximum number of query results that will be returned. The default is one million which would take on the order of 100MB of RAM.
Query results can be returned as HTML via the normal substitution into query template HTML. Query results are also accessible via WMS GetFeatureInfo calls, and from MapScript. The following example shows executing a feature query from Python MapScript and fetching back the results:

This following is a simple example query TEMPLATE file. The raster pixel attributes will be substituted in before the query result is returned to the user as HTML.




Internally raster query results are essentially treated as a set of temporary features cached in RAM. Issuing a new query operation clears the existing query cache on the layer. The transitory in-memory representation of raster query results is also responsible for the inability to save raster query results since saved query results normally only contain the feature ids, not the entire features. Some addition information is available in the RasterQuery Wiki topic.

Raster Display Performance Tips
• Build overview levels for large rasters to ensure only a reasonable amount of data needs to be touched to display an overview of a large layer. Overviews can be implemented as a group of raster layers at different resolutions, using MINSCALEDENOM, and MAXSCALEDENOM to control which layers are displayed at different resolutions.
Another, perhaps easier way, is to build overviews for GDAL supported formats using the gdaladdo utility.
• When using tileindexes to manage many raster files as a single file, it is especially important to have an overview layer that kicks in at high scales to avoid having to open a large number of raster files to fulfill the map request.
• Preprocess RGB images to eightbit with a colormap to reduce the amount of data that has to be read, and the amount of computation to do on the fly.
• For large images use tiling to reduce the overhead for loading a view of a small area. This can be accomplished using the TILEINDEX mechanism of the mapfile, or by creating a tiled format file (ie. TIFF with GDAL).
• Ensure that the image is kept on disk in the most commonly requested projection to avoid on-the-fly image warping which is fairly expensive.
• If you are getting debug output from MapServer in your web server log file, check to see if the message msRe- sampleGDALToMap in effect appears. If so, the raster layer is being resampled. If you don't think it should be resampled carefully review your map file to ensure that the layer projection exactly matches the map projection
or that the layer has no projection definition.

See alsoDebugging MapServer
Preprocessing Rasters
The following operations use GDAL commandline utilities, some of which are python scripts. They are generally available on any GDAL installation with python support.

Producing Tiled Datasets
The TIFF and Erdas Imagine formats support internal tiling within files, and will generally give better display speed for local map requests from large images. To produce a GeoTIFF file in internally tiled format using the TILED=YES creation option with the gdal_translate utility:

Erdas Imagine (HFA) files are always tiled, and can be larger than 4GB (the GeoTIFF limit). Use a command like the following to translate a raster to Imagine format:




Reducing RGB to 8bit
Rendering and returning 24bit images (especially as PNG) can be quite expensive in render/compress time and band- width. Pre-reducing raster data to 8bit can save disk space, processing time, and bandwidth. However, such a color reduction also implicitly reduces the quality of the resulting map. The color reduction can be done on the fly by MapServer but this requires even more processing. A faster approach is to pre-reduce the colors of 24bit imagery to 8bit. This can be accomplished with the GDAL rgb2pct.py script like this:

By default images will be reduced to 256 colors but this can mean there are not enough colors to render other colors in the map. So it may be desired to reduce to even less colors:

Downsampling to 8bit should be done before internal tiling and overview building. The rgb2pct.py script tries to compute an optimal color table for a given image, and then uses error diffusion during the 24bit to 8bit reduction. Other packages (such as ImageMagick or Photoshop) may have alternative color reduction algorithms that are more appropriate for some uses.

Building Internal Overviews
Most GDAL supported raster formats can have overviews pre-built using the gdaladdo utility. However, a few formats, such as JPEG2000, MrSID, and ECW already contain implicit overviews in the format themselves and will not generally benefit from external overviews. For other formats (such as GeoTIFF, and Erdas Imagine format) use a command like the following to build overviews:

The above would build overviews at x2 through x128 decimation levels. By default it uses "nearest neighbour" down- sampling. That is one of the pixels in the input downsampled area is selected for each output pixel. For some kinds of data averaging can give much smoother overview results, as might be generated with this command:

Note that overview building should be done after translating to a final format. Overviews are lost in format conversions using gdal_translate. Also, nothing special needs to be done to make MapServer use GDAL generated overviews. They are automatically picked up by GDAL when MapServer requests a reduced resolution map.

Building External Overviews
When working with large collections of raster files using a MapServer tileindex, it is desirable to build reduced resolu- tion overview layers that kick in at high scales (using MINSCALEDENOM / MAXSCALEDENOM to control which layer activates). Preparing the overviews can be a somewhat complex process. One approach is to use the gdal_merge.py script to downsample and mosaic all the images. For instance if we want to produce an overview of many 1meter ortho photos with 250 meter pixels we might do something like:

The gdal_merge.py utility suffers from a variety of issues, including no support for different resampling kernels. With GDAL 1.3.2 or later it should be able to accomplish something similar with the more flexible gdalwarp utility:

In some cases the easiest way of generating an overview is to let MapServer do it using the map2img utility. For instance if the tileindex layer is called ''orthos" we could do something like:





Note that the overview will be generated with the extents and size in the .map file, so it may be necessary to temporarily adjust the map extents and size values to match the raster extents and the desired output size. Also, if using this method, don't leave large files in PNG (or GIF or JPEG) format as they are slow formats to extract subareas from.

Georeference with World Files
World files are a simple mechanism for associating georeferencing (world coordinates) information with raster files. ESRI was the first company to propagate the use of world files, and they are often used with TIFF instead of embedding georeferencing information in the file itself.
The world file contents look like the following. The first coefficient is the X pixel size. The second and third are rotational/shear coefficients (and should normally be 0.0). The fourth is the Y pixel size, normally negative indicating that Y decreases as you move down from the top left origin. The final two values are the X and Y location of the center of the top left pixel. This example is for an image with a 2m x 2m pixel size, and a top left origin at (356800E, 5767999N):

The name of the world file is based on the file it relates to. For instance, the world file for aerial.tif might be aerial.tfw. Conventions vary for appropriate endings, but with MapServer the extension .wld is always OK for world files.

8.1.3 Virtual File System
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2025-04-14

Table of Contents• Virtual File System
- Virtual File System
* More Information on Virtual File System
* Display Compressed File Directly in MapServer
* Step 1: Verify Format is "Virtual" Enabled
* Step 2: Test Access through ogrinfo/gdalinfo
* Step 3: Configure MapServer Layer
* Step 4: Test your Mapfile




Virtual File System
Starting with GDAL version 1.8.0, it is possible to read and display "virtual" VECTOR and RASTER files, such as to a remote file by pointing to a URL, or a compressed local .zip file that contains an OGR data source, and display that in MapServer. Useful mapfile parameters include /vsizip/, /vsigzip/, /vsitar/, /vsicurl/

More Information on Virtual File System
• GDAL's virtual file systems instructions
• Blog post by initial developer Even Rouault
• GDAL's old Wiki page (might be outdated, but it is still a good source of information)

Display Compressed File Directly in MapServer
The following example uses a compressed shapefile, "test.zip", that contains 3 files:


Step 1: Verify Format is "Virtual" Enabled
Execute ogrinfo -formats (for vector) or gdalinfo -formats (for raster) to check if the format lists a "v" beside the driver name, such as:


The "(rw+v)" beside shapefile indicates that virtual files are supported.



Step 2: Test Access through ogrinfo/gdalinfo
Use ogrinfo with /vsizip/ to summarize the features of the zipped shapefile. Follow the OGR Vector Layers Through MapServer document examples for how to use the ogrinfo command with layers, such as:

Note that "test.zip" exists in the same directory where we are running the ogrinfo command.


Step 3: Configure MapServer Layer
Once you have verified that you can read the features with ogrinfo (or gdalinfo for raster), then we can try creating a map in MapServer.

WarningA full (absolute) path is required for the CONNECTION parameter, for these virtual layers.






Step 4: Test your Mapfile
Verify that MapServer can generate a map image by using the map2img utility:




See alsoDebugging MapServer
Display Remote Compressed File Directly in MapServer
We can also display an external compressed file, that is accessible through HTTP, using /vsicurl/ with /vsizip/

Test Access through ogrinfo/gdalinfo


Configure MapServer Layer











(continues on next page)



(continued from previous page)


WarningVirtual layers have a "cost" / are not as fast to display in MapServer as regular layers.
Display Remote (RASTER) File Directly in MapServer
Remote raster files can also be accessed through HTTP, using /vsicurl/

Test Access through gdalinfo



Configure MapServer Layer







Since the GDAL/OGR library is used for vector and raster access in MapServer, many more formats are supported, so please see the OGR (vector) and GDAL (raster) formats pages.


CHAPTER
NINE



OUTPUT



9.1 Output Generation
9.1.1 AGG Rendering Specifics
Author
Thomas Bonfort
Contact
thomas.bonfort at gmail
Last Updated
2008-11-24


Introduction
MapServer 5.0 released with a new rendering backend. This howto details the changes and new functionality that this adds to map creation. This howto assumes you already now the basics of mapfile syntax. If not, you should probably be reading the mapfile syntax.

Setting the OutputFormat
24 bit png (high quality, large file size):

24 bit png, transparent background:





24 bit jpeg (jpeg compression artifacts may appear, but smaller file size):

png output, with number of colors reduced with quantization.


New Features
• All rendering is now done antialiased by default. All ANTIALIAS keywords are now ignored, as well as TRANS- PARENCY ALPHA. Pixmaps and fonts are now all drawn respecting the image's internal alpha channel (unless a backgroundcolor is specified).
• As with GD in ver. 4.10, using a SYMBOL of type ELLIPSE to draw thick lines isn't mandatory anymore. To draw a thick line just use:

• A line symbolizer has been added, that works with vector or pixmap symbols, to draw textured lines. This happens by default if a line's style is given a symbol of type vector or pixmap. To enable "shield" symbolization,
i.e. a marker placed only on some points of the line, you must add a GAP parameter to your symbol definition. This GAP value is scaled w.r.t the style's SIZE parameter. Specify a positive gap value for symbols always facing north (optionally rotated by the ANGLE of the current style), or a negative value for symbols that should follow the line orientation




• This happens by default if a line's style is given a symbol of type vector or pixmap. To enable "shield" sym- bolization, i.e. a marker placed only on some points of the line, you must add a GAP parameter to your symbol definition. This GAP value is scaled w.r.t the style's SIZE parameter - specify a positive gap value for symbols
always facing north (optionally rotated by the ANGLE of the current style), or a negative value for symbols that should follow the line orientation
• Pixmap and font symbols can now be rotated without losing their transparency
• For POLYGON layers with no specific SYMBOL, the WIDTH keyword specifies the width of the outline, if an OUTLINECOLOR was specified. This is a shorthand that avoids having to create multiple styles for basic
rendering, and will provide a marginal performance gain. Note that in this case, the width of the outline is /not/ scale dependent.

Modified Behavior
• When specifying a SYMBOL for a polygon shape, the GAP parameter of the symbol is used as a separation between each rendered symbol. This works for symbols of type vector, pixmap and ellipse. For example a symbol defined by

that is rendered in a class where SIZE is 15 will be rendered like

• layers of type CIRCLE support hatch type symbol filling
• the ENCODING keyword for labels is now enforced. If unset, MapServer will treat your label text byte-by-byte (resulting in corrupt special characters).

9.1.2 AntiAliasing with MapServer
Author
Pericles Nacionales
Contact
naci0002 at umn.edu
Last Updated
2009/01/17




WarningThis document is outdated. Since version 6.0, MapServer will produce aliased output for the "gd/" drivers, and antialiased output for the "agg/" and "cairo/" ones



What needs to be done
1. Change (or add) IMAGETYPE keyword in MAP object to PNG24 (24-bit PNG output) or JPEG

2. Add TRANSPARENCY to the LAYER object and set value to ALPHA

3. Add ANTIALIAS keyword to the STYLE object within the CLASS object within the LAYER and set value to TRUE







(continues on next page)



(continued from previous page)


Here's an example of a real-world mapfile:



1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21
(continues on next page)



(continued from previous page)
22	TRANSPARENCY ALPHA
23
24	PROJECTION
25	"init=epsg:4326"
26	END
27
28	CLASS
29	NAME 'Country Boundary'
30	STYLE
31	COLOR 96 96 96
32	ANTIALIAS TRUE
33	END
34	END
35	END # end country boundary layer
36
37	# The layer below shows one way to draw a polygon with antialiased outline
38	LAYER # begin antialiased country boundary (polygon) layer
39	NAME 'country_line'
40	DATA 'shapefile/Countries_area.shp'
41	TYPE POLYGON
42	STATUS ON
43	TRANSPARENCY ALPHA
44
45	PROJECTION
46	"init=epsg:4326"
47	END
48
49	CLASS
50	NAME 'Country Boundary'
51	STYLE
52	COLOR 212 212 212
53	OUTLINECOLOR 96 96 96
54	WIDTH 3
55	ANTIALIAS TRUE
56	END
57	END
58	END # end country boundary polygon layer
59
60	# The layer below shows one way to draw a polygon with antialiased outline
61	LAYER # begin antialiased state boundary (line) layer
62	NAME 'state_line'
63	DATA 'shapefile/us_states.shp'
64	TYPE LINE
65	STATUS ON
66	TRANSPARENCY ALPHA
67
68	PROJECTION
69	"init=epsg:4326"
70	END
71
72	CLASS
73	NAME 'State Boundary'
(continues on next page)



(continued from previous page)
74

75

76

77

78

79

80

81


Here's how the 'cartoline' symbol is defined:




9.1.3 Dynamic Charting
Author
Thomas Bonfort
Contact
thomas.bonfort at gmail.com
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2021-04-15

Table of Contents



Starting with version 5.0, MapServer includes the ability to automatically draw pie or bar graphs whose values are taken and adjusted from attributes of a datasource.

This document assumes that you are already familiar with MapServer application development and especially setting up mapfiles. You can also check out the Vector Data Access Guide, which has lots of examples of how to access specific data sources.

Setup
Supported Renderers
Dynamic charts are supported through the AGG renderer (for PNG output) and Cairo renderer (for PDF & SVG output) for MapServer 7 and more recent versions, as the GD renderer was removed in the MapServer 7.0 release; MapServer versions 5 and 6 support the GD and AGG renderers for dynamic charting.



Attempting to add a chart layer with an unsupported renderer will result in undefined behavior. Rendering quality with the GD renderer (if you are using MapServer 5 or 6) is less than optimal, especially with small graphs, due to the lack of subpixel rendering functions.

Output from AGG and GD Renderers
MapServer AGG Rendering


MapServer GD Rendering


Adding a Chart Layer to a Mapfile Layer Type
A new type of layer has been added to the mapfile syntax. To specify a chart layer, use

No other specific keywords have been added in order to keep the number of different keywords to a minimum in the mapfile syntax, therefore all the chart specific configuration is determined by PROCESSING directives.

Specifying the Size of each Chart
The size of each chart is specified by the CHART_SIZE directive. If two values are given for this parameter, this will specify the width and height of each chart (this only applies for bar graphs). By default, the charts are 20x20 pixels.

The diameter of a pie chart can be bound to an attribute,using the CHART_SIZE_RANGE PROCESSING attribute:

or just





where:
• itemname is the name of the attribute that drives the chart size (e.g. total_sales)
• minsize and maxsize are the minimum and maximum chart size values in pixels (e.g. "10 100")
• minval and maxval are the minimum values of the attribute that correspond to chart sizes of minsize and maxsize (e.g. 10000 1000000).
• exponent (optional) applies an exponential factor to the diameter, calculated with:

If the attribute value is smaller than 'minval' then the chart size will be minsize pixels, and if the attribute value is larger than maxval, the chart size will be maxsize pixels.

Specifying the Values to be Plotted
Each value to be plotted (i.e. a slice in a pie chart, or a bar in a par graph) is specified in a CLASS of the chart layer. The value to be plotted is taken from the SIZE keyword from the first STYLE block of the class. This is semantically a bit awkward, but keeps the number of different keywords to a minimum in the mapfile syntax. The value given to the SIZE keyword could of course be given a static value, but dynamic charting really only makes sense with attribute binding.

At least 2 CLASS blocks must be specified before charting can occur (but you already knew this if you want your charts to convey at least some information).

Specifying Style
The styling of each value in the charts is specified by the usual MapServer syntax. Only one style per class is supported, any other STYLE block will be silently ignored. Only a subset of the styling keywords are supported:






Pie Charts
This is the default type of chart that is rendered. This can also be specifically set with a PROCESSING keyword in the layer attributes:

For each shape in the layer's datasource, the STYLE SIZE is used to set the relative size (value) of each pie slice, with the angles of the slices that are automatically computed so as to form a full pie. For example:

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

24

25
(continues on next page)



(continued from previous page)
26

27

28

29

30

31


In the example above, if for a given shape we have v1006=1000, v1007=600 and v1008=400 then the actual pie slices for each class will be respectively 50%, 30% and 20% of the total pie size.

Pie Chart Expressions
Expressions can be used within a CLASS to generate a pie chart for a layer. This is best explained through an example. Let's say we have 3 polygons, with the following crop type attributes:

IDNAMETYPE1polygon1corn,rice2polygon2wheat3polygon3rice,corn,wheat
We can use an expression to give a specific color for each crop type, such as:






























(continues on next page)



(continued from previous page)



More examples of working mapfiles with expressions can be found within the msautotest suite.


Bar Graphs
Bar graph drawing is set with a PROCESSING keyword in the layer attributes:

For each shape in the layer's datasource, the STYLE SIZE is used to set the relative size (value) of each bar in the graph. By default, the vertical axis of each bar graph is scaled for the values of the corresponding shape, and will always include the origin (=0). For example
• a shape whose STYLE SIZEs contains values {5,8,10,3} will be plotted on a graph whose vertical axis spans 0 to 10.
• a shape whose STYLE SIZEs contains values {-5,-8,-10,-3} will be plotted on a graph whose vertical axis spans
-10 to 0.
• a shape whose STYLE SIZEs contains values {-5,-8,10,3} will be plotted on a graph whose vertical axis spans
-8 to 10.
Additional PROCESSING directives are used to optionally specify the bounds of vertical axes so that the graphs for all the shapes can be plotted with the same scale:





Values in the datasource that are above CHART_BAR_MAXVAL or below CHART_BAR_MINVAL will be clipped respectively to these values. If only one of these directives is included, the other will be automatically adjusted for each shape to include at least the origin, i.e. the graphs for all the shapes will be in the same scale only if all the values are of the same sign (positive or negative).

Stacked bar Graphs
Stacked bar graphs can be drawn using:


9.1.4 Flash Output
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Author
Yewondwossen Assefa
Last Updated
2008-07-15


Introduction




WarningSWF is no longer supported since version 6.0
Since MapServer 4.0, MapServer can output Flash files, in SWF format (or "Shockwave Flash Format"). The following document outlines how to enable Flash output in MapServer.

Installing MapServer with Flash Support
To check that your mapserv executable includes Flash support, use the "-v" command-line switch and look for "OUT- PUT=SWF".


Using Pre-compiled Binaries
Windows users can use MS4W, which supports SWF output.

Compiling MapServer with Flash Support
The library chosen to output SWF files is the Ming library. Ming is a C library for generating SWF ("Flash") format movies, and it contains a set of wrappers for using the library from C++ and popular scripting languages like PHP, Python, and Ruby.

Building on Windows
• download the Ming library (the version currently supported is 0.2a)
• as of Ming 0.3 there was no makefile for Windows available in the distribution yet, but you can download a MS VC++ makefile (makefile.vc) from here (contains makefile and also libming.lib)
• copy makefile.vc under the src directory (ming-0.2/src)
• execute:

• at this point you should have a libming.lib that will be linked with MapServer
• edit the nmake.opt in your MapServer directory and uncomment the MING=-DUSE_MING_FLASH flag, and point MING_DIR to your Ming directory.
• build MapServer as usual



Building on Unix
Use the "-with-ming" configure flag to enable MING support on Unix. "-with-ming=dir" will try to find the include files and library in the indicated directory.


How to Output SWF Files from MapServer
SWF output is specified by using the OUTPUTFORMAT object. There are 2 possible output types:
1. A single movie containing the raster output for all the layers. To enable this, declare the following in the map file:

2. A movie for every layer (vector movies for vector layers and raster movies for raster layers). To enable this, declare the following in the map file:


Other OutputFormat Options
• FORMATOPTION "FULL_RESOLUTION=FALSE"
The FULL_RESOLUTION applies only for vector layers. If set to FALSE, filtering will be applied to the vector elements. It results in a smaller SWF file. The default value is TRUE.
• FORMATOPTION "LOAD_AUTOMATICALLY=OFF"
Setting this option to OFF will not load the SWF files for each layer. The default value is ON.

Composition of the Resulting SWF Files
Several SWF Files will be produced from a single map file: there will be one SWF file for each layer defined in the map file and one 'main' SWF file containing critical information on the map file and the layers produced.
• The 'main' SWF File will contain Action Script (AS) code that gives critical information on the map file and the SWF layers produced. Basically there will be an object called mapObj containing the height, width, extent, scale, number of layers, etc. Here is an example (in AS) of the contents of this main movie:





This example is produced based on a mapfile with two layers defined in it. We create a layer class object con- taining useful information on a layer. The parameters are:
- Name : the name found in the map file
- Type : the type of layer ( 0 = Point Layer; 1=Line; 2=Polygon; 3=Raster; 4=Annotation; 6=Circle)
- Fullname : Full name of the file with path included
- Relative name : Relative Name
For example you can use mapObj.layers[0].name to extract the name of the first layer.
Note: All map parameters from MapServer are not exported at this time. We should come up with a list of information of what we want to output. Note that this information can be used in a Flash application to load the SWF file, to build a legend, to build a scale bar, etc.
• SWF Files for each layer
Each layer defined in the mapfile will have an associated SWF file created. The names of these SWF files are based on the name of the main file with an addition of 'layer_X' at the end of the name (where X is the layer index).
These SWF files will contain vector and raster data as well as some Action Script depending on the layer and some configurations in the map file. We will see these configurations in detail in the following section.

Exporting Attributes
Exporting attributes works on a layer basis (it is only available for Vector Layers). To be able to export attributes to the SWF files, you have to define a metadata item called SWFDUMPATTRIBUTES in the layer section of the mapfile. Here is an example :



(continues on next page)



(continued from previous page)
In the above example, the values for the attributes NAME_E and AREA_KMSQ will be exported for each element in the layer.
The resulting SWF File will have the values of these attributes (written in Action Script). Here is an example related to the above layer:


Events and Highlights
Here is what is currently implemented concerning events (events here refer to mouse events happening on an element. The available events are MOUSEUP, MOUSEDOWN, MOUSEOVER, MOUSEOUT):
• Events are only available for layers that have defined attributes exported (using SWFDUMPATTRIBUTES). This is like defining that a certain layer is queryable.
• When a mouse event happens on one of the elements, there is an Action Script call that is made:
_root.ElementSelecetd(LayerId, ShapeId, Event) . The Flash application who wants to receive these events
should define the function ElementSelected and use the information received to do actions like retrieving the attribute values from the specific SWF for the specified shape and display it.
In order to have highlighting, it has to be defined when the SWF is produced (basically highlighting means that the shape is redrawn using a different color).
As of MapServer 5.0, highlighting is available on queryable layers by using the QueryMap object in the map file to extract the color and do a highlight when on MOUSEOVER. The current implementation will highlight all objects that are in a layer that uses SWFDUMPATTRIBUTES, using the COLOR set in the QueryMap object in the mapfile.
Before MapServer 5.0, all objects that are in a layer that uses SWFDUMPATTRIBUTES are highlighted using a red color.

Fonts
Ming uses a special type of font called FDB files. It does not yet support Truetype fonts. Please refer to ming docu- mentation on how to produce FDB files.



Outputting Raster SWF for Vector Layers
One mechanism would be to use the metadata for layer objects to define a raster output for vector layers. We could use something like "SWFOUTPUT" "RASTER". If this sounds desirable, please file an enhancement ticket with this request, specifying the "Output-SWF" component.

What is Currently Supported and Not Supported
1. Vector layers
• Layer Point (case MS_LAYER_POINT) : done
- msDrawMarkerSymbol
- msDrawLabel
• Layer line (case MS_LAYER_LINE) : done
- msDrawLineSymbol
- msDrawLabel
• Layer circle ( case MS_LAYER_CIRCLE) : not done (should be done easily but missing data for testing)
- omsCircleDrawLineSymbol
- omsCircleDrawShadeSymbol
• Layer annotation (case MS_LAYER_ANNOTATION): done
- omsDrawMarkerSymbol
- omsDrawLabel
• Layer Polygon (MS_SHAPE_POLYGON): done
- omsDrawShadeSymbol
- omsDrawLineSymbol
- omsDrawLabel
• Vector Low Level functions
- omsDrawMarkerSymbol
* case(MS_SYMBOL_TRUETYPE) : done
* case(MS_SYMBOL_PIXMAP) : done
* case(MS_SYMBOL_ELLIPSE) : done
* case(MS_SYMBOL_VECTOR) : done
- omsDrawLineSymbol
* case : simple line : done
• drawing with the symbols : not done
- omsDrawShadeSymbol
* case : solid fill polygon : done
* case : filled with symbols : cannot be implemented for now (tried to create a GD image to fill the shape but files created were huge)
- omsCircleDrawLineSymbol : not done



- omsCircleDrawShadeSymbol : not done
- omsDrawLabel : done
- omsDrawLabelCache : done
- obillboard (shadow for texts) : not done
2. Raster Layer
• msDrawRasterLayer: done
3. WMS Layer
• msDrawWMSLayer: done
4. Surround components (Legend, scalebar) : not supported

9.1.5 HTML Legends with MapServer
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2022-08-20


Introduction
The HTML legend is an alternative to the traditional GIF legend in MapServer. The following document describes the process for implementing an HTML legend in MapServer CGI applications (NOTE: MapServer version > 3.5 is required).
This document assumes that you are already familiar with certain aspects of MapServer:
• Setting up MapServer mapfiles and templates.

Implementation
Key components for generating HTML legends are 1) a template parameter in the legend object, 2) a CGI [legend] tag in the HTML file, and 3) an HTML legend template file. So that means that if the HTML page has the CGI [legend] parameter set, and the mapfile has a LEGEND object with its TEMPLATE set to a valid HTML legend file then an HTML legend will be returned. The following sections discuss these components.



Legend Object of Mapfile
The HTML legend is enabled by a new TEMPLATE parameter in the Legend Object of the mapfile. If TEMPLATE is set in the Legend Object, then the HTML legend template file is read and used to generate an HTML legend which will be inserted at the location of the [legend] tag in the main HTML template. Similar to other MapServer templates, the HTML legend template filename MUST end with an ".html" extension.
Example 1. Sample Legend Object with the new TEMPLATE parameter

If TEMPLATE is not set, then the [legend] tag produces a regular image in a GIF/PNG image (the traditional behaviour).

CGI [legend] tag
The traditional CGI [legend] tag returns the URL of an image, so it is usually used inside an <IMG SRC=[legend]> tag in the HTML file. The new HTML [legend] tag returns a block of HTML, so when converting an existing application template from using a traditional image legend to the new HTML legend, you have to remove the IMG tag in the main application template. Also note that if legend mode is specified in the URL, then MapServer will return a gif containing the whole legend if no template is specified.
See the CGI Reference doc for more information on CGI parameters.
Example 2. [legend] tag in the main HTML template (with TEMPLATE set)

Example 3. [legend] tag in the main HTML template (with TEMPLATE not set)


HTML Legend Template File
The HTML legend template file is a separate file that contains 0 or 1 of each of the following tags that define blocks of HTML to use in building the legend:




Note
Any text or HTML tags outside the [leg_*_html] tag pairs in the legend template file are ignored by the template parser. The following example shows what an HTML legend TEMPLATE file could look like:
Example 4. An HTML legend TEMPLATE file

Supported Tags for the TEMPLATE file:

HEADER block
Tag
[leg_header_html]. . .[/leg_header_html]
Description
HTML block to use as the header of the legend.

FOOTER block
Tag
[leg_footer_html]. . .[/leg_footer_html]
Description
HTML block to use as the footer of the legend.
Example 5. HTML Legend File Using Header/Footer Blocks






GROUP block
Tag
[leg_group_html <OPTIONAL PARAMS>]...[/leg_group_html]
Description
HTML block to use for layer group headers if layers should be grouped in the legend. If not set then layers are not grouped in the legend.
When the [leg_group_html] tag is used, then layers that don't belong to any group (i.e. LAYER GROUP not set in the mapfile) and their classes will not show up at all in the legend. The group list is decided by the order_metadata parameter, which is explained later.
SUPPORTED PARAMETERS:
Parameter
opt_flag=<bit_mask>
Description
Control the group's display, by adding the following values (default is 15). The opt_flag is applied on all layers in the group. If at least one layer matches the flag, the group will show up in the legend.
1
If set, show group even if all layers in group are out of scale (default: hide groups out of scale).
2
If set, show group even if all layers in group have status OFF (default: hide groups with STATUS OFF).
4
If set, show group even if all layers in group are of type QUERY (default: hide group of TYPE QUERY)
8
If set, show group even if all layers in group are of type ANNOTATION (default: hide groups of TYPE ANNOTATION)
Deprecated since version 6.2: Use CLASS->LABEL or CLASS->STYLE in your existing layer instead of a separate ANNOTATION layer
e.g. opt_flag=12 (shown below) means show all layer types, including QUERY and AN- NOTATION layers (4 + 8)





SUPPORTED TAGS:
Tag
[leg_group_name]
Description
Returns the group's name.

Tag


[layer_status]

Description
Returns the status of the first layer in the group.

Tag


[leg_icon width=<optional_width> height=<optional_height>]

Description
In the group context, the [leg_icon] tag returns the URL of a legend icon for the first class in the first layer that's part of this group.

Tag


[metadata name=<metadata_field_to_display>]

Description
Returns specified metadata value from web's metadata.
e.g. the group block below simply displays the name of the group in the legend:


LAYER block
Tag
[leg_layer_html <OPTIONAL PARAMS>] . . . [/leg_layer_html]
Description
HTML block to use for layer header. If not set then no layer headers are displayed (could allow a legend with only classes in it).
SUPPORTED PARAMETERS:
Parameter
order_metadata=<field_to_order_by>
Description
Specifies that the value of the layer metadata <field_to_order_by> controls the order and visibility of the layers in the legend.
• Layers with <field_to_order_by> >= 0 are sorted in order of this value, with multiple layers with same value being accepted, in which case the map layer order applies between those layers.
• Layers with <field_to_order_by> < 0 are always hidden in the legend.



Parameter
opt_flag=<bit_mask>
Description
Control the layer display process. Add the values below to acquire the desired options (default is 15):
1
If set, show layer even if out of scale (default: hide layers out of scale).
2
If set, show layer even if status is OFF (default: hide layers with STATUS OFF).
4
If set, show layer even if type is QUERY (default: hide layers of TYPE QUERY)
8
If set, show layer even if type is ANNOTATION (default: hide layers of TYPE ANNOTATION)
Deprecated since version 6.2: Use CLASS->LABEL or CLASS->STYLE in your existing layer instead of a separate ANNOTATION layer
e.g. opt_flag=14 (shown below) means do not show layers in the legend that are out of scale.

SUPPORTED TAGS:
Tag
[leg_layer_group]
Description
Returns the group name of the layer. This was added to MapServer v4.8.

Tag


[leg_layer_index]

Description
Returns the mapfile index value of the layer, which is useful for ordering. This was added to MapServer v4.8.

Tag


[leg_layer_maxscale]

Description
Returns the maximum scale set for the layer. This was added to MapServer v4.8.

Tag


[leg_layer_minscale]

Description
Returns the minimum scale set for the layer. This was added to MapServer v4.8.

Tag


[leg_layer_name]

Description
Returns the current LAYER NAME value.

Tag


[leg_icon width=<optional_width> height=<optional_height>]



Description
In the layer context, the [leg_icon] tag returns the URL of a legend icon for the first class in this layer.

Tag


[metadata name=<metadata_field_to_display>]

Description
Returns specified metadata value from this layer's metadata and web's metadata.
e.g. the layer block below simply displays an icon of the layer's class and the layer name:


CLASS block
Tag
[leg_class_html <OPTIONAL PARAMS>] . . . [/leg_class_html]
Description
HTML block to use for classes. If not set then no classes are displayed (could allow a legend with only layer headers in it). Note that classes with NULL (i.e. empty) NAMEs are not displayed.
SUPPORTED PARAMETERS:
Parameter
opt_flag=<bit_mask>
Description
Control the layer (i.e. class) display process. Add the values below to acquire the desired options (default is 15). Note that using this parameter for the CLASS block has the same effect as using the opt_flag parameter in the LAYER block.
1
If set, show layer even if out of scale (default: hide layers out of scale).
2
If set, show layer even if status is OFF (default: hide layers with STATUS OFF).
4
If set, show layer even if type is QUERY (default: hide layers of TYPE QUERY)
8
If set, show layer even if type is ANNOTATION (default: hide layers of TYPE ANNOTATION)
Deprecated since version 6.2: Use CLASS->LABEL or CLASS->STYLE in your existing layer instead of a separate ANNOTATION layer
e.g. opt_flag=14 (shown below) means do not show classes in the legend that are out of scale.

SUPPORTED TAGS:




Tag


[leg_class_index]

Description
Returns the mapfile index value of the class, which is useful for ordering and legend icon creation. This was added to MapServer v4.8.

Tag


[leg_class_maxscale]

Description
Returns the maximum scale set for the class. This was added to MapServer v4.8.

Tag


[leg_class_minscale]

Description
Returns the minimum scale set for the class. This was added to MapServer v4.8.

Tag


[leg_class_name]

Description
Returns the CLASS NAME value.

Tag


[leg_class_title]

Description
Returns the CLASS TITLE value.

Tag


[leg_layer_name]

Description
Returns the parent layer name. This was added to MapServer v4.8.

Tag


[leg_icon width=<optional_width> height=<optional_height>]

Description
In the layer context, the [leg_icon] tag returns the URL of a legend icon for the first class in this layer.

Tag


[metadata name=<metadata_field_to_display>]

Description
Returns specified metadata value from the metadata of the layer to which this class belongs and web's metadata.
e.g. the class block below simply displays an icon of the layer's class and the class name:




CONDITIONAL text
[if] tags can be used in any of the [leg_*_html] tags above to place conditional text. The syntax is:

Note:
Nested IF's are supported. Parameter "oper" can be "eq" for equal, "neq" for not equal, "isset" (self-explanatory), or "isnull" (self-explanatory). The default value is equal.
Example 6. [if] tag can be used to maintain the state of a layer checkbox

The possible values that can be tested in an [if] tag depend on the context in which the [if] tag is used. At the moment, the number of values that can be tested is limited, but new values may be added as needed.
Note that the order of the items in the following [if] contexts are listed by their order of precedence. The rule is always that special keywords have top priority (e.g. layer_status, etc.), followed by layer-level metadata, and ending with map-level metadata. The possible values that can be tested are as follows:
In a [leg_group_html] context:
• [if name=layer_status value=. . . ] . . . [/if]
value is the layer status of the first layer that belongs to the group in integer format: 0=OFF, 1=ON, 2=DEFAULT
• [if name=layer_visible value=. . . ] . . . [/if]
value is the visibility of the first layer in the group: 0=NOT VISIBLE, 1=VISIBLE
• [if name=group_name value=. . . ] . . . [/if]
• [if name=any_layer_metadata value=. . . ] . . . [/if]
Uses metadata value from the first layer in the mapfile that belongs to that group
• [if name=any_web_metadata value=. . . ] . . . [/if]
• [if name=layer_queryable value=. . . ] . . . [/if] Added in version 5.6.
         value is the queryability of the first layer in the group: 0=NOT QUERYABLE, 1=QUERYABLE In a [leg_layer_html] context:
• [if name=layer_status value=. . . ] . . . [/if]
value is the layer's status in integer format: 0=OFF, 1=ON, 2=DEFAULT



• [if name=layer_type value=. . . ] . . . [/if]
value is the layer's type in integer format: 0=POINT, 1=LINE, 2=POLYGON, 3=RASTER, 4=AN- NOTATION (deprecated since 6.2), 5=QUERY, 6=CIRCLE
• [if name=layer_name value=. . . ] . . . [/if] value is the layer's name in string format
• [if name=layer_group value=. . . ] . . . [/if]
value is the layer's group name in string format
• [if name=layer_visible value=. . . ] . . . [/if]
value is the visibility of the layer: 0=NOT VISIBLE, 1=VISIBLE
• [if name=any_layer_metadata value=. . . ] . . . [/if]
• [if name=any_web_metadata value=. . . ] . . . [/if]
• [if name=layer_queryable value=. . . ] . . . [/if] Added in version 5.6.
         value is the queryability of the layer: 0=NOT QUERYABLE, 1=QUERYABLE In a [leg_class_html] context:
• [if name=layer_status value=. . . ] . . . [/if]
value is the status of the layer in which the class is located
• [if name=layer_type value=. . . ] . . . [/if]
value is the layer's type in integer format: 0=POINT, 1=LINE, 2=POLYGON, 3=RASTER, 4=AN- NOTATION (deprecated since 6.2), 5=QUERY, 6=CIRCLE
• [if name=layer_name value=. . . ] . . . [/if] value is the layer's name in string format
• [if name=layer_group value=. . . ] . . . [/if]
value is the layer's group name in string format
• [if name=layer_visible value=. . . ] . . . [/if]
value is the visibility of the layer: 0=NOT VISIBLE, 1=VISIBLE
• [if name=class_name value=. . . ] . . . [/if]
• [if name=any_layer_metadata value=. . . ] . . . [/if]
• [if name=any_web_metadata value=. . . ] . . . [/if]
• [if name=layer_queryable value=. . . ] . . . [/if] Added in version 5.6.
value is the queryability of the layer: 0=NOT QUERYABLE, 1=QUERYABLE

Sample Site Using the HTML Legend
https://demo.mapserver.org/itasca_legend/
This demo is based on the MapServer Itasca demo and contains several variations of HTML Legends, some of which are listed below:
• "HTML Legend 1" - displays classes only, similar to the traditional legends:





• "HTML Legend 2" - displays layer titles with HREF links and classes:

• "HTML Legend 3" - displays layers by group, with checkboxes to turn layers on/off:


9.1.6 Inverse distance weighted interpolation




Introduction
Added in version 8.0.
The inverse distance weighted interpolation is a method to rasterize vector features with a weight that is the inverse of a power of the distance between the target pixel and the source feature.

Configuration
First, you must set the LAYER CONNECTIONTYPE parameter to IDW. The vector-to-raster interpolation takes the following parameters:
• CONNECTION "layername" : reference to the NAME or GROUP of a LAYER to use as an input vector data- source. NAME takes precedence, followed by the first layer from GROUP who's minscaledenom/maxscaledenom matches the current map scale. The referenced layer should be a TYPE POINT layer. Other layer types will result
in one sample being added for each vertex of the input features.
• PROCESSING "IDW_RADIUS=10" : Radius in pixels of the search radius of features to take into account. Higher values result in increased cpu time needed to compute the filtered data. The default is the dimension of the image to render.
• PROCESSING "IDW_COMPUTE_BORDERS=ON|OFF" : A kernel of radius "r" cannot be applied to "r" pixels along the borders of the image. The default is to extend the search rectangle of the input datasource to include features "r" pixels outside of the current map extent so that the computed result extends to the full extent
of the resulting image. This can be deactivated when tiling if the tiling software applies a metabuffer of "r" pixels to its requests, to avoid the performance overhead of computing this extra information.
• PROCESSING "IDW_POWER=numeric" :
Value such that 1 / distance^power is the weight applied when computing pixel values. The default is 1.0.

Advanced sample weighting and filtering
See corresponding section of Kernel Density Estimation (Dynamic Heatmap)

Raster Color Ramping
See corresponding section of Kernel Density Estimation (Dynamic Heatmap)

Example mapfiles


















(continues on next page)



(continued from previous page)

9.1.7 HTML Imagemaps
Author
David Fawcett
Contact
david.fawcett at gmail.com
Last Updated
2008-10-08

Contents• HTML Imagemaps
- Introduction
- Mapfile Layer Definition
- Templates
- Request URL
- Additional Notes




Introduction
The shpxy method of creating imagemaps uses MapServer query functionality to build a html imagemap. Just like a regular MapServer query, you send a query request and MapServer uses the templates to build a block of html that it sends back to the browser. The first example shows you how to build an imagemap based on a point layer. An example template for a polygon layer is also included.
Components
• MapServer mapfile
• query template file
• query header template
• query footer template

Mapfile Layer Definition
Here is a simple mapfile for our example




You can see that we have a mapfile with one point layer, and that it contains references to three query templates.

Templates
In MapServer, the query header and footers get processed only once. The main query template, 'bodytemplate.html' in this example, gets processed once for each record in the record set returned by the query.

Point Layers
Here is the query header, 'imapheader.html'. It creates the opening tag for your html imagemap.

Here is the query template, 'bodytemplate.html'. It creates the body of the html imagemap.

This template is used to create circular imagemap elements for a point layer. NAME is a fieldname in the data source, the value for NAME for each individual record gets substituted as the template is processed. The href specifies the URL link if the element is clicked. Title and alt will display the value when an element is moused over.
The resulting html element looks like

The key part here is

This is where MapServer will substitute the image coordinates for that query record. With Precision=0, the coordinates will be integers.
You also see shpxy template formatting options 'xf' and 'yf'. 'xf="," tells MapServer to place a comma after the x coordinate. 'yf=",7" after the y coordinate. This is done to specify a radius of 7 pixels for the circle. More options can be found in the Template Reference.
The query footer template simply adds the closing tag for the html imagemap


Polygon Layers
Here is a query template for a polygon layer


Request URL
To get the imagemap, you need to send a GET or POST request to MapServer with several URL variables defined. The below URL tells MapServer where the mapfile is located, what layer we are querying, and that we are using nquery mode to return multiple results.




Additional Notes
If you use separate map files to generate your imagemap and your map image, make sure that the EXTENT and SIZE specified in both mapfiles are identical. If they are not, your features will not align properly.

More Information
Steve Lime's SHPXY Example

9.1.8 Kernel Density Estimation (Dynamic Heatmap)
Author
Thomas Bonfort, Mathieu Coudert
Contact
tbonfort at terriscope.fr, mathieu.coudert at gmail.com
Last Updated
2014/11/02


Introduction
Added in version 7.0.
A heatmap is a popular method for representing sparse data on a regular raster grid, where each pixel on the grid is influenced inversely to its distance to each sample of the sparse dataset. Heatmaps are usually represented with a color- ramp where the hue encodes the density of the data sample, optionally along with the intensity of an attribute. The "heatmap" term itself is used with varying meanings. We will be using it to reference Kernel Density Estimation maps.

Configuration
First, you must set the LAYER CONNECTIONTYPE parameter to KERNELDENSITY. The heatmap vector-to-raster takes the following parameters:
• CONNECTION "layername" : reference to the NAME or GROUP of a LAYER to use as an input vector data- source. NAME takes precedence, followed by the first layer from GROUP who's minscaledenom/maxscaledenom matches the current map scale. The referenced layer should be a TYPE POINT layer. Other layer types will result
in one sample being added for each vertex of the input features.
• PROCESSING "KERNELDENSITY_RADIUS=10" : radius in pixels of the gaussian filter to apply to the bitmap array once all features have been accumulated. Higher values result in increased cpu time needed to compute the filtered data.
• PROCESSING "KERNELDENSITY_COMPUTE_BORDERS=ON|OFF" : A kernel of radius "r" cannot be applied to "r" pixels along the borders of the image. The default is to extend the search rectangle of the





Fig. 1: Example Kernel Density Estimation Map (image cc-by-sa wikipedia)


Fig. 2: Result with kerneldensity_radius set to 10 (pixels)


Fig. 3: Result with kerneldensity_radius set to 20 (pixels)



input datasource to include features "r" pixels outside of the current map extent so that the computed heatmap extends to the full extent of the resulting image. This can be deactivated when tiling if the tiling software applies a metabuffer of "r" pixels to its requests, to avoid the performance overhead of computing this extra information.
• PROCESSING "KERNELDENSITY_NORMALIZATION=AUTO|numeric" : If set to "AUTO", the cre-
ated raster band will be scaled such that its intensities range from 0 to 255, in order to fully span the configured
color ramp. Such behavior may not be desirable (typically for tiling) as the resulting intensity of a pixel at a given location will vary depending on the extent of the current map request. If set to a numeric value, the samples will be multiplied by the given value. It is up to the user to determine which scaling value to use to make the resulting pixels span the full 0-255 range; determining that value is mostly a process of trial and error. Pixels that fall outside the 0-255 range will be clipped to 0 or 255.


Fig. 4: Fixed scaling applied. Compared to the previous images, the greater number of red areas results from the fact that the chosen scaling factor made a large number of pixels overshoot the 255 limit.


Fig. 5: Lower fixed scaling applied. No pixels have attained the 255 limit.

Advanced sample weighting and filtering
By default, each feature is assigned a weight of 1.0, and the resulting heatmap will represent the spatial density of the vector features. If this is not the desired behavior, different weights can be applied on a feature by feature basis by using regular CLASS / STYLE syntax on the source vector layer. The weight used will be read from the SIZE value of the matched STYLE. Standard EXPRESSION and MINSCALEDENOM / MAXSCALEDENOM apply; if a feature results in no matching CLASS and/or STYLE, it is ignored and discarded from the resulting heatmap. The examples at the end give some examples as to how this can be achieved.


Fig. 6: Heatmap representing pure feature density when sample weighting or filtering is not applied, the actual vector points are represented alongside. (The other examples are rendered with attribute weighting on each sample)

Raster Color Ramping
The features added in rfc6 for vector features, and since extended to support raster layers, will be extended in order to support more complex color ramps. Note that these additions will apply to all raster classifications, not only for heatmap layers.
• Support for multiple stops : The actual support for ranges for raster layers is limited to a single COLORRANGE
/ DATARANGE. We will support multiple ranges in order to allow multiple color stops, and will also account
for optional alpha values. The following example creates a ramp ranging from fully transparent blue to blue for values between 0 and 32, then blue to red for values ranging from 32 to 255.



Fig. 7: washed out colors when interpolating in RGB space.



• PROCESSING RANGE_COLORSPACE=RGB|HSL: The current RANGE support interpolates colors be- tween stops in RGB space, which usually results in washed out colors. The interpolation can be done in HSL space which usually results in wanted output for heatmaps.

Example mapfiles
























(continues on next page)



(continued from previous page)
The kernel radius can be set dynamically depending on the scale. Note that any other PROCESSING key can be updated by the same method. In the following example, the kernel radius will be 50 pixels for scales 1/1 to 1/25000000, and 10 pixels for scales 1/25000000 and smaller:

Different weights can be applied by using CLASS->'STYLE'->'SIZE' syntax on the source vector layer to apply a non default weight to each sample:
• Weight read from a feature attribute:





(continues on next page)



(continued from previous page)
• Weight read from a non numeric attribute:


9.1.9 OGR Output
Author
Frank Warmerdam
Contact
warmerdam at pobox.com
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2022-04-25





Introduction
OGR output support was added to MapServer 6.0. It provides an output driver to produce feature style output suitable as a return result from WMS GetFeatureInfo or WFS GetFeature requests. OGR feature output depends on MapServer being built against the GDAL/OGR library. The OGR output driver should be enabled in MapServer 6.0 or newer when INPUT=OGR appears in the version string.

OUTPUTFORMAT Declarations
Details of OGR output formats allowed are controlled by an OUTPUTFORMAT declaration. The declarations define the OGR format driver to be used, creation options specific to that driver, and more general instructions to MapServer on how to package multi-file results and whether to try and build the result on disk or in memory.
Examples:























(continues on next page)



(continued from previous page)
The OGR format driver to be used is determined by the name appearing after "OGR/" in the DRIVER argument. This name should match one of the formats listed as supported for the "-f" argument to ogr2ogr in the ogr2ogr usage message.
The IMAGEMODE for OGR output is FEATURE, but this is implicit and does not need to be explicitly stated for OGR output driver declarations.
The OGR renderer will support the following FORMATOPTION declarations:
DSCO:*
Anything prefixed by DSCO: is used as a dataset creation option with the OGR driver. See the OGR web page for the particular format driver to see layer creation options available.
LCO:*
Anything prefixed by LCO: is used as a layer creation option. See the OGR web page for the particular format driver to see layer creation options available.
FORM=simple/zip/multipart
Indicates whether the result should be a simple single file (simple), a mime multipart attachment (multipart) or a zip file (zip). "zip" is the default.
STORAGE=memory/filesystem/stream
Indicates where the datasource should be stored while being written. "filesystem" is the default.
If "memory" then it will be created in /vsimem/ - but this is only suitable for drivers supporting VSI*L which



we can't easily determine automatically.
If "filesystem", then a directory for temporary files (specified using WEB TEMPPATH or MS_TEMPPATH) will be used for writing and reading back the file(s) to stream to the client.
If "stream" then the datasource will be created with a name "/vsistdout" as an attempt to write directly to stdout. Only a few OGR drivers will work properly in this mode (ie. CSV, perhaps kml, gml).
FILENAME=name
Provides a name for the datasource created, default is "result.dat" for single file or multipart form, or "result.zip" for zip form. In the case of zip form, the filename can be of the format basename.ext.zip where basename.ext will be used as the actual OGR datasource name (i.e. generally the filename that will be put inside the zip file).
USE_FEATUREID=true/false
Starting from MapServer v7.0.2. Defaults to false. Include feature ids in the generated output, if the ows_featureid metadata key is set at the layer level. The featureid column to use should be an integer column. Useful if you need to include an "id" attribute to your geojson output. Use with caution as some OGR output drivers may behave strangely when fed with random FIDs.

LAYER Metadata
The OGR output driver utilizes several items from the LAYER level METADATA object. Some of these were originally intended for GML output or are primarily intended to support WFS.
wfs_getfeature_formatlist
(Optional) A comma delimited list of formats supported for WFS GetFeature responses. The OUTPUTFORMAT NAME values should be listed.

wfs_additional_files_in_output
(Optional) A comma delimited list of filenames that should be included as additional files in the response to a WFS GetFeature request for this layer, for output formats whose FORM FORMATOPTION is "zip" or "multi- part". This is typically used to add technical information, metadata or licensing information. The filenames can also be directory names, in which case all the files contained in the directory will be taken into account. Rela- tive filenames will be evaluated against the mapfile directory, and the SHAPEPATH value if defined. Filenames can also be URLs (starting with http:// or https://). For that latter capability, note that this requires OGR to be compiled with Curl support.

gml_include_items
(Optional) A comma delimited list of items to include, or keyword "all". You can enable full exposure by using the keyword "all".

You can specify a list of attributes (fields) for partial exposure, such as:

The new default behaviour is to expose no attributes at all.
gml_[item name]_alias
(Optional) An alias for an attribute's name. The resulting file will refer to this attribute by the alias. Here is an example:





gml_[item name]_type
(Optional)	Specifies	the	type	of	the	attribute.	Valid	values	are	Inte- ger|Long|Real|Character|Date|Time|DateTime|Boolean.




gml_[item name]_width
(Optional) Specifies the width of the indicated field for formats where this is significant, such as Shapefiles.
gml_[item name]_precision
(Optional) Specifies the precision of the indicated field for formats where this is significant, such as Shapefiles. Precision is the number of decimal places, and is only needed for "Real" fields.
gml_types
(Optional) If this field is "auto" then some input feature drivers (ie. OGR, and native shapefiles) will automatically populate the type, width and precision metadata for the layer based on the source file.

ows/wfs_geomtype
(Optional, metadata shared with WFS server GML output) Set the geometry type of OGR layers created from this MapServer LAYER. One of "Point", "LineString", "Polygon", "MultiPoint", "MultiLineString", "Multi- Polygon", "GeometryCollection", "Geometry", or "None". Most are fairly obvious, but "Geometry" can be used to represent a mix of geometry types, and "None" is sometimes suitable for layers without geometry. Note that layers which are a mix of polygon and multipolygon would normally have to be described as "Geometry". To produce 2.5D output append "25D" to the geometry type (i.e. "Polygon25D").


MAP / WEB Metadata
wms_feature_info_mime_type
In order for WMS GetFeatureInfo to allow selection of OGR output formats, the mime type associated with the OUTPUTFORMAT must be listed in this metadata item.

wfs_additional_files_in_output
(Optional) A comma delimited list of filenames that should be included as additional files in the response to a WFS GetFeature request, for any layer of the mapfile, for output formats whose FORM FORMATOPTION is "zip" or "multipart". This is typically used to add technical information, metadata or licensing information.



The filenames can also be directory names, in which case all the files contained in the directory will be taken into account. Relative filenames will be evaluated against the mapfile directory, and the SHAPEPATH value if defined. Filenames can also be URLs (starting with http:// or https://). For that latter capability, note that this requires OGR to be compiled with Curl support.


Geometry Types Supported
In MapServer we have POINT, LINE and POLYGON layers which also allow for features with multiple points, lines or polygons. However, in the OGC Simple Feature geometry model used by OGR a point and multipoint layer are quite distinct. Likewise for a LineString and MultiLineString and Polygon an MultiPolygon layer type.
To work around the mismatches between the MapServer and OGR geometry models, there is a mechanism to specify the geometry type to be used when exporting through OGR. This is the "wfs/ows_geomtype" metadata item on the layer. It may be one of one of "Point", "LineString", "Polygon", "MultiPoint", "MultiLineString", "MultiPolygon", "GeometryCollection", "Geometry", or "None".
If this item is not specified, then "Point", "LineString" or "Polygon" will be used depending on the TYPE of the LAYER. In cases of mixed geometry types (ie. polygons and multipolygons) the geometry type should be set to "Geometry" which means any geometry type.

In order 2.5D support (geometries with Z coordinates) to be enabled, the "25D" suffix must be add to the value of the "ows_geomtype" metadata item (i.e. "Polygon25D").


Empty or null geometries can also be output through OGR. When using the GeoJSON format these are returned as
"geometry":	null. The CSV format outputs them as an empty value.
To ensure empty features are not removed by a spatial filter use the following setting in the LAYER METADATA:


Attribute Field Definitions
For OGR output it is highly desirable to be able to create the output fields with the appropriate datatype, width and precision to reflect the source feature definition.
It is possible to set the gml_[item]_type, gml_[item]_width and gml_[item]_precision metadata on the layer to provide detailed field definitions:




However, doing this manually is tedious and error prone. For that reason some feature sources (at least OGR, Shapefiles, POSTGIS and ORACLESPATIAL) support a mechanism to automatically populate this information from the source datastore. To accomplish this specify:

If no effort is made to set type, width and precision information for attribute fields, they will all be treated as variable length character fields when writing through OGR.

Return Packaging
One of the challenges returning generalized feature formats is that many such formats consists of multiple files which must be returned in the result. There are three approaches taken to this based on the FORM FORMATOPTION in the OUTPUTFORMAT declaration.
simple
In this case a single result is returned. This is suitable for format drivers that produce a single file. The return result will have the mimetype listed in the OUTPUTFORMAT declaration. Note that if the OGR driver actually returns multiple files, only the primary one (the one with a name matching the filename passed into the OGR Cre- ateDataSource call) will be returned. The return result will have a suggested filename based on the FILENAME FORMATOPTION.
multipart
In this case all the files produced are returned as a multipart mime result. In this case the MIMETYPE of the OUTPUTFORMAT is ignored. All component files are returned with a mime type of "application/binary" and the whole package is "multipart/mixed".

zip


In this case all the files produced are bundled into one .zip file and this zip file is returned with a mimetype of "application/zip". The OUTPUTFORMAT MIMETYPE is ignored.

One caveat with "zip" results is that this option is only available if the GDAL/OGR version is 1.8 or newer (or a 1.8 development later than approximately Oct 15, 2010). Earlier versions of GDAL/OGR lacked the zipping capability needed.

Test Suite Example
The MSAutoTest test suite contains a test case for use of OGR Output from WFS. The mapfile is at: https://github.com/MapServer/MapServer/blob/main/msautotest/wxs/wfs_ogr.map
The comments at the start of the file have a variety of sample requests that can be run against the map, as long as [MAP- FILE] is replaced with the mapfile name. They requests should be run against mapserv sitting in the msautotest/wxs directory.

9.1.10 PDF Output
Author
Yewondwossen Assefa
Last Updated
2006-01-12

Table of Contents• PDF Output




Introduction
PDF output support was added to MapServer 3.7. Previous versions of MapServer had support for pdf output using a utility program (shp2pdf) to output a pdf file given a MapServer mapfile.
The difference in this new version is that the output to PDF can now be directly specified in the mapfile using the IMAGETYPE or the OUTPUTFORMAT parameters in the mapfile. Additionally, raster layers are now supported for pdf output.


What is currently supported and not supported
1. Vector Layers
• Layer Point: supported
• Layer Line: supported
• Layer Polygon: supported
• Layer Circle : not supported



2. Raster Layers
Raster layers are supported. Note that at this point all raster layers are transformed to jpeg format before being written to the PDF file.
3. WMS Layers
Not yet supported
4. Surround components
Legend, scalebar are not supported.
5. Fonts



Standard PostScript fonts are supported. For use of other fonts (such as truetype), see the pdflib documentation for use of UPR description files (some notes on it are here).

Implementing PDF Output
Note that the following instructions were developed for MapServer 3.7 and pdflib 4.0.3, but the general steps should be similar for recent versions of both.

Build the PDF Library
In order to have access to the PDF support in MapServer, you should download and build the PDF library from http:// www.pdflib.com/products/pdflib/. Please follow the instructions on the PDFLib site to build on your specific platforms.
Here are some quick notes on how to build on windows:
• download and extract the source code from https://www.pdflib.com/products/pdflib-family/pdflib/
• open the project PDFlib.dsw in MS Visual C++
• build the project pdflib_dll
• after a successful build, you should have a pdflib.lib and pdblib.dll under the pdflib directory
• copy the pdflib.dll under your system directory (ex : c:/winnt/system32)
• the pdflib.lib will be used while building MapServer with the PDF support

Build MapServer with PDF support
Windows platform
Edit the makefile.vc and uncomment the following lines (make sure that the paths are adapted to your installation):

See the Windows Compilation document for general MapServer compile instructions.
Unix platforms
Add with-pdf to your configure command line before compiling.
See the Unix Compilation document for general MapServer compile instructions.

Mapfile definition
The IMAGETYPE parameter in the Mapfile should be set to pdf in order to output to PDF:









(continues on next page)



(continued from previous page)
You can also specify the output using the OUTPUTFORMAT tag (this tag was introduced in mapserver 3.7) :

If the OUTPUT_TYPE=RASTER all the layers will be rendered as rasters. Note that when WMS layers are included in the mapfile, this option should be set since there is a problem with transparency and wms layers. See the OUTPUT- FORMAT object in the Mapfile reference for parameter explanations.

Testing
The easiest way to test your pdf output mapfile is with the MapServer map2img utility. Windows users can find this utility in MS4W, as well as FWTools.
You simply pass a mapfile to the executable and a name for the output pdf, and a pdf file is generated:


Possible Errors

This is related to fonts. If you remove the LABEL object from your mapfile you will see this error go away. The pdf error is described here. Basically, until this issue is 'fixed', if you want to use a font other than the included standard PostScript fonts in pdf output (such as truetype fonts), consult the PDFlib documentation.

PHP/MapScript and PDF Output
MapServer can render to PDF directly, another option is to render to a PNG and insert that into a PDF document. This is not the only way to create a PDF document of course. You will need to have support for PDFLib compiled into your PHP install.
This example shows the key parts of the process, you will need to furnish parts of the script yourself (depending on your app) and repeat the process for each map element that you want to include.
Refer to the PHP/MapScript Reference wherever necessary.

How does it work?
In brief, we will pass parameters required to render a map to a PHP script that will:
• create a PDF document



• render a PNG view at a suitably higher resolution
• insert the PNG
• buffer it and send it to the user

Create the PDF document
Here is an example similar to the one given on the PHP website to create a new PDF document:

Get this stage and section 4.5 working before you try inserting MapServer elements.

Render PNG views at a suitable resolution
Work back from the assumption that you will need no more than 300 dpi on your page for your map to look presentable. For an A4 map, I am using 150 dpi for an 8' x 8' main map, which is 1200 x 1200 pixels.

Of course, our map will not be very useful unless it is zoomed in to the extent our user requested, and the layers they selected are switched on. Maintain arrays in your application that record:

Open your map file and pass these back through to set the map file into the state the user is expecting, something like:

Now you will need to save a rendered view to a PNG file.

Use the same method for all your map elements, such as drawReferenceMap?(), drawScaleBar?() and drawLegend().

Insert the PNG elements into your PDF document
This is really easy, use the pdf_open_image_file() function to import the map elements into your PDF document:




Repeat as needed for any map elements you created.

Buffer the PDF and send it to the user
Assuming we have been creating the document $my_pdf, when we are done, we merely buffer it and send it to the user using echo():

Gotcha: remember that you cannot send headers if you have at any stage outputed text to the browser.

Additional stuff to try
Rendering everything as PNG can look ugly, so I step through the key and extract labels so I can render them using PDF's text functions.
This can be done for other map element, such as map titles, layer descriptions, or anything else that can be read from the mapfile.

9.1.11 SVG
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2020-09-22




Introduction
SVG (or Scalable Vector Graphics) is a standardized XML language for describing 2D graphics via vector graphics, text and raster graphics. As of version 4.5, MapServer can output SVG v1.1 maps. The following documentation is based on the World Wide Web Consortium's (W3C) Scalable Vector Graphics (SVG) 1.1 Specification.
This document assumes that you are already familiar with certain aspects of MapServer:
• MapServer application development and setting up map files.


Links to SVG-Related Information
• SVG 1.1 specification
• SVG Discussion Paper
• SVG Tiny Profile
• MapFile Reference Doc

Feature Types and SVG Support Status Circle Layers
Circle layers are not yet supported.

Line Layers
The following items describe how line layers are handled by MapServer for SVG output:
• Lines are converted to SVG polyline elements.
• The STYLE object's WIDTH parameter is used for SYMBOL 0 for line thickness.
• The STYLE object's SIZE parameter is used for other symbols for line thickness.
• All lines are drawn without symbols - only line thickness changes.
• If a style uses a symbol and this symbol has a dashed style, it will be transformed into an SVG stroke-dasharray element.

Point Layers
The following items describe how point layers are handled by MapServer for SVG output:
• VECTOR, ELLIPSE, and TRUETYPE symbols are supported.
• PIXMAP symbols are not currently supported.
• Labels attached with the symbols are supported (see the Text Features section below for details).

Polygon Layers
The following items describe how polygon layers are handled by MapServer for SVG output:
• Polygons are converted to SVG polygon elements.



• The STYLE's COLOR is used for the fill.
• The STYLE's OUTLINECOLOR is used for the stroke.
• SVG patterns are not currently supported.
Raster Layers
The following items describe how raster layers are handled by MapServer for SVG output:
• Temporary image is created through the GD library, and GD functions are used to draw the layer.
• You must have at least PNG or JPEG support compiled in MapServer.
• You must have the WEB object's IMAGEPATH and IMAGEURL set properly in your mapfile.
Text Features
The following items describe how text features are handled by MapServer for SVG output:
• Text is converted to SVG text element.
• Only TRUETYPE fonts are supported.
• Supports labels with ENCODING (output as UTF-8 hexadecimal values).
• The FONT name used in MapServer is parsed to form the SVG font-family, font-style, and font-weight.
WMS Layers
You can configure OUTPUTFORMAT in your WMS server mapfile, to allow a GetMap request for an SVG output, as follows.

Setting up a Mapfile for SVG Output
• You must have valid IMAGEPATH and IMAGEURL parameters set in the WEB object of the mapfile.
• To be able to output a valid SVG file, the user needs to define an OUTPUTFORMAT object in the map file and set the IMAGETYPE parameter to svg. Here is an example:




















(continues on next page)



(continued from previous page)
Note:
If FORMATOPTION "COMPRESSED_OUTPUT=TRUE" is set MapServer will produce a compressed SVG file (svgz). By default this option is FALSE. Note that to be able to create compressed output, MapServer must be built with the compile flag USE_ZLIB.
If FORMATOPTION "FULL_RESOLUTION=TRUE" is set MapServer will not eliminate duplicate points and collinear lines when outputting SVG. By default this option is set to FALSE.

Testing your SVG Output
• The easiest way to test your SVG mapfile is to use MapServer CGI. For example, you might enter the following URL in a browser:

• You can also use PHP/MapScript to test your SVG mapfile. Your php file might look like the following:

An SVG file should be created in your IMAGEPATH directory. If you open the SVG file in a text editor you can see that it is an XML file. Below is a sample SVG file of a point layer with labels:
















(continues on next page)



(continued from previous page)
<ellipse cx="328" cy="233" rx="3" ry="3" fill="#000000"	/>
<ellipse cx="331" cy="245" rx="3" ry="3" fill="#000000"	/>
<ellipse cx="366" cy="196" rx="3" ry="3" fill="#000000"	/>
<ellipse cx="161" cy="246" rx="3" ry="3" fill="#000000"	/>
<ellipse cx="92" cy="208" rx="3" ry="3" fill="#000000"	/>
<ellipse cx="40" cy="125" rx="3" ry="3" fill="#000000"	/>
<ellipse cx="108" cy="146" rx="3" ry="3" fill="#000000"	/>
<text	x="40" y="143" font-family="fritqat" font-size="8pt"	fill="#000000" stroke="
??#ffffff"  stroke-width="0.5"	>Yellowknife</text>
<text	x="43" y="121" font-family="fritqat" font-size="8pt"	fill="#000000" stroke="
??#ffffff"  stroke-width="0.5"	>Whitehorse</text>
<text	x="34" y="205" font-family="fritqat" font-size="8pt"	fill="#000000" stroke="
??#ffffff"  stroke-width="0.5"	>Edmonton</text>
<text	x="164" y="258" font-family="fritqat" font-size="8pt"	fill="#000000" stroke="
??#ffffff"  stroke-width="0.5"	>Winnipeg</text>
<text	x="316" y="190" font-family="fritqat" font-size="8pt"	fill="#000000" stroke="
??#ffffff"  stroke-width="0.5"	>St. John's</text>
<text	x="334" y="258" font-family="fritqat" font-size="8pt"	fill="#000000" stroke="
??#ffffff"  stroke-width="0.5"	>Halifax</text>
<text	x="249" y="230" font-family="fritqat" font-size="8pt"	fill="#000000" stroke="
??#ffffff"  stroke-width="0.5"	>Charlottetown</text>
<text	x="241" y="242" font-family="fritqat" font-size="8pt"	fill="#000000" stroke="
??#ffffff"  stroke-width="0.5"	>Quebec</text>
<text	x="223" y="260" font-family="fritqat-italic" font-size="8pt"	fill="#ff0000"?
??stroke="#ffffff"  stroke-width="0.5"	>Ottawa</text>
<text	x="210" y="279" font-family="fritqat" font-size="8pt"	fill="#000000" stroke="
??#ffffff"  stroke-width="0.5"	>Toronto</text>
<text	x="82" y="234" font-family="fritqat" font-size="8pt"	fill="#000000" stroke="
??#ffffff"  stroke-width="0.5"	>Regina</text>
<text	x="40" y="223" font-family="fritqat" font-size="8pt"	fill="#000000" stroke="
??#ffffff" stroke-width="0.5"	>Victoria</text>
<text	x="214" y="125" font-family="fritqat" font-size="8pt"	fill="#000000" stroke="
??#ffffff" stroke-width="0.5"	>Iqaluit</text>
</svg>

You can now view the SVG file in a supported browser (see the official list of SVG implementations for possible SVG viewers). The Adobe Viewer plugin is very popular.

goSVG
goSVG is now supported as a vector output format in MapServer 4.5 (and later).

Definition
This definition of goSVG was obtained from here.
goSVG is short for "G-XML over SVG" and "g-contents over SVG". This is a subset for mobiles specified within the G-XML (a Japanese Spatial Information Format which is an XML based protocol with the ability to describe, communicate and exchange Spatial Information and Electric Maps), and is a Spatial Information Exchanging format that determines the method to expand spatial information and connect to the backend system(G-XML standard mark format). goSVG is an expanded SVG Tiny profile (a Mobile profile of SVG 1.1. suited for cellular phones) that adds functions that are useful for Spatial Information Services (SVG Map Service).



Support for Specific goSVG Elements
• Name space extension: supported
• Content Area Definition (bounding box): supported
• Geographic Coordinate System: supported
   • Map Request Protocol: supported Setting up a Mapfile for goSVG Output Requirements
• A valid MapServer Mapfile.
• Valid IMAGEPATH and IMAGEURL parameters set in the WEB object of the mapfile.
• A PROJECTION object defined beneath the MAP object, using an EPSG code. For example:


Setting the OUTPUTFORMAT
To be able to output a valid goSVG file, you must define an OUTPUTFORMAT object in the mapfile and set the IMAGETYPE to svg. Here is an example:
















(continues on next page)



(continued from previous page)

Specific FORMATOPTIONs Related to goSVG
GOSVG
should be set to TRUE. The default is false.
GOSVG_ZoomInTH
controls the zoomin threshold when outputting the Map Request Protocol. If it is not defined the default value is set to 70.
GOSVG_ZoomOutTH
controls the zoomout threshold when outputting the Map R equest Protocol. If it is not defined the default value is set to 100.
GOSVG_ScrollTH
controls the scrolling threshold when outputting the Map Request Protocol. If it is not defined the default value is set to 10.

Testing your goSVG Output
Refer to the section Testing your SVG Output to generate and test your goSVG output. goSVG can be read by regular SVG viewers (they will just ignore the goSVG headers).

Sample goSVG File Produced by MapServer
Below is a sample goSVG file of a point layer with labels:















(continues on next page)



(continued from previous page)
</rdf:Description>
</rdf:RDF>
<au:lbs protocol="maprequest">
<au:zoomin th="20" xlink:href="."/>
<au:zoomout th="40" xlink:href="."/>
<au:scroll th="60" xlink:href="."/>
</au:lbs>
</metadata>

<!-- START LAYER popplace -->
<ellipse cx="252" cy="130" rx="3" ry="3" fill="#000000"	/>
<ellipse cx="37" cy="227" rx="3" ry="3" fill="#000000"	/>
<ellipse cx="127" cy="239" rx="3" ry="3" fill="#000000"	/>
<ellipse cx="255" cy="282" rx="3" ry="3" fill="#000000"	/>
<polygon fill="#000000"	stroke-width="1"	points=" 267,263 270,263 271,260 272,263 275,
??263 273,265 274,268 271,266 268,268 269,265"/>
<ellipse cx="288" cy="247" rx="3" ry="3" fill="#000000"	/>
<ellipse cx="313" cy="243" rx="3" ry="3" fill="#000000"	/>
<ellipse cx="328" cy="233" rx="3" ry="3" fill="#000000"	/>
<ellipse cx="331" cy="245" rx="3" ry="3" fill="#000000"	/>
<ellipse cx="366" cy="196" rx="3" ry="3" fill="#000000"	/>
<ellipse cx="161" cy="246" rx="3" ry="3" fill="#000000"	/>
<ellipse cx="92" cy="208" rx="3" ry="3" fill="#000000"	/>
<ellipse cx="40" cy="125" rx="3" ry="3" fill="#000000"	/>
<ellipse cx="108" cy="146" rx="3" ry="3" fill="#000000"	/>
<text	x="40" y="143" font-family="fritqat" font-size="8pt"	fill="#000000" stroke="
??#ffffff"  stroke-width="0.5"	>Yellowknife</text>
<text	x="43" y="121" font-family="fritqat" font-size="8pt"	fill="#000000" stroke="
??#ffffff"  stroke-width="0.5"	>Whitehorse</text>
<text	x="34" y="205" font-family="fritqat" font-size="8pt"	fill="#000000" stroke="
??#ffffff"  stroke-width="0.5"	>Edmonton</text>
<text	x="164" y="258" font-family="fritqat" font-size="8pt"	fill="#000000" stroke="
??#ffffff"  stroke-width="0.5"	>Winnipeg</text>
<text	x="316" y="190" font-family="fritqat" font-size="8pt"	fill="#000000" stroke="
??#ffffff"  stroke-width="0.5"	>St. John's</text>
<text	x="334" y="258" font-family="fritqat" font-size="8pt"	fill="#000000" stroke="
??#ffffff"  stroke-width="0.5"	>Halifax</text>
<text	x="249" y="230" font-family="fritqat" font-size="8pt"	fill="#000000" stroke="
??#ffffff"  stroke-width="0.5"	>Charlottetown</text>
<text	x="241" y="242" font-family="fritqat" font-size="8pt"	fill="#000000" stroke="
??#ffffff"  stroke-width="0.5"	>Quebec</text>
<text	x="223" y="260" font-family="fritqat-italic" font-size="8pt"	fill="#ff0000"?
??stroke="#ffffff"  stroke-width="0.5"	>Ottawa</text>
<text	x="210" y="279" font-family="fritqat" font-size="8pt"	fill="#000000" stroke="
??#ffffff"  stroke-width="0.5"	>Toronto</text>
<text	x="82" y="234" font-family="fritqat" font-size="8pt"	fill="#000000" stroke="
??#ffffff"  stroke-width="0.5"	>Regina</text>
<text	x="40" y="223" font-family="fritqat" font-size="8pt"	fill="#000000" stroke="
??#ffffff" stroke-width="0.5"	>Victoria</text>
<text	x="214" y="125" font-family="fritqat" font-size="8pt"	fill="#000000" stroke="
??#ffffff" stroke-width="0.5"	>Iqaluit</text>
</svg>


9.1.12 Tile Mode
Author
Paul Ramsey
Contact
pramsey at cleverelephant.ca
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2025-07-26


Introduction
MapServer can feed tile-based map clients directly using the CGI "tile mode". Tile-based map clients work by dividing the map of the world up into a discrete number of zoom levels, each partitioned into a number of identically sized "tiles". Instead of accessing a map by requesting a bounding box, a tile client builds a map by accessing individual tiles.

Configuration
Tile requests are handled by the 'mapserv' CGI program. In order to return tiles in the correct projection, MapServer must be built against the PROJ library. You can check if your version of 'mapserv' has projection support by running it with the '-v' option and looking for 'SUPPORTS=PROJ'.
Example 1. On Unix:

Example 2. On Windows:





(continues on next page)



(continued from previous page)
MapServer requires that each LAYER in your .map file (or "mapfile") have a valid PROJECTION block to support reprojection. Because the tile mode uses reprojection, you will have to ensure each LAYER has a valid PROJECTION block.


Configuration checklist:
• MapServer compiled with PROJ support
• Mapfile with a PROJECTION defined for every LAYER
As of MapServer 6.0, there are two extra parameters available for configuring tile mode, that can be set as METADATA in the WEB object of your mapfile:
• tile_map_edge_buffer renders the tile into a buffered rendering frame, then clips out the final tile. This will reduce edge effects when large symbols or wide lines are drawn. Recommended value: the size of the largest symbol or line width in your mapfile.
• tile_metatile_level renders the tiles into a fixed metatile, then clips out the final tile. This will reduce label repetition, at the expense of much higher rendering cost. Recommended value: 1 if you are doing labelling of large features in your layer. 0 otherwise.
If you use both tile_map_edge_buffer and tile_metatile_level at the same time, the buffer will be applied at the meta-tile level.








Utilization
The MapServer tile support adds three new directives to the CGI interface:
• mode=tile tells the server to generate tiles based on the other tile mode parameters
• tilemode=gmap tells the server use the Google Maps tile scheme for the tiles (this is the default tilemode)
- tile=x+y+z tells the server what tile you want to retrieve, using the Google Maps tile addressing system
• tilemode=ve tells the server use the Bing Maps (formerly "Virtual Earth") tile naming scheme for the tiles
- tile=10231 tells the server what tile you want to retrieve, using the Bing Maps (formerly "Virtual Earth") tile addressing system
The optional TILESIZE=width+height query parameter (added in MapServer 8.0) can be used to override the default tile size of 256x256 pixels, typically to get high DPI tiles.
A valid mode=tile request might therefore look like:

which results in a 256x256 tile (notice that it is in the Google Mercator projection, even though the mapfile has an output PROJECTION object of "init=epsg:4326") :


About Spherical Mercator
Spherical Mercator (also called the "web mercator" or "google mercator") is a world projection that all the major tile- based map interfaces (Google Maps, Bing Maps [formerly "Virtual Earth"], Yahoo Maps, OpenLayers) use to address tiles. The associated official EPSG code is EPSG:3857.
A spherical mercator set of tiles has the following properties:



• The map has been reprojected to mercator using a spherical mercator algorithm
• There is one tile in the top zoom level, zoom level zero
• Each successive zoom level (z) has 2^z tiles along each axis
• Tiles are 256x256 in size
Google Maps and Bing Maps (formerly "Virtual Earth") both use spherical mercator as their underlying tile projection, but use different formats to address the individual tiles.
Google Maps uses an "x", "y", "zoom" format. The zoom indicates which level to pull tiles from, and the "x" and "y" indicate while tile in that zoom level to pull.
Bing Maps (formerly "Virtual Earth") uses a single string to address each tile. The top zoom level in Bing Maps has four tiles (equivalent to Google's zoom level 1). The top left tile in the Bing Maps top zoom level is addressed as "0", top right as "1", bottom left as "2" and bottom right as "3". Each tile the next level is addressed by first referencing the top level tile that contains it, then its address relative to that tile. So the top left tile in the second zoom level is "00" and the bottom right one is "33". See the Bing Maps site for more details: http://msdn.microsoft.com/en-us/library/bb545006.aspx

Mapbox Vector Tile (MVT) output


See alsoMVT support was added into MapServer through RFC #119
Since the MapServer 7.2.0 release, MapServer is able to output MVT vector tiles.
Notes regarding MVT support in MapServer:
• make sure that your mapserv -v command reports SUPPORTS=PBF in the response, which tells you that your MapServer instance supports MVT output
- if your mapserv is missing the support, on Ubuntu you might execute:

and then compile MapServer with the -DWITH_PROTOBUFC=ON switch
• verify that your mapfile has a PROJECTION object defined for every LAYER (to define the source projection for every layer)

• add an OUTPUTFORMAT block to your mapfile, such as :



(continues on next page)



(continued from previous page)
• now test this output by adding the &map.imagetype=mvt switch to your earlier request, and try to load it in your browser, such as:

• your browser should download a file, which you can rename to something like demo.pbf, and then execute ogrinfo on the file to examine it
- the ogrinfo response should contain a message such as "using driver 'MVT' successful"

Using Google Maps
The Google Maps API includes support for using alternative tile sets as overlays, or as alternate base maps. Here is an example of an GTileLayerOverlay

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

24
(continues on next page)



(continued from previous page)
25

26

27

28

29

30

31

32

33

34

35

36

37


Note the format of the tileUrlTemplate: a valid URL, with {X}, {Y} and {Z} substitution tokens that Google Maps will replace with the tile coordinates and zoom level on the fly to retrieve tiles from your server.
You can also use a MapServer tile layer as an alternate base map:
1	<!DOCTYPE html
2	PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
3	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
4	<html xmlns="http://www.w3.org/1999/xhtml">
5	<head>
6	<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
7	<title>Google/MapServer Tile Example</title>
8	<script src="http://maps.google.com/maps?file=api&v=2&key=[YOUR KEY HERE]"
9	type="text/javascript"></script>
10	<script  type="text/javascript">
11
12	function load() {
13	if (GBrowserIsCompatible()) {
14	var urlTemplate = 'http://localhost/cgi-bin/mapserv?';
15	urlTemplate += 'map=/var/map.map&';
16	urlTemplate += 'layers=layer1 layer2&';
17	urlTemplate += 'mode=tile&';
18	urlTemplate += 'tilemode=gmap&';
19	urlTemplate += 'tile={X}+{Y}+{Z}';
20	var myLayer = new GTileLayer(null,0,18,{
21	tileUrlTemplate:urlTemplate,
22	isPng:true,
23	opacity:0.3 });
24	var map = new GMap2(document.getElementById("map"));
25	map.addControl(new GLargeMapControl());
26	map.addControl(new GMapTypeControl());
27	map.setCenter(new GLatLng(35.35, -80.55), 15);
28	var myMapType = new GMapType([myLayer], new GMercatorProjection(18), 'MapServer');
29	map.addMapType(myMapType);
30	}
31	}
32
33	</script>
34	</head>
(continues on next page)



(continued from previous page)
35

36

37

38


The only change from the previous example is that we don't create a GTileLayerOverlay, we create a GMapType, and use addMapType(), instead of addOverlay().

Using Bing Maps (formerly "Virtual Earth")
The Bing Maps API also includes support for using alternative tile sets as overlays, or as alternate base maps. Here is an example:

1	<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/
??DTD/xhtml1-strict.dtd">
2	<html xmlns="http://www.w3.org/1999/xhtml">
3	<head>
4	<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
5	<title>Virtual  Earth  Example</title>
6	<script type="text/javascript" src="http://dev.virtualearth.net/mapcontrol/mapcontrol.
??ashx?v=6.1"></script>
7	<script  type="text/javascript">
8
9	var map = null;
10
11	function OnLoadMap () {
12	map = new VEMap("myMap");
13	map.LoadMap();
14
15	var url = "http://localhost/cgi-bin/mapserv?";
16	url += "map=/var/map.map&";
17	url += "mode=tile&";
18	url += "layers=layer1 layer2&";
19	url += "tilemode=ve&";
20	url += "tile=%4";
21
22	var tileSourceSpec = new VETileSourceSpecification( "myLayer", url );
23	tileSourceSpec.Opacity = 0.3;
24	map.AddTileLayer(tileSourceSpec, true);
25	}
26
27	</script>
28	</head>
29	<body onload="OnLoadMap();">
30	<div id="myMap" style="position:relative; width:500px; height:500px;"></div>
31	</body>
32	</html>


9.1.13 Template-Driven Output
Author
Chris Hodgson
Contact
chodgson at refractions.net
Author
Seth Girvin
Contact
sethg at geographika.co.uk
Last Updated
2019-10-04


Introduction
RFC 36 added support for defining template-driven OUTPUTFORMATs for use with feature queries, including WMS GetFeatureInfo and WFS GetFeature. This allows for custom text-oriented output such as GeoJSON, KML, or XML. The templates are essentially the same as with the standard MapServer query Templating, however there are some additional tags to allow for template definition in a single file instead of the standard header/template/footer.









OUTPUTFORMAT Declarations
Details of template-driven output formats are controlled by an OUTPUTFORMAT declaration. The declarations define the template file to be used, as well as other standard OUTPUTFORMAT options.
Examples:

The template file to be used is determined by the "FILE=..." FORMATOPTION. The template filename is relative to the mapfile's path. As is standard with MapServer template files, the file must contain the magic string 'mapserver template' in the first line of the file, usually within a comment, but this line is not output to the client.


The MIMETYPE and FORMATOPTION "ATTACHMENT=..." parameters are very useful for controlling how a web browser handles the output file.

Template Substitution Tags
These tags only work in query result templates, and their purpose is primarily to simplify the templating to a single file for custom output formats.
[include src="otherTemplate.txt"]
Includes another template file; the path to the template file is relative to the mapfile path. Attributes:



• src: The file to be included.
[resultset layer=layername]. . . [/resultset]
Defines the location of the results for a given layer. Attributes:
• layer: The layer to be used
• nodata: (optional) A string to return if no results are returned.
[feature]. . . [/feature]
Defines the loop around the features returned for a given layer. Attributes:
• limit: (optional) Specifies the maximum number of features to output for this layer.
• trimlast: (optional) Specifies a string to be trimmed off of the end of the final feature that is output. This is intended to allow for trailing record delimiters to be removed. See the examples below.
[join name=join1]. . . [/join]
defines the loop around the features join from another layer.

See alsoTemplating
Examples
Below are some examples of the different kind of outputs that can be achieved with templates.

Header, Body, Footer
This example shows how to emulate the old 3-file system using the new system, to compare the usage:





















(continues on next page)



(continued from previous page)

GML3

<!-- mapserver template -->
<?xml version="1.0" encoding="ISO-8859-1"?> [resultset layer=mums]
<MapServerUserMeetings xmlns="http://localhost/ms_ogc_workshop" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:gml="http://www.opengis.net/gml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://localhost/ms_ogc_workshop ./mums.xsd">
<gml:description>This is a GML document which provides locations of all MapServer User Meeting that have taken place</gml:description>
<gml:name>MapServer User Meetings</gml:name>
<gml:boundedBy>
<gml:Envelope>
<gml:coordinates>-93.093055556,44.944444444 -75.7,45.4166667</gml:coordinates>
</gml:Envelope>
</gml:boundedBy> [feature]
<gml:featureMember>
<Meeting>
<gml:description>[desc]</gml:description>
<gml:name>[name]</gml:name>
<gml:location>
<gml:Point srsName="http://www.opengis.net/gml/srs/epsg.xml#4326">
<gml:pos>[x] [y]</gml:pos>
</gml:Point>
</gml:location>
<year>[year]</year>
<venue>[venue]</venue>
<website>[url]</website>
</Meeting>
</gml:featureMember> [/feature]
<dateCreated>2007-08-13T17:17:32Z</dateCreated>
</MapServerUserMeetings> [resultset]

GeoJSON
Could be called using . . .&layer=mums&mode=nquery&qformat=geojson Or by adding &outputformat=geojson to a WFS getfeature request:





(continues on next page)



(continued from previous page)

KML
A more complicated KML example. Note the use of [shpxy] to support multipolygons with holes, and also that a point placemark is included with each feature using [shplabel]:
























(continues on next page)





<text>
<![CDATA[
<p ALIGN="center"><b>$[name]</b></p>
$[description]
]]>
</text>
</BalloonStyle>
</Style>
<Style id="parks_normal">
<IconStyle>
<scale>1.2</scale>
<Icon>

(continued from previous page)

<href>http://maps.google.com/mapfiles/kml/shapes/parks.png</href>
</Icon>
<hotSpot x="0.5" y="0" xunits="fraction" yunits="fraction"/>
</IconStyle>
<LineStyle>
<color>ffff5500</color>
<width>4.2</width>
</LineStyle>
<PolyStyle>
<color>ff7fff55</color>
</PolyStyle>
<BalloonStyle>
<text>
<![CDATA[
<p ALIGN="center"><b>$[name]</b></p>
$[description]
]]>
</text>
</BalloonStyle>
</Style>
<StyleMap id="parks_map">
<Pair>
<key>normal</key>
<styleUrl>#parks_normal</styleUrl>
</Pair>
<Pair>
<key>highlight</key>
<styleUrl>#parks_highlight</styleUrl>
</Pair>
  </StyleMap> [resultset layer=parks]
<Folder>
     <name>Parks</name> [feature trimlast="," limit=1]
<Placemark>
<name>[NAME]</name>
<Snippet/>
<description>
<![CDATA[
<p>Year Established: [YEAR_ESTABLISHED]</p>
































(continues on next page)



(continued from previous page)
<p>Area: [AREA_KILOMETERS_SQUARED] sq km</p>
]]>
</description>
<styleUrl>#parks_map</styleUrl>
<ExtendedData>
<Data name="Year Established">[YEAR_ESTABLISHED]</Data>
<Data name="Area">[AREA_KILOMETERS_SQUARED]</Data>
</ExtendedData>
<MultiGeometry>
<Point>
<coordinates>[shplabel proj=epsg:4326 precision=10],0</coordinates>
</Point>
[shpxy	ph="<Polygon><tessellate>1</tessellate>" pf="</Polygon>" xf="," xh=" " yh=" " yf=",0 " orh="<outerBoundaryIs><LinearRing><coordinates>" orf="</coordinates></LinearRing></outerBoundaryIs>" irh="<innerBoundaryIs><LinearRing><coordinates>" irf="</coordinates></LinearRing></innerBoundaryIs>" proj=epsg:4326 precision=10]
</MultiGeometry>
     </Placemark> [/feature]
  </Folder> [/resultset]
</Document>
</kml>

reStructuredText Table
This example creates a reStructuredText table from feature records, making use of the padding formatting option. To test from the command line use syntax similar to below:


The RST output can then be rendered as a table.




City NameAbbreviationLake of the WoodsLOTWKittsonKITTRoseauROSEKoochichingKOOCMarshallMARSSt. LouisSTLO

WarningFor templates (Templating), there are a number of reserved words. If you have want to expose an attribute with a name that is equal to a reserved word, you can not use the shorthand [attribute_name], but will have to use construct [item name=attribute_name] instead. For example, in a template, [id] is a system generated unique session id (see Templating). So if you have an attribute named "id" that you want to expose, you will either have to rename it or use the construct [item name=id].
9.1.14 KML Output
Authors
Dvaid Kana (david.kana at gmail.com)
Authors
Thomas.Bonfort (thomas.bonfort at gmail.com)
Authors
Yewondwossen Assefa
Authors
Michael Smith (michael.smith at usace.army.mil)
Last Updated
2019-12-13

Introduction
This purpose of this document is to describe KML/KMZ output support that was initially added in the MapServer 6.0 release.
The main goal of the KML driver is to generate KML output used mainly by Google Earth application.

General Functionality
KML support is provided by using a kml or kmz image type in the map file. Output can then be generated using MapServer cgi (example mode=map) or through a WMS request.

Output format
The default name of the output format is kml or kmz, and this name can be used to set the imagetype parameter in the map file.
The format can also be defined in the map file:






Build
• On Windows: there is a flag KML in nmake.opt
• On Linux: -with-kml
• AGG driver is necessary for the KML driver
• To be able to get kmz support, MapServer needs to be built against GDAL 1.8 at least

Limiting the number of features
The number of vector features drawn by default is set to 1000 per layer. To control the number of features, users can set:
• layer level metadata that only applies to the layer: "maxfeaturestodraw" "100"
• map level metada that applies to all layers: "maxfeaturestodraw" "100"
• output format option that applies to all layers: FORMATOPTION "maxfeaturestodraw=100"

Map
In terms of the KML object, the MapServer KML output will produce a <Document> element to include all the layers that are part of the MapServer map file. Features supported for the Document are:




Doc-Sup- MapServer equivalence/Notesu-portementele-mentnameYes	Name in the map filevisi-
bilityNo	Can be supported if needed. Default is 1openNo	Can be supported if needed. Default is 0ad-
dressNo	Could be supported for example using ows_address if availableAd-Nodress-De-tailspho-
neNu berNo	Could be supported using ows_contactvoicetelephone is availableSnip-
petNode-
scrip- tionNoAb-
stractVNoTimePr
itiveNostyleUNoStyle-
Se- lectorYes  Style element will be supported. All different styles from the layers will be stored here and referenced
from the folders using a styleUrl.In addition to the Styles related to features, there is a ListStyle element added at the document level. This allows to control the way folders are presented.See Layers section (styleUrl) setting for more details.Re-
gionNoMeta-
dataNoEx-
tended- DataNo
Layers
Each layer of the MapServer map file will be inside a KML <Folder> element. Supported Folder elements are:




Folder elementSup- porteMapServer equivalence/NotesnameYesName of the layer. If not available the name will be Layer concatenated with the layer's index (Layer1)visibilityYesAlways set to 1openNoDefault is 0atom:authoratom:linkaddresNodescriptionNoCould be supported using ows_descriptionAbstarctViewNoTimePrimitiveNostyleUrlYesThe user can use the kml_folder_display layer or map level metedata to
choose a setting. Possible values are 'check' (default), 'radioFolder', 'check- OffOnly', 'checkHideChildren'.RegionMetadataExtended-
DataNo
Each element in the Layer will be inside a KML <Placemark> element. As described in the KML reference : "A Placemark is a Feature with associated Geometry. In Google Earth, a Placemark appears as a list item in the Places panel. A Placemark with a Point has an icon associated with it that marks a point on the Earth in the 3D viewer. (In the Google Earth 3D viewer, a Point Placemark is the only object you can click or roll over. Other Geometry objects do not have an icon in the 3D viewer. To give the user something to click in the 3D viewer, you would need to create a MultiGeometry object that contains both a Point and the other Geometry object.)"
For Polygon and Line layers, when a feature is associated with a label, a MultiGeometry element containing a point geometry and the geometry of the feature is created. The point feature will be located in the middle of the polygon or line

Supported Features in the Placemark element are:




Place-Sup- MapServer equivalence/Notesmarkportele-mentnameYes	Label attached with the feature. If there is no label a default name is assigned using the layer name
and the shape id (ex. park.1)visibil-
ityNoIs is by default set to trueopenNoaddressNoAd-
dress- DetailsNopho-
neNum- berNoSnip-
petNoThis is a short description the feature. If needed It could be supported.de-
scrip- tionYes	This information is what appears in the description balloon when the user clicks on the feature.
The <description> element supports plain text as well as a subset of HTML formatting elements. Used when KML/OWS_DESCRIPTION is definedAb-
stractVieNoTimePri
itiveNostyleUrlYes	Refers to a Style defined in the DocumentStyleS-
electorNoRegionNoMeta-
dataNoEx-
tended- DataYesUsed when KML/OWS_INCLUDE_ITEMS is definedGeom-
etryYesDepends on the layer type
General notes on layers
• Labelcache is turned off on each layer
• Projection block should be set. If not set It will be assumed that the data is in lat/lon projection (a debug message will be sent to the user: Debug Message 1)
• Possible to output vector layers as raster using metadata: "KML_OUTPUTASRASTER" "true"
• The user can use the KML_FOLDER_DSIPLAY layer or map level metedata to choose a setting. Possible values are 'check' (default), 'radioFolder', 'checkOffOnly', 'checkHideChildren'.
• The user can use metadata KML/OWS_DESCRIPTION or KML/OWS_INCLUDE_ITEMS to define the de- scription attached to each feature. If KML/OWS_DESCRIPTION are defined, the <description> tag of the Placemark will be used. If KML/OWS_INCLUDE_ITEMS, the <ExtendedData> tag will be used.
• The user can use the metadata KML_NAME_ITEM to indicate the field name to be used a a name tag for each



feature.
• The user can use metadata KML_ALTITUDEMODE to specify how altitude components in the <coordinates> element are interpreted. Possible values are: absolute, relativeToGround, clampToGround. http://code.google. com/apis/kml/documentation/kmlreference.html#altitudemode
• The user can use metedata KML_EXTRUDE to specify whether to connect the LinearRing to the ground. http:
//code.google.com/apis/kml/documentation/kmlreference.html#tessellate
• The user can use metedata KML_TESSELLATE to specify whether to allow the LinearRing to follow the terrain. http://code.google.com/apis/kml/documentation/kmlreference.html#extrude
• The user can specify an attribute to be used as the elevation value using a layer level metedata: 'kml_elevation_attribute' '<Name of attribute>'. The value will be used as the z value when the coordinates are written.

Point Layers
• Each layer will be inside a Folder element.
• Each feature will be represented by a Placemark.
• The Geometry element for a Point layer would be represented as a Point geometry element in KML. Supported elements are:

Line Layers
• Each layer will be inside a Folder element.
• Each feature in the layer would be represented by a Placemark.
• If a label is attached to the line, the Geometry element would be represented as a MultiGeometry that includes a LineString element and a Point element representing the position of the label. If no label is attached to a feature, the Geometry element will be a LineString.

Polygon Layers
• Each layer will be inside a Folder element.
• Each feature will be represented by a Placemark.
• If a label is attached to the polygon, the Geometry element would be represented as a MultiGeometry that includes a Polygon element and a Point element representing the position of the label.

Raster Layers
• Each layer will be inside a Folder element.
• A GroundOverlay feature is created for the layer, that includes an href link to the raster image generated and LatLongBox for the extents (map extents).
• The href is generated using the imagepath and imageurl settings in the map file.

Styling
As described in Section 4, all different styles from the layers will be stored at the Document level and referenced from the folders using a styleUrl.



Point Layers
Point layers will be styled using the IconStyle styling element of KML. An image representing the symbol will be created and referenced from the IconStyle object. If a label is attached to the point, a LabelStyle element will also be used. The LabelStyle will have the color parameter set.


Line Layers
Line layers will be styled using the LineStyle styling element of KML. Color and width parameters of the LineStyle will be used. If a label is attached to the layer, a LabelStyle element will also be used.

Polygon Layers
Polygon layers will be styled using the PolyStyle styling element of KML. Color parameter of the PolyStyle will be used. If an outline is defined in the map file, an addition LineStyle will be used. If a label is attached to the layer, a LabelStyle element will also be used.

Attributes
As described in section on Layers, two ways of defining the description:
• kml/ows_description
• kml/ows_include_items

Coordinate system
The map level projection should be set to epsg:4326. If not set, the driver will automatically set it. Layers are expected to have projection block if their projection is different from epsg:4326.

Warning and Error Messages
• When the projection of the map file is not set or is different from a a lat/lon projection, the driver automati- cally sets the projection to espg:4326. If the map is is debug mode, the following message is sent: "KmlRen- derer::checkProjection: Mapfile projection set to epsg:4326"
• If imagepath and imageurl are not set in the web object, the following message is sent in debug mode: "KmlRen- derer::startNewLayer: imagepath and imageurl should be set in the web object"

9.1.15 UTFGrid Output
Author
Francois Desjarlais
Contact
fdesjarlais1 at gmail.com



Last Updated
2023-01-30


Introduction
UTFGrid is an output format that was added in MapServer version 7. This howto assumes that you have basic knowledge of the mapfile syntax (see Mapfile).

Functionality
UTFGrid output will allow more interaction with maps by allowing data to be exposed via an invisible UTF-8 character grid.

See alsorfc93
Build
• Iconv is required.
• AGG is required.

Setting the OutputFormat
Adding the following to the mapfile will allow MapServer to use generate UTFGrid output. For this example, the output generated will be a grid with each pixel corresponding to a 4x4 pixels square in the original image. Also, it will not allow duplicates which means different shapes with the same IDs will be considered as a single shape.

If no FORMATOPTION is set, default values will be used. Default values are: 4 for UTFRESOLUTION and true for DUPLICATES.



Exposing Feature Properties
Two LAYER parameters are used to choose which data to expose. To use them, add these to your LAYER in the mapfile.

The items can be used separately. If UTFITEM is not set, a sequence number (based on the rendering order) will be used as the grid ID. If UTFDATA is not set, no data beyond the UTFITEM will be exposed.




9.1.16 Index Page
Author
Seth Girvin
Contact
sethg at geographika.net
Last Updated
2025-09-19

Background
MapServer 8.6 introduces an index page, proposed in rfc140. This feature provides a single HTML page that lists all Mapfiles available in a deployment. From this page, users can select an individual Mapfile to open a dedicated page containing useful links, such as WMS capabilities documents and OGC Features API landing pages.
In addition to the HTML pages, the same information is also available as JSON services, enabling programmatic access.
The index pages are driven by the MapServer CONFIG file, and use the same template-based approach as the OGC APIs.
The index pages improves service discoverability for users and gives system administrators better visibility into which services are exposed by their MapServer instances, making it easier to restrict or disable unneeded options.

Configuration
The index pages require a CONFIG file. MapServer uses this file to locate and list all Mapfiles available in the system.
To activate the index pages, the config file needs to set a new MS_INDEX_TEMPLATE_DIRECTORY parameter. This parameter specifies the folder containing the HTML templates used to render the index pages.




MapServer provides two sets of templates, which may already be included with your deployment (depending on the package source). If not, they are available in the MapServer repository under share/ogcapi/templates.
• html-index-bootstrap - HTML templates styled using the Bootstrap framework.
• html-index-plain - plain HTML templates with no styling.
If your system will only be serving JSON output, the MS_INDEX_TEMPLATE_DIRECTORY value can be set to an empty string.

In this case JSON output remains accessible by appending ?f=json to the request URL, but if you attempt to access the HTML output MapServer will return the following error.

If the configured template folder cannot be found, or if the account running MapServer does not have permission to read it, the following error will be returned:

If MS_INDEX_TEMPLATE_DIRECTORY is not set, MapServer will behave as in previous versions and return standard messages when accessed without a query:


MapServer Homepage
The homepage is available at the root of your MapServer deployment, for example:
• http://localhost:8080/cgi-bin/mapserv.exe/
• https://example.com/mapserver/
• https://demo.mapserver.org/cgi-bin/mapserv/
The page lists all Mapfiles defined in the MAPS section of your CONFIG file. For each Mapfile, the page provides:
• the map name
• the number of layers
• links to the Mapfile's individual index page (available in both HTML and JSON formats)




If any Mapfiles referenced in the CONFIG file cannot be loaded, they will be displayed with an error message - "Error loading the map". In the JSON output, these Mapfiles will include a flag: "has-error":true. This makes it possible to monitor the service programmatically and quickly identify problems with Mapfiles.
The HTML output can be customized using the landing.html template file located in the configured template folder.

Individual Mapfile Homepages
When the index page functionality is enabled, each Mapfile listed in the MAPS section of the config file has its own dedicated index page.
These pages can be accessed directly by appending the Mapfile's key to the MapServer URL. For example, the test. map referenced by the TEST_MAPFILE key in the configuration below can be accessed using URLs such as (keys are not case-sensitive):
• http://localhost:8080/cgi-bin/mapserv.exe/TEST_MAPFILE/
• https://example.com/mapserver/test_mapfile/
• https://demo.mapserver.org/cgi-bin/mapserv/TEST_MAPFILE/

Each Mapfile homepage lists the services enabled for that Mapfile. The following links may be available:
• CGI - link to the inbuilt MapServer OpenLayers Viewer.
- Always available unless explicitly disabled via the ms_enable_modes setting in METADATA.
• OGC API - links to the OGC APIs.
- "OGC API Landing Page" (HTML)
- Root JSON service
- Available if MapServer was compiled with the -DWITH_OGCAPI option and one of the following META- DATA settings is present:
* "oga_enable_request" "*"


* "ows_enable_request" "*"
• WMS - links to the WMS GetCapabilities documents for supported versions:
- 1.0.0, 1.1.0, 1.1.1 and 1.3.0
- Available if MapServer was compiled with the -DUSE_WMS_SVR option, and one of the following META- DATA settings:
* "wms_enable_request" "*"
* "ows_enable_request" "*"
• WFS - links to the WFS GetCapabilities documents for supported versions:
- 1.0.0, 1.1.0, and 2.0
- Available if MapServer was compiled with the -DUSE_WFS_SVR option, and one of the following META- DATA settings:
* "wfs_enable_request" "*"
* "ows_enable_request" "*"
• WCS - links to the WCS GetCapabilities documents for supported versions:
- 1.0.0, 1.1.0, 2.0.0, and 2.0.1
- Available if MapServer was compiled with the -DUSE_WCS_SVR option, and one of the following META- DATA settings:
* "wcs_enable_request" "*"
* "ows_enable_request" "*"

The HTML output can be customized using the map.html template file located in the configured template folder.


CHAPTER
TEN



OGC


10.1 OGC Support and Configuration
Interoperability is increasingly becoming a focus point for organizations that distribute and share data over the Internet. The Open Geospatial Consortium (OGC) focuses on the development of publicly available geospatial web standards. MapServer supports numerous OGC standards, allowing users to publish and consume data and services in an appli- cation neutral implementation manner.

10.1.1 MapServer OGC Specification support
• Web Map Service (OGC:WMS) 1.0.0, 1.1.0, 1.1.1, 1.3.0
• Web Feature Service (OGC:WFS) 1.0.0, 1.1.0, 2.0
• Web Coverage Service (OGC:WCS) 1.0.0, 1.1.0, 2.0.0, 2.0.1
• Geography Markup Language (OGC:GML) 2.1.2, 3.1.0 Level 0 Profile, 3.2.1
• GML Application Schema - Coverages (OGC:GMLCOV) 1.0.0, 1.0.1
• Web Map Context Documents (OGC:WMC) 1.0.0, 1.1.0
• Styled Layer Descriptor (OGC:SLD) 1.0.0
• Filter Encoding Specification (OGC:FES) 1.0.0
• Sensor Observation Service (OGC:SOS) 1.0.0
• Observations and Measurements (OGC:OM) 1.0.0
• SWE Common (OGC:SWE) 1.0.1
• OWS Common (OGC:OWS) 1.0.0, 1.1.0, 2.0.0
• OGC API: Features (OGCAPI:Features) 1.0.0

10.1.2 Accessing OGC services over HTTPS
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Original Author
Normand Savard
Last updated
2022-08-15






Introduction
The following documentation explains how to set up MapServer as a client to access a WMS/WFS server through a secure SSL connection using the HTTPS protocol. It describes the common problems a user could encounter and how to solve them.

Requirements
MapServer 5.4.1 or more recent, compiled with cURL. cURL must be built with SSL support. You should also follow the full steps for configuring your related OGC client support, through:
• WMS Client Howto
• WFS Client Howto

Verify Installation cURL executable
First check that cURL is found locally, and was built with SSL support:

On Linux systems the response should be similar to (notice the ssl protocol):

On Windows the response should be similar to (notice the ssl protocol):







Next, verify your connection with the cURL commandline, to a remote HTTPS service such as:

You should receive a result such as:

If you receive an error message such as the following, you likely have not pointed to the local CA bundle properly:


CA Bundle
The cURL CA (certificate authority) bundle file must be located on your local machine/server.
Download the CA bundle file "cacert.pem" found at https://curl.se/docs/caextract.html or if you have the cURL source you could create the CA bundle by executing "make ca-bundle" or "make ca-firefox" (if you have Firefox and the certutil tool installed). If you used the second choice, the bundle file will be named ca-bundle.crt and will be found in the lib directory under the cURL root directory. See https://curl.se/docs/caextract.html for more details. Store this file in the location pointed to by the CURL_CA_BUNDLE environment variable.
Set the CURL_CA_BUNDLE environment variable to point to the bundle file (e.g.	export CURL_CA_BUNDLE=/path/to/my-ca-bundle.ext where my-ca-bundle.ext could be cacert.pem or ca-bundle.crt).


Mapfile Setup
Edit your map file to add the WMS connection URL. For example:

Test with the map2img utility, to verify that MapServer can connect through HTTPS and generate a valid map image, such as the command:

If you receive an error from MapServer similar to the following, it means that you have not pointed to your local CA bundle properly:






Remote Server with a Self-Signed SSL Certificate
If you get the following error, it means that your remote server probably use a self-signed SSL certificate and the server certificate is not included in your CA bundle file.

To get the remote server certificate you have to execute this command:

Copy everything from the "--BEGIN CERTIFICATE--" tag to "--END CERTIFICATE--" tag. Paste it at the end of the my-ca-bundle.ext file.
If you get the error "Verification error: unable to get local issuer certificate" you may be missing an intermediate certificate. If you have saved locally the certificate file you can supply this file as a parameter to openssl as follows:

Verify your connection with the cURL command line:








You have to use the exact same domain name as the one appearing in the "Common Name" prompt used when generating the remote server certificate. You cannot use the remote server ip for instance. It means that the following URL is not acceptable.



10.1.3 WMS Server
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2025-11-18

Table of Contents• WMS Server
- Introduction
* Links to WMS-Related Information
* How does a WMS Work
- Setting Up a WMS Server Using MapServer
* Install the Required Software
* Setup a Mapfile For Your WMS
* Test Your WMS Server
* GetLegendGraphic Request
- Changing the Online Resource URL
* Mapserver Alias in config
* Apache ReWrite rules (using Apache mod_rewrite)
* Apache environment variables - MS_MAPFILE




Introduction
A WMS (or Web Map Server) allows for use of data from several different servers, and enables for the creation of a network of Map Servers from which clients can build customized maps. The following documentation is based on the Open Geospatial Consortium's (OGC) Web Map Server Interfaces Implementation Specification v1.1.1.
MapServer v3.5 or more recent is required to implement WMS features. At the time this document was written, MapServer supports the following WMS versions: 1.0.0, 1.1.0, 1.1.1 and 1.3.0.
This document assumes that you are already familiar with certain aspects of MapServer:
• MapServer application development and setting up .map files.
• Familiarity with the WMS spec would be an asset. A link to the WMS specification document is included in the "WMS-Related Information" section below.

Links to WMS-Related Information
• MapServer WMS Client Howto
• WMS 1.3.0 specification
• WMS 1.1.1 specification
• OGC's WMS homepage



• WMS Cookbook
• MapServer OGC Web Services Workshop package
• MapServer Styled Layer Descriptor (SLD) Howto
• MapServer WMS Time Support Howto

How does a WMS Work
WMS servers interact with their clients via the HTTP protocol. In most cases, a WMS server is a CGI program. This is also the case with MapServer.
The WMS specification defines a number of request types, and for each of them a set of query parameters and associated behaviors. A WMS-compliant server MUST be able to handle at least the following 2 types of WMS requests:
1. GetCapabilities: return an XML document with metadata of the Web Map Server's information
   2. GetMap: return an image of a map according to the user's needs. And support for the following types is optional:
1. GetFeatureInfo: return info about feature(s) at a query (mouse click) location. MapServer supports 3 types of responses to this request:
• text/plain output with attribute info.
• text/html output using MapServer query templates (see Templating) specified in the CLASS TEMPLATE parameter (the filename has to have an .html extension). The MIME type returned by the Class templates defaults to text/html and can be controlled using the metadata "wms_feature_info_mime_type".
• application/vnd.ogc.gml, GML.1 or GML for GML features.
2. DescribeLayer: return an XML description of one or more map layers. To execute this:
• for vector layers: to have a valid return the user needs to setup wfs_onlineresource (or ows_onlineresource) metadata either at the map level or at the layer level (the layer level metadata is the one which is used if both are defined) - for raster layers: the metadata is wcs_onlineresource with the same logic as above.
3. GetLegendGraphic: returns a legend image (icon) for the requested layer, with label(s). More information on this request can be found in the GetLegendGraphic section later in this doc.
With respect to MapServer specifically, it is the "mapserv" CGI program that knows how to handle WMS requests. So setting up a WMS server with MapServer involves installing the mapserv CGI program and a setting up a mapfile with appropriate metadata in it. This is covered in the rest of this document.

Setting Up a WMS Server Using MapServer Install the Required Software
WMS requests are handled by the mapserv CGI program. Not all versions of the mapserv program do include WMS support (it is included by default when you compile together with the PROJ library), so the first step is to check that your mapserv executable includes WMS support. One way to verify this is to use the "-v" command-line switch and look for "SUPPORTS=WMS_SERVER".
(Unix users should refer to the Compiling on Unix document for any compiling instructions, and Windows users might want to use MS4W, which comes ready with WMS/WFS support)
Example 1. On Unix:





Example 2. On Windows:


Setup a Mapfile For Your WMS
Each instance of WMS server that you setup needs to have its own mapfile. It is just a regular MapServer mapfile in which some parameters and some metadata entries are mandatory. Most of the metadata is required in order to produce a valid GetCapabilities output.
Here is the list of parameters and metadata items that usually optional with MapServer, but are required (or strongly recommended) for a WMS configuration:
At the MAP level:
• Map NAME
• Map PROJECTION
• Map Metadata (in the WEB Object):
- wms_title
- wms_onlineresource
- wms_srs (unless PROJECTION object is defined using "init=epsg:. . .")
- wms_enable_request
And for each LAYER:
• Layer NAME
• Layer PROJECTION
• Layer METADATA
- wms_title
- wms_srs (optional since the layers inherit the map's SRS value)
• Layer STATUS
- Layers set to STATUS DEFAULT will always be sent to the client.



- Layers set to STATUS ON or STATUS OFF can be requested by the client.
   • Layer TEMPLATE (required for GetFeatureInfo requests - see Templating) Let's go through each of these parameters in more detail:
• Map Name and wms_title:
WMS Capabilities requires a Name and a Title tag for every layer. The Map's NAME and wms_title metadata will be used to set the root layer's name and title in the GetCapabilities XML output. The root layer in the WMS con- text corresponds to the whole mapfile. You can suppress the root layer's name by setting wms_rootlayer_name
to "".
• Layer Name and wms_title metadata:
Every individual layer needs its own unique name and title. Layer names are also used in GetMap and GetFea- tureInfo requests to refer to layers that should be included in the map output and in the query. Layer names must start with a letter when setting up a WMS server (layer names should not start with a digit or have spaces in them).
• Map PROJECTION and wms_srs metadata:
WMS servers have to advertise the projection in which they are able to serve data using EPSG projection codes (see The EPSG web page for more background on EPSG codes). The PROJ library come with a table of EPSG initialization codes and allows users to define a projection like this:

(Note that "epsg" has to be in lowercase when used in the PROJ 'init' directive.)
If the MAP PROJECTION block is provided in the format "init=epsg:xxxx" then MapServer will also use this information to generate a <BoundingBox> tag for the top-level layer in the WMS capabilities document. Bound- ingBox is a mandatory element of WMS capabilities for WMS 1.3.0 (for WMS 1.1.0 it is optional, but it is good practice to allow MapServer to include it when possible).
The above is sufficient for MapServer to recognize the EPSG code and include it in SRS tags in the capabilities output (wms_srs metadata is not required in this case). However, it is often impossible to find an EPSG code to match the projection of your data. In those cases, the "wms_srs" metadata is used to list one or more EPSG codes that the data can be served in, and the PROJECTION object contains the real PROJ definition of the data's projection.
Here is an example of a server whose data is in a Lambert Conformal Conic projection (3978). Its capabili- ties output will advertise EPSG:3857 (web mercator), EPSG:4269 and EPSG:4326 projections (lat/lon), but the PROJECTION object is set to the real projection that the data is in:













(continues on next page)



(continued from previous page)
In addition to EPSG:xxxx projections, a WMS server can advertise projections in the AUTO:xxxx namespace. AUTO projections 42001 to 42005 are internally supported by MapServer. However, AUTO projections are useful only with smart WMS clients, since the client needs to define the projection parameters in the WMS requests to the server. For more information see Annex E of the WMS 1.1.1 specification and section 6.5.5.2 of the same document. See also the FAQ on AUTO projections at the end of this document.
• Layer PROJECTION and wms_srs metadata:
By default layers inherit the SRS of their parent layer (the map's PROJECTION in the MapServer case). For this reason it is not necessary (but still strongly recommended) to provide PROJECTION and wms_srs for every layer. If a layer PROJECTION is not provided then the top-level map projection will be assumed.
Layer PROJECTION and wms_srs metadata are defined exactly the same way as the map's PROJECTION and wms_srs metadata.
For vector layers, if a PROJECTION block is provided in the format "init=epsg:xxxx" then MapServer will also use this information to generate a <BoundingBox> tag for this layer in the WMS capabilities document. BoundingBox is a mandatory element of WMS capabilities for WMS 1.3.0 (for WMS 1.1.0 it is optional, but it is good practice to allow MapServer to include it when possible).
• "wms_onlineresource" metadata:
The wms_onlineresource metadata is set in the map's web object metadata and specifies the URL that should be used to access your server. This is required for the GetCapabilities output. If wms_onlineresource is not provided then MapServer will try to provide a default one using the script name and hostname, but you shouldn't count on that too much. It is strongly recommended that you provide the wms_onlineresource metadata.
See section 6.2.2 of the WMS 1.1.1 specification for the whole story about the online resource URL. Basically, what you need is a complete HTTP URL including the http:// prefix, hostname, script name, potentially a "map=" parameter, and terminated by "?" or "&".
Here is a valid online resource URL:

By setting an alias in map config (or creating a wrapper script on the server) it is possible to hide the "map=" parameter from the URL and then your server's online resource URL could be something like:

This is covered in more detail in the section "More About the Online Resource URL" below.
• "wms_enable_request" metadata:
Specify which requests to enable. If not specified, no requests will be enabled! See the explanation below.
• Configuring for GetFeatureInfo Requests:
You must set the layer TEMPLATE parameter for the layer to be queryable by GetFeatureInfo requests (see Templating), with a value such as "empty" or the name of your html template file. For requests of type "text/html" you should also set the layer HEADER and FOOTER parameters.





As of MapServer 4.6 you must set the gml_* metadata for the layer attributes to be served (see the Layer Object metadata in the Reference Section later in this document). To include geometry, gml_geometries and gml_[geometry name]_type has to be specified.
Here are working examples of GetFeatureInfo requests: text/plain / text/html / gml (for gml, your browser might ask you to save the file, if so save it locally as a .gml file and view it in a text editor)

Test Your WMS Server
Validate the Capabilities Metadata
OK, now that we've got a mapfile, we have to check the XML capabilities returned by our server to make sure nothing is missing.
Using a web browser, access your server's online resource URL to which you add the parameters "SER- VICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities" to the end, e.g.

Here is a working GetCapabilities request (note that the SERVICE parameter is required for all GetCapabilities re- quests):
https://demo.mapserver.org/cgi-bin/wms?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
This should return a document of MIME type application/vnd.ogc.wms_xml, so your browser is likely going to prompt you to save the file. Save it and open it in a text editor (Emacs, Notepad, etc.), and you will see the returned XML from the WMS server.
If you get an error message in the XML output then take necessary actions. Common problems and solutions are listed in the FAQ at the end of this document.
If everything went well, you should have a complete XML capabilities document. Search it for the word "WARN- ING"... MapServer inserts XML comments starting with "<!-WARNING: " in the XML output if it detects missing mapfile parameters or metadata items. If you notice any warning in your XML output then you have to fix all of them before you can register your server with a WMS client, otherwise things are likely not going to work.
Note that when a request happens, it is passed through WMS, WFS, and WCS in MapServer (in that order) until one of the services respond to it.

Test With a GetMap Request
OK, now that we know that our server can produce a valid XML GetCapabilities response we should test the GetMap request. MapServer only checks for a few of the required GetMap parameters, so both of the minimum MapServer parameters and a valid GetMap request will be explained below.
The following is a list of the required GetMap parameters according to the WMS spec:



VERSION=version: Request version
REQUEST=GetMap: Request name
LAYERS=layer_list: Comma-separated list of one or more map layers. Optional if SLD parameter is present.
STYLES=style_list: Comma-separated list of one rendering style per requested layer. Optional if SLD parameter is present. Set "STYLES=" with an empty value to use default style(s). Named styles are also supported and are controlled by CLASS GROUP names in the mapfile.


SRS=namespace:identifier: Spatial Reference System.
BBOX=minx,miny,maxx,maxy: Bounding box corners (lower left, upper right) in SRS units.
WIDTH=output_width: Width in pixels of map picture. HEIGHT=output_height: Height in pixels of map picture. FORMAT=output_format: Output format of map.


A valid example would therefore be:

Here is a working valid request.




Test with a Real Client
If you have access to a WMS client, then register your new server's online resource with it and you should be off and running.
If you don't have your own WMS client installed already, here are a few pointers:
• MapServer itself can be used as a WMS client, see the MapServer WMS Client Howto.
• QGIS is a full GIS package which includes WMS client support. (recommended)


• OpenJUMP is a desktop GIS package which includes WMS client support.
• uDig is a desktop package that allows users to add WMS layers.
• Deegree provides a WMS client.
This list is not exhaustive, there are several Open Source or proprietary packages that offer WMS support and could be used to interact with your new MapServer WMS server instance.

GetLegendGraphic Request
This request returns a legend image (icon) for the specified layer. The request will draw an icon and a label for all classes defined on the layer. If the requested layername is a GROUP-name, all included layers will be returned in the legend-icon.

Requirements
The following are required in the WMS server mapfile to enable this GetLegendGraphic request:
• a LEGEND object.
• a CLASS object for each layer.
• a NAME in the CLASS object.
• the STATUS of each LAYER must be set to ON.

Parameters
The following are valid parameters for this GetLegendGraphic request:
• LAYER - (Required) Name of the WMS layer to return the legend image of. Note that this is the <Name> parameter of the Layer in the GetCapabilities.
• FORMAT - (Required) Format of the legend image (e.g. "image/png").
• WIDTH - (Optional) Width of the legend image. Note that the Width parameter is only used when the Rule parameter is also used in the request.
• HEIGHT - (Optional) Height of the legend image. Note that the Height parameter is only used when the Rule parameter is also used in the request.
• SLD - (Optional) The URL to the SLD. Applies the SLD on the layer and the legend is drawn after the SLD is applied (using the classes specified by the SLD). Note here that you need to put a <Name>class1</Name> inside the Rule element so that a class name is created from the SLD and therefore a correct legend image.



• SLD_BODY - (Optional) The body (code) of the SLD, instead of specifying a URL (as in the 'SLD' parameter).
• SLD_VERSION - (Optional) The SLD version.
• SCALE - (Optional) Specify a scale so that only layers that fall into that scale will have a legend.
• STYLE - (Optional) The style.
• RULE - (Optional) Specify the name of the CLASS to generate the legend image for (as opposed to generating an icon and label for ALL classes for the layer).


The CLASS object's KEYIMAGE parameter can also be used to specify a legend image for a CLASS. See the MapFile Reference doc if necessary. Example Request
An example request might look like:


Content Dependent Legends
Support for content dependent legends is supported (since the MapServer 6.4 release) for WMS GetLegendGraphic calls on POINT, LINE and POLYGON layers, when the client includes the (non-standard) BBOX, SRS/CRS and WIDTH/HEIGHT parameters in the request URL (such as a GetMap request). If these parameters are not present, the normal legend rendering will occur. For more information, please see rfc101.

Changing the Online Resource URL
As mentioned in the section "Setup a Mapfile / wms_onlineresource metadata" above, the following Online Resource URL is perfectly valid for a MapServer WMS according to section 6.2.2 or the WMS 1.1.1 specification:

However, some people will argue that the above URL contains mandatory vendor-specific parameters and that this is illegal. First we would like to point that "map=. . ." is not considered a vendor-specific parameter in this case since it is part of the Online Resource URL which is defined as an opaque string terminated by "?" or "&" (See WMS 1.1.1 section 6.2.2).


But anyway, even if it's valid, the above URL is still ugly. And you might want to use a nicer URL for your WMS Online Resource URL. Here are some suggestions:



Mapserver Alias in config
Since Mapserver 8.2 it is possible to configure a set of map aliases in config. An alias can be used as a parameter in path, to reference the configured mapfile for that alias.


Apache ReWrite rules (using Apache mod_rewrite)
One can use Apache's mod_rewrite to avoid specifying the map, or any other default parameter in the mapserver URL. This task consist of three steps, specifying the mod_rewrite module to be loaded, enabling the mod_rewrite module for the selected directories and at last to write a .htaccess file to do the rewriting.
In the httpd.conf file, the mod_rewrite module is per default disabled. To enable it, remove the opening # in the line

To be able to use the module, it must be enabled, using the directive AllowOverride. This can be done per server or per directory. If you just have one server, add an "AllowOverride All" line in the httpd.conf file (see the Apache documentation to be sure about the security implications of this). Per directory is the easiest way to make it work on virtual hosts. Within the <virtualHost> section of the httpd.conf insert:

Where myhtdocsdir is the directory defined as documentroot for the actual virtual server.
When the directives are set to load and enable the mod_rewrite module, Apache has to be restarted. In a web-accessible directory make a .htaccess file like the following:
The rewriteRule says: given a webpage starting with wmsmap, pick out the query parameters, make a new page request starting with /cgi-bin/mapserv?map=(. . .)? and add on whatever was the query parameters in the original page request.
e.g, the URL wmsmap?mode=map will be rewritten as
::
/cgi-bin/mapserv?map=/home/www/mapserverstuff/mymapfile.map&mode=map
If just the URL wmsmap is given (without any parameters) a page not found error will show up as that does not match the wmsmap? expression.

Apache environment variables - MS_MAPFILE
A default mapfile can be specified using the MS_MAPFILE environment variable:




Apache SetEnvIf
Another option is to use the "setenvif" feature of Apache: use symbolic links that all point to a same mapserv binary, and then for each symbolic link test the URL, and set the MAP environment accordingly.
For Windows and Apache users the steps are as follows (this requires Apache 1.3 or newer):
• Copy mapserv.exe to a new name for your WMS, such as "mywms.exe".
• In httpd.conf, add:


ASP script (IIS - Microsoft Windows)
On IIS servers (Windows), you can use the following ASP script:



Mapscript wrapper
Some OGC services (WFS, SOS) support both GET and POST requests. Here, you can use a minimal MapScript WxS wrapper. Here's a Python example:



(continues on next page)



(continued from previous page)

Wrapper script (Unix)
On Unix servers, you can setup a wrapper shell script that sets the MS_MAPFILE environment variable and then passes control to the mapserv executable. The script will usually live inside your /cgi-bin/ directory. The result is a cleaner OnlineResource URL:



WMS 1.3.0 Support
MapServer 5.4 adds support for WMS 1.3.0. Although the general mechanism in MapServer to support this new specification are the same, there are some notable upgrades.

Major features related to the WMS 1.3.0 support
• Support WMS 1.3.0 basic operations: GetCapabilities, GetMap and GetFeatureInfo.
• Implement the Styled Layer Descriptor profile of the Web Map Service Implementation Specification. This specification extends the WMS 1.3.0 and allows to advertise styling capabilities (Styled Layer Descriptor (SLD) support). It also defines two additional operations, GetLegendGraphic and DescribeLayer.
• Implement the Symbology Encoding Implementation Specification, which is the new version of the SLD. Read support was added for Point, Line, Polygon, Raster symbolizers.
• Upgrade the generation of SLD to version 1.1.0 (SLD generated through through the GetStyles operation or through MapScript).

Coordinate Systems and Axis Orientation
The most notable changes introduced in WMS 1.3.0 are the:
• the axis changes
• the introduction of new coordinate reference systems
• the use of CRS parameter (instead of SRS)
The axis order in previous versions of the WMS specifications was to always use easting (x or lon ) and northing (y or lat). WMS 1.3.0 specifies that, depending on the particular CRS, the x axis may or may not be oriented West-to-East, and the y axis may or may not be oriented South-to-North. The WMS portrayal operation shall account for axis order.



This affects some of the EPSG codes that were commonly used such as ESPG:4326. MapServer 5.x makes sure that coordinates passed to the server (as part of the GetMap BBOX parameter) as well as those advertised in the capabilities document reflect the inverse axe orders for EPSG codes between 4000 and 5000.
MapServer 6.0 and up holds a list of EPSG codes with inverted axis order. It is currently based on EPSG database version 7.6. It is also possible to define the axis order at build time for a specific ESPG code (see issue #3582). This allows for example to use the "normal" axis order for some of EPSG codes between 4000 and 5000.
In addition, the WMS 1.3.0 defines a series of new coordinate system. These are the ones that are currently supported in MapServer:
• CRS:84 (WGS 84 longitude-latitude)
• CRS:83 (NAD83 longitude-latitude)
• CRS:27 (NAD27 longitude-latitude)
• AUTO2:42001 (WGS 84 / Auto UTM )
• AUTO2:42002 (WGS 84 / Auto Tr. Mercator)
• AUTO2:42003 (WGS 84 / Auto Orthographic)
• AUTO2:42004 (WGS 84 / Auto Equirectangular)
• AUTO2:42005 (WGS 84 / Auto Mollweide)

Example of requests
Users can use the CRS:84 coordinate system and order the BBOX coordinates as long/lat:
• . . .&CRS=CRS:84&BBOX=-180.0,-90.0,180.0,90.0&. . . (example request)
Users can also use the ESPG:4326 coordinates and use the axis ordering of lat/long:
• . . .&EPSG:4326&BBOX=-90.0,-180.0,90,180.0&. . . (example request)

Other notable changes
• valid values for the EXCEPTIONS parameter in a GetMap request are XML, INIMAGE, BLANK
• valid value for the EXCEPTIONS parameter in a GetFeatureInfo request is XML
• LayerLimit is introduced, allowing a server to advertise and limit the number of layers a client is allowed to include in a GetMap request

Some Missing features
• WMS 1.3.0 Post request should be an XML document containing the different operations and parameters.
• SLD documents containing elements from the Feature Encoding 1.1 specification could potentially use ESPG projections with some filters. It is not yet clear nor implemented if the axis ordering should be taken into account in these specific cases.

OGC compliance tests
As of version 5.4, MapServer passes all the basic and query tests of the OGC CITE test suite for WMS 1.3.0.



Reference Section
The following metadata are available in the setup of the mapfile:
(Note that each of the metadata below can also be referred to as 'ows_*' instead of 'wms_*'. MapServer tries the 'wms_*' metadata first, and if not found it tries the corresponding 'ows_*' name. Using this reduces the amount of duplication in mapfiles that support multiple OGC interfaces since "ows_*" metadata can be used almost everywhere for common metadata items shared by multiple OGC interfaces.)

Web Object Metadata
ows_allowed_ip_list (or wms_allowed_ip_list)
• Description: (Optional) A list of IP addresses that will be allowed access to the service. Example:

ows_compliance_mode (or wms_compliance_mode) Added in version 8.6.0.
• Description: (Optional) Aim for enhanced OGC compliance. Work in progress, the goal is to pass all INSPIRE tests. Possible values are "true" or "false". Defaults to "false".
Example:

ows_denied_ip_list (or wms_denied_ip_list)
• Description: (Optional) A list of IP addresses that will be denied access to the service. Example:

ows_http_max_age
• Description: (Optional) an integer (in seconds) to specify how long a given map response should be considered new. Setting this directive allows for aware WMS clients to use this resulting HTTP header value as a means
to optimize (and minimize) requests to a WMS Server. More info is available at https://www.mnot.net/cache_ docs/#CACHE-CONTROL
ows_schemas_location
• Description: (Optional) (Note the name ows_schemas_location and not wms_... this is because all OGC Web Services (OWS) use the same metadata) Root of the web tree where the family of OGC WMS XMLSchema files are located. This must be a valid URL where the actual .xsd files are located if you want your WMS output to
validate in a validating XML parser. Default is https://schemas.opengis.net.
ows_sld_enabled



• Description: (Optional) A value (true or false) which, when set to "false", will ignore SLD and SLD_BODY parameters in order to disable remote styling of WMS layers. Also, SLD is not advertised in WMS Capabilities as a result
ows_updatesequence
• Description: (Optional) The updateSequence parameter can be used for maintaining the consistency of a client cache of the contents of a service metadata document. The parameter value can be an integer, a timestamp in [ISO 8601:2000] format, or any other number or string.
wms_abstract
• WMS TAG Name: Abstract (WMS1.1.1, sect. 7.1.4.2)
• Description: (Optional) A blurb of text providing more information about the WMS server.
wms_accessconstraints
• WMS TAG Name: AccessConstraints (WMS1.1.1, sect. 7.1.4.2)
• Description: (Optional) Access constraints information. Use the reserved word "none" if there are no access constraints.
wms_addresstype, wms_address, wms_city, wms_stateorprovince, wms_postcode, wms_country
• WMS TAG Name: ContactAddress and family (WMS1.1.1, sect. 7.1.4.2)
• Description: Optional contact address information. If provided then all six metadata items are required.
wms_allow_getmap_without_styles
Added in version 8.0.
• Description: (Optional) "true" or "false". If true, the "STYLES=" GetMap parameter will not be required. If false (the default as of MapServer 8.0) the "STYLES=" GetMap parameter will be required.
wms_attribution_logourl_format
• Description: (Optional) The MIME type of the logo image. (e.g. "image/png"). Note that the other wms_attribution_logourl_* metadata must also be specified.
• refer to section 7.1.4.5.11 of the WMS 1.1.1 spec.
wms_attribution_logourl_height
• Description: (Optional) Height of the logo image in pixels. Note that the other wms_attribution_logourl_* metadata must also be specified.
• refer to section 7.1.4.5.11 of the WMS 1.1.1 spec.
wms_attribution_logourl_href
• Description: (Optional) URL of the logo image. Note that the other wms_attribution_logourl_* metadata must also be specified.
• refer to section 7.1.4.5.11 of the WMS 1.1.1 spec.
wms_attribution_logourl_width
• Description: (Optional) Width of the logo image in pixels. Note that the other wms_attribution_logourl_* meta- data must also be specified.
• refer to section 7.1.4.5.11 of the WMS 1.1.1 spec.
wms_attribution_onlineresource
• Description: (Optional) The data provider's URL.



• refer to section 7.1.4.5.11 of the WMS 1.1.1 spec.
wms_attribution_title
• Description: (Optional) Human-readable string naming the data
provider.
• refer to section 7.1.4.5.11 of the WMS 1.1.1 spec.
wms_bbox_extended:
Added in version 6.0.
• Description: (Optional) "true" or "false". If true, bounding boxes are reported for all supported SRS / CRS in the capabilities document. If false, only the bounding box of the first SRS / CRS is reported.
wms_contactelectronicmailaddress
• WMS TAG Name: ContactElectronicMailAddress (WMS1.1.1,
sect. 7.1.4.2)
• Description: Optional contact Email address.
wms_contactfacsimiletelephone
• WMS TAG Name: ContactFacsimileTelephone (WMS1.1.1, sect. 7.1.4.2)
• Description: Optional contact facsimile telephone number.
wms_contactperson, wms_contactorganization, wms_contactposition
• WMS TAG Name: ContactInformation, ContactPerson, ContactOrganization, ContactPosition (WMS1.1.1, sect. 7.1.4.2)
• Description: Optional contact information. If provided then all three metadata items are required.
wms_contactvoicetelephone
• WMS TAG Name: ContactVoiceTelephone (WMS1.1.1, sect. 7.1.4.2)
• Description: Optional contact voice telephone number.
wms_enable_request (or ows_enable_request)
• Description: Space separated list of requests to enable. The default is none. The following requests can be enabled: GetCapabilities, GetMap, GetFeatureInfo and GetLegendGraphic. A "!" in front of a request will disable the request. "*" enables all requests.
• Examples:
To enable only GetMap and GetFeatureInfo:

To enable all requests except GetFeatureInfo

wms_encoding
• WMS TAG Name: Encoding
• Description: Optional XML capabilities encoding type. The default is ISO-8859-1.
wms_feature_info_mime_type
• WMS TAG Name: Feature_info_mime_type



• Description:
- Used to specify an additional MIME type that can be used when responding to the GetFeature request.
For example if you want to use the layer's HTML template as a base for its response, you need to add "WMS_FEATURE_INFO_MIME_TYPE" "text/html". Setting this will have the effect of advertising text/html as one of the MIME types supported for a GetFeature request. You also need to make sure that the layer points to a valid html template (see Templating). The client can then call the server with INFO_FORMAT=text/html.
- If not specified, MapServer by default has text/plain and GML implemented.
wms_fees
• WMS TAG Name: Fees (WMS1.1.1, sect. 7.1.4.2)
• Description: (Optional) Fees information. Use the reserved word "none" if there are no fees.
wms_getcapabilities_version
• Description: (Optional) Default version to use for GetCapabilities requests that do not have a version parameter. If not set, the latest supported version will be returned.
wms_getlegendgraphic_formatlist
• Description: (Optional) A comma-separated list of valid formats for a WMS GetLegendGraphic request.
wms_getmap_formatlist
• Description: (Optional) A comma-separated list of valid formats for a WMS GetMap request.
wms_keywordlist
• WMS TAG Name: KeywordList (WMS1.1.1, sect. 7.1.4.2)
• Description: (Optional) A comma-separated list of keywords or keyword phrases to help catalog searching. As of WMS 1.1.0 no controlled vocabulary has been defined.
wms_keywordlist_vocabulary
• WMS Attribute Name: vocabulary of KeywordList -> Keyword
• Description: (Optional) Name of vocabulary used in wms_keywordlist_[vocabulary's name]_items as de- scribed below.
wms_keywordlist_[vocabulary's name]_items
• WMS TAG Name: KeywordList -> Keyword
• Description: (Optional) A comma-separated list of keywords or keyword phrases to help catalog searching for given vocabulary.
wms_languages
• Description: (Optional) A comma-separated list of supported languages. For details please refer to the section
Multi-language support for certain capabilities fields in the INSPIRE View Service documentation.
wms_layerlimit
• WMS TAG Name: LayerLimit (WMS1.3.0, sect. 7.2.4.3)
• Description: (Optional) The maximum number of layers a WMS client can specify in a GetMap request. If not set, then no limit is imposed.
wms_onlineresource
• WMS TAG Name: OnlineResource (WMS1.1.1, sect. 6.2.2)



• Description: (Recommended) The URL that will be used to access this WMS server. This value is used in the GetCapabilities response.

See alsoSections "Setup a Mapfile / wms_onlineresource metadata" and "More About the Online Resource URL" above.
wms_remote_sld_max_bytes
• Description: (Optional) Maximum size in bytes authorized when fetching a remote SLD through http. Defaults to 1 MegaByte (1048596).
wms_resx, wms_resy
• WMS TAG Name: BoundingBox (WMS1.1.1, sect. 6.5.6)
• Description: (Optional) Used in the BoundingBox tag to provide info about spatial resolution of the data, values are in map projection units.
wms_rootlayer_abstract
• WMS TAG Name: Abstract (WMS1.1.1, sect. 7.1.4.2)
• Description: (Optional) Same as wms_abstract, applied to the root Layer element. If not set, then wms_abstract will be used.
wms_rootlayer_keywordlist
• WMS TAG Name: KeywordList (WMS1.1.1, sect. 7.1.4.2)
• Description: (Optional) Same as wms_keywordlist, applied to the root Layer element. If not set, then wms_keywordlist will be used.
wms_rootlayer_name
• WMS TAG Name: Name (WMS1.1.1, sect. 7.1.4.1)
• Description: (Optional) Same as MAP.NAME, applied to the root Layer element. If not set, then MAP.NAME will be used. If set to "", then Name element is suppressed and the root layer name will not be advertised as a GetMap capable layer.
wms_rootlayer_title
• WMS TAG Name: Title (WMS1.1.1, sect. 7.1.4.1)
• Description: (Optional) Same as wms_title, applied to the root Layer element. If not set, then wms_title will be used.
wms_service_onlineresource
• Description: (Optional) Top-level onlineresource URL. MapServer uses the onlineresource metadata (if pro- vided) in the following order:
1. wms_service_onlineresource
2. ows_service_onlineresource
3. wms_onlineresource (or automatically generated URL, see the onlineresource section of this document)
wms_srs
• WMS TAG Name: SRS (WMS1.1.1, sect. 6.5.5)



• Description: (Recommended) Contains a list of EPSG projection codes that should be advertised as being avail- able for all layers in this server. The value can contain one or more EPSG:<code> pairs separated by spaces (e.g. "EPSG:4269 EPSG:4326") This value should be upper case (EPSG:3978.  not epsg:3978) to avoid problems
with case sensitive platforms.
• See Also: section "Setup a Mapfile / Map PROJECTION and wms_srs metadata" above.
wms_timeformat
• Description: The time format to be used when a request is sent. (e.g. "wms_timeformat" "%Y-%m-%d %H,
%Y-%m-%d %H:%M"). Please see the WMS Time Support Howto for more information.
wms_title
• WMS TAG Name: Title (WMS1.1.1, sect. 7.1.4.1)
• Description: (Required) A human-readable name for this Layer.

Layer Object Metadata
gml_exclude_items
• Description: (Optional, applies only to GetFeatureInfo GML requests) A comma delimited list of items to ex- clude. As of MapServer 4.6, you can control how many attributes (fields) you expose for your data layer with metadata. The previous behaviour was simply to expose all attributes all of the time. The default is to expose no
attributes at all. An example excluding a specific field would be:

gml_geometries
• Description: (Optional, applies only to GetFeatureInfo GML requests) Provides a name for geometry elements. The value is specified as a string to be used for geometry element names. By default, GML geometries are not written in GML GetFeatureInfo output, unless gml_geometries and gml_[geometry name]_type are both set. By
default, only the bounding box is written. If gml_geometries is set to "none", neither the bounding box nor the geometry are written.
gml_groups
• Description: (Optional, applies only to GetFeatureInfo GML requests) A comma delimited list of group names for the layer.
gml_[group name]_group
• Description: (Optional, applies only to GetFeatureInfo GML requests) A comma delimited list of attributes in the group. Here is an example:

gml_include_items
• Description: (Optional, applies only to GetFeatureInfo GML requests) A comma delimited list of items to in- clude, or keyword "all". As of MapServer 4.6, you can control how many attributes (fields) you expose for your data layer with this metadata. The previous behaviour was simply to expose all attributes all of the time. You
can enable full exposure by using the keyword "all", such as:




You can specify a list of attributes (fields) for partial exposure, such as:

The new default behaviour is to expose no attributes at all.
gml_[item name]_alias
• Description: (Optional, applies only to GetFeatureInfo GML requests) An alias for an attribute's name. The served GML will refer to this attribute by the alias. Here is an example:

gml_[item name]_type
• Description: (Optional) Specifies the type of the attribute. Valid values are the OGR data types: Inte- ger|Long|Real|Character|Date|Time|DateTime|Boolean. MapServer translates these to valid GML data types.




gml_[geometry name]_type
• Description: (Optional, applies only to GetFeatureInfo GML requests) When employing gml_geometries, it is also necessary to specify the geometry type of the layer. This is accomplished by providing a value for gml_[geometry name]_type, where [geometry name] is the string value specified for gml_geometries, and a
value which is one of:
- point
- multipoint
- line
- multiline
- polygon
- multipolygon
gml_xml_items
• Description: (Optional, applies only to GetFeatureInfo GML requests) A comma delimited list of items that should not be XML-encoded.
ows_allowed_ip_list
Same as ows_allowed_ip_list in the Web Object.
ows_denied_ip_list
Same as ows_denied_ip_list in the Web Object.
wms_abstract
Same as wms_abstract in the Web Object.



wms_attribution_logourl_format
• Description: (Optional) The MIME type of the logo image. (e.g. "image/png"). Note that the other wms_attribution_logourl_* metadata must also be specified.
• refer to section 7.1.4.5.11 of the WMS 1.1.1 spec.
wms_attribution_logourl_height
• Description: (Optional) Height of the logo image in pixels. Note that the other wms_attribution_logourl_* metadata must also be specified.
• refer to section 7.1.4.5.11 of the WMS 1.1.1 spec.
wms_attribution_logourl_href
• Description: (Optional) URL of the logo image. Note that the other wms_attribution_logourl_* metadata must also be specified.
• refer to section 7.1.4.5.11 of the WMS 1.1.1 spec.
wms_attribution_logourl_width
• Description: (Optional) Width of the logo image in pixels. Note that the other wms_attribution_logourl_* meta- data must also be specified.
• refer to section 7.1.4.5.11 of the WMS 1.1.1 spec.
wms_attribution_onlineresource
• Description: (Optional) The data provider's URL.
• refer to section 7.1.4.5.11 of the WMS 1.1.1 spec.
wms_attribution_title
• Description: (Optional) Human-readable string naming the data
provider.
• refer to section 7.1.4.5.11 of the WMS 1.1.1 spec.
wms_authorityurl_name, wms_authorityurl_href
• Description: (Optional) AuthorityURL is used in tandem with Identifier values to provide a means of linking identifier information back to a web service. The wms_identifier_authority should provide a string that matches a declared wms_authorityurl_name. Both wms_authorityurl_name and wms_authorityurl_href must be present
for an AuthorityURL tag to be written to the capabilities.
• refer to section 7.1.4.5.12 of the WMS 1.1.1 spec.
wms_bbox_extended:
Added in version 6.0.
• Description: (Optional) "true" or "false". If true, bounding boxes are reported for all supported SRS / CRS in the capabilities document. If false, only the bounding box of the first SRS / CRS is reported.
wms_dataurl_format
• Description: (Optional) Non-standardized file format of the metadata. The layer metadata wms_dataurl_href must also be specified.
• refer to section 7.1.4.5.14 of the WMS 1.1.1 spec.
wms_dataurl_href
• Description: (Optional) The URL to the layer's metadata. The layer metadata wms_dataurl_format must also be specified.



• refer to section 7.1.4.5.14 of the WMS 1.1.1 spec.
wms_enable_request (or ows_enable_request)
• Description: Space separated list of requests to enable. The default is none. The following requests can be enabled: GetCapabilities, GetMap, GetFeatureInfo and GetLegendGraphic. A "!" in front of a request will disable the request. "*" enables all requests.
• Examples:
To enable only GetMap and GetFeatureInfo:

To enable all requests except GetFeatureInfo

wms_exclude_items
• Description: (Optional, applies only to GetFeatureInfo text/plain requests) A comma delimited list of items to exclude, or keyword "all".
See gml_exclude_items above.
wms_extent
• WMS TAG Name: BoundingBox (WMS1.1.1, sect. 6.5.6)
• Description: (Optional) Used for the layer's BoundingBox tag for cases where it is impossible (or very inefficient) for MapServer to probe the data source to figure its extents (such as with databases). The value for this metadata is "minx miny maxx maxy" separated by spaces, with the values in the layer's projection units. If wms_extent is
provided then it has priority and MapServer will NOT try to read the source file's extents.

See alsoVector Data Management & Optimization
For Rasters served through WMS, MapServer can now use the wms_extent metadata parameter to register the image. If a .wld file cannot be found, MapServer will then look for the wms_extent metadata parameter and use the extents of the image and the size of the image for georegistration.

See alsoRaster Management & Optimization
wms_getfeatureinfo_formatlist
• Description: (Optional) Comma-separated list of formats that should be valid for a GetFeatureInfo request. If defined, only these formats are advertised through in the Capabilities document.
wms_getlegendgraphic_formatlist
• Description: (Optional) Comma-separated list of image formats that should be valid for a GetLegendGraphic request. If defined, only these formats are advertised through in the Capabilities document.
wms_getmap_formatlist



• Description: (Optional) Comma-separated list of image formats that should be valid for a GetMap request. If defined, only these formats are advertised through in the Capabilities document.
wms_group_abstract
• Description: (Optional) A blurb of text providing more information about the group. Only one layer for the group needs to contain wms_group_abstract, MapServer will find and use the value. The value found for the first layer in the group is used. So if multiple layers have wms_group_abstract set then only the first value is used.
wms_group_title
• WMS TAG Name: Group_title (WMS1.1.1, sect. 7.1.4.1)
• Description: (Optional) A human-readable name for the group that this layer belongs to. Only one layer for the group needs to contain wms_group_title, MapServer will find and use the value. The value found for the first layer in the group is used. So if multiple layers have wms_group_title set then only the first value is used.
wms_identifier_authority, wms_identifier_value
• Description: (Optional) Identifier is used in tandem with AuthorityURL end points to provide a means of linking identifier information back to a web service. The wms_identifier_authority should provide a string that matches
a declared wms_authorityurl_name. Both wms_identifier_authority and wms_identifier_value must be present for an Identifier tag to be written to the capabilities.
• refer to section 7.1.4.5.12 of the WMS 1.1.1 spec.
wms_include_items
• Description: (Optional, applies only to GetFeatureInfo text/plain requests) A comma delimited list of items to include, or keyword "all".
See gml_include_items above.
wms_keywordlist
Same as wms_keywordlist in the Web Object.
wms_keywordlist_vocabulary
Same as wms_keywordlist_vocabulary in the Web Object.
wms_keywordlist_[vocabulary's name]_items
Same as wms_keywordlist_[vocabulary's name]_items in the Web Object.
wms_layer_group
• Description: (Optional) Can be used to assign a layer to a number of hierarchically nested groups. This grouped hierarchy will be expressed in the capabilities.
From MapServer 7.2, WMS_LAYER_GROUP is similar to the GROUP keyword in that it always publishes the name and the tile of the group in the capabilities. As a consequence the groups set with WMS_LAYER_GROUP can always be requested with a GetMap or GetFeatureInfo request (see section 7.1.4.5.2 of the WMS implemen- tation specification version 1.1.1. (OGC 01-068r2)).
A difference with GROUP is that GROUP does not support nested groups. The purpose of this metadata setting is to enable making a WMS client aware of layer grouping.
All group names should be preceded by a forward slash (/). It is not allowed to use both the WMS_LAYER_GROUP setting and the GROUP keyword for a single layer. GROUP can be seen as deprecated!






(continues on next page)



(continued from previous page)
wms_metadataurl_format
• Description: (Optional) The file format MIME type of the metadata record (e.g. "text/plain"). The layer metadata wms_metadataurl_type and wms_metadataurl_href must also be specified.
• refer to section 7.1.4.5.10 of the WMS 1.1.1 spec.
• To output several MetadataURL elements, use wms_metadataurl_list
wms_metadataurl_href
• Description: (Optional) The URL to the layer's metadata. The layer metadata wms_metadataurl_format and wms_metadataurl_type must also be specified.
• refer to section 7.1.4.5.10 of the WMS 1.1.1 spec.
• To output several MetadataURL elements, use wms_metadataurl_list
wms_metadataurl_list
Added in version 8.0.
• Description: (Optional) Space-separated list of parts of metadata keys, to be able to specify several MetadataURL. If the value of wms_metadataurl_list is "foo bar", then wms_metadataurl_foo_href, wms_metadataurl_foo_format,	wms_metadataurl_foo_type,	wms_metadataurl_bar_href,
wms_metadataurl_bar_format, wms_metadataurl_bar_type will be queried with the semantics of the wms_metadataurl_href, wms_metadataurl_format and wms_metadataurl_type items.
Example:

wms_metadataurl_type
• Description: (Optional) The standard to which the metadata complies. Currently only two types are valid: "TC211" which refers to [ISO 19115], and "FGDC" which refers to [FGDC-STD-001-1988]. The layer metadata wms_metadataurl_format and wms_metadataurl_href must also be specified.
• refer to section 7.1.4.5.10 of the WMS 1.1.1 spec.
• To output several MetadataURL elements, use wms_metadataurl_list
wms_opaque



• WMS TAG Name: Opaque (WMS1.1.1, sect. 7.1.4.6.3)
• Description: (Optional) Set this metadata to "1" to indicate that the layer represents an area-filling coverage of space (e.g. a bathymetry and elevation layer). This should be taken by the client as a hint that this layer should be placed at the bottom of the stack of layers.
wms_srs
Same as wms_srs in the Web Object .
wms_style
• Description: (Optional) The LegendURL style name.		Requires the following meta- data:	wms_style_[style's_name]_width,	wms_style_[style's_name]_legendurl_height, wms_style_[style's_name]_legendurl_format, wms_style_[style's_name]_legendurl_href
• refer to section 7.1.4.5.4 of the WMS 1.1.1 spec.
wms_style_[style's_name]_legendurl_format
• Description: (Optional) The file format MIME type of the legend image.  Requires the follow- ing metadata: wms_style_[style's_name]_width, wms_style_[style's_name]_legendurl_height, wms_style, wms_style_[style's_name]_legendurl_href.
• refer to section 7.1.4.5.4 of the WMS 1.1.1 spec.
wms_style_[style's_name]_legendurl_height
• Description: (Optional) The height of the legend image in pixels.  Requires the following meta- data:	wms_style_[style's_name]_width, wms_style, wms_style_[style's_name]_legendurl_format, wms_style_[style's_name]_legendurl_href.
• refer to section 7.1.4.5.4 of the WMS 1.1.1 spec.
wms_style_[style's_name]_legendurl_href
• Description: (Optional) The URL to the layer's legend.		Requires the following metadata:	wms_style_[style's_name]_width,	wms_style_[style's_name]_legendurl_height, wms_style_[style's_name]_legendurl_format, wms_style.
• refer to section 7.1.4.5.4 of the WMS 1.1.1 spec.
wms_style_[style's_name]_legendurl_width
• Description: (Optional) The width of the legend image in pixels.  Requires the following meta- data:	wms_style_[style's_name]_format, wms_style_[style's_name]_legendurl_height, wms_style, wms_style_[style's_name]_legendurl_href.
• refer to section 7.1.4.5.4 of the WMS 1.1.1 spec.
wms_timedefault
• Description: (Optional for Time Support) This value is used if it is defined and the Time value is missing in the request. Please see the WMS Time Support Howto for more information.
wms_timeextent
• Description: (Mandatory for Time Support) This is used in the capabilities to return the valid time values for the layer. The value defined here should be a valid time range. Please see the WMS Time Support Howto for more information.
wms_timeitem
• Description: (Mandatory for Time Support) This is the name of the field in the DB that contains the time values. Please see the WMS Time Support Howto for more information.



wms_title
Same as wms_title in the Web Object.

Layer Metadata API
If wms_metadataurl_href is not defined, MapServer will provide a link to the Layer Metadata API for the given layer in the <MetadataURL> element See the Layer Metadata API documentation for more information.

Vendor specific WMS parameters
angle
• Angle (in degrees) to rotate the map.


bbox_pixel_is_point
• If this parameter is "TRUE", MapServer will treat the BBOX received in WMS GetMap requests as if it was provided in pixel_is_point mode. Essentially disabling the conversion from pixel_is_area (WMS model) to pixel_is_point that is present in mapwms.c for that specific mapfile.
map_resolution
• Set this parameter to change the Map RESOLUTION . MapServer uses a default screen resolution of 72 DPI. For high-resolution screens, pass this parameter to ensure fonts and symbols appear at the correct size.
radius
• This parameter accepts two types of input:
- An integer that specifies the search radius in pixels.
- The special value bbox that will change the query into a bbox query based on the bbox given in the request parameters.

HTTP status error codes
The OGC WMS specification is not explicit about which HTTP status error code servers should return in case of errors. Traditionaly most WMS implementation return "200 OK" in those situations. Starting with MapServer 8.4, it is possible to define the MS_WMS_ERROR_STATUS_CODE configuration option to ON in the CONFIG.ENV section of the MapServer configuration file to ask MapServer to return HTTP 4xx or 5xx status codes in case of error.












(continues on next page)



(continued from previous page)

Cascading WMS Requests
Currently, there are 3 requests that support WMS cascading:
• GetMap
• GetFeatureInfo
• GetLegendGraphic
Before MapServer 6.2, a GetLegendGraphic request was not cascaded. A legend was returned using the layer classes. To preserve that behavior, a GetLegendGraphic request will be cascaded only if:
1. The GetLegendGraphic request is enabled via the _enable_request metadata.
2. The layer does not contain any class with the name property set. ie:

This layer won't be cascaded because it contains at least a class with the property NAME set.


Sample WMS Server Mapfile
The following is a very basic WMS Server mapfile:

1

2

3

4

5

6

7

8

9

10

11

12
(continues on next page)



(continued from previous page)
13	IMAGEURL "/ms_tmp/"
14	METADATA
15	"wms_title"	"WMS Demo Server"	##required
16	"wms_abstract"	"Longer description of your service" ##recommended
17	"wms_onlineresource"  "http://yourpath/cgi-bin/mapserv.exe?map=/path/to/your-
??mapfile.map"	##required (must change mapfile path)
18	"wms_srs"	"EPSG:3978 EPSG:3857 EPSG:4269 EPSG:4326"	##recommended
19	"wms_enable_request" "*"	##required
20	"wms_getfeatureinfo_formatlist"  "text/plain,text/html,application/vnd.ogc.gml,gml"
??##recommended
21	END
22	END # Web
23
24	PROJECTION
25	"init=epsg:3978"	##required
26	END
27
28	SYMBOL
29	NAME "circle"
30	TYPE ellipse
31	POINTS 1 1 END
32	END # Symbol
33
34	#
35	# Start of layer definitions
36	#
37
38	LAYER
39	NAME "park" ##no special characters or spaces
40	METADATA
41	"wms_title"	"Parks"	##required
42	"wms_abstract"	"Longer description of your layer" ##recommended
43	"wms_include_items" "all" ##optional
44	"gml_include_items" "all" ##optional
45	"gml_featureid"	"ogc_fid" ##optional
46	"gml_geometries"	"msgeom" ##optional
47	"gml_msgeom_type"	"multipolygon" ##optional
48	END
49	TYPE POLYGON
50	STATUS ON
51	DATA "park.shp"
52	PROJECTION
53	"init=epsg:3978"	##recommended
54	END
55	CLASS
56	NAME "Parks"
57	STYLE
58	COLOR 200 255 0
59	OUTLINECOLOR 120 120 120
60	END # Style
61	END # Class
62	TEMPLATE "empty" ##recommended (enable GetFeatureInfo / can point to valid .html?
(continues on next page)



(continued from previous page)


63

64

65

66

67

68

69

70

71

72

73

74

75

76

77

78

79

80

81

82

83

84

85

86

87

88

89

90


91

92

93

FAQ / Common Problems
Q
How can I find the EPSG code for my data's projection?
A
If you know some of the parameters of your data's projection, then you can use the search tool at https://spatialreference.org to find your data's associated EPSG code. The EPSG official home also allows you to perform a text or map search for a projection: https://epsg.org/
For PROJ version >= 6: the EPSG codes are stored in a SQLite database proj.db usually located in /usr/local/share/proj/ on Unix systems and in C:/PROJ/ or C:/PROJ/NAD in Windows systems (depending on the installation), and specifically for MS4W >= 5 users at /ms4w/share/proj.
For PROJ version < 6: you can browse the "epsg" file that comes with PROJ and look for a projection definition that matches your data's projection. It's a simple text file and the EPSG code is inside brack- ets (<. . . >) at the beginning of every line. The "epsg" file is usually located in /usr/local/share/proj/ on Unix systems and in C:/PROJ/ or C:/PROJ/NAD in Windows systems (depending on the installation). MS4W version < 5 users will find the epsg file in /ms4w/proj/nad/.




Q
My WMS server produces the error "msProcessProjection(): no system list, errno: .."
A
That's likely PROJ complaining that it cannot find the epsg projection definition file (for PROJ version
< 6), or the proj.db file (for PROJ version >= 6). Make sure you have installed PROJ and that the proj.db file (or epsg depending on your local PROJ version) is installed at the right location. On Unix it should be under /usr/local/share/proj/, and on Windows PROJ looks for it under C:/PROJ/ or C:/PROJ/NAD (depending on the installation), MS4W users will find the file in /MS4W/proj/nad/. You should also check the error documentation to see if your exact error is discussed.
If you don't have the proj.db file (or epsg file) then you can get it as part of the PROJ distribution at https://proj.org/ Alternatively, you can manually download the PROJ < 6 epsg file at http://www. maptools.org/dl/proj4-epsg.zip.


Q
How do AUTO projections work?
A
When a WMS client calls a WMS server with an auto projection, it has to specify the SRS in the form: AUTO: proj_id,unit_id,lon0,lat0 where:
• proj_id is one of 42001, 42002, 42003, 42004, or 42005 (only five auto projections are currently defined).
• unit_id is always 9001 for meters. (It is uncertain whether anyone supports any other units.)
• lon0 and lat0 are the coordinates to use as the origin for the projection.
When using an AUTO projection in WMS GetCapabilities, you include only the "AUTO:42003" string in your wms_srs metadata, you do not include the projection parameters. Those are added by the application (client) at runtime depending on the map view. For example:

The above server advertises the first two auto projections.

10.1.4 OGC API : Features
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com



Last Updated
2025-11-19


Background
OGC is undergoing a revolutionary effort around modernizing their API specifications to align with current technology and design patterns:
• REST
• JSON
• OpenAPI (and Swagger)
The OGC API efforts represent a clean break from the first generation WxS specifications. This document is an attempt to describe MapServer support for (initially) the OGC API - Features server specifications. The modular nature of OGC API will allow for reuse of shared functionality (landing pages, conformance, collections, queryables, filtering, etc.) across various OGC APIs implemented in MapServer.
OGC API request/response design patterns consist of HTTP operations with GET (KVP) or POST (JSON) methods to specific query parameters. HTTP methods beyond GET/POST (PUT, DELETE, etc.) are envisioned as optional extensions for transactional capability.
Below are mappings between WxS specifications implemented in the MapServer suite and the relevant emerging OGC API standards.

WxSOGC APIOWS CommonOGC API - CommonWMSOGC API - MapsWMTSOGC API - TilesWFSOGC API - FeaturesWCSOGC API - CoveragesSLDOGC API - Styles


Requirements
MapServer 8.0 or more recent (compiled with the -DWITH_OGCAPI CMake switch enabled) is required to implement OGC API.


This document assumes that you are already familiar with certain aspects of MapServer:
• MapServer application development and setting up .map files.
• Familiarity with the OGCAPI: Features spec would be an asset.

Links to OGC API-Related Information
• MapServer's RFC 134
• OGC API: Features specification
• OGC API: Features workshop module
• pygeoapi OGCAPI demo landing page
• pygeoapi OGCAPI Swagger API docs

Setting Up an OGC API Server Using MapServer Install the Required Software
OGC API requests are handled by the mapserv CGI program. The first step is to check that your mapserv exe- cutable includes OGC API support. One way to verify this is to use the "-v" command-line switch and look for "SUPPORTS=OGCAPI_SERVER".
(Unix users should refer to the Compiling on Unix document for any compiling instructions, and Windows users might want to use MS4W, which comes ready with OGC API support)
Example 1. On Unix:

Example 2. On Windows:







(continues on next page)



(continued from previous page)

Configure the MapServer CONFIG file
Since MapServer 8.0 all installations require a CONFIG file. In the case of OGC API, it is required that you setup a map alias to your mapfile such as:





Setup a Mapfile For Your OGC API Service
The namespace "oga" (OGC Geospatial API) is used for OGC API support, and existing ows|wfs|wms|gml metadata will be leveraged wherever possible. The oga namespace will take precedence in metadata lookups.
Here is the list of parameters and metadata items that usually optional with MapServer, but are required (or strongly recommended) for an OGC API server:
At the MAP level:
• Map NAME
• Map PROJECTION
• Map Metadata (in the WEB Object):
- ows_title
- oga_onlineresource
- oga_html_template_directory
- oga_enable_request
And for each LAYER:
• Layer NAME
• Layer PROJECTION
• Layer METADATA

MapServer Documentation, Release 8.6.0


- ows_title
- gml_include_items
- gml_featureid
• LAYER TEMPLATE "VOID"
Metadata


KeyLevelMeaningonlineresourceMapAPI root url, can't reuse WxS valueshtml_template_directMapfull path or relative (to mapfile) of html template directorydescriptionMapservice description, fall back to ows/wfs_abstractlinksMap,
Layercomma delimited list of link keys - references to other metadatalink_{key}_titleMap,
Layerlink titlelink_{key}_hrefMap,
Layerlink href (url)html_tagsMapcomma delimited list of tag keys to expose to HTML templates - references to other
metadatatag_{key}Mapvalue associated with the tag, added to JSON data in template.tags objectkeywordsLayercomma delimited list of keywords, fall back to ows/wfs_keywordlistmax_limitMap,
Layermap or layer-level maximum limit value (integer)use_default_extent_fo
(optional)Layer(since 8.4) Use MAP EXTENT as a spatial filter if no bbox is in the request. Setting to "false" can improve performance. See also
wfs_use_default_extent_for_getfeature.
Example OGC API Server Mapfile






















(continues on next page)



(continued from previous page)
"oga_onlineresource"	"http://127.0.0.1/cgi-bin/mapserv.exe/localdemo/ogcapi"
??#REQUIRED	(setup "localdemo" link to mapfile in CONFIG file) "ows_service_onlineresource" "https://gatewaygeomatics.com/" "ows_contactperson"	"Jeff McKenna" "ows_contactorganization" "GatewayGeo"
"ows_contactposition"	"President" "ows_contactelectronicmailaddress" "info@gatewaygeomatics.com" "ows_srs"	"EPSG:4326 EPSG:3857 EPSG:4269"
"ows_getfeatureinfo_formatlist"  "text/plain,text/html,application/json,application/
??vnd.ogc.gml,gml"
"ows_enable_request"	"*" #REQUIRED
"oga_html_template_directory" "share/ogcapi/templates/html-bootstrap/" #REQUIRED
END
END

OUTPUTFORMAT
NAME "png"
DRIVER AGG/PNG
MIMETYPE "image/png" IMAGEMODE RGB EXTENSION "png"
FORMATOPTION "GAMMA=0.75"
END

OUTPUTFORMAT
NAME "application/json"
DRIVER "OGR/GEOJSON"
MIMETYPE "application/json" FORMATOPTION "FORM=SIMPLE" FORMATOPTION "STORAGE=memory"
END

/* Ocean */
LAYER
NAME "ocean"
METADATA
"ows_title" "Ocean" #REQUIRED
"ows_abstract" "Oceans, NaturalEarth dataset, 2020" "gml_include_items" "all" #REQUIRED
"gml_featureid"	"ne_id" #REQUIRED
"oga_use_default_extent_for_getfeature" # Optional. Can improve performance.
END
TYPE POLYGON STATUS ON CONNECTIONTYPE OGR
CONNECTION "demo.db" DATA "countries" PROJECTION
"init=epsg:4326"
END
CLASS
NAME "Ocean"
(continues on next page)



(continued from previous page)

Template Handling
Templates contain Inja template markup. The filenames are fixed in code (e.g. collection-items.html). The directory containing the templates is given in webObj metadata or (optionally) via environment variable (that can be set in the MapServer CONFIG file). The directory specification is either absolute (e.g. /opt/mapserver/ogcapi/templates) or relative to the location of the mapfile. As present the implementation allows the use of the Inja {{ include "file" }} tag. It's really impractical to maintain templates with common elements (e.g. header, footer, etc. . . ) without that functionality. The current Inja implementation allows any value for the file attribute which represents a security risk if access to the templates is not limited. There are existing enhancement requests for Inja to add this functionality, or we'll need to update the library to limit includes to the specified directory or sub-directories.




Test Your OGC API Server Landing Page
• you can access your OGC API landing page with a url such as:

or in the above example, it would be: http://127.0.0.1/cgi-bin/mapserv.exe/localdemo/ogcapi/






Collections
• you can access your OGC API collections with a url such as ogcapi/collections?f=json (JSON) or og- capi/collections?f=html (HTML) such as:


or in the above example, it would be: http://127.0.0.1/cgi-bin/mapserv.exe/localdemo/ogcapi/ collections?f=html




Collection Items
• you	can	access	a	specific	OGC	API	collection	item	in	GeoJSON	such	as	og- capi/collections/layername/items?f=json such as:


or in the above example, it would be: http://127.0.0.1/cgi-bin/mapserv.exe/localdemo/ogcapi/ collections/lakes/items?f=json







• you can access your OGC API collection items in HTML such as ogcapi/collections/layername/items?f=html
such as:


or in the above example, it would be: http://127.0.0.1/cgi-bin/mapserv.exe/localdemo/ogcapi/ collections/lakes/items?f=html






API Document
• you can access your OGC API document with a url such as ogcapi/api?f=json (JSON) or ogcapi/api?f=html
(HTML) such as:


or in the above example, it would be: http://127.0.0.1/cgi-bin/mapserv.exe/localdemo/ogcapi/ api?f=json





Further Configuration
The following metadata may be used for additional configuration of the service:

Web Object Metadata
ows_extra_params
Added in version 8.6.0.
• Description: (Optional) The ows_extra_params (or oga_extra_params) metadata entry allows you to append additional query parameters to all URLs generated by MapServer. This can be used, for example, to include authentication tokens such as JSON Web Tokens (JWT) in your API requests.
The value supports Run-time Substitution, where tokens in the form %TOKEN%, are replaced with validated values from the query string or cookies. Parameters are validated against the rules in the VALIDATION block, and are case-insensitive. ows_extra_params can also be set at the LAYER METADATA level, for adding or overriding parameters at the collection-level. Example Mapfile:

Example URL:

Will return JSON containing the same parameters and values for all links:

If a parameter is missing or invalid, it is replaced by the corresponding default value (e.g., MISSING for token,
-1 for user_id). Example URL:

Will return:




The extra parameters are available in HTML templates for the OGC Features API as {{ template. extra_params }}. The templates supplied in the MapServer repository append this value to all URLs by default.
ows_schemas_location
Added in version 8.2.0.
• Description: (Optional) (Note the name ows_schemas_location because all OGC Web Services (OWS) use the same metadata) Root of the web tree where the family of OGC API JSON Schema files are located. This must be a valid URL where the actual .yaml files are located if you want your OpenAPI description to be valid. Default
is http://schemas.opengis.net

10.1.5 INSPIRE View Service
Author
Stephan Meissl
Contact
stephan.meissl at eox.at
Last Updated
2012-03-19


Introduction
INSPIRE is the name of an European directive, establishing an infrastructure for spatial information in Europe to support Community environmental policies, and policies or activities which may have an impact on the environment.
The INSPIRE View Service is an implementation of the INSPIRE Technical Guidance document on top of the WMS Server implementation explained in the previous chapter.
In order to achieve INSPIRE View Service compliance, the following enhancements have been implemented in MapServer:
• Activation of INSPIRE support (two scenarios)
• Multi-language support for certain capabilities fields
• Provision of INSPIRE specific metadata
• Named group layers
• Style section for root layer and possibly existing group layers



Support for INSPIRE View Service in MapServer uses a syntax identical to the one used for INSPIRE Download Service. Consequently, it is possible to define shared metadata items between Download and View services by using the ows_ prefix instead of wms_.

Activation of INSPIRE support
INSPIRE specific metadata can either be referenced in an external INSPIRE service metadata document (scenario 1) or can be directly embedded in the capabilities document (scenario 2). MapServer supports both scenarios.
Activation of the corresponding scenario for INSPIRE support takes place in the WEB.METADATA section of the mapfile through wms_inspire_capabilities. If activated, the corresponding INSPIRE namespace as well as appropriate validation warnings are generated in the capabilities document.
Scenario 1 - activate INSPIRE support using a reference to external service metadata:

Scenario 2 - activate INSPIRE support using embedded service metadata:


Multi-language support for certain capabilities fields
INSPIRE requires multi-language support and requests a list of all supported languages as well as the default language in the capabilities document. Based on the language parameter in the GetCapabilities request, certain specific metadata values, namely
• wms_title
• wms_abstract
• wms_rootlayer_title
• wms_rootlayer_abstract
• wms_group_title
• wms_group_abstract
• wms_style_title
• wms_style_<name>_title
as well as language dependent reference data like
• DATA "road_eng"
• CONNECTION "db_ger"
need to be provided in the requested language. If the language is not supported (or no language parameter is present), the default language has to be used.



All supported languages have to be specified as comma separated list (first language is default) through wms_languages in the WEB.METADATA section of the mapfile. This language parameter is also added to the OnlineResource in the GetCapabilities output:

For language specific metadata values, a key extension method is applied:

For language dependent reference data, a similar approach like the run-time substitution feature of MapServer has been followed (only DATA and CONNECTION values with %language% are substituted):

If the language is not supported (or no language parameter is present), the default language is substituted.

Provision of INSPIRE specific metadata
Depending on the scenario, additional metadata information is required to support the specification. The INSPIRE related fields are provided below.
Scenario 1 - INSPIRE related fields using referenced external service metadata:











(continues on next page)



(continued from previous page)
Scenario 2 - INSPIRE related fields using embedded service metadata:
WEB
METADATA
"wms_inspire_capabilities" "embed"
"wms_languages" "eng,ger"	#first default, values according ISO 639-2/B
"wms_inspire_temporal_reference" "2011-09-19" #date of last revision, value according?
??YYYY-MM-DD
"wms_inspire_mpoc_name" "mympocname"	#point of contact "wms_inspire_mpoc_email" "mympoc@e.mail" #point of contact "wms_inspire_metadatadate" "2011-09-19" #value according YYYY-MM-DD "wms_inspire_resourcelocator" "http://myinspireresource" #URL for ResourceLocator "wms_inspire_keyword" "infoMapAccessService" #value according "classification of?
??spatial data services"
"wms_keywordlist_ISO_items" "infoMapAccessService" "wms_keywordlist_vocabulary" "ISO"
"wms_title" "myservicetitle" "wms_abstract" "myabstract"
"wms_fees" "conditions unknown"	#value either "no conditions apply"|default
??"conditions unknown"|<specific conditions>
"wms_accessconstraints" "None"	#value according ISO 19115 (MD_RestrictionCode?
??codelist) or default "None"
"wms_contactorganization"  "MapServer"	#responsible organization
"wms_contactposition" "owner"	#responsible organization, value according
??"INSPIRE Metadata Regulation" (part D6)
 ... END END

Notes:
• several fields require certain values, these values are not validated by MapServer itself, instead a manual valida- tion against the INSPIRE schemas and the WMS INSPIRE tester is recommended
• as suggested in this document regarding scenario 2, <inspire_common:ResourceType> is always set to service and <inspire_common:SpatialDataServiceType> is always set to view, both values can't be altered through the mapfile
• conformity is always set to not evaluated, based on the latest INSPIRE Metadata Implementing Rules (page 7), a specification document, the specification date and a specification URI or URL need to be provided for degree conformant/not conformant, which is currently not implemented



Named group layers
INSPIRE mandates usage of named group layers. Thus the functionality of wms_layer_group is extended to support named group layers. If a layer with the same name as used in wms_layer_group is found it is treated as named group and if no layer with this name is found as unnamed group as before.
Provided that ability, a hierarchy of any level can be achieved. See for example the grouping used in the wms_inspire.map mapfile in msautotest:


Style section for root layer and possibly existing group layers
For regular layers, the concept of GROUP and CLASSGROUP can be used to set the layer style name to the according value. Additionally the layer style titles can be overwritten through wms_style_<stylename>_title and the layer style legendURLs through wms_style_<stylename>_legendurl_* (width, height, format, and href need to be provided):
























(continues on next page)



(continued from previous page)
The following method is implemented to support (customizable) style sections in the root layer:
• use wms_style_name in the WEB.METADATA section to add a style section to the root layer
• use wms_style_title to override the style title (optional)
   • use wms_style_legendurl_* to override width, height, format and href of the legendURL (optional) and possibly existing group layers:
• use wms_group_style_name in the first corresponding LAYER.METADATA section to add a style section to the group layer
• use wms_group_style_title to override the style title (optional)
• use wms_group_style_legendurl_* to override width, height, format and href of the legendURL (optional)
...
WEB
METADATA
...
"wms_style_name" "inspire_common:DEFAULT"	#style name
"wms_style_title" "myroadarealayerstyletitle"	#style title
"wms_style_legendurl_width" "85"	#override style legendurl (mandatory:?
??width, height, format, href) "wms_style_legendurl_height" "40" "wms_style_legendurl_format" "image/png"
 "wms_style_legendurl_href" "http://path/to/onlineresource...roadarea" END
END
LAYER
NAME TN.RailTransportNetwork.RailwayLink
GROUP TN.CommonTransportElements.TransportLink DATA "road"
METADATA
"wms_group_title.eng" "Transport networks: Generic Transport Link" "wms_group_title.ger" "Verkehrsnetze: Generisches Verkehrssegment" "wms_group_abstract" "mygenerictransportlinklayerabstract" #fallback "wms_group_abstract.ger" "mygenerictransportlinklayerabstract" "wms_group_style_name" "inspire_common:DEFAULT" #style name "wms_group_style_title" "mygenerictransportlinklayerstyletitle" #style title
"wms_group_style_legendurl_width"  "85"	#override style legendurl (mandatory:?
(continues on next page)



(continued from previous page)
Provided that ability, 3 levels of hierarchy can be achieved as done in the example mapfiles wms_inspire_scenario1.map and wms_inspire_scenario2.map in msautotest:


10.1.6 WMS Client
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2024-07-08

Table of Contents• WMS Client
- Introduction
* WMS-Related Information
- Compilation / Installation
* Check your MapServer executable
- MapFile Configuration
* Storing Temporary Files
* Configuring for HTTPS Connections
* Adding a WMS Layer
· Required Layer Parameters and Metadata




Introduction
A WMS (or Web Map Server) allows for use of data from several different servers, and enables for the creation of a network of Map Servers from which clients can build customized maps. The following document contains information about using MapServer's WMS connection type to include layers from remote WMS servers in MapServer applications.
MapServer supports the following WMS versions when acting as client: 1.0.0, 1.1.0, 1.1.1, 1.3.0 (see MapServer OGC Specification support for an updated list).
This document assumes that you are already familiar with certain aspects of MapServer:
• MapServer application development and setting up .map files.
• Familiarity with the WMS spec would be an asset. A link to the WMS specification document is included below.

WMS-Related Information
• MapServer WMS Server HowTo
• WMS 1.3.0 specification
• WMS 1.1.1 specification
• OGC's WMS homepage
• MapServer OGC Web Services Workshop package

Compilation / Installation
The WMS connection type is enabled by the -with-wmsclient configure switch. It requires PROJ, GDAL and libcurl version 7.10.1 or more recent. Windows users who do not want to compile MapServer should use MS4W (which comes ready for WMS/WFS client and server use), or check for the availability of other Windows binaries with WMS support.
• For PROJ and GDAL installation, see the MapServer Compilation HowTo (Compiling on Unix / Compiling on Win32)
• For libcurl, make sure you have version 7.10.1 or more recent installed on your system. You can find out your libcurl version using curl-config -version. (if your system came with an older version of libcurl preinstalled then you MUST uninstall it prior to installing the new version)
Once the required libraries are installed, then configure MapServer using the -with-wmsclient switch (plus all the other switches you used to use) and recompile. This will give you a new set of executables (and possibly php_mapscript.so if you requested it). See the MapServer Compilation HowTo (links above) for installation details.

Check your MapServer executable
To check that your mapserv executable includes WMS support, use the "-v" command-line switch and look for "SUP- PORTS=WMS_CLIENT".
Example 1. Mapserv Version Info on Unix:





Example 2. Mapserv Version Info on Windows:


MapFile Configuration


Storing Temporary Files
Since MapServer version 6.0 when wms_cache_to_disk metadata is turned on (and for MapServer < 6.0), you have to set the IMAGEPATH value in the WEB object of your mapfile to point to a valid and writable directory. MapServer will use this directory to store temporary files downloaded from the remote servers. The temporary files are automatically deleted by MapServer so you won't notice them.
Example 3. Setting IMAGEPATH Parameter in Mapfile

MS4W Users Should Specify the Following for IMAGEPATH and IMAGEURL:





If you want to keep this temporary file for debugging purposes, you should add the following statement to the LAYER object of your mapfile:



See alsoDebugging MapServer
Configuring for HTTPS Connections
Follow the Accessing OGC services over HTTPS document to make sure that your local server can connect through HTTPS secured connections.

Adding a WMS Layer
WMS layers are accessed via the WMS connection type in the Mapfile. Here is an example of a layer using this connection type:

You can also combine remote WMS layers from a server into one layer, separated by a comma (,) such as:




(continues on next page)



(continued from previous page)


Required Layer Parameters and Metadata
CONNECTIONTYPE WMS CONNECTION
• Description: This is the remote server's online resource URL, just the base URL without any of the WMS parameters. The server version, image format, layer name, etc. will be provided via metadata, see below.


"wms_format" metadata
• Description: The image format to use in GetMap requests.


"wms_name" metadata
• Description: Comma-separated list of layers to be fetched from the remote WMS server. This value is used to set the LAYERS and QUERY_LAYERS WMS URL parameters. Note that when specifying multiple layers there must not be any spaces between the comma and the layer name.
"wms_server_version" metadata
• Description: The version of the WMS protocol supported by the remote WMS server and that will be used for issuing GetMap requests.
"wms_srs" metadata



• Description: Space-delimited list of EPSG projection codes supported by the remote server. You normally get this from the server's capabilities output. This value should be upper case (EPSG:4236.  not epsg:4236) to
avoid problems with case sensitive platforms. The value is used to set the SRS WMS URL parameter.

Optional Layer Parameters and Metadata
MINSCALE, MAXSCALE
• Description: If the remote server's capabilities contains a ScaleHint value for this layer then you might want to set the MINSCALE and MAXSCALE in the LAYER object in the mapfile. This will allow MapServer to request the layer only at scales where it makes sense
PROJECTION object
• Description: It is optional at this point. MapServer will create one internally if needed. Including one may allow MapServer to avoid looking up a definition in the PROJ init files.
"wms_allowed_gdal_drivers" metadata
Added in version 8.2.0.
List of GDAL driver short names that are allowed to be used to open the image returned by the remove server. The separator is a comma character. The default value is "PNG,JPEG" (starting with version 8.2.0). If the output format asked to the server is explicitly set to PNG or image/png (resp. JPEG or image/jpeg), then the default value is restricted of wms_allowed_gdal_drivers is set to PNG (resp. JPEG)

"wms_auth_username" metadata
• Description: msEncrypt-style authorization string. Empty strings are also accepted.

"wms_auth_type" metadata
• Description: Authorization type. Supported types include:
- basic
- digest
- ntlm
- any (the underlying http library picks the best among the opotions supported by the remote server)
- anysafe (the underlying http library picks only safe methods among the options supported by the remote server)

"wms_connectiontimeout" metadata



• Description: The maximum time to wait for a remote WMS layer to load, set in seconds (default is 30 seconds). This metadata can be added at the layer level so that it affects only that layer, or it can be added at the map level (in the web object) so that it affects all of the layers. Note that wms_connectiontimeout at the layer level has
priority over the map level.

"wms_essential" metadata
Added in version 7.6.0.
• Description: Set this to "1" to mark this WMS layer as essential. Normally, when a request to a WMS layer fails, this layer will be skipped and the map is rendered without the layer. If the layer is essential and fails, the map will not be rendered and an exception is thrown.


"wms_exceptions_format" metadata
• Description: Set the format for exceptions (as of MapServer 4.6). MapServer defaults to applica- tion/vnd.ogc.se_inimage (the exception will be in a picture format). You can check the GetCapabilities of the server to see what formats are available for exceptions. The application/vnd.ogc.se_inimage exception format
is actually a non-required exception format in the WMS 1.1.1 spec, so there are servers out there which don't support this format. In that case you would use:

Which would return this xml exception in the MS_ERRORFILE:





(continues on next page)



(continued from previous page)
"wms_force_separate_request" metadata
• Description: Set this to "1" to force this WMS layer to be requested using its own separate GetMap request. By default MapServer will try to merge multiple adjacent WMS layers from the same server into a single multi-layer
GetMap request to reduce the load on remote servers and improve response time. This metadata is used to bypass that behavior.
"wms_formatlist" metadata
• Description: Comma-separated list of image formats supported by the remote WMS server. Note that wms_formatlist is used only if wms_format is not set. If both wms_format and wms_formatlist are provided then wms_format takes precedence.
"wms_latlonboundingbox" metadata
• Description: The bounding box of this layer in geographic coordinates in the format "lon_min lat_min lon_max lat_max". If it is set then MapServer will request the layer only when the map view overlaps that bounding box. You normally get this from the server's capabilities output.

"wms_proxy_auth_type" metadata
• Description: The authorization type to use for a proxy connection. Supported types include:
- basic
- digest
- ntlm
- any (the underlying http library picks the best among the opotions supported by the remote server)
- anysafe (the underlying http library picks only safe methods among the options supported by the remote server)

"wms_proxy_host" metadata
• Description: The hostname of the proxy to use, in "dot-quad" format, with an optional port component (e.g. '192.168.2.10:8080').




"wms_proxy_port" metadata
• Description: The port to use for a proxy connection.

"wms_proxy_type" metadata
• Description: The type of the proxy connection. Valid values are 'http' and 'socks5', which are case sensitive.

"wms_proxy_username" metadata
• Description: msEncrypt-style string for a proxy connection. Empty strings are also accepted.

"wms_sld_body" metadata
• Description: Can be used to specify an inline SLD document.
"wms_sld_url" metadata
• Description: Can be used to specify a link to an SLD document.
"wms_style" metadata
• Description: Name of style to use for the STYLES parameter in GetMap requests for this layer.
"wms_style_<stylename>_sld" metadata
• Description: URL of a SLD to use in GetMap requests. Replace <stylename> in the metadta name with the name of the style to which the SLD applies.

For more information on SLDs in MapServer see the SLD HowTo document.
"wms_time" metadata
• Description: Value to use for the TIME parameter in GetMap requests for this layer. Please see the WMS Time HowTo for more information.
"wms_bgcolor" metadata
• Description: Specifies the color to be used as the background of the map. The general format of BGCOLOR is a hexadecimal encoding of an RGB value where two hexadecimal characters are used for each of Red, Green, and Blue color values. The values can range between 00 and FF for each (0 and 255, base 10). The format is



0xRRGGBB; either upper or lower case characters are allowed for RR, GG, and BB values. The "0x" prefix shall have a lower case "x".
"wms_transparent" metadata
• Description: Specifies whether the map background is to be made transparent or not. TRANSPARENT can take on two values, "TRUE" or "FALSE". If not specified, MapServer sets default to "TRUE".
"wms_cache_to_disk" metadata
• Description: Set this to "1" to force MapServer to write fetched images to disk. Writing to disk is necessary to take advantage of MapServer's caching logic to avoid refetching WMS requests made previously. This feature is new to MapServer 6.0 - previously results were always written to disk.
"wms_nonsquare_ok" metadata
• Description: Set this to "0" to indicate that the remote WMS only supports requests for square pixels. In this case MapServer will be careful to only make square pixel requests even if it means oversampling in one dimension compared to the resolution of image data required. This feature is new to MapServer 6.0.
"wms_extent" metadata
• Description: If there is exactly one SRS supported by this layer (as listed in the wms_srs metadata), and if the wms_extent metadata item (or an extent specified via the EXTENT keyword) is set then MapServer will take care to only making requests within this area. This can short circuit requests completely outside the layer, reduce
processing for layers that only partially overlap the target map area and avoid poor behaviors with reprojection in some areas. The contents of this metadata item should be of the form "minx miny maxx maxy". This feature is new to MapServer 6.0.
"wms_strict_axis_order metadata
• Description: Set this to "1" or "true" to force WMS requests to use strict axis order according to the EPSG code, or "0" or "false" to force WMS requests to always use xy (or lonlat) axis order. This should only be necessary if the axis order interpretation of the server for the chosen EPSG code does not conform to the standard: In the
case of WMS 1.0 and 1.1 the assumption is to always use xy (default 0/false), for WMS 1.3.0 the assumption is strict axis order according to the EPSG database (default 1/true).


Old CONNECTION parameter format from version 3.5 and 3.6 (deprecated)
In MapServer version 3.5 and 3.6, the CONNECTION parameter had to include at a minimum the VERSION, LAY- ERS, FORMAT and TRANSPARENT WMS parameters. This mode of operation is still supported but is deprecated and you are encouraged to use metadata items for those parameters as documented in the previous section above.
Here is an example of a layer definition using this deprecated CONNECTION parameter format:







(continues on next page)



(continued from previous page)

Limitations/TODO
1. GetFeatureInfo is not fully supported since the output of getFeatureInfo is left to the discretion of the remote server. A method layer.getWMSFeatureInfoURL() has been added to MapScript for applications that want to access featureInfo results and handle them directly.
2. MapServer does not attempt to fetch the layer's capabilities. Doing so at every map draw would be extremely inefficient. And caching that information does not belong in the core of MapServer. This is better done at the application level, in a script, and only the necessary information is passed to the MapServer core via the CONNECTION string and metadata.

10.1.7 WMS Time
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2023-01-09


Introduction
A WMS server can provide support to temporal requests. This is done by providing a TIME parameter with a time value in the request. MapServer 4.4 and above provides support to interpret the TIME parameter and transform the resulting values into appropriate requests.

Links to WMS-Related Information
• MapServer WMS Server HowTo
• MapServer WMS Client HowTo
• WMS 1.1.1 specification
• MapServer OGC Web Services Workshop



Enabling Time Support in MapServer Time Patterns
WMS specifies that the basic format used for TIME requests is based on the ISO 8601:1988(E) "extended" format. MapServer supports a limited set of patterns that are defined in the ISO 8601 specifications, as well as few other patterns that are useful but not compliant to ISO 8601. Here is a list of patterns currently supported:
Table 1. Supported Time Patterns

Time PatternsExamplesYYYYMMDD20041012YYYY-MM-DDTHH:MM:SSZ2004-10-12T13:55:20ZYYYY-MM-DDTHH:MM:SS2004-10-12T13:55:20YYYY-MM-DD HH:MM:SS2004-10-12 13:55:20YYYY-MM-DDTHH:MM2004-10-12T13:55YYYY-MM-DD HH:MM2004-10-12 13:55YYYY-MM-DDTHH2004-10-12T13YYYY-MM-DD HH2004-10-12 13YYYY-MM-DD2004-10-12YYYY-MM2004-10YYYY2004THH:MM:SSZT13:55:20ZTHH:MM:SST13:55:20
Setting Up a WMS Layer with Time Support
To have a valid WMS layer with time support, the user has to define the following metadata at the layer level:
• wms_timeextent: (Mandatory) this is used in the capabilities document to return the valid time values for the layer. The value defined here should be a valid time range. (more on this in 'Specifying Time Extents' below)
• wms_timeitem: (Mandatory) this is the name of the field in the DB that contains the time values.
• wms_timedefault: (Optional) this value is used if it is defined and the TIME value is missing in the request.
It is also recommended to set a LAYER FILTER for the time layer to provide a default time also for non-WMS requests. If the time item is mytime, and the time format is "YYYYMMDD" the following layer filter could be used:


Specifying Time Extents
Time Extents can be declared with the following syntax for the wms_timeextent metadata (see Annex C.3 in the WMS 1.1.1 specification document for a full description):
1. value - a single value. This is not directly supported in MapServer but there is an easy workwound by specifying the same value as min and max.
2. value1,value2,value3,. . . - a list of multiple values.
3. min/max/resolution - an interval defined by its lower and upper bounds and its resolution. This is supported in MapServer (note that the resolution is not supported however).
4. min1/max1/res1,min2/max2/res2,... - a list of multiple intervals.



Example WMS-Server Layer


GetCapabilities Output
If your layer is set up properly, requesting the capabilities on the server outputs a Dimension element. Here is an example of a GetCapabilities result for a layer configured for time support:


Supported Time Requests
When sending a request with the TIME parameter, different types of time values can be specified. The following are supported by MapServer:
• single value: for example: . . .&TIME=2004-10-12&. . .
• multiple values: for example: . . .&TIME=2004-10-12, 2004-10-13, 2004-10-14&. . .
• single range value: for example: . . .&TIME=2004-10-12/2004-10-13&. . .
• multiple range values: for example: . . .&TIME=2004-10-12/2004-10-13, 2004-10-15/2004-10-16&. . .



Interpreting Time Values
When MapServer receives a request with a TIME parameter, it transforms the time requests into valid expressions that are assigned to the filter parameter on layers that are time-aware. Here are some examples of how different types of requests are treated (wms_timeitem is defined here as being "time_field"):
• single value (2004-10-12) transforms to ('[time_field]' eq '2004-10-12')
• multiple values (2004-10-12, 2004-10-13) transform to ('[time_field]' eq '2004-10-12' OR '[time_field]' eq '2004-10-13')
• single range : 2004-10-12/2004-10-13 transforms to (('[time_field]' ge '2004-10-12') AND ('[time_field]' le '2004-10-13'))
• multiple ranges (2004-10-12/2004-10-13, 2004-10-15/2004-10-16) transform to (('[time_field]' ge '2004-10-12' AND '[time_field]' le '2004-10-13') OR ('[time_field]' ge '2004-10-15' AND '[time_field]' le '2004-10-16'))
As shown in the above examples, all fields and values are written inside back tics (') - this is the general way of specifying time expressions inside MapServer.
Exceptions to this rule:
1. When dealing with layers that are not Shapefiles nor through OGR, the expression built has slightly different syntax. For example, the expression set in the filter for the first example above would be ([time_field] = '2004- 10-12').
2. For PostGIS/PostgreSQL layers, the time expression built uses the date_trunc function available in PostgreSQL. For example, if the user passes a time value of '2004-10-12', the expression set in the filter is date_trunc('day', time_field) = '2004-10-12'. The use of the date_trunc function allows requests to use the concept of time reso- lution. In the example above, for a request of '2004-10-12', MapServer determines that the resolution is "day" by parsing the time string and the result gives all records matching the date 2004-10-12 regardless of the values set for Hours/Minutes/Seconds in the database. For more information on the date_trunc function, please refer to the PostgreSQL documentation.

Limiting the Time Formats to Use
The user has the ability to define the time format(s) to be used when a request is sent, in metadata at the WEB level. For example, the user can define the following two formats:

Another example is for a WMS layer that is based on time data that contains precise time values taken every minute (e.g., 2004-10-12T13:55, 2004-10-12T13:56, 2004-10-12 T13:57, . . . ). Normally, a valid request on such a layer would require the time value to be as complete as the data underneath. By defining a set of patterns to use, MapServer introduces the notion of resolution to be used when doing a query. Using the example above, a request TIME= 2004- 10-12T13:55 would be valid and a request TIME= 2004-10-12T13 would also be valid and would return all elements taken for that hour.
Note that this functionality is only available on layers based on Shapefiles and OGR.

Example of WMS-T with PostGIS Tile Index for Raster Imagery
This example currently requires latest 4.9 CVS build!
Here is an example mapfile snippet for a raster WMS-T instance using a PostGIS tileindex. This example shows US Nexrad Base Reflectivity running at Iowa State U at http://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r-t.cgi? SERVICE=WMS&request=GetCapabilities



1	#	Tile Index
2	LAYER
3	STATUS ON
4	NAME "time_idx"
5	TYPE POLYGON
6	# Mapserver requires some unique field for SQL query
7	DATA "the_geom from nexrad_n0r_tindex using unique filepath"
8	METADATA
9	"wms_title" "TIME INDEX"
10	"wms_srs"	"EPSG:4326"
11	"wms_extent" "-126 24 -66 50"
12	"wms_timeextent" "2003-08-01/2006-12-31/PT5M"
13	"wms_timeitem" "datetime" #column in postgis table of type timestamp
14	"wms_timedefault" "2006-06-23T03:10:00Z"
15	"wms_enable_request" "*"
16	END
17	CONNECTION "dbname=postgis host=10.10.10.20"
18	CONNECTIONTYPE postgis
19	END
20
21	# raster layer
22	LAYER
23	NAME "nexrad-n0r-wmst"
24	TYPE RASTER
25	STATUS ON
26	DEBUG ON
27	PROJECTION
28	"init=epsg:4326"
29	END
30	METADATA
31	"wms_title" "NEXRAD BASE REF WMS-T"
32	"wms_srs"	"EPSG:4326"
33	"wms_extent" "-126 24 -66 50"
34	"wms_timeextent" "2003-08-01/2006-12-31/PT5M"
35	"wms_timeitem" "datetime" #datetime is a column in postgis table of type timestamp
36	"wms_timedefault" "2006-06-23T03:10:00Z"
37	"wms_enable_request" "*"
38	END
39	OFFSITE 0 0 0
40	TILEITEM "filepath" #filepath is a column in postgis table with varchar of the filepath?
??to each image
41	TILEINDEX "time_idx"
42	FILTER ('[datetime]' = '2006-06-23T03:10:00Z')
43	END

You can find more information on Time and tileindexes in the WCS documentation.



Future Additions
• Support for a special time value: "current".

Limitations and Known Bugs
• Pattern "YYYYMMDD" does not work on Windows. (Bug#970)

10.1.8 WMS Dimension
Author
Yewondwossen Assefa
Last Updated
2013-10-08


Introduction
A WMS server can provide support for several type of dimensions such as time, elevation or other types of dimensions (for example, satellite images in different wavelength bands). For temporal dimension, please refer to WMS Time Support. This document describes support for the elevation dimension and other type of dimensions

Links to WMS-Related Information
• MapServer WMS Server HowTo
• WMS Time Support HowTo

Enabling Dimension Support in MapServer Setting Up a WMS Layer with dimension support
To have a valid WMS layer with dimension support, the user has to define the following metadata at the layer level:
• wms_dimensionlist: (Mandatory) comma separated list of dimension names available for the layer
• wms_[dimensionname]_item: (Mandatory) this is the name of the field in the DB that contains the dimension values.
• wms_[dimensionname]_units: (Mandatory) Attribute indicating units of dimensional axis. If the dimensional quantity has no units (e.g. band number in a multi-wavelength sensor), use the null string: "". If the dimensional quantity has units, unit names should be taken from the Unified Code for Units of Measure (UCUM) if UCUM
has an appropriate entry. When UCUM is used, the mandatory units attribute shall be an appropriate entry from the UCUM "name" column.



• wms_[dimensionname]_extent: (Mandatory) defines a valid set of values for the dimension
• wms_[dimensionname]_default: (Optional) this value is used if it is defined and the dimension value is missing in the request.

Specifying Dimension Extents
Dimension Extents can be declared with the following syntax for the wms_[dimensionname]_extent metadata (see Annex C.3 in the WMS 1.1.1 specification document for a full description):
1. value - a single value.
2. value1,value2,value3,. . . - a list of multiple values.
3. min/max/resolution - an interval defined by its lower and upper bounds and its resolution. This is supported in MapServer (note that the resolution is not supported however).
4. min1/max1/res1,min2/max2/res2,... - a list of multiple intervals.

Example WMS-Server Layer


GetCapabilities Output
If your layer is set up properly, requesting the capabilities on the server outputs one or several Dimension elements. Here is an example of a GetCapabilities result for a layer configured for two dimensions (wms 1.3.0):










(continues on next page)



(continued from previous page)

Supported Dimension Requests
A request parameter name is constructed by concatenating the prefix "dim_" with the sample dimension Name (the value of the name attribute of the corresponding <Dimension> and <Extent> elements in the Capabilities XML). The resulting "dim_name" is case-insensitive. The use of the "dim_" prefix is to avoid clashes between server-defined dimension names and current or future OGC Web Service specifications. (Time and Elevation, being predefined, do not use the prefix.) (section C.4.2)
• single value: for example: . . .&elevation=500&. . .
• multiple values: for example: . . .&dim_text_dimension=first,second&. . .
• single range value: for example: . . .&elevation=480/490&. . .
• multiple range values: for example: . . .&elevation=480/490,490/500&. . .

Processing Dimension Requests
When MapServer process a valid dimension wms parameter, It will process it into expressions and set it on the LAYER FILTER object. If there was already a Logical "MapServer expressions", It will be concatenated with it.
For example a request such as &elevation=490/500&. . . on a MapServer layer (with an empty FILTER) would give .. code-block:: mapfile
FILTER (([ELEV] >= 490 AND [ELEV] <= 500))
For example a request such as &elevation=600&. . . on a postgis layer with an existing FILTER would give .. code- block:: guess
• FILTER (elev > 500) #before request
• FILTER ((elev > 500) and (((ELEV = 600)))) #after request

10.1.9 Map Context
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2019-11-21

Contents• Map Context
- Introduction




Introduction
The term 'map context' comes from the Open Geospatial Constortium's (OGC) Web Map Context Specification v1.0.0, which coincides with the OGC Web Map Server Specification (WMS) v1.1.1. A map context is a XML document that describes the appearance of layers from one or more WMS servers, and can be transferred between clients while maintaining startup views, the state of the view (and its layers), and storing additional layer information.
Support for OGC Web Map Context was added to MapServer in version 3.7/4.0. This allows client applications to load and save a map configuration in a standard XML format. MapServer can read context documents of versions 0.1.2, 0.1.4, 0.1.7, 1.0.0, 1.1.0 and can export contents in versions 0.1.4, 0.1.7, 1.0.0, 1.1.0. Web Map Context 1.1.0 support was added to MapServer 4.10
This document assumes that you are already familiar with certain aspects of MapServer:
• MapServer application development and setting up mapfiles.
• Familiarity with the WMS spec would be an asset. Please see the following section for links to associated sources.

Links to WMS / Map Context Related Information
• MapServer WMS Client HowTo
• Open Geospatial Consortium (OGC) home page
• WMS 1.1.1 specification
• Map Context 1.0.0 specification
• MapServer OGC Web Services Workshop

Implementing a Web Map Context Special Build Considerations
Map Context support requires PROJ4, GDAL/OGR and PHP support libraries.
Build/install the above libraries on your system and then build MapServer with the '-with-wmsclient -with-proj -with- ogr -with-gdal -with-php' configure options. Also make sure that your build uses the USE_WMS_LYR and USE_OGR flags. For more details on MapServer compilation see the appropriate HowTo: Unix / Windows
Windows users can use MS4W, which is ready for Map Context use.

Map Context Mapfile
A map context document can ONLY contain WMS layers (e.g. CONNECTIONTYPE WMS). Please refer to the
MapServer WMS Client HowTo for more information on declaring WMS layers.

MapFile Metadata
The following mapfile metadata are used by MapServer to handle map context information:
(Note that some parameters have width, height, format, and href, and some only have format and href. This is because width and height are only used for images and parameters that do not have them are text or html. For consistency with the spec MapServer supports height and width for all parameters, but they should only be used for images)



Web Object Metadata
• ows_schemas_location : Location of XML schema document. Default is http://schemas.opengis.net. See http:
//ogc.dmsolutions.ca for an example of a valid schema tree.
• wms_abstract : A blurb of text providing more information about the WMS server.
• wms_address : If provided must also then provide wms_addresstype, wms_city, wms_stateorprovince, wms_postcode, and wms_country)
• wms_addresstype : If provided must also then provide wms_address, wms_city, wms_stateorprovince, wms_postcode, and wms_country)
• wms_city : If provided must also then provide wms_address, wms_addresstype, wms_stateorprovince, wms_postcode, and wms_country)
• wms_contactelectronicmailaddress : contact Email address.
• wms_contactfacsimiletelephone : contact facsimile telephone number.
• wms_contactorganization :
• wms_contactperson :
• wms_contactposition :
• wms_contactvoicetelephone : contact voice telephone number.
• wms_context_fid : the feature id of the context. Set to 0 when saving if not specified.
• wms_context_version : the version of the map context specification.
• wms_country :	If provided must also then provide wms_address, wms_city, wms_stateorprovince, wms_postcode, and wms_addresstype.
• wms_descriptionurl_format : Format of the webpage which contains relevant information to the view.
• wms_descriptionurl_href : Reference to a webpage which contains relevant information to the view.
• wms_keywordlist : A comma-separated list of keywords or keyword phrases to help catalog searching.
• wms_logourl_width : Width of the context logo.
• wms_logourl_height : Height of the context logo.
• wms_logourl_format : Format of the context logo.
• wms_logourl_href : Location of the context logo.
• wms_postcode :	If provided must also then provide wms_address, wms_city, wms_stateorprovince, wms_addresstype, and wms_country.
• wms_stateorprovince : If provided must also then provide wms_address, wms_city, wms_addresstype, wms_postcode, and wms_country.
• wms_title : (Required) A human-readable name for this Layer (this metadata does not exist beyond version 0.1.4)
Layer Object Metadata
• wms_abstract : A blurb of text providing more information about the WMS server.
• wms_dataurl_href : Link to an online resource where data corresponding to the layer can be found.
• wms_dataurl_format : Format of the online resource where data corresponding to the layer can be found.



• wms_dimension :
Added in version 4.10. Current dimension used.
• wms_dimensionlist :
Added in version 4.10.
List of available dimensions.
• wms_dimension_%s_default :
Added in version 4.10.
Default dimension value. MapServer will check for wms_time and wms_timedefault metadata when this is not specified. %s = the name of the dimension.
• wms_dimension_%s_multiplevalues  :
Added in version 4.10.
Multiple dimension values. %s = the name of the dimension.
• wms_dimension_%s_nearestvalue :
Added in version 4.10.
Nearest dimension value. The default value is 0. %s = the name of the dimension.
• wms_dimension_%s_units :
Added in version 4.10.
Units for the dimension values. The default value is ISO8601. %s = the name of the dimension.
• wms_dimension_%s_unitsymbol  :
Added in version 4.10.
Symbol for dimension units. The default value is t. %s = the name of the dimension.
• wms_dimension_%s_uservalue :
Added in version 4.10.
User dimension value. MapServer will check for wms_time and wms_timedefault metadata when this is not specified. %s = the name of the dimension.
• wms_format : Current format used.
• wms_formatlist : List of available formats for this layer.
• wms_metadataurl_href : Link to an online resource where descriptive metadata of the corresponding layer can be found.
• wms_metadataurl_format : Format of the online resource where descriptive metadata of the corresponding layer can be found.
• wms_name : Name of the WMS layer on the server.
• wms_onlineresource : Required URL to access the server.
• wms_server_version : The version of the web map server specification.
• wms_server_title : The title of the web map server.
• wms_stylelist : Current style used.



• wms_style_%s_legendurl_width : Width of an image describing the style. %s = the name of the style.
• wms_style_%s_legendurl_height : Height of an image describing the style. %s = the name of the style.
• wms_style_%s_legendurl_format : Format of an image describing the style. %s = the name of the style.
• wms_style_%s_legendurl_href : Location of an image describing the style. %s = the name of the style.
• wms_style_%s_sld : URL to the SLD document of this style. %s = the name of the style.
• wms_style_%s_sld_body : SLD_BODY document of this style. %s = the name of the style.
• wms_style_%s_title : Title of the layer. %s = the name of the style.
• wms_title : (Required) A human-readable name for this Layer.
Sample Map Context Mapfile


1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

24

25

26

27

28

29

30

31

32

33

34

35

36

37

38
(continues on next page)



(continued from previous page)
39

40

41

42


43

44

45

46

47

48

49

50

51

52

53

54

55

56

57

58

Testing Map Context Support
1. The first thing to do is to save your mapfile using the saveMapContext function available from the PHP/MapScript
library. An example script is shown below:

2. Scan the XML output to look for <!- WARNING: . . . -> comments. Then make the necessary changes to fix every warning that you encounter. At the end of this you should have a mapfile compatible with the Map Context specification.
3. Now you can load your new Map Context document into an application using the loadMapContext function from the PHP/MapScript library.

Sample Map Context Document
The following is a sample Map Context document:

1

2





3

4
(continues on next page)



(continued from previous page)
5	<!-- Bounding box corners and spatial reference system -->
6	<BoundingBox SRS="EPSG:4326" minx="-180.000000" miny="-90.000000" maxx="180.
??000000" maxy="90.000000"/>
7	<!-- Title of Context -->
8	<Title>Map Context demo</Title>
9	<Abstract>Demo for map context document. Blah blah...</Abstract>
10	<ContactInformation>
11	</ContactInformation>
12	</General>
13	<LayerList>
14	<Layer queryable="0" hidden="0">
15	<Server service="OGC:WMS" version="1.1.1" title="World Country Boundaries">
16	<OnlineResource  xlink:type="simple"  xlink:href="https://demo.mapserver.org/
??cgi-bin/wms?"/>
17	</Server>
18	<Name>country_bounds</Name>
19	<Title>World Country Boundaries</Title>
20	<SRS>EPSG:4326</SRS>
21	<FormatList>
22	<Format current="1">image/gif</Format>
23	</FormatList>
24	<DimensionList>
25	<Dimension name="time" units="ISO8601" unitSymbol="t" userValue="1310"?
??default="1310" multipleValues="1310,1410" nearestValue="0" current="1"/>
26	</DimensionList>
27	</Layer>
28	</LayerList>
29	</ViewContext>

Map Context Support Through CGI
MapServer CGI allows you to load a map context through the use of a CONTEXT parameter, and you can point this parameter to a locally stored context file or a context file accessible through a URL. For more information on MapServer CGI see the CGI Reference.

Support for Local Map Context Files
There is a new cgi parameter called CONTEXT that is used to specify a local context file. The user can then use MapServer to request a map using the following syntax:







Support for Context Files Accessed Through a URL
The syntax of using a web accessible context file would be similar to accessing a local context file:

Due to security concerns loading a file from a URL is disabled by default. To enable this functionality, the user needs to set a CONFIG parameter called CGI_CONTEXT_URL in the default mapfile that will allow this functionality. Here is an example of a map file with the CONFIG parameter:


Default Mapfile
To smoothly run a MapServer CGI application with a Map Context, the application administrator needs to provide a default mapfile with at least the basic required parameters that will be used with the Context file. This default mapfile can contain as little information as the imagepath and imageurl or contain a list of layers. Information coming from the context (e.g.: layers, width, height, . . . ) would either be appended or will replace values found in the mapfile.
Here is an example of a default map file containing the minimum required parameters:

1

2

3

4

5

6

7

8

9
(continues on next page)



(continued from previous page)
10

11

12

13

14

15

16

17

18

19

20

21

Map Context Support Through WMS
MapServer can also output your WMS layers as a Context document. MapServer extends the WMS standard by adding a request=GetContext operation that allows you to retrieve a context for a WMS-based mapfile with a call like:

The VERSION parameter controls the version of context document to return.
GetContext is disabled by default because it could be considered a security issue: it could publicly expose the URLs of WMS layers used (cascaded) by a mapfile.
To enable it, set the "wms_getcontext_enabled" web metadata to "1" in your WMS server's mapfile.

10.1.10 Layer Metadata
Author
Tom Kralidis
Contact
tomkralidis at gmail.com
Last Updated
2020-10-12




Introduction
OGC Web Services (OWS) have the ability to advertise content metadata associated with a given resource (WMS Layer, WFS FeatureType, WCS Coverage, SOS ObservationOffering), both inline to the Capabilities document and as a reference to a given URL (i.e. ISO metadata XML document).
MapServer supports both inline (e.g. wms_title, wms_abstract) and URL based (e.g. wms_metadataurl_href ) metadata advertising for OWS Capabilities.
Formal XML metadata in MapServer OGC services Capabilities XML provides value to Catalogue services which harvest metadata to support discovery.
MapServer 7.2 adds support for dynamic publishing of XML metadata for all OGC Web Services to advertise formal layer metadata.

How it Works
If a layer does not have associated formal XML metadata configured via ows_metadataurl_* metadata, MapServer provides a metadata URL link to metadata (i.e. WMS MetadataURL) in the OGC Capabilities XML. The URL itself points to MapServer's GetMetadata API. Example:


Supported Metadata Formats
MapServer's layer API supports the ISO 19115-1:2014 geospatial standard, via ISO 19139-1:2019 as the XML repre- sentation.

The Layer Metadata API
The Layer Metadata API provides formal metadata for any LAYER object in a mapfile, deriving metadata values (title, abstract, keywords, spatial properties), from a mapfile LAYER object definition. The metadata response contains useful information (title, abstract, keywords), as well as access links to associated services (WMS, WFS, etc.).
The API supports two parameters:
• request (Mandatory): fixed value of GetMetadata
• layer (Mandatory): single layer name value
Missing parameters will result in an OGC ogc:ExceptionReport XML.

Request Example
http://localhost/path/to/ows?request=GetMetadata&amp;layer=road

Layer Metadata Support Through CGI
10.1.11 WFS Server
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com



Author
Even Rouault
Contact
even.rouault at mines-paris.org
Last Updated
2025-11-09


Introduction
A WFS ( Web Feature Service ) publishes feature-level geospatial data to the web. This means that instead of returning an image, as MapServer has traditionally done, the client now obtains fine-grained information about specific geospatial features of the underlying data, at both the geometry AND attribute levels. As with other OGC specifications, this interface uses XML over HTTP as it's delivery mechanism, and, more precisely, GML (Geography Markup Language), which is a subset of XML.
In version 7.0, MapServer supports versions 1.0, 1.1 and 2.0 of the WFS specifications.

WFS-Related Information
Here are some WFS related links (including a newly added OGC services workshop with MapServer). Since these are highly detailed technical specifications, there is no need to read through them in their entirety to get a MapServer WFS up and running. It is still recommended however to read them over and get familiar with the basics of each of them, in order to understand how it all works:
• The OGC Web Feature Service Implementation Specification.
• The Geography Markup Language Implementation Specification.
   • MapServer OGC Web Services Workshop package. For WFS 2.0, the following documents apply :
• The OGC WFS 2.0 specification.
• The OGC Filter Encoding 2.0 specification.
• The OGC GML 3.2.1 specification.
Technical details on the implementation of WFS 2.0 in MapServer are given in the rfc105. Working knowledge of MapServer is of course also required.



Software Requirements
In order to enable MapServer to serve WFS, it MUST be compiled against certain libraries:
• PROJ: The reprojection library. Version 4.4.3 or greater is required.
• GDAL/OGR: I/O support libraries. Version 1.6.0 or greater is required.
Please see the MapServer UNIX Compilation and Installation HowTo for detailed instructions on compiling MapServer with support for these libraries and features. For Windows users, the MS4W installer comes ready to serve both WFS and WMS.

Versions of GML Supported
MapServer can output both GML2 and GML3. By default MapServer serves GML2. You can test this by adding an 'OUTPUTFORMAT' parameter to a GetFeature request, such as:
• GML2 request output
• GML3 request output
With WFS 2.0, the default OUTPUTFORMAT is "application/gml+xml; version=3.2". For a detailed discussion on the versions supported, see bug#884.
Configuring your MapFile to Serve WFS layers
Much as in the WMS support, WFS publishing is enabled by adding certain magic METADATA keyword/value pairs to a MapFile.
MapServer will serve and include in its WFS capabilities only the layers that meet the following conditions:
• Data source is of vector type (Shapefile, OGR, PostGIS, SDE, SDO, . . . )
• LAYER NAME must be set. Layer names must start with a letter when setting up a WFS server (layer names should not start with a digit or have spaces in them).
• LAYER TYPE is one of: LINE, POINT, POLYGON
• The "wfs_onlineresource" metadata:
The wfs_onlineresource metadata is set in the map's web object metadata and specifies the URL that should be used to access your server. This is required for the GetCapabilities output. If wfs_onlineresource is not provided then MapServer will try to provide a default one using the script name and hostname, but you shouldn't count on that too much. It is strongly recommended that you provide the wfs_onlineresource metadata.
See section 12.3.3 of the WFS 1.0.0 specification for the whole story about the online resource URL. Basically, what you need is a complete HTTP URL including the http:// prefix, hostname, script name, potentially a "map=" parameter, and and terminated by "?" or "&".
Here is a valid online resource URL:

By creating a wrapper script on the server it is possible to hide the "map=" parameter from the URL and then your server's online resource URL could be something like:

This is covered in more detail in the "More About the Online Resource URL" section of the WMS Server docu- ment.






• The "wfs_enable_request" metadata (see below).
Example WFS Server Mapfile
The following is an example of a bare minimum WFS Server mapfile. Note the comments for the required parameters.









































(continues on next page)



(continued from previous page)
METADATA
"wfs_title"	"World continents" ##REQUIRED
"wfs_srs"	"EPSG:4326" ## REQUIRED
"gml_include_items" "all" ## Optional (serves all attributes for layer)
"gml_featureid"	"ID" ## REQUIRED
"gml_types"	"auto" ## Optional (automatically populate the type for the?
??attributes)
"gml_geometries"	"geom" ## Recommended (give new name for geometry elements)
"gml_geom_type"	"polygon" ## Recommended (specify the geometry type for the?
??layer)
"wfs_enable_request" "*"
"wfs_use_default_extent_for_getfeature" "false" ## Optional (improves performance?
??of OGR layers)
END
TYPE POLYGON
STATUS ON
DATA "shapefile/countries_area"
# define source projection
PROJECTION
"init=epsg:4326"
END
CLASS
NAME "World Continents"
STYLE
COLOR 255 128 128
OUTLINECOLOR 96 96 96
END
END
END #layer

END #mapfile

Rules for Handling SRS in MapServer WFS
The OGC WFS 1.0 specification doesn't allow a layer (feature type) to be advertised in more than one SRS. Also, there is no default SRS that applies to all layers by default. However, it is possible to have every layer in a WFS server advertised in a different SRS.
The OGC WFS 1.1 and 2.0 specifications allow more than one SRS to be advertised, and one of the SRSs will be advertised as the default SRS (the default SRS will be the first in the list specified in the METADATA wfs_srs / ows_srs).
Here is how MapServer decides the SRS to advertise and use for each layer in your WFS:
• If a top-level map SRS is defined then this SRS is used and applies to all layers (feature types) in this WFS. In this case the SRS of individual layers is simply ignored even if it is set.
• If no top-level map SRS is defined, then each layer is advertised in its own SRS in the capabilities.









At the layer level, if both the wfs_srs / ows_srs metadata and the PROJECTION object are set to different values, then the wfs_srs / ows_srs metadata defines the projection to use in advertising this layer (assuming there is no top-level map SRS), and the PROJECTION value is assumed to be the projection of the data. So this means that the data would be reprojected from the PROJECTION SRS to the one defined in the wfs_srs / ows_srs metadata before being served to WFS clients.
Confusing? As a rule of thumb, simply set the wfs_srs / ows_srs at the map level (in web metadata) and never set the
wfs_srs / ows_srs metadata at the layer level and things will work fine for most cases.

Axis Orientation in WFS 1.1 and 2.0
The axis order in previous versions of the WFS specifications was to always use easting (x or lon ) and northing (y or lat). WFS 1.1 specifies that, depending on the particular SRS, the x axis may or may not be oriented West-to-East, and the y axis may or may not be oriented South-to-North. The WFS portrayal operation shall account for axis order. This affects some of the EPSG codes that were commonly used such as ESPG:4326. The current implementation makes sure that coordinates returned to the server for the GetFeature request reflect the inverse axis orders for EPSG codes between 4000 and 5000.
Regarding SRS, for WFS 2.0, it will always be reported with the "urn:ogc:def:crs:EPSG::" syntax. This should likely also be done for WFS 1.1.0. The "wfs_return_srs_as_urn" web metadata item can be set to "true" or "false" to enable or disable this behaviour. It defaults to "true" for WFS 2.0 and to "false" for older versions.

Test Your WFS Server
Validate the Capabilities Metadata
OK, now that we've got a mapfile, we have to check the XML capabilities returned by our server to make sure nothing is missing.
Using a web browser, access your server's online resource URL to which you add the parameter "RE- QUEST=GetCapabilities" to the end, e.g.
https://demo.mapserver.org/cgi-bin/wfs?SERVICE=WFS&VERSION=1.0.0&REQUEST=GetCapabilities
If everything went well, you should have a complete XML capabilities document. Search it for the word "WARN- ING"... MapServer inserts XML comments starting with "<!-WARNING: " in the XML output if it detects missing mapfile parameters or metadata items. If you notice any warning in your XML output then you have to fix all of them before you can register your server with a WFS client, otherwise things are likely not going to work.







Test With a GetFeature Request
OK,  now  that  we  know  that  our  server  can  produce  a  valid  XML  GetCapa- bilities response we should test the GetFeature request.	Simply adding "SER- VICE=WFS&VERSION=1.0.0&REQUEST=GetFeature&TYPENAME=yourlayername1,yourlayername2"	to your server's URL should return the GML associated with those layers.
https://demo.mapserver.org/cgi-bin/wfs?SERVICE=WFS&VERSION=1.0.0&REQUEST=getfeature&  TYPENAME=continents&MAXFEATURES=100
For WFS 2.0, the same request would be :
https://demo.mapserver.org/cgi-bin/wfs?SERVICE=WFS&VERSION=2.0.0&REQUEST=GetFeature&  TYPENAMES=continents&COUNT=100

Test with a Real Client
If you have access to a WFS client, then register your new server's online resource with it and you should be off and running.
If you don't have your own WFS client installed already, here are a few pointers:
• MapServer itself can be used as a WFS client, see the WFS Client HowTo.
• QGIS is a full GIS package which includes WFS client support. (recommended)
• Deegree provides a WFS client.
• uDig can add layers from WMS/WFS servers.

Test with an ogrinfo command
You can use GDAL's WFS driver and the ogrinfo utility to analyze your WFS service. For example, here is a command to examine the continents WFS layer:

Which should return something like:














(continues on next page)



(continued from previous page)
Feature Count: 27458
Extent: (-180.000000, -90.000000) - (180.000000, 83.627419)
Layer SRS WKT:
GEOGCRS["WGS 84",
ENSEMBLE["World Geodetic System 1984 ensemble", MEMBER["World Geodetic System 1984 (Transit)"], MEMBER["World Geodetic System 1984 (G730)"], MEMBER["World Geodetic System 1984 (G873)"], MEMBER["World Geodetic System 1984 (G1150)"], MEMBER["World Geodetic System 1984 (G1674)"], MEMBER["World Geodetic System 1984 (G1762)"], MEMBER["World Geodetic System 1984 (G2139)"], MEMBER["World Geodetic System 1984 (G2296)"], ELLIPSOID["WGS 84",6378137,298.257223563,
    LENGTHUNIT["metre",1]], ENSEMBLEACCURACY[2.0]],
PRIMEM["Greenwich",0, ANGLEUNIT["degree",0.0174532925199433]],
CS[ellipsoidal,2],
AXIS["geodetic latitude (Lat)",north, ORDER[1], ANGLEUNIT["degree",0.0174532925199433]],
AXIS["geodetic longitude (Lon)",east, ORDER[2], ANGLEUNIT["degree",0.0174532925199433]],
USAGE[
SCOPE["Horizontal component of 3D system."], AREA["World."],
    BBOX[-90,-180,90,180]], ID["EPSG",4326]]
Data axis to CRS axis mapping: 2,1
Supported SRS: EPSG:4326, EPSG:4269, EPSG:3978, EPSG:3857
Geometry Column = geom gml_id: String (0.0) NOT NULL NA2DESC: String (0.0)
NA3DESC: String (0.0)





Support for GET and POST Requests
Starting from version 4.2 MapServer supports XML-encoded POST requests and GET requests. The default in MapServer is POST.

Support for Filter Encoding
Starting from version 4.2 MapServer supports Filter Encoding (FE) in WFS GetFeature requests. For more information on the server side of Filter Encoding see the Filter Encoding HowTo.

Support for Sorting
Sorting is supported for WFS 1.1 and 2.0. WFS clients can add a SORTBY parameter to the query string to order results based on one or more attribute values e.g. SORTBY=Field1 DESC,Field2 ASC.
The list of drivers that support sorting (sorting was implemented in MapServer 7.0 unless otherwise specified):
• OGR
• PostGIS
• Oracle
• MS SQL Server (version 7.4)
The MapServer Shapefile provider does not support sorting. If this needed, you must use the OGR Shapefile provider. Further sorting implementation details can be found in rfc105.
MapServer WFS Extensions
STARTINDEX
This is standard in WFS 2.0, and also available as a MapServer extension for WFS 1.0 and 1.1. In addition to the MAXFEATURES=n keyword (replaced by COUNT in WFS 2.0), MapServer also supports a STARTINDEX=n keyword in WFS GetFeature requests. This can be used to skip some features in the result set and in combination with MAXFEATURES (or COUNT) provides for the ability to use WFS GetFeature to page through results. Note that STARTINDEX=0 means start with the first feature, skipping none.
OUTPUTFORMAT
Normally OUTPUTFORMAT should be GML2 for WFS 1.0 and either "text/xml; subtype=gml/2.1.2" or "text/xml; subtype=gml/3.1.1" for WFS 1.1. For WFS 2.0, the default is "application/gml+xml; version=3.2", but GML2 and GML3 can also be requested. However as an extension to the specification, it is also possible to configure MapServer for a variety of other feature output formats. This is discussed in some detail in the OGR Output document.

Stored queries (WFS 2.0)
Stored queries are queries (<wfs:Query>) stored on the server, potentially with parameters whose value can be assigned by the client during a GetFeature request.
At WEB.METADATA level, a "wfs_storedqueries" metadata item can be specified with a comma separated list of stored queries ids.



Then for each stored query id, "wfs_[storedqueryid]_inlinedef" must be specified with a valid <StoredQueryDe- scription> as value. As it is not always convenient to specify a inline XML content, it is also possible to specify "wfs_{storedqueryid}_filedef" whose value is a filename that contains the <StoredQueryDescription> XML content.

with /data/bboxstoredquery.xml containing for example:
<?xml version="1.0" encoding="UTF-8"?>
<StoredQueryDescription   xmlns:xs="http://www.w3.org/2001/XMLSchema"
xmlns:gml="http://www.opengis.net/gml/3.2" id="bboxstoredquery">
<Title>query title</Title>
<Abstract>query abstract</Abstract>
<Parameter name="longmin" type="xs:double"/>
<Parameter name="latmin" type="xs:double"/>
<Parameter name="longmax" type="xs:double"/>
<Parameter name="latmax" type="xs:double"/>
<QueryExpressionText isPrivate="false"
language="urn:ogc:def:queryLanguage:OGC-WFS::WFS_QueryExpression" xmlns:ms="http://mapserver.gis.umn.edu/mapserver" returnFeatureTypes="ms:firstLayer ms:secondLayer">
<Query xmlns:fes="http://www.opengis.net/fes/2.0" typeNames="ms:firstLayer">
<fes:Filter>
<fes:BBOX>
<gml:Envelope  srsName="urn:ogc:def:crs:EPSG::4326">
<gml:lowerCorner>${latmin} ${longmin}</gml:lowerCorner>
<gml:upperCorner>${latmax} ${longmax}</gml:upperCorner>
</gml:Envelope>
</fes:BBOX>
</fes:Filter>
</Query>
<Query xmlns:fes="http://www.opengis.net/fes/2.0" typeNames="ms:secondLayer">
<fes:Filter>
<fes:BBOX>
<gml:Envelope  srsName="urn:ogc:def:crs:EPSG::4326">
<gml:lowerCorner>${latmin} ${longmin}</gml:lowerCorner>
<gml:upperCorner>${latmax} ${longmax}</gml:upperCorner>
</gml:Envelope>
</fes:BBOX>
</fes:Filter>
</Query>
</QueryExpressionText>
</StoredQueryDescription>

A corresponding valid GetFeature request can be: REQUEST=GetFeature&STOREDQUERY_ID=bboxstoredquery&LONGMIN=2&LATMIN=49&LONGMAX=3&LATMAX=50



Predefined urn:ogc:def:query:OGC-WFS::GetFeatureById stored query
WFS 2.0 defines a mandatory "urn:ogc:def:query:OGC-WFS::GetFeatureById" stored query. This query accept a ID parameter whose value must be a feature id.
A	valid	request	is:	REQUEST=GetFeature&STOREDQUERY_ID=urn:ogc:def:query:OGC- WFS::GetFeatureById&ID=mylayer.3
The definition hardcoded in MapServer is:

Comparing to a more standard stored query description, there are 2 oddities : The value of the "returnFeatureTypes" attribute is replaced at runtime by the name of the valid WFS layers of the mapfile (when issuing the response document to DescribeStoredQueries request). And the value of the typeNames attribute is deduced at runtime from the value of the passed ID parameter.
It is possible to override this hardcoded definition by a custom one (for example to provide alter- nate values for other languages) by defining "wfs_urn:ogc:def:query:OGC-WFS::GetFeatureById_inlinedef" or "wfs_urn:ogc:def:query:OGC-WFS::GetFeatureById_filedef". The value of <QueryExpressionText> attributes and child elements must however be strictly identical to the hard-coded definition for correct execution.
A GetFeature using "urn:ogc:def:query:OGC-WFS::GetFeatureById" seems to be identical to a GetFeature with a RESOURCEID parameter, but there is a difference. GetFeatureById returns the feature directly as the response :

















(continues on next page)



(continued from previous page)

Reference Section
The following metadata are available in the setup of the WFS Server mapfile:


Web Object Metadata
ows_allowed_ip_list (or wfs_allowed_ip_list)
• Description: (Optional) A list of IP addresses that will be allowed access to the service. Example:

ows_denied_ip_list (or wfs_denied_ip_list)
• Description: (Optional) A list of IP addresses that will be denied access to the service. Example:

ows_schemas_location
(Optional) (Note the name ows_schemas_location and not wfs/_. . . this is because all OGC Web Services (OWS) use the same metadata) Root of the web tree where the family of OGC WFS XMLSchema files are located. This



must be a valid URL where the actual .xsd files are located if you want your WFS output to validate in a validating XML parser. Default is http://schemas.opengis.net.
ows_updatesequence
(Optional) The updateSequence parameter can be used for maintaining the consistency of a client cache of the contents of a service metadata document. The parameter value can be an integer, a timestamp in [ISO 8601:2000] format, or any other number or string.
wfs_abstract
(Optional) Descriptive narrative for more information about the server. WFS TAG Name: Abstract (WFS 1.0.0, sect. 12.3.3)
wfs_accessconstraints
(Optional) Text describing any access constraints imposed by the service provider on the WFS or data retrieved from this service.
WFS TAG Name: Accessconstraints (WFS 1.0.0, sect. 12.3.3)
wfs_compute_number_matched
(Optional, WFS 2.0 only) When this metadata item is set to "true", the server will determine the number of features that match the GetFeature request and return it in the 'numberMatched' attribute of the <FeatureCollec- tion> element in the response. Computing that number might take a very long time, so it is strongly encouraged to NOT define this item. When it is not defined, the 'numberMatched' attribute is set to "unknown".
See "wfs_maxfeatures_ignore_for_resulttype_hits" for a similar setting affecting resultType=hits GetFeature re- quest.
wfs_enable_request (or ows_enable_request)
Space separated list of requests to enable. The default is none. The following requests can be enabled: GetCa- pabilities, GetFeature and DescribeFeatureType. A "!" in front of a request will disable the request. "*" enables all requests.
Examples:
To enable only GetCapabilities and GetFeature:

To enable all requests except GetCapabilities

wfs_feature_collection
Replaces the default name of the feature-containing element (<msFeatureCollection>) with a user-defined value.
wfs_features_cache_count
(Optional, since MapServer 7.2) Maximum number of features retrieved during the first query pass that should be cached, so as not to be asked again to the datasource. This might be set to the same value as wfs_maxfeatures, but not necessarily. If wfs_features_cache_size is also set, the most limiting will be honoured. Note: this is an advanced setting.
wfs_features_cache_size
(Optional, since MapServer 7.2) Maximum amount of RAM allowed to cache features during the first query pass, so as not to be asked again to the datasource when generating the GML or OGR output. If wfs_features_cache_count is also set, the most limiting will be honoured. By default the value is in bytes, unless the " MB" suffix is specified. Note: this is an advanced setting.
wfs_fees
(Optional) Any fees imposed by the service provider for usage of this service or for data retrieved from the WFS.



WFS TAG Name: Fees (WFS 1.0.0, sect. 12.3.3)
wfs_geometry_precision
(Optional, since MapServer 8.0) Specifies the precision of the geometry coordinates in the generated GML, where precision is the number of decimal places. This affects WFS requests using the built-in GML2/GML3 output (specifying a different OUTPUTFORMAT will override this setting).


wfs_getcapabilities_version
(Optional) Default version to use for GetCapabilities requests that do not have a version parameter. If not set, the latest supported version will be returned. As of MapServer 7.0, this default version is "2.0.0". Valid values are "1.0.0", "1.1.0" and "2.0.0".
wfs_keywordlist
(Optional) List of words to aid catalog searching. WFS TAG Name: Keyword (WFS 1.0.0, sect. 12.3.3)
wfs_languages
• Description: (Optional) A comma-separated list of supported languages. For details please refer to the section
Multi-language support for certain capabilities fields in the INSPIRE Download Service documentation.
wfs_maxfeatures
(Optional) The maximum and default number of elements to be returned by the WFS server. If the user sets the 'maxfeatures' parameter in a GetFeatureRequest, his value will be used, provided it does not exceed wfs_maxfeatures. If wfs_maxfeatures is not specified, the server will return all the features that match the query, without limit, which may make the server busy for a long time when layers with big number of features are served. Sensible values are integers greater than 0. If 0 is specified, no features will be returned. In WFS 2.0, this item is used to fill the "CountDefault" parameter of the response document to a GetCapabilities request, so that clients are aware of the server limit. See also the "wfs_maxfeatures_ignore_for_resulttype_hits" item.
wfs_maxfeatures_ignore_for_resulttype_hits
(Optional, added in MapServer 7.2) Controls whether the limit set by "wfs_maxfeatures" is also taken into ac- count in resultType=hits GetFeature requests.
See "resultType parameter" chapter (OGC WFS 2.0 specification, sect. 7.6.3.6)
When setting this item to "false", the limit set by "wfs_maxfeatures" will also be taken into account when pro- cessing a resultType=hits GetFeature request, that is to say the number of hits returned will not be greater than wfs_maxfeatures. This is the behaviour in MapServer version prior to 7.2, and also the general default behaviour in later versions. Unless if all the layers that are queried are PostGIS layers, in which case wfs_maxfeatures is not taken into account when computing the number of hits. The item may be explicitly set to "true" so that wfs_maxfeatures is not taken into account when computing the number of hits (for any layer type), which may exhibit performance issues for large layers and/ or backends with slow access.
This item has no effect if wfs_maxfeatures is not set.
wfs_namespace_prefix
(Optional) User defined namespace prefix to be used in the response of a WFS GetFeature request. E.g. "wfs_namespace_prefix" "someprefix".
wfs_namespace_uri
(Optional) User defined namespace URI to be used in the response of a WFS GetFeature request. e.g. "wfs_namespace_uri" "http://somehost/someurl".



wfs_onlineresource
(Recommended) The URL prefix for HTTP GET requests. WFS TAG Name: Onlineresource (WFS 1.0.0, sect. 12.3.3)
wfs_return_srs_as_urn
(Optional) Defaults to "true" in WFS 2.0, and "false" in WFS 1.0 and 1.1. When set to "true", SRS in GetFeature response documents will always be reported with the "urn:ogc:def:crs:EPSG::" syntax.
wfs_service_onlineresource
(Optional) Top-level onlineresource URL. MapServer uses the onlineresource metadata (if provided) in the fol- lowing order:
1. wfs_service_onlineresource
2. ows_service_onlineresource
3. wfs_onlineresource (or automatically generated URL, see the onlineresource section of this document)
wfs_srs
(Recommended) The SRS to use for all layers in this server. (e.g. EPSG:4326) See the note about the SRS rules in WFS.
wfs_storedqueries
(Optional, WFS 2.0) A comma separated list of stored queries IDs. The definition of each of those stored queries must be given with wfs_[storedqueryid]_inlinedef or wfs_[storedqueryid]_filedef
wfs_[storedqueryid]_inlinedef
(Optional, WFS 2.0) Inline XML content for a stored query listed in wfs_storedqueries. This content must be a valid <StoredQueryDescription> document.
wfs_[storedqueryid]_filedef
(Optional, WFS 2.0) Name of a file that contains a valid <StoredQueryDescription> document.
wfs_title
(Required) Human readable title to identify server. WFS TAG Name: Title (WFS 1.0.0, sect. 12.3.3)

Layer Object
gml_constants
(Optional) A comma delimited list of constants. This option allows you to define data that are not part of the underlying dataset and add them to the GML output. Many application schemas require constants of one form or another. To specify the value and type of the constants use gml_[item name]_value and gml_[item name]_type.

gml_default_items
(Optional) A comma delimited list of items to put in a GetFeature response document without explicit PROPERTYNAME, or "all". When a GetFeature request without explicit PROPERTYNAME is processed, MapServer returns all items by default. As of MapServer 7.0, this behaviour can be amended by specifying "gml_default_items" to specify which items (among the optional ones) must be returned.
gml_exclude_items
(Optional) A comma delimited list of items to exclude. As of MapServer 4.6, you can control how many attributes (fields) you expose for your data layer with metadata. The previous behaviour was simply to expose all attributes all of the time. The default is to expose no attributes at all. An example excluding a specific field would be:





gml_featureid
(Required for MapServer 4.10) Field to be used for the ID of the feature in the output GML. wfs_featureid or ows_featureid can be specified instead.
gml_geometries
Provides a name other than the default "msGeometry" for geometry elements. The value is specified as a string to be used for geometry element names. "none" will exclude the geometry from MapServer integrated output (OGR outputformat doesn't honour this setting).
gml_[geometry name]_occurances
MapServer applies default values of 0 and 1, respectively, to the "minOccurs" and "maxOccurs" attributes of geometry elements, as can be seen in the preceding examples. To override these defaults, a value is assigned to a gml_[geometry name]_occurances layer metadata item, where again [geometry name] is the string value specified for gml_geometries, and the value is a comma-delimited pair containing the respective lower and upper bounds.
gml_[geometry name]_type
When employing gml_geometries, it is also necessary to specify the geometry type of the layer. This is accom- plished by providing a value for gml_[geometry name]_type, where [geometry name] is the string value specified for gml_geometries, and a value which is one of:
• point
• multipoint
• line
• multiline
• polygon
• multipolygon
ows/wfs_geomtype
(Optional, metadata shared with OGR output). Set the geometry type of OGR layers created from this MapServer LAYER. One of "Point", "LineString", "Polygon", "MultiPoint", "MultiLineString", "MultiPolygon", "Geome- tryCollection", "Geometry", or "None". Most are fairly obvious, but "Geometry" can be used to represent a mix of geometry types, and "None" is sometimes suitable for layers without geometry. Note that layers which are a mix of polygon and multipolygon would normally have to be described as "Geometry". To produce 2.5D output append "25D" to the geometry type (i.e. "Polygon25D").


gml_groups
(Optional) A comma delimited list of group names for the layer.
gml_[group name]_group
(Optional) A comma delimited list of attributes in the group. Here is an example:





gml_include_items
(Optional) A comma delimited list of items to include, or keyword "all". As of MapServer 4.6, you can control how many attributes (fields) you expose for your data layer with this metadata. The previous behaviour was simply to expose all attributes all of the time. You can enable full exposure by using the keyword "all", such as:

You can specify a list of attributes (fields) for partial exposure, such as:

The new default behaviour is to expose no attributes at all.
gml_[item name]_alias
(Optional) An alias for an attribute's name. The served GML will refer to this attribute by the alias. Here is an example:

gml_[item name]_precision
(Optional) Specifies the precision of the indicated field for formats where this is significant, such as Shapefiles. Precision is the number of decimal places, and is only needed for "Real" fields. Currently this is only used for OGR based output formats, not the WFS GML2/GML3 output.
gml_[item name]_type (Optional)
Specifies the type of the attribute.	Valid values are the OGR data types: Inte- ger|Long|Real|Character|Date|Time|DateTime|Boolean. MapServer translates these to valid GML data types.




gml_[item name]_value
Used to specify values for gml_constants.
gml_[item name]_width
(Optional) Specifies the width of the indicated field for formats where this is significant, such as Shapefiles.
gml_mandatory_items
(Optional) A comma delimited list of items to make mandatory, or keyword "all". See gml_optional_items.
gml_optional_items
(Optional) A comma delimited list of items to make optional, or keyword "all". By default, as of MapServer 7.0, all items are considered as optional (minOccurs="0" in the GML application schema). If "gml_optional_items"



is specified, only the listed elements will be optional and other included items will be mandatory. If there are more mandatory items, it might be more convenient to specify "gml_mandatory_items".
gml_types
(Optional) If this field is set to "auto" then the OGR, POSTGIS, ORACLESPATIAL, MSSQL, and native Shape- files input feature drivers will automatically populate the type, width and precision metadata for the layer based on the source file. This is mainly used by OGR based output formats, as well as the WFS GML2/GML3 output to format dates.
In addition the MSSQL driver also sets nillable="true" in the output GML for any database fields that accept NULLs.
This option can be overridden by setting gml_[item name]_type for individual fields.

gml_xml_items
(Optional) A comma delimited list of items that should not be XML-encoded.
ows_allowed_ip_list
Same as ows_allowed_ip_list in the Web Object.
ows_denied_ip_list
Same as ows_denied_ip_list in the Web Object.
wfs_abstract
Same as wfs_abstract in the Web Object.
wfs_enable_request (or ows_enable_request)
Space separated list of requests to enable. The default is none. The following requests can be enabled: GetCa- pabilities, GetFeature and DescribeFeatureType. A "!" in front of a request will disable the request. "*" enables all requests.
Examples:
To enable only GetCapabilities and GetFeature:

To enable all requests except GetCapabilities

wfs_extent
(Optional) Used for the layer's BoundingBox tag for cases where it is impossible (or very inefficient) for MapServer to probe the data source to figure its extents. The value for this metadata is "minx miny maxx maxy" separated by spaces, with the values in the layer's projection units. If wfs_extent is provided then it has priority and MapServer will NOT try to read the source file's extents.
wfs_featureid
(Required for MapServer 4.10) Field to be used for the ID of the feature in the output GML. gml_featureid or ows_featureid can be specified instead.
wfs_geometry_precision
(Optional, since MapServer 8.0) Specifies the precision of the geometry coordinates in the generated GML, where precision is the number of decimal places. This affects WFS requests using the built-in GML2/GML3 output (specifying a different OUTPUTFORMAT will override this setting).






wfs_getfeature_formatlist
(Optional) Comma-separated list of formats that should be valid for a GetFeature request. If defined, only these formats are advertised in the Capabilities document.
wfs_keywordlist
Same as wfs_keywordlist in the Web Object.
wfs_metadataurl_about
• (Optional) used to reference the aspect of the element which includes the MetadataURL element that this meta- data provides more information about. The layer metadata wfs_metadataurl_href must also be specified. Refer to Table 11 of the OGC WFS 2.0 specification (WFS 2.0 only)
• To output several MetadataURL elements, use wfs_metadataurl_list
wfs_metadataurl_format
• (Optional) The file format of the metadata record. Valid values are "XML", "SGML", or "HTML". The layer metadata wfs_metadataurl_type and wfs_metadataurl_href must also be specified. Refer to section 12.3.5 of the WFS 1.0.0 spec (unused for WFS 2.0).
• To output several MetadataURL elements, use wfs_metadataurl_list
wfs_metadataurl_href
• (Optional) The URL to the layer's metadata. The layer metadata wfs_metadataurl_type and wfs_metadataurl_format for WFS 1.0 and 1.1, or wfs_metadataurl_about for WFS 2.0 may also be speci- fied. Refer to section 12.3.5 of the WFS 1.0.0 spec and Table 11 of the OGC WFS 2.0 specification
• To output several MetadataURL elements, use wfs_metadataurl_list
wfs_metadataurl_list
Added in version 8.0.
• (Optional) Space-separated list of parts of metadata keys, to be able to specify several MetadataURL. If the value of wfs_metadataurl_list is "foo bar", then wfs_metadataurl_foo_href, wfs_metadataurl_foo_format,
wfs_metadataurl_foo_type,	wfs_metadataurl_foo_about,	wfs_metadataurl_bar_href, wfs_metadataurl_bar_format, wfs_metadataurl_bar_type, wfs_metadataurl_bar_about will be queried with the semantics of the wfs_metadataurl_href, wfs_metadataurl_format, wfs_metadataurl_type and wfs_metadataurl_about items.
Example:




wfs_metadataurl_type
• (Optional) The standard to which the metadata complies. Currently only two types are valid: "TC211" which refers to [ISO 19115], and "FGDC" which refers to [FGDC CSDGM]. The layer metadata
wfs_metadataurl_format and wfs_metadataurl_href must also be specified. Refer to section 12.3.5 of the WFS
1.0.0 spec (unused for WFS 2.0).
• To output several MetadataURL elements, use wfs_metadataurl_list
wfs_srs
If there is no SRS defined at the top-level in the mapfile then this SRS will be used to advertise this feature type (layer) in the capabilities. See the note about the SRS rules in WFS.
wfs_title
Same as wfs_title in the Web Object.
wfs_use_default_extent_for_getfeature
(Optional, since MapServer 7.0.4) Whether the MAP.EXTENT should be used in request to datasources in the absence of other spatial filter. This is the default behaviour, but this might affect performance in some use cases. In those cases, setting this item to "false" will avoid the default spatial filter to be appended to the request. This is only implemented for OGR datasources (since 7.0.4), MSSQL2008 (since 7.6), and PostGIS connections (since 8.4). Use ows_use_default_extent_for_getfeature to set for both WFS and OGC API : Features.

Layer Metadata API
If wfs_metadataurl_href is not defined, MapServer will provide a link to the Layer Metadata API for the given layer in the <MetadataURL> element. See the Layer Metadata API documentation for more information.

To-do Items and Known Limitations
• This is just a basic WFS (read-only): transaction requests are not supported and probably never will given the nature of MapServer. GeoServer or TinyOWS is recommended for those needing WFS-T support.
• WFS spec. seems to require that features of a given feature type must all be of the same geometry type (point, line, polygon). This works fine for shapefiles, but some data source formats supported by MapServer allow mixed geometry types in a single layer and this goes against the WFS spec. Suggestions on how to handle this
are welcome (send suggestions to the mapserver-dev mailing list.

10.1.12 INSPIRE Download Service
Author
Stephan Meissl
Contact
stephan.meissl at eox.at
Author
Even Rouault
Contact
even.rouault at mines-paris.org
Author
Fabian Schindler
Contact
fabian.schindler at eox.at
Last Updated
2018-03-16






Introduction
INSPIRE is the name of an European directive, establishing an infrastructure for spatial information in Europe to support Community environmental policies, and policies or activities which may have an impact on the environment.
The INSPIRE Download Service is an implementation of the INSPIRE Technical Guidance Download Services v3.1 on top of the WFS Server, version 2.0 (implementation explained in the previous chapter) and an implementation of Technical Guidance for the implementation of INSPIRE Download Services using Web Coverage Services on top of WCS Server, version 2.0. The INSPIRE schemas contain extensions to OGC WFS and WCS schemas.
In order to achieve INSPIRE Download Service compliance, the following enhancements have been implemented in MapServer:
• Activation of INSPIRE support (two scenarios)
• Multi-language support for certain capabilities fields
• Provision of INSPIRE specific metadata
Support for INSPIRE Download Service in MapServer uses a syntax identical to the one used for INSPIRE View Service. Consequently, it is possible to define shared metadata items between Download and View services by using the ows_ prefix instead of wfs_ or wcs_. In the following examples the ows_ prefix is used, as the documentation is meant for both WCS and WFS.

Activation of INSPIRE support
INSPIRE specific metadata can either be referenced in an external INSPIRE service metadata document (scenario 1) or can be directly embedded in the capabilities document (scenario 2). MapServer supports both scenarios.
Activation of the corresponding scenario for INSPIRE support takes place in the WEB.METADATA section of the mapfile through ows_inspire_capabilities. If activated, the corresponding INSPIRE namespace as well as appropriate validation warnings are generated in the capabilities document.
Scenario 1 - activate INSPIRE support using a reference to external service metadata:

Scenario 2 - activate INSPIRE support using embedded service metadata:






Multi-language support for certain capabilities fields
INSPIRE requires multi-language support and requests a list of all supported languages as well as the default language in the capabilities document. Based on the language parameter in the GetCapabilities request, certain specific metadata values, namely
• ows_title
• ows_abstract
need to be provided in the requested language (both at the WEB.METADATA and LAYER.METADATA levels). If the language is not supported (or no language parameter is present), the default language has to be used.
For INSPIRE download service WCS, only the WEB.METADATA fields have an effect, as the INSPIRE and language specific metadata are only relevant for the service itself and is not required on the level of coverages.
As an extension, also not encouraged by the INSPIRE Download Services technical guidance, MapServer supports language dependent reference data like
• DATA "road_eng"
• CONNECTION "db_ger"
All supported languages have to be specified as comma separated list (first language is default) through wfs_languages in the WEB.METADATA section of the mapfile. This language parameter is also added to the OnlineResource in the GetCapabilities output:

For language specific metadata values, a key extension method is applied:














(continues on next page)



(continued from previous page)
For language dependent reference data, a similar approach like the run-time substitution feature of MapServer has been followed (only DATA and CONNECTION values with %language% are substituted):

If the language is not supported (or no language parameter is present), the default language is substituted.

Provision of INSPIRE specific metadata
Depending on the scenario, additional metadata information is required to support the specification. The INSPIRE related fields are provided below.
Scenario 1 - INSPIRE related fields using referenced external service metadata:

Scenario 2 - INSPIRE related fields using embedded service metadata:



WEB
METADATA
"ows_inspire_capabilities"  "embed"
"ows_languages" "eng,ger"	#first default, values according ISO 639-2/B
"ows_inspire_temporal_reference"  "2011-09-19"	#date of?
??last revision, value according YYYY-MM-DD
"ows_inspire_mpoc_name" "mympocname"	#point?
??of contact
"ows_inspire_mpoc_email" "mympoc@e.mail"	#point?
??of contact
"ows_inspire_metadatadate" "2011-09-19"
"ows_inspire_resourcelocator" "http://myinspireresource"	#URL for?
??ResourceLocator
"ows_inspire_keyword" "infoMapAccessService"	#value?
??according "classification of spatial data services" "ows_inspire_dsid_code" "mycode" "ows_inspire_dsid_ns" "http://mycode"

"ows_keywordlist" "ogc,wfs,gml" "ows_title" "myservicetitle" "ows_abstract" "myabstract"
"ows_fees" "conditions unknown"	#value either "no conditions apply"|default
??"conditions unknown"|<specific conditions>
"ows_accessconstraints" "None"	#value according ISO 19115 (MD_RestrictionCode?
??codelist) or default "None"
"ows_contactorganization" "MapServer"	#responsible organization
"ows_contactposition" "owner"	#responsible organization, value according
??"INSPIRE Metadata Regulation" (part D6)
 ... END END

Notes:
• this mailing list exchange gives a few hints how to fill the wfs_inspire_dsid_code metadata item.
• regarding scenario 2, <inspire_common:ResourceType> is always set to service and <in- spire_common:SpatialDataServiceType> is always set to download, both values can't be altered through the mapfile
• conformity is always set to not evaluated, based on the latest INSPIRE Metadata Implementing Rules (page 7), a specification document, the specification date and a specification URI or URL need to be provided for degree conformant/not conformant, which is currently not implemented

10.1.13 WFS Client
Author
Jean-François Doyon
Contact
jdoyon at nrcan.gc.ca
Author
Jeff McKenna



Contact
jmckenna at gatewaygeomatics.com
Last Updated
2020-06-09


Introduction
MapServer can retrieve and display data from a WFS server. The following document explains how to display data from a WFS server using the MapServer CONNECTIONTYPE WFS.
WFS can also be accessed through OGR (CONNECTIONTYPE OGR). See the OGR Vector Layers Through MapServer
documentation for datails.
A WFS ( Web Feature Service ) publishes feature-level geospatial data to the web. This means that it is possible to use this data as a data source to render a map. In effect, this is not unlike having a shapefile accessible over the web, only it's not a shapefile, it's XML-Encoded geospatial data (GML to be exact), including both geometry AND attribute information.

WFS-Related Information
Although in-depth understanding of WFS and GML is neither necessary nor required in order to implement a MapServer application that reads remote WFS data, it is recommended to at least get acquainted with the concepts and basic functionality of both. Here are the official references (including a newly added OGC workshop with MapServer):
• OGC Web Feature Service Implementation Specification.
• Geography Markup Language Implementation Specification.
• MapServer OGC Web Services Workshop package.



Software Requirements
In order to enable MapServer to serve WFS, it MUST be compiled against certain libraries:
• PROJ: The reprojection library. Version 4.4.3 or greater is required.
• GDAL/OGR: I/O support libraries. Version 1.1.8 or greater is required.
• LibCURL: Used to help MapServer act as an HTTP client. Version 7.10 or greater is required.
Please see the MapServer UNIX Compilation and Installation HOWTO for detailed instructions on compiling mapserver with support for these libraries and features. For Windows users, look on the MapServer website to see if there are any binaries available that meet these requirements.

Setting up a WFS-client Mapfile Storing Temporary Files
You must set the IMAGEPATH parameter in your mapfile since MapServer uses this directory to store temporary files downloaded from the remote WFS server. Windows users must specify a full path for IMAGEPATH, such as: IMAGEPATH "C:/tmp/ms_tmp/"


Configuring for HTTPS Connections
Follow the Accessing OGC services over HTTPS document to make sure that your local server can connect through HTTPS secured connections.

WFS Layer
A WFS layer is a regular mapfile layer, which can use CLASS objects, with expressions, etc.
As of MapServer 4.4, the suggested method to define a WFS Client layer is through the CONNECTION parameter and the layer's METADATA. The necessary mapfile parameters are defined below:
• CONNECTIONTYPE: must be "wfs"
• CONNECTION : The URL to the WFS Server. e.g. https://demo.mapserver.org/cgi-bin/wfs? The path to the mapfile on the WFS server is required if it was required in the GetCapabilities re- quest e.g.  you would have to specify the MAP parameter in the CONNECTION for the following
server: http://map.ns.ec.gc.ca/MapServer/mapserv.exe?MAP=/mapserver/services/envdat/config.map &SER- VICE=WFS&VERSION=1.0.0&REQUEST=GetCapabilities
• METADATA: The LAYER's must contain a METADATA object with the following parameters:
- wfs_connectiontimeout (optional): The maximum time to wait for a remote WFS layer to load, set in sec- onds (default is 30 seconds). This metadata can be added at the layer level so that it affects only that layer, or it can be added at the map level (in the web object) so that it affects all of the layers. Note that wfs_connectiontimeout at the layer level has priority over the map level.



- wfs_filter: This can be included to include a filter encoding parameter in the getFeature request (see the Filter Encoding Howto for more information on filtering). The content of the wfs_filter is a valid filter encoding element.

- wfs_geometryname (optional): The name of the geometry column used for spatial filtering in the filter parameter (Geometry by default). This parameter is used for ArcGIS or GeoServer WFS services as several geometry column can be chosen (or with a different default name to Geometry).
- wfs_latlongboundingbox (optional): The bounding box of this layer in geographic coordinates in the format "lon_min lat_min lon_max lat_max". If it is set then MapServer will request the layer only when the map view overlaps that bounding box. You normally get this from the server's capabilities output.
- wfs_maxfeatures (optional): Limit the number of GML features to return. Sensible values are integers greater than 0. If 0 is specified, no features will be returned.
- wfs_request_method (optional): Can be set to "GET" to do a Get request to WFS servers that do not support Post requests. The default method in MapServer is Post.

- wfs_typename (required): the <Name> of the layer found in the GetCapabilities. An example Get- Capabilities request is: https://demo.mapserver.org/cgi-bin/wfs?SERVICE=WFS&VERSION=1.0.0& REQUEST=GetCapabilities
- wfs_version (required): WFS version, currently "1.0.0"


Optional Layer Parameters and Metadata
• "wfs_auth_username" metadata - msEncrypt-style authorization string. Empty strings are also accepted.

• "wfs_auth_type" metadata - Authorization type. Supported types include:
- basic



- digest
- ntlm
- any (the underlying http library picks the best among the options supported by the remote server)
- anysafe (the underlying http library picks only safe methods among the options supported by the remote server)

• "wfs_connectiontimeout" metadata
- the maximum time to wait for a remote WFS layer to load, set in seconds (default is 30 seconds). This metadata can be added at the layer level so that it affects only that layer, or it can be added at the map level (in the web object) so that it affects all of the layers. Note that wfs_connectiontimeout at the layer level has priority over the map level.

• "wfs_proxy_auth_type" metadata - the authorization type to use for a proxy connection. Supported types include:
- basic
- digest
- ntlm
- any (the underlying http library picks the best among the opotions supported by the remote server)
- anysafe (the underlying http library picks only safe methods among the options supported by the remote server)

• "wfs_proxy_host" metadata - the hostname of the proxy to use, in "dot-quad" format, with an optional port component (e.g. '192.168.2.10:8080').

• "wfs_proxy_port" metadata - the port to use for a proxy connection.

• "wfs_proxy_type" metadata - the type of the proxy connection. Valid values are 'http' and 'socks5', which are case sensitive.





• "wfs_proxy_username" metadata - msEncrypt-style string for a proxy connection. Empty strings are also accepted.


Example WFS Layer


Connection - deprecated
As of MapServer v4.4 the method of specifying all of the connection information in the CONNECTION parameter has beendeprecated. The preferred method is mentioned above. If the metadata is not provided, VERSION, SERVICE, and TYPENAME will be fetched from the CONNECTION, as shown below


TODO / Known Limitations
1. Temporary WFS (gml) files are written to the IMAGEPATH directory, but this could become a security concern since it makes the raw GML data downloadable by someone who could guess the gml filename. We should consider having a "wfs_cache_dir" metadata that, if it is set will define a directory where temp files should be written. The default would still be to use the value of IMAGEPATH if "wfs_tmpdir" is not set.

MapServer Documentation, Release 8.6.0

10.1.14 WFS-T Server


WFS-T
MapServer does not support the WFS-T specification. A companion program, TinyOWS, is a fast implementation of WFS-T. TinyOWS and MapServer share the same Mapfile format, and you can use the same Mapfile and datasources for a dual installation of MapServer and TinyOWS on your server.

10.1.15 WFS Filter Encoding
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Author
Yewondwossen Assefa
Last Updated
2024-06-27


Introduction
This document describes the procedures for taking advantage of the Filter Encoding (FE) support in WFS GetFeature requests, which was added to MapServer in version 4.2.
This document assumes that you are already familiar with the following aspects of MapServer:
• MapServer application development and setting up .map files.
• Familiarity with the WFS specification would be an asset. Links to the MapServer WFS documents are included in the next section.
As of MapServer 7.0, the OGC Filter Encoding 2.0 specification is also used to evaluate Filters of WFS 2.0 GetFeature requests.



Links to SLD-related Information
• Filter Encoding Implementation Specification.
• MapServer WFS Client Howto.
• MapServer WFS Server Howto.
• MapServer OGC Web Services Workshop.
• Open GIS Consortium (OGC) home page.

Currently Supported Features
The following table lists the currently supported features for FE.
Table 1. Currently Supported Features

Feature Set	FeatureSpatial CapabilitiesEqualsDisjointTouchesWithinOverlapsCrossesIntersectsContainsDWithinBBOXScalar CapabilitiesLogical OperatorsAndOrNotComparison OperatorsPropertyIsEqualTo (=)PropertyIsNotEqualTo (<>)PropertyIsLessThan (<)PropertyIsGreaterThan (>)PropertyIsLessThanOrEqualTo (<=)PropertyIsGreaterThanOrEqualTo (>=)PropertyIsLikePropertyIsBetween (range)
Units of measure
The following units of measure are supported:




m or metersmeterskm or kilometerskilometersNMnauticalmilesmi or milesmilesin or inchesinchesft or feetfeetdeg or dddegreepxpixels
Get and Post Requests
MapServer already has the capability to receive and parse Get requests and URL-encoded Post requests. The ability for MapServer to be able to receive Post requests with XML-encoded information sent in the body of the request has been added. Also, the ability to generate XML-encoded Post requests for WFS layers has been added.
Both Get and Post request are now supported for all WFS requests:
• GetCapabilities
• GetFeatures
• DescribeFeatureType
Supporting these WFS requests in Post was implemented to keep consistency between all supported WFS requests.
When sending requests, the default request method used is Post. To change this behavior, we have introduced a layer level meta data, wfs_request_method, which can be set to "GET".

Use of Filter Encoding in MapServer
This section describes how to use FE on both the server and client sides.

Server Side
To be able to use Filter Encoding, you need to create a valid WFS server using MapServer. Please refer to the WFS Server HOWTO for specifics.
There is nothing special that should be added to a WFS server for Filter Encoding, but you should note that, when requesting the capabilities of your WFS server, the document returned should contain the supported filters. Here is part of a Capabilities document (note the "Filter_Capabilities" section):
















(continues on next page)



(continued from previous page)
<Capability>
<Request>
<GetCapabilities>
<DCPType>
<HTTP>
<Get  onlineResource="https://demo.mapserver.org/cgi-bin/wfs?"/>
</HTTP>
</DCPType>
<DCPType>
<HTTP>
<Post onlineResource="https://demo.mapserver.org/cgi-bin/wfs?"/>
</HTTP>
</DCPType>
</GetCapabilities>
...
</Request>
</Capability>
...
<ogc:Filter_Capabilities>
<ogc:Spatial_Capabilities>
<ogc:Spatial_Operators>
<ogc:Equals/>
<ogc:Disjoint/>
<ogc:Touches/>
<ogc:Within/>
<ogc:Overlaps/>
<ogc:Crosses/>
<ogc:Intersects/>
<ogc:Contains/>
<ogc:DWithin/>
<ogc:BBOX/>
</ogc:Spatial_Operators>
</ogc:Spatial_Capabilities>
<ogc:Scalar_Capabilities>
<ogc:Logical_Operators/>
<ogc:Comparison_Operators>
<ogc:Simple_Comparisons/>
<ogc:Like/>
<ogc:Between/>
</ogc:Comparison_Operators>
</ogc:Scalar_Capabilities>
</ogc:Filter_Capabilities>

</WFS_Capabilities>

Client Side
To be able to generate a Filter to a WFS server, a layer level metadata called wfs_filter has been added, which should contain the filter to be sent to the server. Following is an example of a valid WFS client layer with a filter:


(continues on next page)



(continued from previous page)
Note:
• The filter given as a value of the wfs_filter metadata should not contain <Filter> start and end tags.
• The CONNECTION points to a valid WFS server supporting filters
• The returned shapes will be drawn using the class defined in the layer.

Limitations
• A limited set of spatial operators are supported.

Tests
Here are some test URLs for the different supported filters:
• PropertyIsEqualTo





• PropertyIsNotEqualTo

• PropertyIsLessThan

• PropertyIsGreaterThan

• PropertyIsLessThanOrEqualTo

• PropertyIsGreaterThanOrEqualTo

• PropertyIsBetween

• PropertyIsLike




• Logical operator OR

• Logical operator AND

• Logical operator NOT

• Spatial operator BBOX

• Spatial operator Dwithin

• Spatial operator Intersects

• The OGC conformance tests (https://cite.opengeospatial.org/teamengine/) have been run on the FE support. The following table and notes reflect the current status.



Table 2. WFS OGC test suite (over the HTTP Get and Post method)

Test #	Description# ofTests# ofFailedTests1	Basic WFS tests over the HTTP Get and Post method4022811.1	GetCapabilities1601.2	DescribeFeatureType1801.3	GetFeature3682811.3.1	Basic WFS tests2011.3.2	Complex WFS tests18181.3.3	Arithmetic filter WFS tests881.3.4	Comparison WFS tests50261.3.4.1	GetFeature PropertyIsGreaterThanOrEqualTo filter201.3.4.2	GetFeature PropertyIsBetween filter621.3.4.3	GetFeature PropertyIsEqualTo filter401.3.4.4	GetFeature PropertyIsGreaterThan filter421.3.4.5	GetFeature PropertyIsGreaterThanOrEqualTo filter661.3.4.6	GetFeature PropertyIsLessThan filter641.3.4.7	GetFeature PropertyIsLessThanOrEqualTo filter641.3.4.8	GetFeature PropertyIsLike filter201.3.4.9	GetFeature PropertyIsNotEqualTo filter601.3.4.10	GetFeature PropertyIsNull filter881.3.5	Logical WFS test2001.3.5.1	GetFeature AND PropertyIsEqualTo PropertyIsEqualTo filter801.3.5.2	GetFeature OR PropertyIsEqualTo PropertyIsEqualTo filter801.3.5.3	GetFeature NOT PropertyIsNotEqualTo filter401.3.6	Spatial operator WFS test2522281.3.6.1	GetFeature BBOX filter36121.3.6.2	GetFeature with other filter types2162162	Transactional WFS test6969
The OGC Cite WFS test suite can be found on the OGC Cite portal. Following are some MapServer specific notes on this test suite:
1. Test number 1.3.1:
• There is a contradiction between the wfs/1.0.0/basic/getfeature/post/3 assertion and the XPath expected value of the test. The assertion says: "Test that a GetFeature request with no output format de-
fined returns a wfs:FeatureCollection with GML data." and the expected XPath value for this request: "boolean(/ogc:ServiceExceptionReport)" is supposed to be true. So, the assertion means that when a WFS server receives a request which contains an undefined output format or no output format at all, the WFS server must return a WFS collection containing GML data. The XPath expected value means that when a WFS server receives a request with an undefined output format or no output format at all, the WFS server must return a service exception report.
2. Tests number 1.3.2 and 1.3.3:
• Not supported.
3. Tests number 1.3.4.2, 1.3.4.4 to 1.3.4.7:
• The string comparison is not supported using >, <, >=, <=.
• The date comparison is not supported.




See alsobug 461
4. Test number 1.3.4.10:
• This property is not supported in MapServer.
5. Test number 1.3.6.1:
• The returned feature xml won't validate because the validation is done against a specific xsd (geomatry.xsd).
• The data conversion on multipoints and multilayers are not supported within GDAL.

See alsobug 461
6. Test number 2:
• The transaction requests are not supported.

10.1.16 SLD
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Author
Yewondwossen Assefa
Last Updated
2025-08-18




Introduction
This document describes the procedures for taking advantage of the Styled Layer Descriptor (SLD) support in WMS GetMap requests with MapServer. SLD support exists for the server side (ability to read an SLD and apply it with a GetMap request) and for the client side (includes sending SLD requests to server and generate SLD files on the fly from MapServer map file). SLD support was added to MapServer in version 4.2.
This document assumes that you are already familiar with the following aspects of MapServer:
• MapServer application development and setting up .map files.
• Familiarity with the WMS specification would be an asset. Links to the MapServer WMS documents are included in the next section.

Links to SLD-related Information
• Styled Layer Descriptor Implementation Specification.
• MapServer WMS Client HowTo.
• MapServer WMS Server HowTo.
• MapServer OGC Web Services Workshop.
• Open GIS Consortium (OGC) home page.

Server Side Support General Information
There are two ways a WMS request can pass an SLD document with a GetMap request to MapServer:
• SLD parameter pointing to remote SLD (SLD=http://URL_TO_SLD).
• SLD_BODY parameter to send the SLD definition in the URL.
These two methods are both available through MapServer. An example of a request would be:

Test the remote SLD request.
The SLD in the above request follows:















(continues on next page)



(continued from previous page)
Version 1.1.0 of the same SLD
<?xml version="1.0" encoding="UTF-8"?>
<StyledLayerDescriptor  version="1.1.0" xmlns="http://www.opengis.net/sld" xmlns:se="http://www.opengis.net/se" xmlns:ogc="http://www.opengis.net/ogc" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/sld http://schemas.opengis.net/sld/1.1.0/StyledLayerDescriptor.xsd">
<NamedLayer>
<se:Name>country_bounds</se:Name>
<UserStyle>
<se:Name>xxx</se:Name>
<se:FeatureTypeStyle>
<se:Rule>
<se:LineSymbolizer>
<se:Geometry>
<ogc:PropertyName>center-line</ogc:PropertyName>
</se:Geometry>
<se:Stroke>
<se:SvgParameter  name="stroke">#0000ff</se:SvgParameter>
</se:Stroke>
</se:LineSymbolizer>
</se:Rule>
</se:FeatureTypeStyle>
</UserStyle>
</NamedLayer>
</StyledLayerDescriptor>

When MapServer gets a valid SLD through a request, it parses this SLD to extract all the styles attached to the Named- Layers, and then it applies these styles to the map before it is returned to the client. When applying the SLD, MapServer compares the <Name> parameter of the NamedLayers in the SLD document to the WMS layer names (WMS layer names are available in a GetCapabilities request).






Additional WMS features related to SLDs have also been developed:
Table1. Additional WMS Features

FeaturesSupportedNotesMethod GET : SLD URLYesMethod GET : SLD_BODYYesAdditional itemDescriber LayerYesGetLegendGraphicYesGetStylesYesUses MapScript to get the SLD


Specific SLD Elements Supported
The following tables give a lot of additional details about SLD support in MapServer.
Table2. Named Layers and User Layers

FeaturesSupportedNotesNamed LayersYesUser LayersNo
Table3. Named Layers

FeaturesSupportedNotesLayerFeatureConstraintsYesSince MapServer 7.0.1Named StylesYesUser StylesYes
Table 4. User Styles

MapServer Documentation, Release 8.6.0



FeaturesSup- portedNotesNameNoThis was removed at implementation time, since it does not fit with MapServerTitleNoNo use in the MapServer environmentAbstractNoNo use in the MapServer environmentIsDefaultNoOnly one style is available per layerFeatureType-
StyleYesMapServer has a concept of one feature type style per layer (either point, line, poly-
gon, or raster)
Table 5. FeatureTypeStyle

FeaturesSupportedNotesNameNoNo use in the MapServer environmentTitleNoNo use in the MapServer environmentAbstractNoNo use in the MapServer environmentFeatureTypeNameNoNo use in the MapServer environmentSemanticTypeIdentifierNoStill an experimental element in the SLD specificationsRuleYes
Table 6. Rule

FeaturesSupportedNotesNameYesTitleYesAbstractNoNo use in the MapServer environmentLegendGraphicYesFilterYesElseFilterYesMinScaleDenominatorYesMaxScaleDenominatorYesLineSymbolizerYesPolygonSymbolizerYesPointSymbolizerYesTextSymbolizerYesRasterSymbolizerYesApplies for 8-bit rasters• Filter and ElseFilter
For each rule containing a filter, there is a class created with the class expression set to reflect that filter. Available filters that can be used are Comparison Filters and Logical Filters (see the Filter Encoding HowTo). The ElseFilter parameters are converted into a class without an expression, placed at the end of the class list, and flagged as fallback. They are used to render elements that did not fit into any other classes.
   • MinScaleDenominator and MaxScaleDenominator are translated in minscale and maxscale in MapServer. The following are examples of valid requests using the Filters:
• line with one filter: sld 6a / full request 6a
• line with multiple filters: sld 6b / full request 6b
• line with one filter and an else filter: sld 6c / full request 6c

	MapServer Documentation, Release 8.6.0


• spatial filter using BBOX: sld 6d/ full request 6d
This example enables spatial filtering using the BBOX parameter as a Filter for a selected area (Africa). Note that an ElseFilter will not work with a spatial filter.
Table 7. LineSymbolizer

FeaturesSupportedNotesGeometryNoMapServer uses the data geometry for the renderingStroke: GraphicFillNoSolid color is usedStroke: GraphicStrokeYesDraws the symbol along the lineStroke (CssParameter): strokeYesRGB colors are supportedStroke (CssParameter): widthYesStroke (CssParameter): opacityYesOnly for AGG driver and mapserver version >=5.2Stroke (CssParameter): linejoin and linecapNoNot supported in MapServerStroke (CssParameter): dasharrayYesStroke (CssParameter): dashoffsetNoPerperdicularOffset (only in SLD 1.1.0)YesOffset values of the style object will be setInitialGap(GraphicStroke SLD 1.1.0)NoGap (GraphicStroke parameter SLD 1.1.0)No


The following are examples of valid requests using the LineSymbolizer:
• simple line: sld 7a / full request 7a
• line with width: sld 7b / full request 7b
• dashed line: sld 7c / full request 7c
Table 8. PolygonSymbolizer

FeaturesSupportedNotesGeometryNoStrokeYesStrokes are the same as for the LineSymbolizerFillYesWas developed to support symbol fill polygons in addition to solid fillFill-opacityYesOnly available for AGG driver and mapserver version >=5.2PerperdicularOffsetNoSLD 1.1.0 parameterDisplacementYesSLD 1.1.0 parameter. Sets offsetx/y in MapServer
A Fill can be a solid fill or be a Graphic Fill, which is either a well-known Mark symbol (e.g., square, circle, triangle, star, cross, x) or an ExternalGraphic element (e.g., gif, png) available through a URL. When a Mark symbol is used in an SLD, MapServer creates a corresponding symbol in the map file and uses it to render the symbols. When a ExternalGraphic is used, the file is saved locally and a pixmap symbol is created in the mapfile referring to the this file.





The following are examples of valid requests using the PolygonSymbolizer:
• simple solid fill: sld 8a / full request 8a
• solid fill with outline: sld 8b / full request 8b
• fill with mark symbol: sld 8c / full request 8c
• fill with external symbol: sld 8d/ full request 8d
Table 9. PointSymbolizer

FeaturesSup- portedNotesGeometryNoGraphic: Mark symbolYesWell-known names (square, circle, triangle, star, cross, X) are supportedGraphic: External-
GraphicYesWas developed to support symbol fill polygons in addition to solid fillOpacityYesSupport added in MapServer 5.4SizeYesRotationYesSupport added in MapServer 5.4DisplacementYesSLD 1.1.0 Parameter. Support added in MapServer 5.4AnchorPointNo




The following are examples of valid requests using the PointSymbolizer:
• filled mark symbol: sld 9a / full request 9a
• default settings (square, size 6, color 128/128/128): sld 9b / full request 9b
• external symbol: sld 9c / full request 9c
Table 10. TextSymbolizer

FeaturesSup- portedNotesGeometryNoLabelYesMapServer behaviour changes for versions >= 8.0, see note belowFont(font-
family)YesFont names used are those available in MapServer font file. If no fonts are available there,
default bitmap fonts are usedFont-style
(Italic, . . . )YesFont-weightYesFont-sizeYesIf true-type fonts are not used, default bitmap sizes are givenLabelPlace-
mentYesPointPlacement is supported. LinePlacement is supported for versions >=5.2.1. Only Per-
perdicularOffset and IsAligned are supported for LinePlacement.HaloYesSupported (fill converted to outlinecolor, and radius is converted to outlinewidth. Note that
outlinewidth is only available for AGG in >=5.2)FillYesOnly solid color is available
Notes on the TextSymbolizer:
• Label: Starting with version >= 8.0 and in conformance with OGC standard, raw text in a Label tag is interpreted as an implicit Literal instead of an implicit PropertyName. Moreover, Literal and Function tags are supported, as well as mixed content. Supported Functions are MapServer functions returning a number.
• Font names: when converting Font parameters to MapServer, the following rule is applied to get the font name: FontFamily-FontStyle-FontWeight. For example, if there is an SLD with a Font Family of arial, a Font Style of italic, and a Font weight equal to bold, the resulting MapServer font name is arial-bold-italic. Font Style and
Weight are not mandatory and, if not available, they are not used in building the font name. When a Font Style or a Font Weight is set to normal in an SLD, it is also ignored in building the name. For example, if there is an SLD with a Font Family of arial, a Font Style of normal and a Font weight equals to bold, the resulting MapServer font name is arial-bold.
• A TextSymbolizer can be used in MapServer on a Point, Line, or Polygon layer - in addition to other symbolizers used for these layers.
• PointPacement: a point placement includes AnchorPoint (which is translated to Position in MapServer) Dis- placement (which is translated to Offset) and Angle (which is translated to Angle).
• Angle setting (MapServer version >=5.4): by default the angle parameter is set to AUTO. For point features, users can use the PointPlacement to alter the value. For line features, the user can add a LinePlacement: If an 'empty' LinePlacement is part of the SLD, the angle will be set to FOLLOW, If a LinePlacement contains
the PerpendicualarOffset parameter, the angle will be set to 0 and the PerpendicualarOffset will be used to set the offset values in the label object. SLD 1.1.0 introduces the IsAligned parameter for LinePlacement: if this parameter is set to false, the angle will be set to 0.



The following are examples of valid requests using the TextSymbolizer:
• point layer : test for label, font, point placement, color, angle: sld 10a / full request 10a
• point layer with text and symbols using 2 symbolizers: sld 10b / full request 10b
• line layer with text using 2 symbolizers: sld 10c / full request 10c
Table 11. RasterSymbolizer

FeaturesSupportedNotesGeometryNoOpacityYesChannelSelectionNoOverlapBehaviourNoColorMapYesContrastEnhancementNoShadedReliefNoImageOutlineNo
The current support in MapServer includes only ColorMap parameter support. It can be used to classify 8-bit rasters. Inside the ColorMap parameters, the color and quantity parameters are extracted and used to do the classification.
Table 12. ColorMap
The following Features are available in SLD 1.0

FeaturesSupportedNotesColorYesOpacityNoQuantityYesLabelNo
The following is an example of ColorMap usage for SLD 1.0. If we have following ColorMap in an SLD:
The six classes that are created are:

class1:[pixel]>=22AND[pixel]<30withcolor00ff00class2:[pixel]>=30AND[pixel]<37withcolor00bf3fclass3:[pixel]>=37AND[pixel]<45withcolor007f7fclass4:[pixel]>=45AND[pixel]<52withcolor003fbfclass5:[pixel]>=52AND[pixel]<60withcolor0000ff





The following Features are available in SLD 1.1

FeaturesSupportedNotesCategorizeYes
The following is an example of and SLD 1.1.0 with a raster symbolizer
<StyledLayerDescriptor version="1.1.0" xsi:schemaLocation="http://www.opengis.net/sld http://schemas.opengis.net/sld/1.1.0/StyledLayerDescriptor.xsd" xmlns="http://www.opengis.net/sld" xmlns:ogc="http://www.opengis.net/ogc" xmlns:se="http://www.opengis.net/se" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
<NamedLayer>
<se:Name>landsat</se:Name>
<UserStyle>
<se:Name>xxx</se:Name>
<se:FeatureTypeStyle>
<se:Rule>
<se:RasterSymbolizer>
<se:Opacity>0.7</se:Opacity>
<se:ColorMap>
<se:Categorize  fallbackValue="#78c818">
<se:LookupValue>Rasterdata</se:LookupValue>
<se:Value>#ffffff</se:Value>
<se:Threshold>22</se:Threshold>
<se:Value>#00ff00</se:Value>
<se:Threshold>30</se:Threshold>
<se:Value>#00bf3f</se:Value>
<se:Threshold>37</se:Threshold>
<se:Value>#007f7f</se:Value>
<se:Threshold>45</se:Threshold>
<se:Value>#003fbf</se:Value>
<se:Threshold>52</se:Threshold>
<se:Value>#0000ff</se:Value>
<se:Threshold>60</se:Threshold>
<se:Value>#000000</se:Value>
</se:Categorize>
</se:ColorMap>
</se:RasterSymbolizer>
</se:Rule>
</se:FeatureTypeStyle>
</UserStyle>
</NamedLayer>
</StyledLayerDescriptor>

The classes that are created are:





class2:[pixel]>=22AND[pixel]<30withcolor00ff00class3:[pixel]>=30AND[pixel]<37withcolor00bf3fclass4:[pixel]>=37AND[pixel]<45withcolor007f7fclass5:[pixel]>=45AND[pixel]<52withcolor003fbfclass6:[pixel]>=52AND[pixel]<60withcolor0000ff

Examples using 8 bits and 16 bits rasters can be seen at:
• example 1
• example 2
Table 13. LayerFeatureConstraints (MapServer 7.0.1 or above)

FeaturesSupportedNotesFeatureTypeConstraintYesOnly one occurrence
Table 14. FeatureTypeConstraint (MapServer 7.0.1 or above)

FeaturesSupportedNotesFeatureTypeNameNoFilterYesExtentNo
A Filter can be applied through LayerFeatureConstraints/FeatureTypeConstraint to a named style or a user style. It is used to select which features are to be rendered. If the style has also filtering rules, they are combined with the filter of FeatureTypeConstraint (as well as with any FILTER or native filter set on the layer in the mapfile configuration)


Client Side Support
Client side support of the SLD consists of two parts:
• The first part is using MapServer as a WMS client to send a GetMap request with an SLD. This is done using two metadata that can be placed at a layer level in a MapServer mapfile. These two metadata are:
- wms_sld_url, which takes a valid URL as a value and appends SLD=xxx to the GetMap request.
- wms_sld_body, which takes a valid SLD string and appends SLD_BODY=xxx to the GetMap request. If the value of wms_sld_body is set to AUTO, MapServer generates an SLD based on the classes found in the layer and send this SLD as the value of the SLD_BODY parameter in the GetMap request.



• The other major item is the generation of an SLD document from MapServer classes. These functions are cur- rently available through MapServer/MapScript interface. Here are the functions available:
- on a map object: generatesld
- on a layer object: generatesld
Additional MapScript functions have been added or will be added to complement these functions:
- on a map object: applysld
- on a layer object: applysld


PHP/MapScript Example that Generates an SLD from a Mapfile
The following is a small script that calls the generateSLD() function to create an SLD for a specific layer in a mapfile:

1

2

3

4

5

6

7

8

9

10

11

12

13

14

15

16

17

18

19

20

21

22

23

24

25

26

27



Named Styles support
Named styles support are introduced in MapServer 5.2. The support is base on rfc39.
MapServer 5.2 introduces the possibility to assign a group to a series of classes defined on a layer object using two new non-mandatory keywords CLASSGROUP (at the layer level) and GROUP at the class level:

At rendering time, if the CLASSGROUP is defined, only classes that have the same group name would be used. Based on this concept, WMS/SLD support uses the class groups as named styles. Each group of classes is considered equiv- alent to a named style:
• The GetCapbilities request will output all the styles that are available
• The GetMap request can use the STYLES parameter to specify a named style
• The GetLegendGraphic can use the STYLES parameter to specify a named style

Other Items Implemented
• Support of filled polygons with Mark and ExternalGraphic symbols.
• MapScript functions to parse and apply SLD.
• SLD_BODY request support on client and server side.
• rfc138, added in MapServer 8.2, introduced two new SLD use cases:
- Referencing an SLD file in the LAYER STYLEITEM
- Reading SLD strings when from an attribute defined in the LAYER STYLEITEM
• Added the FALLBACK keyword in CLASS to support the functionality of ElseFilter in SLD.

Issues Found During Implementation
• Limitation of the FilterEncoding to comparison and logical filters. The spatial filters were not made available since it required major changes in MapServer WMS support.


10.1.17 WCS Server
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Author
Stephan Meissl
Contact
stephan.meissl at eox.at
Author
Fabian Schindler
Contact
fabian.schindler at eox.at
Last Updated
2025-08-02


Introduction
A WCS (or Web Coverage Service) allows for the publication of "coverages"- digital geospatial information represent- ing space-varying phenomena. In the MapServer world it allows for unfiltered access to raster data. Conceptually it is easy think of WCS as a raster equivalent of WFS. The following documentation is based on the Open Geospatial Consortium's (OGC) Web Coverage Service Interfaces Implementation Specification version 1.0.0.



Links to WCS-Related Information
• OGC'c WCS Standard page
• WCS 1.0.0 specification
• WCS 1.1.1c1 specification
• WCS 2.0
- GML 3.2.1 Application Schema Coverages
- WCS 2.0 Specification - Core
- WCS 2.0 Specification - KVP Protocol Binding Extension
- WCS 2.0 Specification - XML/POST Protocol Binding Extension
• WMS Server HowTo

Software Requirements
In order to enable MapServer to serve WCS data, it MUST be compiled against certain libraries:
• PROJ: The reprojection library. Version 4.4.3 or greater is required.
• GDAL: raster support library.
• MapServer: version >= 4.4 (tested with 5.0.2 while updating this document)
For WCS 1.1.x (MapServer 5.2) and WCS 2.0 (MapServer 6.0) support there is an additional requirement:
• libxml2: An xml parser and generation library.
Please see the MapServer UNIX Compilation and Installation HowTo for detailed instructions on compiling MapServer with support for these libraries and features. For Windows users, MapServer for Windows (MS4W) comes with WCS Server support.

Configuring Your Mapfile to Serve WCS Layers
Much as in the WMS and WFS support, WCS publishing is enabled by adding certain magic METADATA key- word/value pairs to a .map file.
MapServer will serve and include in its WCS capabilities only the layers that meet the following conditions:
• Data source is a raster, which is processed using GDAL (e.g GeoTIFF, Erdas Imagine, . . . )
• LAYER NAME must be set
• LAYER TYPE is set to RASTER
• WEB metadata or LAYER metadata "wcs_enable_request" must be set
• WEB metadata "wcs_label" must be set
• LAYER metadata "wcs_label" must be set
• LAYER metadata "wcs_rangeset_name" must be set
• LAYER metadata "wcs_rangeset_label" must be set
• LAYER is enabled to be served via WCS (see MS RFC 67)
• LAYER PROJECTION must be set, even if PROJECTION is set at the MAP level (a bug?)



Example WCS Server Mapfile
The following is an example of a simple WCS Server mapfile. Note the comments for the required parameters.
MAP
NAME STATUS ON
SIZE 400 300
SYMBOLSET "../etc/symbols.txt"
EXTENT -2200000 -712631 3072800 3840000
UNITS METERS
SHAPEPATH "../data"
IMAGECOLOR 255 255 255
FONTSET "../etc/fonts.txt"

#
# Start of web interface definition #
WEB
IMAGEPATH "/ms4w/tmp/ms_tmp/"
IMAGEURL "/ms_tmp/"
METADATA
"wcs_label"	"GMap WCS Demo Server" ### required
"wcs_description"	"Some text description of the service" "wcs_onlineresource"	"http://127.0.0.1/cgi-bin/mapserv.exe?" ### recommended "wcs_fees"	"none"
"wcs_accessconstraints"	"none" "wcs_keywordlist"	"wcs,test" "wcs_metadatalink_type"	"TC211" "wcs_metadatalink_format"	"text/plain" "wcs_metadatalink_href"	"http://someurl.com" "wcs_address"	"124 Gilmour Street"
"wcs_city"	"Ottawa" "wcs_stateorprovince"	"ON" "wcs_postcode"	"90210"
"wcs_country"	"Canada" "wcs_contactelectronicmailaddress" "blah@blah" "wcs_contactperson"		"me" "wcs_contactorganization"		"unemployed" "wcs_contactposition"		"manager" "wcs_contactvoicetelephone"		"613-555-1234"
"wcs_contactfacimiletelephone" "613-555-1235" "wcs_service_onlineresource"	"http://127.0.0.1/cgi-bin/mapserv.exe?" "wcs_enable_request"	"*"
END
END

PROJECTION
"init=epsg:3978"
END



LAYER



(continues on next page)



(continued from previous page)
NAME METADATA
"wcs_label"	"Elevation/Bathymetry"	### required
"wcs_rangeset_name"	"Range 1"	### required to support DescribeCoverage request
"wcs_rangeset_label"	"My Label" ### required to support DescribeCoverage request
END
TYPE RASTER ### required
STATUS ON
DATA bath_mapserver.tif
PROJECTION
"init=epsg:3978"
END
END
END # Map File

Output Formats
The raster formats supported by MapServer WCS are determined by the wcs_formats metadata item on the LAYER. This should contain a space separated list of OUTPUTFORMAT driver names separated by spaces. If absent, all raster OUTPUTFORMATs are allowed.
WCS is a "raw data" oriented format. So it often most suitable to use it with format using the BYTE, INT16 and FLOAT32 IMAGEMODEs with GDAL related output formats rather than the built in "rendering oriented" output formats. By default the only GDAL format driver defined is the GTiff driver. The following are example output format declarations utilizing the raw image modes:

The FORMATOPTION FILENAME defines the preferred name of the result file when returned WCS GetCoverage results.

Test Your WCS 1.0 Server Validate the Capabilities Metadata
OK, now that we've got a mapfile, we have to check the XML capabilities returned by our server to make sure nothing is missing.



Using a web browser, access your server's online resource URL to which you add the parameters "SER- VICE=WCS&VERSION=1.0.0&REQUEST=GetCapabilities" to the end, e.g.



If you get an error message in the XML output then take necessary actions. Common problems and solutions are listed in the FAQ at the end of this document.
If everything went well, you should have a complete XML capabilities document. Search it for the word "WARN- ING"... MapServer inserts XML comments starting with "<!-WARNING: " in the XML output if it detects missing mapfile parameters or metadata items.
Note that when a request happens, it is passed through WMS, WFS, and WCS in MapServer (in that order) until one of the services respond to it.
Here is a working example of a GetCapabilities request:
WCS GetCapabilities live example

Test With a DescribeCoverage Request
OK, now that we know that our server can produce a valid XML GetCapabilities response we should test the De- scribeCoverage request. The DescribeCoverage request lists more information about specific coverage offerings.
Using a web browser, access your server's online resource URL to which you add the parameters "SER- VICE=WCS&VERSION=1.0.0&REQUEST=DescribeCoverage&COVERAGE=layername" to the end, e.g.

Here is a working example of a DescribeCoverage request:
WCS DescribeCoverage live example

Test With a GetCoverage Request
The GetCoverage request allows for the retrieval of coverages in a specified output format to the client. The following is a list of the required GetCoverage parameters according to the WCS spec:
VERSION=version: Request version
REQUEST=GetCoverage: Request name
COVERAGE=coverage_name: Name of an available coverage, as stated in the GetCapabilities
CRS=epsg_code: Coordinate Reference System in which the request is expressed.
BBOX=minx,miny,maxx,maxy: Bounding box corners (lower left, upper right) in CRS units. One of BBOX or TIME is required.
TIME=time1,time2: Request a subset corresponding to a time. One of BBOX or TIME is required..



WIDTH=output_width: Width in pixels of map picture. One of WIDTH/HEIGHT or RESX/Y is re- quired.
HEIGHT=output_height: Height in pixels of map picture. One of WIDTH/HEIGHT or RESX/Y is required.
RESX=x: When requesting a georectified grid coverage, this requests a subset with a specific spatial resolution. One of WIDTH/HEIGHT or RESX/Y is required.
RESY=y: When requesting a georectified grid coverage, this requests a subset with a specific spatial resolution. One of WIDTH/HEIGHT or RESX/Y is required.
FORMAT=output_format: Output format of map, as stated in the DescribeCoverage response.
The following are optional GetCoverage parameters according to the WCS spec:
RESPONSE_CRS=epsg_code: Coordinate Reference System in which to express coverage responses.
So to follow our above examples, a valid DescribeCoverage request would look like:

Here is a working example of a GetCoverage request (note that a 350KB tif is being requested, so this may take a second):
WCS GetCoverage live example

WCS 1.1.0+ Issues
WCS 1.1.0 and later versions of the WCS protocol are supported by MapServer 5.2. For the most part the map file setup for WCS 1.1.0 is similar to WCS 1.0.0, but the actual protocol is substantially changed.

GetCapabilities
The GetCapabilities request is the same as WCS 1.0 but with a different VERSION value:

The format of the returned capabilities document is substantially altered from WCS 1.0, and makes use of OWS Com- mon for service descriptions.

DescribeCoverage
The DescribeCoverage request is similar to WCS 1.0, but the IDENTIFIERS keyword is used instead of COVERAGE to name the coverage(s) being requested:


GetCoverage
The format for GetCoverage is substantially changed from 1.0. The following is a list of GetCoverage required param- eters:
VERSION=version: Request version
REQUEST=GetCoverage: Request name



IDENTIFIER=coverage_name: Name of an available coverage, as stated in the GetCapabilities
BOUNDINGBOX=minx,miny,maxx,maxy,crs: Bounding box corners (lower left, upper right), and the CRS they are in. The CRS is described using a URN.
FORMAT=output_format: Output format (mime type) of grid product, as stated in the GetCapabilities.
If an alternate spatial resolution is desired, then the following set of keywords must be used to specify the sample origin and step size of the output grid to be produced. The produced grid will be of a number of pixels and lines as can be fit in the BOUNDINGBOX starting at GridOrigin, at GridOffsets resolution.
GRIDBASECRS=crs: The grid base CRS (URN).
GRIDCS=crs: The grid CRS (URN).
GridType=urn:ogc:def:method:WCS:1.1:2dGridIn2dCrs: This is the only supported value for MapServer.
GridOrigin=x_origin,y_origin: The sample point for the top left pixel.
GridOffsets=xstep,ystep: The x and y step size for grid sampling (resolution). Both are positive.
As well, the following optional parameters are available.
RangeSubset=selection: Selects a range subset, and interpolation method. Currently only subsetting on bands are allowed. Depending on rangeset names, this might take the form "BandsName[bands[1]]" to select band 1, or "BandsName:bilinear[bands[1]]" to select band 1 with bilinear interpolation.
So a simple GetCoverage might look like:

A more complex request might look like:

It should also be noted that return results from WCS 1.1 GetCoverage requests are in multi-part mime format. Typically this consists of a first part with an xml document referencing the other parts of the message, and an image file part. However, for output formats that return multiple files, each will be a separate part. For instance, this means it is possible to return a jpeg file with a world file, the OUTPUTFORMAT is appropriately configured.

URNs
In WCS 1.1 protocol coordinate systems are referenced by URN. Some typical URNs are:

The first two are roughly equivalent to EPSG:4326, and EPSG:27700 while the third is a CRS defined by OGC (es- sentially WGS84). One critical thing to note is that WCS 1.1 follows EPSG defined axis/tuple ordering for geographic coordinate systems. This means that coordinates reported, or provided in urn:ogc:def:EPSG::4326 (WGS84) are ac- tually handled as lat, long, not long,lat. So, for instance the BOUNDINGBOX for an area in California might look like:





And, likewise the bounds reported by GetCapabilities, and DescribeCoverage will be in this ordering as appropriate.

WCS 2.0
Overview
Version 6.0 introduces support for the new version 2.0 of the WCS specification. This section documents the usage of the new WCS version.

Web Coverage Service (WCS) 2.0 Interface Standard
This specification adopts the new OGC Core and Extension model and at the moment the following documents are available from the OGC'c WCS Standard page:
• GML 3.2.1 Application Schema Coverages
• WCS 2.0 Specification - Core
• WCS 2.0 Specification - KVP Protocol Binding Extension
• WCS 2.0 Specification - XML/POST Protocol Binding Extension
• WCS 2.0 Specification - Interpolation Extension
• WCS 2.0 Specification - Range Subsetting Extension
• WCS 2.0 Specification - GeoTIFF Coverage Encoding Profile
• WCS 2.0 Specification - CRS Extension
• WCS 2.0 Specification - Scaling Extension
Technical changes from WCS version 1.1.2 include entirely building on the GML 3.2.1 Application Schema Coverages and adoption of OWS Common 2.0. Another major change is the introduction of trim and slice concepts which is explained in more detail below.
There are WCS 2.0 Schemas defined against which all requests and responses should validate.

WCS 2.0 KVP request parameters
The following KVP request parameters are available in WCS 2.0:
COVERAGEID=id: This parameter is technically the same as the COVERAGE parameter for WCS
1.0 or the IDENTIFIER parameter for WCS 1.1. In DescribeCoverage requests, multiple IDs can be requested by concatenating them with commas.
SUBSET=axis[,crs](low,high): This parameter subsets the coverage on the given axis. This parameter can be given multiple times, but only once for each axis. The optional sub-parameter crs can either be an EPSG definition (like EPSG:4326), an URN or an URI or 'imageCRS' (which is the default). All crs sub- parameters from all SUBSET parameters must be equal. (e.g: you cannot subset one axis in imageCRS and another in EPSG:4326).







SUBSETTINGCRS=crs: This parameter defines the crs subsetting all SUBSETs are expressed in, and also the output CRS if no OUTPUTCRS is specified. By default all subsets are interpreted to be relative to the coverages CRS.
OUTPUTCRS=crs: This parameter defines in which crs the output image should be expressed in.
MEDIATYPE=mediatype: This parameter is relevant to GetCoverage requests, when multipart XML/image output is desired. It should be set to 'multipart/related' (which is currently the only possible value for this parameter).
SCALEFACTOR=factor: With this parameter (a positive float) the size of the output image can be ad- justed. All axes are scaled equally.
SCALEAXES=axis(value)[,axis(value)]: With this parameter, an axis specific scaling can be applied. Any axis not mentioned
SCALESIZE=axis(size)[,axis(size)]: This is similar to the SCALEAXES parameter, but allows an axis specific setting of the absolute pixel size of the returned coverage.
SCALEEXTENT=axis(min:max)[,axis(min:max)]: This parameter is treated like a SCALESIZE pa- rameter with "axis(max-min)".
INTERPOLATION=interpolation_method: This defines the interpolation method used, for rescaled images. Possible values are "NEAREST", "BILINEAR" and "AVERAGE".
RANGESUBSET=band1[,band2[,. . . ]]: With this parameter, a selection of bands can be made. Also the bands can be reordered. The bands can be referred to either by name (which can be retrieved using the DescribeCoverage request) or by index (starting with '1' for the first band). Also a range of bands can be given: bandX:bandY. This also includes the lower and upper bounds. As the name implies, the lower bound must reference the band with the lower index. You can mix direct references to the bands with intervals. E.g: RANGESUBSET=band1,band3:band:5,band7
The following parameters are part of the WCS 2.0 Specification - GeoTIFF Coverage Encoding Profile and are only available for the GeoTIFF outputformat:
GEOTIFF:COMPRESSION=compression: The compression method used for the returned image. Valid options are: None, PackBits, Deflate, Huffman, LZW and JPEG.
GEOTIFF:JPEG_QUALITY=1-100: When the compression method JPEG is chosen, this value defines the quality of the algorithm.
GEOTIFF:PREDICTOR=None|Horizontal|FloatingPoint: The predictor value for the LZW and De- flate compression methods.
GEOTIFF:INTERLEAVE=Band|Pixel: Defines whether the image shall be band or pixel interleaved.
GEOTIFF:TILING=true|false: Defines if the output image shall be internally tiled.
GEOTIFF:TILEWIDTH=tilewidth, GEOTIFF:TILEHEIGHT=tileheight: Define the size of the in- ternal tiles. Must be positive integer divisible by 16.
The following request parameters are not part of the WCS 2.0 Core or any extension thereof, and are kept for backward compatibility. They originate from a time where the most vital standard extensions were not specified and the WCS core was not quite useful without. They are deprecated.



SIZE=axis(value): This parameter sets the size of the desired axis to the desired value (pixels).
RESOLUTION=axis(value): This parameter sets the resolution of the desired axis to the desired value (pixels/unit).


Unchanged KVP parameters
The following parameters have not (or just slightly) changed since the last version of the WCS standard.
VERSION=version: For WCS 2.0, this should be set to '2.0.1'. This
parameter is deprecated for GetCapabilities related to OGC Web Services Common Standard 2.0.0.
SERVICE=service REQUEST=request ACCEPTVERSIONS=versions SECTIONS=sections
UPDATESEQUENCE=updatesequence ACCEPTFORMATS=formats: This parameter is currently ignored.
ACCEPTLANGUAGES=languages: This is used for language negotiation for multi-lingual services
FORMAT=format: The desired format can now also be set with the name of the outputformat object defined in the mapfile. In contrast to previous versions of WCS this parameter is optional when the native format is either specified or can be determined via GDAL.
MAP=mapfile

KVP request examples
The below sample request outline the new KVP request syntax:
















(continues on next page)



(continued from previous page)
Please refer to the WCS 2.0 tests in msautotest for further sample requests.

Changes to previous versions
The layer name must be a valid NCName, i.e: must not start with a number and can only contain alphanumerical characters. This constraint derives of the gml:id property which has to be a NCName, that relates to the coverage ID which is itself taken from the layers name.

Specifying coverage specific metadata
For WCS enabled layers in MapServer, there are different possibilities for declaring coverage metadata for WCS 2.0. In the simplest case, all of the required metadata can be retrieved from the source image.
For some reason this may not be desirable, maybe because the source image does not provide these metadata. Not every input image format has geospatial metadata attached. In this case, the layer metadata can be used to provide this information.
The convention is that once (wcs|ows)_extent and one of (wcs|ows)_size and (wcs|ows)_resolution is set in the layer metadata, all the coverage specific metadata will be retrieved from there. Otherwise the source image is queried via GDAL, if possible.
The relevant layer metadata fields are (wcs|ows)_bandcount, (wcs|ows)_imagemode, (wcs|ows)_native_format, and all
New band related metadata entries.

New band related metadata entries
In this section new WCS 2.0 specific layer metadata entries are discussed.
The following layer metadata fields can be used to return a more detailed description for the range type of a "virtual dataset" coverage. A coverage is considered as a "virtual dataset" if the (wcs|ows)_extent metadata entry and one of the (wcs|ows)_size or (wcs|ows)_resolution metadata entries are set.
First of all, the used version of metadata has to be identified. To identify the bands of a coverage, the following field must be present:
• (wcs|ows)_band_names
The type of these fields is a space delimited list of names, whereas the count of the names has to match the "bandcount" metadata field. These names are then used as a prefix for other metadata fields only concerning this band. The possible metadata keys are the following:
• {band_name}_band_interpretation
• {band_name}_band_uom
• {band_name}_band_definition
• {band_name}_band_description



• {band_name}_interval
All values are interpreted as strings, only "interval" is interpreted as 2 double precision float values separated with a space.
Also default values can be configured for every key. These have the same suffix as the band specific keys but start with (wcs|ows) instead of the bands name:
• (wcs|ows)_band_interpretation
• (wcs|ows)_band_uom
• (wcs|ows)_band_definition
• (wcs|ows)_band_description
• (wcs|ows)_interval
If no specific or default value is given, the output is dependent on the metadata key. The UOM, for example will be set to 'W.m-2.Sr-1', interval and significant figures will be determined according to the image type and definition, description, and interpretation will not be visible in the output at all.
This example demonstrates the use of the band-specific metadata fields with their default values:

The above example would result in having BandA a more specific description, and BandB and BandC having the default description. It would also be possible to only use some of the specific values for BandA and others from the default.
If no default and specific values are given for the interval or significant figures metadata field, the a default is generated from the "imagemode" field, which itself defaults to FLOAT32.
The new metadata fields also contain the (wcs|ows)_nilvalues and (wcs|ows)_nilvalues_reasons
• (wcs|ows)_nilvalues
With this field, specific nilvalues can be set. The values have to be delimited by a space.



• (wcs|ows)_nilvalues_reasons
This field defines the reasons for the specific nilvalues. The reasons are also space delimited and reference the nilvalue with the same index. The values for the reasons should be URIs or URNs.
The following example demonstrates the use of both metadata fields:


HTTP-POST support
Since version 6.0 MapServer also supports HTTP-POST XML requests. All requests possible via HTTP GET can also be sent via POST. POST requests are possible for WCS 1.1 or WCS 2.0 which adhere to the according standard.
This is an example GetCapabilities request:

This is an example DescribeCoverage request, which is only valid for WCS 2.0:









(continues on next page)



(continued from previous page)
This example demonstrates the usage of a WCS 2.0 POST-XML GetCoverage request:
<?xml version="1.0" encoding="UTF-8"?>
<wcs:GetCoverage xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation="http://www.opengis.net/wcs/2.0
  http://schemas.opengis.net/wcs/2.0/wcsAll.xsd" xmlns="http://www.opengis.net/wcs/2.0" xmlns:wcs="http://www.opengis.net/wcs/2.0" xmlns:wcscrs="http://www.opengis.net/wcs/crs/1.0" xmlns:scal="http://www.opengis.net/wcs/scaling/1.0" xmlns:int="http://www.opengis.net/wcs/interpolation/1.0" service="WCS"
version="2.0.1">
<wcs:CoverageId>SOME_ID</wcs:CoverageId>
<wcs:DimensionTrim>
<wcs:Dimension>x</wcs:Dimension>
<wcs:TrimLow>16.5</wcs:TrimLow>
<wcs:TrimHigh>17.25</wcs:TrimHigh>
</wcs:DimensionTrim>
<wcs:DimensionTrim>
<wcs:Dimension>y</wcs:Dimension>
<wcs:TrimLow>47.9</wcs:TrimLow>
</wcs:DimensionTrim>
<wcs:format>image/tiff</wcs:format>
<wcs:mediaType>multipart/related</wcs:mediaType>
<wcs:Extension>
<wcscrs:subsettingCrs>http://www.opengis.net/def/crs/EPSG/0/4326</
??wcscrs:subsettingCrs>
<wcscrs:outputCrs>http://www.opengis.net/def/crs/EPSG/0/32611</wcscrs:outputCrs>
<scal:ScaleToSize>
<scal:TargetAxisSize>
<scal:axis>x</scal:axis>
<scal:targetSize>50</scal:targetSize>
</scal:TargetAxisSize>
<scal:TargetAxisSize>
<scal:axis>y</scal:axis>
<scal:targetSize>50</scal:targetSize>
</scal:TargetAxisSize>
</scal:ScaleToSize>
<int:Interpolation>
<int:globalInterpolation>NEAREST</int:globalInterpolation>
</int:Interpolation>
</wcs:Extension>
</wcs:GetCoverage>

These are some other scaling options:



<wcs:GetCoverage xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation="http://www.opengis.net/wcs/2.0
  http://schemas.opengis.net/wcs/2.0/wcsAll.xsd" xmlns="http://www.opengis.net/wcs/2.0" xmlns:wcs="http://www.opengis.net/wcs/2.0" xmlns:scal="http://www.opengis.net/wcs/scaling/1.0"  service="WCS"
version="2.0.1">
<!-- ... -->
<wcs:Extension>
<scal:ScaleByFactor>
<scal:scaleFactor>1.5</scal:scaleFactor>
</scal:ScaleByFactor>

<!-- or -->

<scal:ScaleAxesByFactor>
<scal:ScaleAxis>
<scal:axis>x</scal:axis>
<scal:scaleFactor>1.5</scal:scaleFactor>
</scal:ScaleAxis>
<scal:ScaleAxis>
<scal:axis>y</scal:axis>
<scal:scaleFactor>2.0</scal:scaleFactor>
</scal:ScaleAxis>
</scal:ScaleAxesByFactor>

<!-- or -->

<scal:ScaleToExtent>
<scal:TargetAxisExtent>
<scal:axis>x</scal:axis>
<scal:low>10</scal:low>
<scal:high>20</scal:high>
</scal:TargetAxisExtent>
<scal:TargetAxisExtent>
<scal:axis>y</scal:axis>
<scal:low>20</scal:low>
<scal:high>30</scal:high>
</scal:TargetAxisExtent>
</scal:ScaleToExtent>
</wcs:Extension>
</wcs:GetCoverage>

GeoTIFF parameters are used as follows:





(continues on next page)



(continued from previous page)
Please refer to the WCS 2.0 Specification - XML/POST Protocol Binding Extension and the WCS 2.0 Schemas for further information on POST request in WCS 2.0.

INSPIRE download service support
Since version 7.2, MapServer WCS 2.0 also supports the the INSPIRE download service. To enable this functionality, the wcs_inspire_capabilities setting must be set to either url or embed.
Please refer to the INSPIRE Download Service documentation for further metadata options.

Multi-language support
Part of the INSPIRE download service support is the support for multi-lingual WCS services. With the wcs_languages a (comma-separated) list of language specifiers can be set. When this is set, client and server can negotiate the result language using the ACCEPTLANGUAGES parameter (or the <ows:AcceptLanguages>/<ows:Language> tags when using XML). The first item in the accept languages list contained in the list specified with wcs_languages will be used for the resulting capabilities document
Additional information can be found in the section for Multi-language support for certain capabilities fields.

Reference Section
To avoid confusion only "wcs_*" and "ows_*" prefixed metadata entries are evaluated in OGC WCS services. Previous versions used "wms_*" prefixed entries as fallback which is dropped in version 6.0 in favor of forcing explicit decisions. The module will look for the "wcs_*" and "ows_*" metadata prefixes in this order.
The following metadata are available in the setup of the mapfile:

Web Object Metadata
ows_allowed_ip_list (or wcs_allowed_ip_list)
• Description: (Optional) A list of IP addresses that will be allowed access to the service. Example:





ows_denied_ip_list (or wcs_denied_ip_list)
• Description: (Optional) A list of IP addresses that will be denied access to the service. Example:

wcs_abstract
• Description: (Optional) A brief description of the service, maps to ows:Abstract (WCS 1.1+ only).
wcs_accessconstraints
• Description: (Optional) A list of codes describing any access constraints imposed by the service provider. The keyword NONE is reserved to mean no access constraints are imposed.
wcs_address,	wcs_city,	wcs_contactelectronicmailaddress,	wcs_contactfacimiletelephone, wcs_contactorganization, wcs_contactperson, wcs_contactposition, wcs_contactvoicetelephone, wcs_country, wcs_postcode, wcs_stateorprovince
• Description: (Optional) Contact address information. If provided then all twelve metadata items are required. You can also use the responsibleparty metadata instead.
wcs_band_names
• Description: (WCS 2.0) Space separated list of band names. See New band related metadata entries
wcs_description
• Description: (Optional) A description of the server.
wcs_enable_request (or ows_enable_request)
• Description: Space separated list of requests to enable. The default is none. The following requests can be en- abled: GetCapabilities, GetCoverage and DescribeCoverage. A "!" in front of a request will disable the request. "*" enables all requests.
• Examples:
To enable only GetCapabilities and GetCoverage:

To enable all requests except GetCapabilities

wcs_fees
• Description: (Optional) A text string indicating any fees imposed by the service provider.
wcs_keywords
• Description: (Optional) Short words for catalog searching.
wcs_label



• Description: (Required) A human-readable label for the server.
wcs_metadatalink_format
• Description: (Optional) The file format MIME type of the metadata record (e.g. "text/plain"). The web metadata wcs_metadatalink_type and wcs_metadatalink_href must also be specified.
• To output several metadata links, use wcs_metadatalink_list
wcs_metadatalink_href
• Description: (Optional) The URL to the server's metadata. The web metadata wcs_metadatalink_format and wcs_metadatalink_type must also be specified.
• To output several metadata links, use wcs_metadatalink_list
wcs_metadatalink_list
Added in version 8.0.
• Description: (Optional) Space-separated list of parts of metadata keys, to be able to specify several metadata links.  If the value of wcs_metadatalink_list is "foo bar", then wcs_metadatalink_foo_href,
wcs_metadatalink_foo_format,	wcs_metadatalink_foo_type,	wcs_metadatalink_bar_href, wcs_metadatalink_bar_format, wcs_metadatalink_bar_type will be queried with the semantics of the wcs_metadatalink_href, wcs_metadatalink_format and wcs_metadatalink_type items.
Example:

wcs_metadatalink_type
• Description: (Optional) The standard to which the metadata complies. Currently only two types are valid: "TC211" which refers to [ISO 19115], and "FGDC" which refers to [FGDC-STD-001-1988]. The web metadata wcs_metadatalink_format and wcs_metadatalink_href must also be specified.
• To output several metadata links, use wcs_metadatalink_list
wcs_name
• Description: (Optional) A name for the server.
wcs_responsibleparty_address_administrativearea,			wcs_responsibleparty_address_city, wcs_responsibleparty_address_country,	wcs_responsibleparty_address_deliverypoint, wcs_responsibleparty_address_electronicmailaddress,		wcs_responsibleparty_address_postalcode, wcs_responsibleparty_individualname, wcs_responsibleparty_onlineresource, wcs_responsibleparty_organizationname, wcs_responsibleparty_phone_facsimile, wcs_responsibleparty_phone_voice, wcs_responsibleparty_postionname
• Description: (Optional) Contact address information. If provided then all twelve metadata items are required. You can also use the address* metadata instead.
wcs_service_onlineresource
• Description: (Optional) Top-level onlineresource URL. MapServer uses the onlineresource metadata (if pro- vided) in the following order:



1. wcs_service_onlineresource
2. ows_service_onlineresource
3. wcs_onlineresource (or automatically generated URL, see the onlineresource section of this document)
wcs_languages
• Description: (Optional) A comma-separated list of supported languages. For details please refer to the section
Multi-language support for certain capabilities fields in the INSPIRE Download Service documentation.

Layer Object Metadata
ows_allowed_ip_list
Same as ows_allowed_ip_list in the Web Object.
ows_denied_ip_list
Same as ows_denied_ip_list in the Web Object.
wcs_abstract
• Description: (Optional) A brief description of the service, maps to ows:Abstract (WCS 1.1+ only).
wcs_description
• Description: (Optional) A description of the layer.
wcs_enable_request (or ows_enable_request)
• Description: Space separated list of requests to enable. The default is none. The following requests can be en- abled: GetCapabilities, GetCoverage and DescribeCoverage. A "!" in front of a request will disable the request. "*" enables all requests.
• Examples:
To enable only GetCapabilities and GetCoverage:

To enable all requests except GetCapabilities

wcs_extent
• Description: (Optional) Bounding box of layer, which must be provided for tiled data. Comma-delimited, in the format of: minx,miny,maxx,maxy
wcs_formats
• Description: (Optional) The formats which may be requested for this layer, separated by a space. (e.g. "GTiff MrSID")
wcs_keywords
• Description: (Optional) Short words for catalog searching.
wcs_label
• Description: (Required) A human-readable label for the layer.
wcs_metadatalink_format
• Description: (Optional) The file format MIME type of the metadata record (e.g. "text/plain"). The web metadata wcs_metadatalink_type and wcs_metadatalink_href must also be specified.



wcs_metadatalink_href
• Description: (Optional) The URL to the layer's metadata. The web metadata wcs_metadatalink_format and wcs_metadatalink_type must also be specified.
wcs_metadatalink_type
• Description: (Optional) The standard to which the metadata complies. Currently only two types are valid: "TC211" which refers to [ISO 19115], and "FGDC" which refers to [FGDC-STD-001-1988]. The web metadata wcs_metadatalink_format and wcs_metadatalink_href must also be specified.
wcs_name
• Description: (Optional) A name for the layer.
wcs_nativeformat
• Description: (Optional) The current format of the served raster layer. (e.g. "GTiff") (used for WCS 1.0)
wcs_native_format
• Description: (Optional) The mime-type of the current format of the served raster layer (e.g. "image/tiff"). This field is used when coverage metadata is provided by the layer metadata only (when wcs_extent and wcs_size/wcs_resolution are set). When set, WCS 2.0 GetCoverage requests will use this format when no other
format is specified (the format parameter is optional then).
wcs_outputformat_{OUTPUTFORMATNAME}_creationoption_{OPTIONNAME}
• Description: (Optional) (added in MapServer 7.2.0) To provide creation options in a (GDAL) output format specific and layer specific way. {OUTPUTFORMATNAME} should be substituted by the user with the OUT- PUTFORMAT.NAME value of an output format allowed for the layer. And {OPTIONNAME} by a valid GDAL
creation option valid for the OUTPUTFORMAT.DRIVER.
The purpose of this metadata item is to provide creation options that depend on the layer, typically to configure some metadata in the resulting raster file that depends on that layer (for non-layer dependent configuration options, OUTPUTFORMAT.FORMATOPTION should rather be used).
For GDAL drivers that support band-specific creation output (at time of writing, only the GRIB  driver  in  GDAL  2.3.0),  with  a  BAND_{bandnumber}_{OPTIONNAME}  syntax  for the  GDAL  creation  option,  it  is  also  possible  to  use  a  MapServer  metadata  item  named
wcs_outputformat_{OUTPUTFORMATNAME}_creationoption_BAND_{bandnumber}_{OPTIONNAME}.   bandnumber will be automatically adjusted when passed to GDAL so that the WCS band subsetting is properly taken into account. You can consult WCS GRIB output in msautotest as a practical example of how to configure GRIB2 WCS output (requires GDAL 2.3.0)
wcs_outputformat_{OUTPUTFORMATNAME}_mdi_{DOMAIN}_{KEY}
• Description: (Optional) (added in MapServer 8.0.0) To provide metadata item (mdi) options in a GDAL output format specific and layer specific way. {OUTPUTFORMATNAME} should be substituted by the user with the OUTPUTFORMAT.NAME value of an output format allowed for the layer. {DOMAIN} is the name of a GDAL
metadata domain. In general, you should use "default" for the default metadata domain. And {KEY} is the key of the GDAL metadata item.
The purpose of this metadata item is to provide GDAL metadata that depend on the layer, typically to configure some metadata in the resulting raster file that depends on that layer.
For	GDAL		drivers		that	support		band-specific	metadata	(e.g	GeoTIFF, netCDF),		it	is		also	possible		to	use		a	MapServer	metadata	item		named wcs_outputformat_{OUTPUTFORMATNAME}_mdi_BAND_{bandnumber}_{DOMAIN}_{KEY}. bandnumber will be automatically adjusted when passed to GDAL so that the WCS band subsetting is properly taken into account.
netCDF output is a typical use case. For dataset level metadata, the key must be prefix with NC_GLOBAL#


Example:

For Band metadata:

NETCDF_VARNAME is a special key name recognized by the GDAL netCDF driver to determine the variable name. All other keys are mapped to a netCDF attribute belonging to the corresponding variable.
In the special case of the DATA of the layer being a netCDF dataset and the output of the WCS request too, and no manual wcs_outputformat_netCDF_mdi_* item is defined, then MapServer will automatically forward metadata from the input dataset to the output file.
For netCDF output, if the input dataset has multiple bands, it is possible to generate a 3D dataset with the extra dimension being typically time or Z.
For each band, the MapServer metadata item wcs_outputformat_{OUTPUTFORMATNAME}_mdi_BAND_{bandnumber}_d
must be defined, where DIMNAME is the name of the extra dimension (e.g. "time")
In addition to that, netCDF attributes can be defined on the extra dimension by setting metadata items of the form
wcs_outputformat_{OUTPUTFORMATNAME}_mdi_default_{DIMNAME}#{ATTRNAME}
where {ATTRNAME} is substituted with the name of the attribute to set on the extra dimension (e.g. "stan- dard_name", "units", etc.)
Example:

In the special case of the DATA of the layer being a netCDF 3D dataset and the output of the WCS request is netCDF too, and no manual wcs_outputformat_netCDF_mdi_* item is defined, then MapServer will automati- cally forward metadata from the input dataset to the output file to generate a netCDF 3D dataset.
Axes Descriptions (WCS 1.x only)
MapServer allows you define a number of these for a layer. Individual axis are identified by name when defining specific metadata (e.g. description). All defined axes must be listed in the rangeset_axes metadata tag so MapServer knows in advance what to expect. A special rangeset for multiband date is automatically generated by adding the name "bands" to the rangeset_axes list. If found MapServer will automatically generate metadata for the image bands. You may of course extend that basic support using the naming conventions below.
wcs_rangeset_axes



• Description: (Optional) Delimited list of defined range sets. If defined, you can also use the following nine metadata items, where rangeset axis matches the axis name provided in this wcs_rangeset_axes metadata: (WCS 1.x only)
{rangeset axis}_semantic
{rangeset axis}_refsys
{rangeset axis}_refsyslabel
{rangeset axis}_description
{rangeset axis}_label
{rangeset axis}_values
{rangeset axis}_values_semantic
{rangeset axis}_values_type
         {rangeset axis}_interval wcs_rangeset_description
• Description: (Optional, for DescribeCoverage request) Rangeset description (WCS 1.0 only)
wcs_rangeset_label
• Description: (Required, for DescribeCoverage request) Rangeset label (WCS 1.x only)
wcs_rangeset_name
• Description: (Required, for DescribeCoverage request) Rangeset name (WCS 1.x only)
wcs_rangeset_nullvalue
• Description: (Optional, for DescribeCoverage request) Rangeset single null value (WCS 1.x only)
wcs_srs
• Description: (Optional) Spatial reference system of the layer, in the form of: EPSG:code (e.g. EPSG:3978)
wcs_timeitem
• Description: (Optional) The attribute in the spatio/temporal index that contains time values.
wcs_timeposition
• Description: (Optional) A list of the start and end time of a given coverage (i.e. "2000-11-11T11:11:11Z,2001- 11-11T11:11:11Z"), used when advertising GetCapabilities.

Layer Metadata API
If wcs_metadatalink_href is not defined, MapServer will provide a link to the Layer Metadata API for the given layer. See the Layer Metadata API documentation for more information.

Rules for handling SRS in a MapServer WCS
TODO!

Spatio/Temporal Indexes
MapServer has long supported a method of breaking a dataset into smaller, more manageable pieces or tiles. In this case a shapefile is used to store the boundary of each tile, and an attribute holds the location of the actual data. Within a MapServer mapfile the layer keywords TILEINDEX and TILEITEM are used to activate tiling.



Consider the example where an organization wants to serve hundreds or even thousands of MODIS scenes. Five images cover the spatial extent and each group of five varies by date of acquisition. This turns out to be a fairly common scenario for organizations interested in WCS, one that the existing tiling support does not adequately address. In previous versions of MapServer a developer would have to create one tile index and one layer definition for each group of five images. This could result in configuration files that are prohibitively long and difficult to manage.
In order to more efficiently support the WCS specification a new tiling scheme has been implemented within MapServer. One that supports spatial sub-setting, but also ad hoc sub-setting based on any attributes found within tile index. In many cases a temporal attribute could be used, but sub-setting is not limited to that case. The new scheme introduces the concept of tile index layers, that is, a separate layer definition is used to describe the tile index dataset. With this we get all the benefits of any MapServer layer, most importantly we can apply MapServer filters to the data. Filters can be defined at runtime using MapServer CGI, MapScript or via the WCS server interface. The syntax for the layer using the index remains unchanged except that the value for Tile Indexes refers to the index layer instead of an external shapefile.
So, looking at the example above again we can reduce our MapServer configuration to two layer definitions, one for the tile index and one for the imagery itself. Extracting a single dates worth of imagery is now a matter of setting the appropriate filter within the tile index layer.

Building Spatio-Temporal Tile Indexes
Developing these tile indexes is more difficult than basic indexes simply because there are no ready-made tools to do so. Fortunately we can leverage existing tool available within MapServer or supporting libraries such as GDAL by post processing their output.
Taking the above example, building an index is relatively simple task if you are willing to roll up your sleeves and write a bit of code. First, the basic spatial index needs to be built. The GDAL utility gdaltindex already does this. Simply point gdaltindex at the directory containing the collection of MODIS images and it will build a shapefile index suitable for use with MapServer. The next step would be to add the temporal information. The pseudo code would look something like:
• open the index .dbf file for reading
• create a new column to hold the image acquisition date
• for each image; 1) extract the image acquisition date and 2) insert it into the new column
• close the index .dbf file
This general approach could be used for many cases. A scripting language such as Perl, PHP or Python works well since they all have readily available modules for manipulating .dbf files. A worst case would involve hand editing the resulting .dbf file using a desktop tool such as Mircosoft Access or ESRI Arcview.

WCS 2.0 Application Profile - Earth Observation (EO-WCS)
OGC is currently discussing the adoption of an Earth Observation (EO) Application Profile for WCS 2.0 (EO-WCS) (see public RFC on EO-WCS). For an implementation please refer to the Open Source project EOxServer which already implements this proposed EO-WCS based on MapServer.

To-do Items and Known Limitations
• MapServer does not derive all of the metadata it could from a given dataset. For example, you must explicitly list time periods covered by a layer. This should get better with time.
• Only spatial, simple temporal and radiometric band subsetting is possible with the current implementation. Fu- ture enhancements should allow for arbitrary subsets based on pixel values or tile/image attributes.
• The available set of WCS 2.0 specification documents is not yet complete. Thus, for some implementation details, the content of some forthcoming extensions had to be anticipated based on the approaches taken for WCS 1.1 and 1.0. The implementation will be adjusted as soon as new specification documents become available.



• If you want to use libxml2 or its derived tools (like xmllint) for validation be aware that there is a currently bug in libxml2 that breaks the validation of GML 3.2.1.

Credits
Support for per-layer creation options has been funded by Meteorological Service of Canada.

10.1.18 WCS Use Cases
Author
Norman Barker
Contact
nbarker at ittvis.com
Author
Gail Millin
Contact
nbarker at ittvis.com
Last Updated
2024-02-28

This document explains how to use MapServer to deliver Landsat, SPOT, DEM, and NetCDF temporal/banded data through the MapServer WCS interface. Thanks go to Steve Lime and Frank Warmerdam for their assistance with these projects
It also shows how to configure MapServer for GRIB2 output format.

Landsat
To serve Landsat imagery through the MapServer Web Coverage Service specify the OUTPUTFORMAT object. For format support install the GDAL library and from the command prompt and cd to where GDAL is installed and use the command, gdalinfo -formats. A list of all supported formats will appear and will specify if the format is read only
<ro> or read and write <rw> for WCS the format needs to be supported for read and write (except for GDAL's own WCS format, however).
For the example below the Landsat 7 15m resolution mosaic is in a Enhanced Compressed Wavelets format (ECW). By running the gdalinfo.exe program I could verify that the ECW format has write permissions, therefore the format can be specified in the MapFile and requested using the GetCoverage request.


(continues on next page)



(continued from previous page)

A GetCoverage request can then be requested (using the parameters set in the MapFile) by creating a URL with the elements: - Your Server, MapServer Program, Location of MapFile, Type of Service (WCS), Request (GetCoverage), Coverage (Landsat7), BBOX (0,0,700005,1050000), CRS (EPSG:27700), ResX (75) ResY (75), Format (ECW).

SPOT
SPOT imagery can be delivered through MapServer Web Coverage Service similarly to the Landsat example above. The main difference is that as SPOT is a greyscale image the wcs_bandcount = 1 rather than a Landsat image which consists of 3 bands. For this example the well known GeoTiff format will be used to demonstrate what to specify in a MapFile for SPOT data.















(continues on next page)



(continued from previous page)
The key parameters to specify in the WCS MapFile for any data layer and format are:

The following examples further demonstrate how WCS can be implemented and also how to create WCS containing layers with a temporal dimension (see NetCDF example).

DEM
It is possible to deliver 16 bit DEM data through the MapServer Web Coverage Service. Firstly it is necessary to specify the output format in the map file
and the corresponding layer















(continues on next page)



(continued from previous page)
Performance gains can be made by using the gdaladdo utility described at https://gdal.org/programs/gdaladdo.html

NetCDF
Firstly GDAL doesn't support all versions of netCDF (there are a lot, it is a generic format), so for stability it may be necessary to convert the files into GeoTiff format first. This can be achieved using the netCDF libraries here https:
//www.unidata.ucar.edu/software/netcdf/. Denis Nadeau and Frank Warmerdam have added netCDF CF as a read only format within GDAL, so it now possible to read the CF convention netCDF files directly from disk.
We placed the Z-levels in the bands of the GDAL data file (either GeoTiff or netCDF), and created a shape index for the time levels. GDAL data is a 2-D format (x,y) and bands. netCDF is an N-D file format, supporting time, x,y,z, and experiment parameters. By using a set of GDAL netCDF / geoTiff files it is possible to represent this, and to store the z-level (height) as bands within the data file. Although a hack, it is possible for a custom client to receive important metadata from the describeCoverage operation of a WCS about the which z-level a band of a geotiff represents by encoding this in the returned axes description tag.
To create the shape file for the temporal dimension we had to do some hacking with Java code, but we also got it to work with Steve Lime' s perl script in the MODIS MapServer demo download (which doesn't seem to be available now).
The perl script used in Modis demo by Steve Lime is as follows, and I have placed inline comments below. The script assumes that gdaltindex has already been run in this directory to create a tile index shape and dbf file. It assumes that the filenames of your data files have the date in the filename, for example myfileYYYYMMDDHH.tif

1

2

3

4

5


6

7

8

9

10

11

12

13

14

15


16


17


18


19

20
(continues on next page)



(continued from previous page)
21

22

23

24


25

26

27


28

29

30

31

32

33

34

35


If have used the perl script then skip to the layer definitions below, if you wish to code your own the description is here.
The DBF file has to have the column 'location' that indicates the location of the data file (either absolute path or relative to the map file location, and the second column that can be called whatever you want but indexes time. In our case we called it 'time' :-)
The corresponding shapefile then has to contain Polygons with the bounding boxes of the tif file for each time. So OGRInfo timeIndex.shp looks something like:

Define your output format as

Then you need to define your tile index within the map file

and the actual layer





The TempData coverage layer will now let you subset with the &bands=. . . &time=. . . subset parameters! To do a coordinate reprojection specify in the request &Response_CRS=ESPG:xxxx
When you start doing temporal subsetting with WCS and MapServer you can see the need for an automatic way of generating map files such as using an XSL stylesheet!
For a tile-index layer you need to provide the following extra metadata in order to use it for WCS:

If your image has a colortable and only one band, it will come out greyscale unless you set the IMAGEMODE to PC256 instead of BYTE.

GRIB2 output format
This requires MapServer 7.2.0 for format-specific and layer-specific creation options mechanism, as well as GDAL
2.3.0 for GRIB2 output support.
Define your output format as





(continues on next page)



(continued from previous page)
(consult GDAL GRIB driver documentation for more options that can be provided in FORMATOPTION) and the actual layer
LAYER
NAME
TYPE raster STATUS ON DUMP TRUE
DATA "temperatures.tif"

PROJECTION
"init=epsg:4326"
END

METADATA
"ows_extent" "-180 -90 180 90" "wcs_label" "Test label" "ows_srs"	"EPSG:4326" "wcs_resolution" "2.4 2.4"
"wcs_bandcount" "1" "wcs_imagemode" "Float32"
"wcs_formats" "GEOTIFF_FLOAT32 GRIB" "wcs_description" "Test description"
"wcs_metadatalink_href" "http://www.gdal.org/metadata_test_link.html" "wcs_keywordlist" "test,mapserver"
"wcs_abstract" "abstract"

# GDAL creation options for the GRIB output format
# In the case where the input DATAset would be a GRIB2 product, # those wcs_outputformat_GRIB_creationoption_* keywords are not # needed, as being directly taken from the input dataset
"wcs_outputformat_GRIB_creationoption_DISCIPLINE" "0(Meteorological)" "wcs_outputformat_GRIB_creationoption_IDS" "Normally this will never be used?
??given the BAND_1_IDS override" "wcs_outputformat_GRIB_creationoption_BAND_1_IDS" "CENTER=54(Montreal)?
??SUBCENTER=0 MASTER_TABLE=4 LOCAL_TABLE=0 SIGNF_REF_TIME=1(Start_of_Forecast) REF_
??TIME=2017-01-05T00:00:00Z PROD_STATUS=0(Operational) TYPE=2(Analysis_and_forecast)" "wcs_outputformat_GRIB_creationoption_PDS_PDTN" "0"
"wcs_outputformat_GRIB_creationoption_PDS_TEMPLATE_ASSEMBLED_VALUES" "0 0 2 47?
??47 0 0 1 0 103 0 2 255 -127 -2147483647"

# WCS 2.0 metadata items "wcs_native_format" "application/x-grib2" "wcs_band_names" "Temperature_2m"
"Temperature_2m_band_interpretation" "interp" "Temperature_2m_band_uom" "Celsius"
"Temperature_2m_band_definition"	"Temperature at 2m above ground"
(continues on next page)



(continued from previous page)
(consult	GDAL	GRIB	driver	documentation	for	more	options	that	can	be	provided	in 'wcs_outputformat_GRIB_creationoption_{OPTIONNAME}')
Credit: Support for per-layer creation options has been funded by Meteorological Service of Canada.

10.1.19 SOS Server
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2021-03-27


Introduction
SOS (Sensor Observation Service), currently an OGC discussion paper, is part of of the OGC's SensorWeb Enablement (SWE) group of specifications. These specifications describe how applications and services will be able to access sensors of all types over the Web. Specifically, SOS provides an API for managing deployed sensors and retrieving sensor data.
SOS support is available in MapServer 4.10.0 or more recent. Note that no client tools currently exist in MapServer for SOS; you can try QGIS desktop and its plugins, or try using a JavaScript library such as OpenLayers as a client.
SOS support was implemented in MapServer to the guidelines of MapServer rfc13. This document assumes that you are already familiar with certain aspects of MapServer:



• MapServer application development and setting up .map files.

Links to SOS-Related Information
• SOS specification documents
• OGC's Sensor Web Enablement working group

Relevant Definitions
The following is taken from the SOS 1.0.0 specification:
Observation
An observation is an event with a result which has a value describing some phenomenon.
Observation Offering
An observation offering is a logical grouping of observations offered by a service that are related in some way.
Observed Value
A value describing a natural phenomenon, which may use one of a variety of scales including nominal, ordinal, ratio and interval.
Sensor
An entity capable of observing a phenomenon and returning an observed value. A sensor can be an instrument or a living organism (e.g. a person).

Setting Up an SOS Server Using MapServer Install the Required Software
SOS requests are handled by the "mapserv" CGI program. The first step is to check that your mapserv exe- cutable includes SOS support. One way to verify this is to use the "-v" command-line switch and look for "SUP- PORTS=SOS_SERVER".
Example 1. On Unix:

Example 2. On Windows:







If you don't have SOS support in your MapServer build, then you must compile MapServer with the following in mind:
• flag -DUSE_SOS_SVR is required
• requires either -DUSE_WMS_SVR or -DUSE_WFS_SVR flags to be enabled
• requires libxml2 and proj libraries
• requires ICONV support (-DUSE_ICONV ) on Windows
For more help with MapServer compilation see the appropriate HowTo: Unix / Windows

Configure a Mapfile For SOS
Each instance of SOS server that you setup needs to have its own mapfile. It is just a regular MapServer mapfile in which some parameters and some metadata entries are mandatory. Most of the metadata is required in order to produce a valid GetCapabilities output.
Here is the list of parameters and metadata items that usually optional with MapServer, but are required (or strongly recommended) for a SOS configuration:
MAP level:
• Map NAME
• Map PROJECTION
• Map Metadata (in the WEB Object):
- sos_title
- sos_onlineresource
- sos_srs
- sos_enable_request
- see the Reference Section of this document for a full list of metadata and descriptions
LAYER level:
• Layer NAME
• Layer PROJECTION
• Layer METADATA
- sos_offering_id
- sos_observedproperty_id
- sos_observedproperty_id
- sos_describesensor_url
- see the Reference Section of this document for a full list of metadata and descriptions



Onlineresource URL
The sos_onlineresource metadata is set in the map's web object metadata and specifies the URL that should be used to access your server. This is required for the GetCapabilities output. If sos_onlineresource is not provided then MapServer will try to provide a default one using the script name and hostname, but you shouldn't count on that too much. It is strongly recommended that you provide the sos_onlineresource metadata.
Here is a valid online resource URL:

By creating a wrapper script on the server it is possible to hide the "map=" parameter from the URL and then your server's online resource URL could be something like:

This is covered in more detail in the "More About the Online Resource URL" section of the WMS Server document.


Example SOS Server Mapfile
The following is an example of a bare minimum SOS Server mapfile. Note the comments for the required parameters.


























(continues on next page)



(continued from previous page)

Test Your SOS Server GetCapabilities Request
The GetCapabilities request allows the clients to retrieve service metadata about a specific service instance. For an SOS service, it allows to identify such things as offerings and observed property available, as well as information on sensors that are used.
Using a web browser, access your server's online resource URL to which you add the parameters "SER- VICE=SOS&REQUEST=GetCapabilities" to the end, e.g.

If everything went well, you should have a complete XML capabilities document. Search it for the word "WARN- ING"... MapServer inserts XML comments starting with "<!-WARNING: " in the XML output if it detects missing mapfile parameters or metadata items. If you notice any warning in your XML output then you have to fix all of them before you can try your server with an SOS client, otherwise things are likely not going to work.




GetObservation Request
The GetObservation request is designed to query sensor systems to retrieve observation data in the form defined in the Observation and Measurement specification (O&M), and more information on this O&M spec can be found at https://www.ogc.org/standards/om. Upon receiving a GetObservation request, a SOS shall either satisfy the request or return an exception report.
The following is a list of the possible parameters for a GetObservation request:
request: (Required) value must be "GetObservation".
service: (Required) value must be "SOS".
version: (Required) value must be "1.0.0".
offering: (Required) The Offering identified in the capabilities document.
observedProperty: (Required) The property identified in the
capabilities document.
responseFormat: (Required) The format / encoding to be returned
by the response.
eventTime (Optional) Specifies the time period for which
observations are requested.
procedure: (Optional) The procedure specifies the sensor system
used. In this implementation, the procedure is equivalent to be the sensor id that will be used when doing a DescribeSensor request.
featureOfInterest: (Optional) In this implementation, this will
be represented by a gml envelope defining the lower and upper corners.
Result: (Optional) The Result parameter provides a place to put
OGC filter expressions based on property values.
resultModel: (Optional) Identifier of the result model to be
used for the requested data. The resultModel values supported by a SOS server are listed in the contents section of the service metadata (GetCapabilities). MapServer currently supports om:Observation and om:Measurement. om:Measurement provides a flat model of the geometry and attributes, similar to WFS GetFeature output. om:Observations provides a more compact definition which includes an XML header of the field names and definitions, followed by a "DataBlock" of delimited records (default is CSV delimited output). The default output is om:Measurement.
srsName: (Optional) srs (EPSG code) of the output response.
Here are some valid examples: Example 1:
Example 2:





(continues on next page)



(continued from previous page)
Example 3:

Example 4:


DescribeSensor Request
The DescribeSensor request gives the client the ability to retrieve the characteristics of a particular sensor and return the information in a SensorML xml document. In this implementation, MapServer does not generate the SensorML document but only redirect the request to an existing SensorML document.
The following is a list of the possible parameters for a DescribeSensor request:
request: (Required) value must be "DescribeSensor"
service: (Required) value must be "SOS".
version: (Required) value must be "1.0.0".
procedure: (Required) This is the sensor id, which was specified
in the "sos_procedure" metadata.
outputFormat: (Required) The format encoding to be returned by
           the response.
Here is a valid example:


Limitations / TODO
1. Have MapServer generate the SensorML document, instead of redirecting the request to an existing SensorML document.



Reference Section
The following metadata are available in the setup of the SOS Server mapfile:


Web Object Metadata
ows_allowed_ip_list (or sos_allowed_ip_list)
• Description: (Optional) A list of IP addresses that will be allowed access to the service. Example:

ows_denied_ip_list (or sos_denied_ip_list)
• Description: (Optional) A list of IP addresses that will be denied access to the service. Example:

ows_language
• Description: (Optional) Descriptive narrative for more information about the server. Identifier of the language used by all included exception text values. These language identifiers shall be as specified in IETF RFC 1766.
When this attribute is omitted, the language used is not identified. Examples: "en-CA", "fr-CA", "en-US". Default is "en-US".
ows_schemas_location
• Description: (Optional) (Note the name ows_schemas_location and not sos/_. . . this is because all OGC Web Services (OWS) use the same metadata) Root of the web tree where the family of OGC SOS XMLSchema files
are located. This must be a valid URL where the actual .xsd files are located if you want your SOS output to validate in a validating XML parser. Default is http://schemas.opengis.net/sos/.
ows_updatesequence
• Description: (Optional) The updateSequence parameter can be used for maintaining the consistency of a client cache of the contents of a service metadata document. The parameter value can be an integer, a timestamp in [ISO 8601:2000] format, or any other number or string.
sos_abstract
• Description: (Optional) Descriptive narrative for more information about the server.
sos_accessconstraints



• Description: (Optional) Text describing any access constraints imposed by the service provider on the SOS or data retrieved from this service.
sos_addresstype, sos_address, sos_city, sos_country, sos_postcode, sos_stateorprovince
• Description: Optional contact address information. If provided then all six metadata items are required.
sos_contactelectronicmailaddress
• Description: Optional contact Email address.
sos_contactfacsimiletelephone
• Description: Optional contact facsimile telephone number.
sos_contactinstructions
• Description: (Optional) Supplemental instructions on how or when to contact the individual or organization.
sos_contactorganization, sos_contactperson, sos_contactposition
• Description: Optional contact information. If provided then all three metadata items are required.
sos_contactvoicetelephone
• Description: Optional contact voice telephone number.
sos_enable_request (or ows_enable_request)
• Description: Space separated list of requests to enable. The default is none. The following requests can be enabled: GetCapabilities, GetObservation and DescribeSensor. A "!" in front of a request will disable the request. "*" enables all requests.
• Examples:
To enable only GetCapabilities and GetObservation:

To enable all requests except GetCapabilities

sos_encoding_blockSeparator
• Description: (Optional) For GetObservation requests using resultModel=om:Observation (SWE DataBlock en- coding). Record separator to be used. Default is '\n'
sos_encoding_tokenSeparator
• Description: (Optional) For GetObservation requests using resultModel=om:Observation (SWE DataBlock en- coding). Token (field) separator to be used. Default is ','
sos_fees
• Description: (Optional) Fees information. Use the reserved word "none" if there are no fees.
sos_hoursofservice
• Description: (Optional) Time period (including time zone) when individuals can contact the organization or individual.
sos_keywordlist
• Description: (Optional) A comma-separated list of keywords or keyword phrases to help catalog searching.
sos_maxfeatures



• Description: (Optional) The number of elements to be returned by the SOS server. If the not set all observations are returned
sos_onlineresource
• Description: (Required) The URL that will be used to access this OGC server. This value is used in the GetCa- pabilities response.
• See the section "Onlineresource URL" above for more information.
sos_role
• Description: (Optional) Function performed by the responsible party. Possible values of this Role shall include the values and the meanings listed in Subclause B.5.5 of ISO 19115:2003.
sos_service_onlineresource
• Description: (Optional) Top-level onlineresource URL.
sos_srs
• Description: (Required) Contains a list of EPSG projection codes that should be advertized as being available for all layers in this server. The value can contain one or more EPSG:<code> pairs separated by spaces (e.g. "EPSG:4269 EPSG:4326") This value should be upper case (EPSG:3978.  not epsg:3978) to avoid problems
with case sensitive platforms.
sos_title
• Description: (Recommended) A human-readable name for this Layer.

Layer Object Metadata
ows_allowed_ip_list
Same as ows_allowed_ip_list in the Web Object.
ows_denied_ip_list
Same as ows_denied_ip_list in the Web Object.
sos_describesensor_url
• Description: (Required) This metadata item is only a temporary measure until the describe sensor is generated from MapServer. Right now when a DescribeSensor request is sent with a procedure (sensorid), it will redirect it to the url defined by this metadata item.
• In MapServer 5.0, it is possible to use variable substitution on the url. For example "sos_describesensor_url" "http://foo/foo?mysensor=%procedure%"will substitute the %procedure% in the metadata with the procedure value coming from the request.

sos_enable_request (or ows_enable_request)
• Description: Space separated list of requests to enable. The default is none. The following requests can be enabled: GetCapabilities, GetObservation and DescribeSensor. A "!" in front of a request will disable the request. "*" enables all requests.
• Examples:
To enable only GetCapabilities and GetObservation:

To enable all requests except GetCapabilities





sos_[item name]_alias
• Description: (Optional) An alias for an attribute's name that will be returned when executing a GetObservation request.
sos_[item name]_definition
• Description: (Optional) An associated definition (usually a URN) for a component, that will be returned when executing a GetObservation request. Default is "urn:ogc:object:definition"
sos_[item name]_uom
• Description: (Optional) An associated unit of measure URN) for a component, that will be returned when exe- cuting a GetObservation request. Default is "urn:ogc:object:uom"
sos_observedproperty_authority
• Description: (Optional) An associated authority for a given component of an observed property
sos_observedproperty_id
• Description: (Required) ID of observed property, possibly in number format.
sos_observedproperty_name
• Description: (Optional) Name of observed property, possibly in string format.
sos_observedproperty_version
• Description: (Optional) An associated version for a given component of an observed property
sos_offering_description
• Description: (Optional) Description of offering.
sos_offering_extent
• Description: (Optional) Spatial extents of offering, in minx, miny, maxx, maxy format:

The logic for the bounding box returned as part of the offering is the following:
- note that it is a mandatory element that needs an espg code and lower/upper corner coordinates
- looks for the espg parameter in the first layer of the offering (this could be an ows/sos_srs or a projection object with the epsg code (mandatory)
- looks for sos_offering_extent. If the metadata is not available, the extents of all layers in the offering will be used to compute it.
Here is an example result from a GetCapabilities request:

sos_offering_id
• Description: (Required) ID of offering, possibly in number format.



sos_offering_intendedapplication
• Description: (Optional) The intended category of use for this offering.
sos_offering_name
• Description: (Optional) Name of offering, possibly in string format.
sos_offering_timeextent
• Description: (Optional) Time extent of offering, in the format of "begin/end". Here is an example:

If end is not specified it will be set to now. Here is an example result from a GetCapabilities request:

sos_procedure
• Description: (Required) Normally a sensor unique id. One per layer:



All sos_procedure links from layers in the offerings will be outputed together, such as the following taken from a GetCapabilities response:

sos_procedure_item
• Description: (Required if sos_procedure is not present): See section 5 for more details

sos_timeitem
• Description: (Optional) Name of the time field. It will be used for queries when a GetObservation request is called with an EVENTTIME parameter. It is layer specific and should be set on all layers.




Layer Metadata API
If sos_metadataurl_href is not defined, MapServer will provide a link to the Layer Metadata API for the given layer. See the Layer Metadata API documentation for more information.

Use of sos_procedure and sos_procedure_item
In MapServer 5.0 SOS support has been upgraded to use a new metadata called sos_procedure_item. The value for sos_procedure_item is the field/attribute name containing the procedure values. The use of this metadata as well as the sos_procedure is described here per type of request (refer to https://github.com/MapServer/MapServer/issues/2050 for more description):
It should be noted that, for very large datasets defined only with sos_procedure_item, this may result in costly process- ing, because MapServer has to process attribute data. It is advised to setup and manage datasets accordingly if dealing with large observation collections.

GetCapabilities
• if sos_procedure is defined, use it
• if not look for sos_procedure_item : procedure values are extracted from the layer's attribute specified by this metadata. Not that this can be time consuming for layers with a large number of features.
• if none is defined return an exception

DescribeSensor
• if sos_procedure is defined, use it
• if not look for sos_procedure_item : procedure values are extracted from the layer's attribute specified by this metadata
• if none is defined return an exception

GetObservation
Both sos_procedure and sos_procedure_item can be define. Here are the cases:
• case 1
[only sos_procedure is defined.]
- Use this metadata to match the layer with the procedure value sent in the request
- When outputting the <member/procedure> output the value of the metadata

• case 2: only procedure_item is defined.
- Use the sos_procedure_item and do a query on the layer to match the procedure with the layer.
- When outputting the <member/procedure> use the procedure_item as a way to only output the attribute value corresponding to the feature.
• case 3: both are defined.



- check in sos_procedure to match the procedure with the layer.
- When outputting the <member/procedure> use the procedure_item as a way to only output the attribute value corresponding to the feature.

10.1.20 MapScript Wrappers for WxS Services
Author
Frank Warmerdam
Contact
warmerdam at pobox.com


Introduction
With the implementation of MapServer rfc16 in MapServer 4.9, MapScript now has the ability to invoke MapServer's ability to execute OGC Web Service requests such as WMS, WCS, and WFS as well as capturing the results of pro- cessing the requests.
This makes it possible to dynamically configure a map object based on information in the original request, and to capture the output of processing requests for further post-processing.

WarningMapServer CGI Controls and Run-time Substitution are not applied when using mapscript WxS wrappers. It is up to the mapscript code you are writing to apply any mapfile modifications.
Python Examples
The following trivial example, in Python, demonstrates a script that internally provides the map name, but otherwise uses normal MapServer processing.






(continues on next page)



(continued from previous page)
The OWSRequest object is used to manage a parsed list of OWS processing options. In the above example they are loaded from the environment using the loadParams() call which fetches and parses them from QUERY_STRING in the same way the mapserv executable would.
Then we load a map, and invoke OWSDispatch with the given arguments on that map. By default the results of the dispatched request are written to stdout which returns them back to the client.
The following example ignores all passed in arguments, and manually constructs a request argument by argument. It is likely more useful for testing purposes than for deploying WxS services, but demonstrates direct manipulation of the request object.

The previous example have all let results be returned directly to the client. But in some cases we want to be able to capture, and perhaps modify the results of our requests in some custom way. In the following example we force the hated OGC required mime type for errors to simple text/xml (warning - non-standard!)

This example demonstrates capture capturing output of OWSRequest to a buffer, capturing the "Content-type:" header value, and capturing the actual content as binary data. The msIO_getStdoutBufferBytes() function returns the stdout buffer as a byte array. If the result was known to be text, the msIO_getStdoutBufferString() function could have been used to fetch it as a string instead, for easier text manipulation.



Perl Example
Most of the same capabilities are accessible in all SWIG based mapscript languages. In perl, we could script creation of a request like this:

One issue in Perl is that there is currently no wrapping for binary buffers so you cannot call msIO_getStdoutBufferBytes(), and so cannot manipulate binary results.

More Perl example code

#!/usr/bin/perl ############################################################################  #
# Name:	wxs.pl
# Project:	MapServer
# Purpose:	MapScript WxS example #
# Author:	Tom Kralidis #
##############################################################################  #
# Copyright (c) 2007, Tom Kralidis #
# Permission is hereby granted, free of charge, to any person obtaining a
# copy of this software and associated documentation files (the "Software"), # to deal in the Software without restriction, including without limitation # the rights to use, copy, modify, merge, publish, distribute, sublicense,
# and/or sell copies of the Software, and to permit persons to whom the # Software is furnished to do so, subject to the following conditions: #
# The above copyright notice and this permission notice shall be included in # all copies of this Software or works derived from this Software.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
# OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, # FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
# THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
(continues on next page)



(continued from previous page)
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING # FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
# DEALINGS IN THE SOFTWARE. ############################################################################/

use CGI::Carp qw(fatalsToBrowser);
use mapscript; use strict; use warnings;
use XML::LibXSLT; use XML::LibXML;
my $dispatch;

# uber-trivial XSLT document, as a file
my $xsltfile = "/tmp/foo.xslt";

# here's the actual document inline for
# testing save and alter $xsltFile above

=comment
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:wfs="http://www.opengis.net/wfs">
<xsl:output method="xml" indent="yes"/>
<xsl:template match="/">
<WFSLayers>
<xsl:for-each  select="//wfs:FeatureType">
<wfs_layer>
<name><xsl:value-of select="wfs:Name"/></name>
<title><xsl:value-of select="wfs:Title"/></title>
</wfs_layer>
</xsl:for-each>
</WFSLayers>
</xsl:template>
</xsl:stylesheet>
=cut

my $mapfile	= "/tmp/config.map";
# init OWSRequest object
my $req = new mapscript::OWSRequest();

# pick up CGI parameters passed
$req->loadParams();

# init mapfile
my  $map = new  mapscript::mapObj($mapfile);

# if this is a WFS GetCapabilities request, then intercept # what is normally returned, process with an XSLT document # and then return that to the client
(continues on next page)



(continued from previous page)
if ($req->getValueByName('REQUEST') eq "GetCapabilities" && $req->getValueByName('SERVICE
??') eq "WFS") {

# push STDOUT to a buffer and run the incoming request
my  $io  =  mapscript::msIO_installStdoutToBuffer();
$dispatch = $map->OWSDispatch($req);
# at this point, the client's request is sent # pull out the HTTP headers
my $ct = mapscript::msIO_stripStdoutBufferContentType();

# and then pick up the actual content of the response
my  $content  =  mapscript::msIO_getStdoutBufferString();

my $xml	= XML::LibXML->new(); my $xslt = XML::LibXSLT->new();

# load XML content
my  $source  =  $xml->parse_string($content);

# load XSLT document
my  $style_doc  =  $xml->parse_file($xsltfile);
my $stylesheet = $xslt->parse_stylesheet($style_doc);

# invoke the XSLT transformation
my $results = $stylesheet->transform($source); # print out the result (header + content) print "Content-type: $ct\n\n";
print $stylesheet->output_string($results);
}

# else process as normal
else {
$dispatch = $map->OWSDispatch($req);
}

Java Example
One benefit of redirection of output to a buffer is that it is thread-safe. Several threads in the same process can be actively processing requests and writing their results to distinct output buffers. This Java example, used to test multi-threaded access demonstrates that.










(continues on next page)



(continued from previous page)
public void run() {
mapObj map = new mapObj(mapName);
map.setMetaData( "ows_onlineresource", "http://dummy.org/" ); OWSRequest req = new OWSRequest();
req.setParameter( "SERVICE", "WMS" ); req.setParameter( "VERSION", "1.1.0" ); req.setParameter( "REQUEST", "GetCapabilities" );

mapscript.msIO_installStdoutToBuffer();
int owsResult = map.OWSDispatch( req );

if( owsResult != 0 )
System.out.println( "OWSDispatch Result (expect 0): " + owsResult );

resultBytes = mapscript.msIO_getStdoutBufferBytes();
}
}

public class WxSTest {
public static void main(String[] args)	{
try {
WxSTest_thread tt[] = new WxSTest_thread[100];
int i;
int expectedLength=0, success = 0, failure=0;
for( i = 0; i < tt.length; i++ )
{
tt[i] = new WxSTest_thread(); tt[i].mapName = args[0];
}

for( i = 0; i < tt.length; i++ ) tt[i].start();

for( i = 0; i < tt.length; i++ )
{
tt[i].join();
if( i == 0 )
{
expectedLength  =  tt[i].resultBytes.length;
System.out.println( "Document Length: " + expectedLength + ",?
??expecting somewhere around 10000 or more." );
}
else if( expectedLength != tt[i].resultBytes.length )
{
System.out.println( "Document Length:" + tt[i].resultBytes.length + "?
??Expected:" + expectedLength );
failure++;
(continues on next page)



(continued from previous page)

PHP Example
Most of the same capabilities are accessible in php mapscript. Here is an example displaying a wms capabilities.



































(continues on next page)



(continued from previous page)

Use in Non-CGI Environments (mod_php, etc)
The loadParams() call establish parses the cgi environment varabiables (QUERY_STRING, and RE- QUEST_METHOD) into parameters in the OWSRequest object. In non-cgi environments, such as when php, python and perl are used as "loaded modules" in Apache, or Java with Tomcat, the loadParams() call will not work - in fact in 4.10.x it will terminate the web server instance.
It is necessary in these circumstances for the calling script/application to parse the request url into keyword/value pairs and assign to the OWSRequest object by other means, as shown in some of the above examples explicitly setting the request parameters.

Post Processing Capabilities
In the following python example, we process any incoming WxS request, but if it is a GetCapabilities request we replace the Service section in the capabilities with a section read from a file, that is carefully tailored the way we want.




(continues on next page)



(continued from previous page)


CHAPTER
ELEVEN



BASEMAPS


11.1 Basemaps
Author
Thomas Bonfort
Contact
tbonfort at terriscope.fr
Author
Yves Jacolin
Contact
yjacolin at free.fr
Author
Nicolas Ribot
Basemaps project is a mapfile for MapServer in order to generate maps from OpenStreetMaps data in different styles like Google, Bing or using custom style.

11.1.1 Installation
Author
Yves Jacolin
Contact
yjacolin at free.fr

Table of Contents• Installation
- Data
* Database creation
* Imposm Installation
* Data Import
- Project configuration
* Project deployment
* Custom configuration



Basemaps needs: * data * project configuration This section explains how to set up both of them.
Data
Data comes from an OpenStreetMap database and are stored in a PostgreSQL database.

Database creation

This will create a new database called osm, add the postgis extension, create a www-data role with right in the public schema.

Imposm Installation
OpenStreetMap data are processed by imposm. This is a fast and easy step.
Check the Installation process from https://imposm.org/docs/imposm/latest/install.html or see the steps below:

We have now a virtual python env with imposm. Each time you need to use it, run source venv/bin/activate (see below the next steps to use it in our use case).

Data Import
Source: https://imposm.org/docs/imposm/latest/tutorial.html#writing











(continues on next page)



(continued from previous page)
Let's explain this better: First we download 2 pbf files from Geofabrik OpenStreetMap data. PBF is a space-efficient binary format used for OpenStreetMap data. pwd and ls -1 commands are just there to show you where we are and what we get.
The source command activates the Python virtual environment in order to use imposm.
The next two commands (read) are similar and preprocesses PBF data. The difference is that the second one merges cached data to push both French region into the database.
Then we write (push) data into the database using the French National projection EPSG code (EPSG:2154). You can use whatever that's fit your needs.
The last commands optimize the data and give some rights to www-data. Some data are missing, you can get there:
• Get the following layer : https://github.com/datadesk/osm-la-streets/tree/master/la-streets/layers/processed_p and putt hem in basemaps/data/
• Get the following layer land_polygon (Projection: Mercator) https://osmdata.openstreetmap.de/download/ land-polygons-complete-3857.zip also in basemaps/data/
• Get	the	following	layer	simplified_land_polygon	https://osmdata.openstreetmap.de/download/ land-polygons-split-3857.zip also in basemaps/data/

Project configuration
The Basemaps project source code is located here: https://github.com/MapServer/basemaps.

Project deployment

That's easy enough to not need much explanation.

Custom configuration
Create your own custom makefile and give it a name (whatever your want):




You can add all custom values from the main Makefile, here are some examples:

Here we customize the SRID of the data (see above when we imported data into the database) and the database con- nection.

Build the mapfile

You should have now a working mapfile.

Apache configuration
Create an Apache configuration and enable it.

With such a content:

Finally enable this Apache virtual conf:

And test the GetCapabilities URL: http://localhost/osm-default?SERVICE=WMS&VERSION=1.3.0&REQUEST= GetCapabilities

11.1.2 Tweaking Map Styles
Author
Nicolas Ribot




This page contains information about the way to tweak map styles using the MapServer/basemaps project.
Prior to using this version of MapServer/basemaps, you have to import OSM map data into a postgis database using the imposm tool. See Installation to know how to set up easily your project.

Generating a mapfile
The mapfile called osm-_STYLE_.map is generated by executing the 'make' command based on the settings at the top of the Makefile.

Makefile
The following parameters are configurable at the top of the Makefile:
• OSM_PREFIX: the prefix of the table names in the postgis database
• OSM_SRID: EPSG code of the mapfile's output projection (common values are 4326 for lon,lat and 900913 for the Google Mercator projection)
• OSM_UNITS: MapServer units corresponding to the OSM_SRID (common values: DD or METERS)
• OSM_DB_CONNECTION : MapServer CONNECTION string to the OSM database
• OSM_EXTENT : Default extents to use in the generated mapfile (in the same coordinate system as OSM_SRID)
• STYLE: Name of the map style to generate. Three styles are available to choose from by default: default, google and bing

The generate_style.py script
The generate_style.py script contains the value of all configurable style parameters.
At the top of the file, the vars array defines the default values of all configurable parameters. Those values are used by the default style.
Then the style array that follows can be used to define custom styles. A custom style inherits the settings of the default style (from the vars array), and then all values set for that style in the styles array override default values. Several sample custom styles are provided as examples (see Supported Map Styles chapter)

Structure of parameters in generate_style.py
For each configurable style parameter, the value can either be a single value applicable to all map scales (map scales are defined at the top of the file), or an associative array of values where the key is the corresponding scale, and the value is the value applicable to this scale and all scales that follow up to the next entry in the array.
e.g.:





In this example, stream_clr and stream_font have values of "#B3C6D4" and "sc" respectively for all scales.

In this case stream_width has a value of 0 for scales 0 to 9, 0.5 for scales 10-11, 1 for scales 12-13, and 2 for scales 14 and up.

Supported map styles
The generate_styles.py file defines base styles in the styles object.
Final styles generated by the make command are defined in the styles_alias object, allowing to define a final style based on several base styles.
For instance, the google style is defined by the combination of default, outlined and google base styles.
The outlined style overloads default style to add custom outline around way and the google style overloads default for object colors.

base styles
The following base styles are defined in generate_styles.py:
• default: a map style with no road casing and few colors, suited for using as a basemap when overlaying other layers without risk of confusion between layers.
• outlined: a style adding outline around ways
• centerlined: a style adding center line for ways
• google: a style resembling the google-maps theme
• googleosm2pgsql: a style resembling the google-maps theme, but using data coming from an osm2pgsql schema rather than imposm
• bing: a style resembling the Bing-maps theme
• michelin: a style resembling the Michelin-maps theme
• grayscale: gray scale colors
• symbols: a style adding symbols and labels for amenities, transportation (metro, bus, tramway, carparks). PNG symbols are based on SVG OSM symbols
• labels_only: a style displaying only labels on a transparent background
• geoms_only: a style displaying only geometries, without any label or symbol
• symbols_only: a style displaying only symbols and labels, without geometries
• buildings: a style displaying buildings (OSM polygons with tag building=yes) at zoom level >= 15



sample final styles
Based on the defined base styles, the following styles are available when running make command to generate mapfiles (style alias name and base style combination are shown)
• default: default
• google: default,outlined,google
• googleosm2pgsql: default,outlined,google,osm2pgsql
• bing: default,outlined,bing
• michelin: default,outlined,centerlined,michelin
• default-symbols: default,symbols
• default-grayscale: default,outlined,grayscale
• google-buildings-symbols: default,outlined,google,symbols,buildings
• google-buildings-symbols-grayscale: default,outlined,google,symbols,buildings,grayscale
• bing-buildings-symbols: default,outlined,bing,symbols,buildings
• bing-buildings-symbols-grayscale:  default,outlined,bing,symbols,buildings,grayscale
• michelin-buildings-symbols: default,outlined,michelin,symbols,buildings
• michelin-buildings-symbols-grayscale:  default,outlined,michelin,symbols,buildings,grayscale
• google-no-labels: default,outlined,google,geoms_only,buildings
• google-no-labels-grayscale: default,outlined,google,geoms_only,buildings,grayscale
• google-labels-only: default,outlined,google,labels_only
• symbols-only: symbols,symbols_only

Google style
Colorfull Default Style basemaps

Colorfull Google Style basemaps




Black and white Google Style basemaps

Colorfull Bing Style basemaps




Colorfull Michelin Style basemaps


11.1.3 Features
• Service WMS
• Colored and Grey level maps
• Custom style
• World or specific extent data
• Standard or custom projections


CHAPTER
TWELVE



TINYOWS




12.1 TinyOWS
Author
Olivier Courtin



Fig. 1: in memory of Olivier Courtin



Requires





TinyOWS is a lightweight and fast implementation of the OGC WFS-T speci- fication. Web Feature Service (WFS) allows to query and to retrieve features. The transactional profile (WFS-T) allows then to insert, update or delete such features.
From a technical point of view WFS-T is a Web Service API in front of a spatial database. TinyOWS is deeply tied to PostgreSQL/PostGIS.
TinyOWS is safely used in quite big GIS infrastructures, for instance, to allow European farmers to report the locations and crops on their fields (and then to be paid by EEC accordingly).
TinyOWS strictly implements OGC standards and successfully passes all WFS OGC CITE tests (and even beta ones).
TinyOWS is part of the MapServer Suite, but provided as a distinct module (i.e you could use it in conjonction with MapServer and MapCache, or as a standalone app) But both MapServer and TinyOWS could use the same con- figuration file, if you want to (or native TinyOWS XML config file).

12.1.1 TinyOWS Installation

TinyOWS need following libraries/applications:
• LibXML2 (2.8 version or later)
• PostGIS (1.5.x version or later)
• PostgreSQL (with libpq headers)
• A working Web Server with cgi-bin support
• Fast-CGI is recommended



Installing from a stable source release
An example of a typical download, configure, make, make install:

Then copy the tinyows binary to your cgi-bin directory.

Installing the Current Trunk from GIT
To build from git, you must first install the autoconf utility, and git application .

Then copy the tinyows binary to your cgi-bin directory.

Installing from source on Windows (oldies so dunno if still up to date)
• From GIT with Visual C++ for Win32 (written by Alexander Bruy)


12.1.2 Configuring TinyOWS with an XML File
The simplest way to configure TinyOWS is with a single XML file called tinyows.xml.
The default path is /etc/tinyows.xml. You can also use TINYOWS_CONFIG_FILE environment variable to set your own path.

Configuration file simple Example
An example config.xml file is in the demo directory:






(continues on next page)



(continued from previous page)

Testing your config.xml file
Once you have a config.xml file related to your service, launch TinyOWS with the -check option to validate your configuration file, test your database connection, and list the layers to be used:


Structure of the config.xml file TinyOWS Element
TinyOWS is the root element. He is mandatory, and must contains some system information about the service itself. Some globals service options could also be switched on or off at this level.




At- tributeRe- quireDe- faultDescriptionon- line_resomand toryURL where the service is located, e.g: http://127.0.0.1/cgi-bin/tinyowsschema_mand
toryPath where TinyOWS schema dir is located e.g: /usr/local/tinyows/schema/logop-
tionalPath where TinyOWS logs input requests. e.g: /var/log/tinyows.log. This file must be
writable by the user that owns the TinyOWS process.log_levelop-
tional0Bit field value to indicate what to log: 1: ERROR, 2: EVENT, 4: HTTP QUERY, 8:
SQL. e.g: 15 to log all.de-
gree_precop-
tional6Indicate how many digits of decimal precision when coordinates are express in lati-
tude/longitude.me-
ter_precisop-
tional0Indicate how many digits of decimal precision to use when coordinates are projected (so
meter unit).dis-
play_bboxop-
tional1Flag to indicate if bounding box should be computed for WFS GML GetFeature output.
It's mandatory in WFS specification. But as it's time consuming it could be interesting to be able to deactivate it.esti-
mated_exop-
tional0Flag to indicate if TinyOWS should use estimated_extent (faster but slightly less accu-
rate).check_schop-
tional1Flag to indicate if input data must be checked against schema before to be executed.
Caution, schema validation is an important part of security. Disable this attribute at your peril.check_vaop-
tional1Flag to indicate if OGC SFS 1.1 geometry validation should be done prior to execute a
transaction.encod-	op-	UTF- Output encoding. Other values could be ISO-8859-1 for instance. No encoding conver-
ing	tional 8	sion is done on data; this attribute is declarative.ex-
pose_pkop-
tional0Flag to indicate if TinyOWS should expose PK in schema (and so require them in Trans-
action query).wfs_defaop-
tionaloString version to indicate WFS default version, 1.0.0 or 1.1.0 for instance.
Limits Element
Limits Element provides a maximum for the server output. It could help to prevent a denial of service attack, or an abnormally large user query, from crashing your server. This element is optional.
Limits attributes

At- tributeRe- quired?De- faultDescriptionfeaturesoptionalUse to set maximum number of features returned to WFS client, on GetFeature
requestgeob-
boxoptionalGeographic bounding bbox, used to indicate maximum extent:
East,West,North,South



PostgreSQL Connection
PostgreSQL connection element. This element is mandatory.

At- tributeRe- quired?De- faultDescriptionhostop- tionallocal- hostName (or IP) to PostgreSQL server (default is localhost)userop-
tionalPostgreSQL user to connect (default is the system user used to run the server)pass-
wordop-
tionalPostgreSQL password connectiondb-
nameop-
tionalPostGIS database (by default, same as the system user used to run the serverportop-
tional5432PostgreSQL port numberen-
cod- ingop-
tionalUTF-
8PostgreSQL DB encoding, as specified in http://www.postgresql.org/docs/9.0/static/
multibyte.html#CHARSET-TABLE

Metadata and Contact Elements
Used to provide information about the service itself. These two elements are mandatory.

Metadata attributes


AttributeRequired?DefaultDescriptionnamemandatoryWeb Service NametitlemandatoryWeb Service TitlekeywordsoptionalWeb Service Keywords list (comma separated list)feesoptionalWeb Service Feesaccess_constraintsoptionalWeb Service Access Constraints
Abstract Element
The Abstract element is an optional child element of Metadata. It is a place for a free-formatted text description of the service.

	MapServer Documentation, Release 8.6.0


Contact attributes


AttributeRequired?DefaultDescriptionnamemandatoryWeb Service Contact NamesitemandatoryWeb Service Contact URLemailmandatoryWeb Service Contact Emailindividual_nameoptionalWeb Service Contact Individual NamepositionoptionalWeb Service Contact PositionphoneoptionalWeb Service Contact PhonefaxoptionalWeb Service Contact Faxonline_resourceoptionalWeb Service Contact URL (e.g additional Metadatas)addressoptionalWeb Service Contact Postal AddresspostcodeoptionalWeb Service Contact PostcodecityoptionalWeb Service Contact Cityadministrative_areaoptionalWeb Service Contact Administrative AreacountryoptionalWeb Service Contact Countryhours_of_serviceoptionalWeb Service Contact Hours of Servicescontact_instructionsoptionalWeb Service Contact Instructions ||
Contact and Metadata example with only mandatory attributes:


Layer Element
Layer element is used to set all layers provided by the service. Although this element is technically optional, omitting it will cause no layer at all to be provided.

MapServer Documentation, Release 8.6.0



AttributeRe- quired?De- faultInher- its?Descriptionns_prefixmanda- toryYesLayer's Namespace Prefix used in WFSns_urimanda-
toryYesLayer's Namespace URI used in WFSnamemanda-
toryNoLayer's Nametitleop-
tionalNoLayer's Titleretriev-
ableop-
tionalfalseYesIf true, layer is retrievable on WFS GetFeature requestwritableop-
tionalfalseYesIf true, layer is editable with WFS Transaction requestschemaop-
tional'pub-
lic'YesPostgreSQL Schema name.tableop-
tionalNoPostgreSQL table name (default is to use layer's name).abstractop-
tionalNoAbstract textkeywordsop-
tionalYesKeywords (comma separated list)sridop-
tionalYesComma separated list of output SRIDgeobboxop-
tionalYesWGS-84 bbox of max extent: East,West,North,Southin-
clude_iteop-
tionalYesComma separated list of columns to retrieve (only)ex-
clude_iteop-
tionalYesComma separated list of columns to not retrievepkeyop-
tionalYesColumn name to use as a Primary Key, when there's no PostgreSQL one
(e.g useful to use with VIEW)

Nested Layers
Layer entities could be nested, properties in this case are inherited. A Layer without title is then considered as a 'virtual' layer.


(continues on next page)



(continued from previous page)

12.1.3 Configuring TinyOWS with a standard Mapfile
Mapfile Config File support for TinyOWS
TinyOWS supports as a configuration file a standard MapServer mapfile. This allow a single file to configure both MapServer and TinyOWS. (e.g could be useful if you use them both, as one for WMS and the other as WFS-T)
TinyOWS does not handle all of the parameters in a mapfile, but will ignore, without error, any extra parameters that are not implemented in TinyOWS.
If you prefer, you can configure TinyOWS using an XML file (Configuring TinyOWS with an XML File).
To indicate where your mapfile is located, to TinyOWS binary, use the ''TINYOWS_MAPFILE" environment variable. Here an example of a single mapfile:
MAP
NAME "TinyOWS"


WEB





END


METADATA




END



"tinyows_schema_dir" "/usr/local/share/tinyows/schema/" "tinyows_onlineresource" "127.0.0.1/cgi-bin/tinyows.fcgi" "wfs_title" "TinyOWS service provided by a mapFile" "wfs_contact" "foo@bar.net"



LAYER


NAME 'France'
CONNECTIONTYPE postgis
CONNECTION "host=127.0.0.1 user=postgres password=postgres dbname=tinyows_

??demo port=5432"
METADATA



'wfs_title' 'France' 'wfs_namespace_prefix' 'tows'
'wfs_namespace_uri' 'http://www.mapserver.org/tinyows/' 'wfs_srs' 'EPSG:27582'
'tinyows_table' 'france' 'tinyows_writable' '1'

(continues on next page)



(continued from previous page)
Current concepts and limitations:
• Only the PostGIS CONNECTIONTYPE is handled
• TinyOWS does not support all of the WFS parameters available in a mapfile. But on the other hand, you are able to configure every part of TinyOWS with a Mapfile.
• The CONNECTION string value in each layer must be the same.
• Mapfile PROJECTION content is not parsed, so use explicit wfs_srs.
• Mapfile LAYER and FILTER are not parsed.
• Default values are TinyOWS ones, even for common properties shared by both TinyOWS and MapServer.
• TinyOWS does not use DATA element from mapfile, so you have to use tinyows_table (and tinyows_schema if needed) in each layer.
• If DUMP is not set to TRUE on a layer, both read and write access are disabled for the layer.

Mapfile path of each TinyOWS config element

Original TinyOWS XML Config FileMapfile counterpart/tinyows@online_resource/map/metadata@tinyows_onlineresource/tinyows@schema_dir/map/metadata@tinyows_schema_dir/tinyows@log/map/metadata@tinyows_log/tinyows@log_level/map/metadata@tinyows_log_level/tinyows@degree_precision/map/metadata@tinyows_degree_precision/tinyows@meter_precision/map/metadata@tinyows_meter_precision/tinyows@display_bbox/map/metadata@tinyows_display_bbox/tinyows@estimated_extent/map/metadata@tinyows_estimated_extent/tinyows@check_schema/map/metadata@tinyows_check_schema/tinyows@check_valid_geom/map/metadata@tinyows_check_valid_geom/tinyows@encoding/map/metadata@wfs_encoding/tinyows@db_encoding/map/metadata@tinyows_db_encoding/tinyows@expose_pk/map/metadata@tinyows_expose_pk/tinyows/limits@features/map/metadata@wfs_maxfeatures/tinyows/limits@geobbox/map/metadata@tinyows_geobbox/tinyows/pg@host/map/layer@connection/tinyows/pg@user/map/layer@connection/tinyows/pg@password/map/layer@connection/tinyows/pg@dbname/map/layer@connection/tinyows/pg@port/map/layer@connection/tinyows/pg@encoding/map/metadata@tinyows_db_encoding/tinyows/metadata@name/map@name/tinyows/metadata@title/map/metadata@wfs_title/tinyows/metadata@keywords/map/metadata@wfs_keywordlist/tinyows/metadata/abstract/map/metadata@wfs_abstract/tinyows/metadata@fees/map/metadata@wfs_feescontinues on next page



Table 1 - continued from previous page
Original TinyOWS XML Config FileMapfile counterpart/tinyows/metadata@access_constraints/map/metadata@wfs_accessconstraints/tinyows/layer@ns_prefix/map/layer/metadata@wfs_namespace_prefix or
/map/metadata@wfs_namespace_prefix/tinyows/layer@ns_uri/map/layer/metadata@wfs_namespace_uri or
/map/metadata@wfs_namespace_uri/tinyows/layer@name/map/layer@name/tinyows/layer@title/map/layer/metadata@wfs_title/tinyows/layer@retrievable/map/layer/metadata@tinyows_retrievable  and
/map/layer@dump/tinyows/layer@writable/map/layer/metadata@tinyows_writable  and
/map/layer@dump/tinyows/layer@schema/map/layer/metadata@tinyows_schema/tinyows/layer@keywords/map/layer/metadata@wfs_keywordlist/tinyows/layer/abstract/map/layer/metadata@wfs_abstract/tinyows/layer@srid/map/metadata@wfs_srs and
/map/layer/metadata@wfs_srs/tinyows/layer@geobbox/map/layer/metadata@tinyows_geobbox/tinyows/layer@include_items/map/layer/metadata@include_items/tinyows/layer@exclude_items/map/layer/metadata@exclude_items/tinyows/layer@pkey/map/layer/metadata@pkey/tinyows/contact@name/map/metadata@ows_contactorganization/tinyows/contact@site/tinyows/contact@email/map/metadata@ows_contactelectronicmailaddress/tinyows/contact@individual_name/map/metadata@ows_contactperson/tinyows/contact@position/map/metadata@ows_contactposition/tinyows/contact@phone/map/metadata@ows_contactvoicetelephone/tinyows/contact@fax/map/metadata@ows_contactfacsimiletelephone/tinyows/contact@online_resource/tinyows/contact@address/map/metadata@ows_address/tinyows/contact@city/map/metadata@ows_city/tinyows/contact@administrative_area/tinyows/contact@country/map/metadata@ows_country/tinyows/contact@hours_of_service/tinyows/contact@contact_instructions
12.1.4 Sample: WFS-T with TinyOWS and OpenLayers
0) Install PostGIS and TinyOWS (TinyOWS Installation)
1) Within PostGIS, create a spatial database called 'tinyows'

2) Import Frida data (we will use the parks layer) into your PostGIS database



(continues on next page)



(continued from previous page)
3) Configure TinyOWS by editing /usr/local/tinyows/config.xml

4) Test your installations of TinyOWS and PostGIS

5) Install OpenLayers

6) Install the OpenLayers proxy (you need the Python interpreter to make it work)





7) Add your server IP to proxy allowedHosts in (/YOUR/SERVER/CGI-BIN/proxy.cgi)

8) Create a new file at OpenLayers-2.12/examples/tinyows.html
<html>
<head>
<link rel="stylesheet" href="../theme/default/style.css" type="text/css" />
<link rel="stylesheet" href="style.css" type="text/css" />
<script  src="../lib/OpenLayers.js"></script>
<style>
#map {
width: 800px; height: 500px; float: left;
border: 1px solid #ccc;
}
#message {
position: relative; left: 5px;
}
#docs {
float: left;
}
.customEditingToolbar { float: right; right: 0px;
height: 30px;
width: 200px;
}
.customEditingToolbar div {
float: right; margin: 5px; width: 24px; height: 24px;
}
.olControlNavigationItemActive {
background-image: url("../theme/default/img/editing_tool_bar.png");
background-repeat: no-repeat; background-position: -103px -23px;
}
.olControlNavigationItemInactive  {
background-image: url("../theme/default/img/editing_tool_bar.png");
background-repeat: no-repeat; background-position: -103px -0px;
}
.olControlDrawFeaturePolygonItemInactive  {
background-image: url("../theme/default/img/editing_tool_bar.png");
background-repeat: no-repeat; background-position: -26px 0px;
(continues on next page)



(continued from previous page)
}
.olControlDrawFeaturePolygonItemActive {
background-image: url("../theme/default/img/editing_tool_bar.png");
background-repeat: no-repeat; background-position: -26px -23px ;
}
.olControlModifyFeatureItemActive  {
background-image:  url(../theme/default/img/move_feature_on.png);
background-repeat: no-repeat; background-position: 0px 1px;
}
.olControlModifyFeatureItemInactive {
background-image:  url(../theme/default/img/move_feature_off.png);
background-repeat: no-repeat; background-position: 0px 1px;
}
.olControlDeleteFeatureItemActive {
background-image:  url(../theme/default/img/remove_point_on.png);
background-repeat: no-repeat; background-position: 0px 1px;
}
.olControlDeleteFeatureItemInactive  {
background-image:  url(../theme/default/img/remove_point_off.png);
background-repeat: no-repeat; background-position: 0px 1px;
}
</style>
<script  src="tinyows.js"></script>
</head>
<body onload="init()">
<h1 id="title">WFS Transaction Example, (TinyOWS ans OpenLayers)</h1>
<div id="tags"></div>
<p id="shortdesc">
Shows the use of the WFS Transactions (WFS-T). Parks of Osnabruck (Frida).
<br />
Base layers is OpenStreetMap from Omniscale WMS Server.
</p>
<div id="map"></div>
<div id="message"></div>
<div id="docs">
<p>


</p>
<p>



</p>

The WFS protocol allows for creation of new features and reading, updating, or deleting of existing features.

Use the tools to create, modify, and delete (in order from left to right) features. Use the save tool (picture of a disk) to save your changes. Use the navigation tool (hand) to stop editing and use the mouse for map navigation.

(continues on next page)



(continued from previous page)
9) Create a new file at OpenLayers-2.12/examples/tinyows.js (and replace all 127.0.0.1 addresses by your IP server if necessary)
var map, wfs;
OpenLayers.ProxyHost = "/cgi-bin/proxy.cgi?url=";
var DeleteFeature = OpenLayers.Class(OpenLayers.Control, { initialize: function(layer, options) {
OpenLayers.Control.prototype.initialize.apply(this, [options]);
this.layer = layer;
this.handler = new OpenLayers.Handler.Feature(
this, layer, {click: this.clickFeature}
);
},
clickFeature: function(feature) {
// if feature doesn't have a fid, destroy it
if(feature.fid == undefined) {
this.layer.destroyFeatures([feature]);
} else {
feature.state = OpenLayers.State.DELETE;
this.layer.events.triggerEvent("afterfeaturemodified",
                               {feature: feature}); feature.renderIntent = "select"; this.layer.drawFeature(feature);
}
},
setMap: function(map) {
this.handler.setMap(map); OpenLayers.Control.prototype.setMap.apply(this, arguments);
},
CLASS_NAME:  "OpenLayers.Control.DeleteFeature"
});
function showMsg(szMessage) { document.getElementById("message").innerHTML = szMessage; setTimeout(
"document.getElementById('message').innerHTML = ''",2000);
}
function  showSuccessMsg(){
showMsg("Transaction successfully completed");
};
function  showFailureMsg(){
showMsg("An error occurred while operating the transaction");
};
function init() {
map = new OpenLayers.Map('map', {
(continues on next page)



(continued from previous page)
projection: new OpenLayers.Projection("EPSG:31467"), units: "m",
maxResolution: "auto",
maxExtent: new OpenLayers.Bounds(3427000,5788000,3444000,5800000), controls: [
new OpenLayers.Control.PanZoom()
]
});
var osm = new OpenLayers.Layer.WMS( "OSM by Omniscale WMS",
"http://osm.omniscale.net/proxy/service",
{layers: 'osm', format: 'image/jpeg'},
{projection:"EPSG:31467",	units: "m", maxResolution: "auto", maxExtent: new?
??OpenLayers.Bounds(3427000,5788000,3444000,5800000)}
);
var saveStrategy = new OpenLayers.Strategy.Save(); saveStrategy.events.register("success", '', showSuccessMsg); saveStrategy.events.register("fail", '', showFailureMsg); wfs = new OpenLayers.Layer.Vector("Editable Features", {
strategies: [new OpenLayers.Strategy.BBOX(), saveStrategy], projection: new OpenLayers.Projection("EPSG:31467"), protocol: new OpenLayers.Protocol.WFS({
version: "1.1.0", srsName: "EPSG:31467",
url: "http://127.0.0.1/cgi-bin/tinyows", featureNS :	"https://mapserver.org/tinyows/", featureType: "frida",
geometryName: "geom",
schema:  "http://127.0.0.1/cgi-bin/tinyows?service=wfs&
??request=DescribeFeatureType&version=1.1.0&typename=tows:frida"
})
});
map.addLayers([osm, wfs]);
var panel = new OpenLayers.Control.Panel(
{'displayClass': 'customEditingToolbar'}
);
var navigate = new OpenLayers.Control.Navigation({ title: "Pan Map"
});
var draw = new OpenLayers.Control.DrawFeature( wfs, OpenLayers.Handler.Polygon,
{
title: "Draw Feature",
displayClass: "olControlDrawFeaturePolygon", multi: true
}
);
var edit = new OpenLayers.Control.ModifyFeature(wfs, { title: "Modify Feature",
displayClass: "olControlModifyFeature"
});
var del = new DeleteFeature(wfs, {title: "Delete Feature"});
(continues on next page)



(continued from previous page)

12.1.5 Server Tuning: How to speed up your TinyOWS server
Tips and Tricks for PostgreSQL / PostGIS databases
• Use Spatial Indexes on your geometry/geography columns PostGIS Spatial Indexes.
• Index any column that could be used frequently as a filter
• General PostGIS Performance tips
• General PostgreSQL Performance tips
• Even more tips on Tuning PostgreSQL

Tips and Tricks for Apache Using Fast-CGI
• Check that your TinyOWS is compiled with FastCGI support:


Fast-CGI in Apache
• In Apache, activate mod_fastcgi

• Apache fast-cgi configuration:




(continues on next page)



(continued from previous page)

Fast-CGI in MS4W
• Please refer to the fastcgi doc in ms4w
• Add the following 2 lines:


HTTP GZip compression
• In Apache, activate mod_deflate
• Deflate basic configuration, (note we're including xml so gml and json):


12.1.6 Working Around the LibXML2 XSD Schema GML Bug
Issue
TinyOWS makes use of GML, an XML-based language that encodes geometry. Frequently the input and the output of TinyOWS are in GML.
Even if LibXML2 is a great lib, older versions (i.e previous to 2.8) didn't handled correctly GML 3.1.1 XSD Schema (see https://bugzilla.gnome.org/show_bug.cgi?id=630130).

Workaround and options
For TinyOWS users, you have several options
• Take a recent libxml2 version (i.e 2.8 or later)
• Patch your oldest copy of LibXML2 release and link TinyOWS against your local copy:




• Modify the XSD GML Schema itself (but you violate the OGC License if you do this!):
Index: schema/gml/3.1.1/base/valueObjects.xsd
===================================================================
--- schema/gml/3.1.1/base/valueObjects.xsd (revision 550)
+++ schema/gml/3.1.1/base/valueObjects.xsd (revision 561) @@ -200,11 +200,13 @@
<group name="ValueExtent">
<choice>

+<!--

+-->





</group>


<element ref="gml:CategoryExtent"/>
<element ref="gml:QuantityExtent"/>
<element ref="gml:CountExtent"/>
</choice>

- <!-- ======================================================================
- <element name="QuantityExtent" type="gml:QuantityExtentType" substitutionGroup=
??"gml:_Value"> -->
+	<!-- ======================================================================
+	<element name="QuantityExtent" type="gml:QuantityExtentType" substitutionGroup=
??"gml:_Value">
<element name="QuantityExtent" type="gml:QuantityExtentType">
                   <annotation> @@ -212,5 +214,4 @@
</annotation>
</element>
-	<!	>
<complexType name="QuantityExtentType">
                   <annotation> @@ -223,6 +224,7 @@
</simpleContent>
</complexType>
+-->
<!-- ======================================================================
- <element name="CategoryExtent" type="gml:CategoryExtentType" substitutionGroup=
??"gml:_Value"> -->
+	<element name="CategoryExtent" type="gml:CategoryExtentType" substitutionGroup=
??"gml:_Value">
<element  name="CategoryExtent"  type="gml:CategoryExtentType">
                   <annotation> @@ -230,5 +232,4 @@
</annotation>
</element>
-	<!	>
<complexType name="CategoryExtentType">
                   <annotation> @@ -241,4 +242,5 @@
</simpleContent>
</complexType>

+-->


<!-- ======================================================================
<element name="CountExtent" type="gml:CountExtentType" substitutionGroup="gml:_

??Value"> -->


• Or choose to use only GML 2.1.2 in the meantime.



CHAPTER
THIRTEEN



OPTIMIZATION



13.1 Optimization
13.1.1 Debugging MapServer
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2025-10-05




Introduction
When developing an application for the Internet, you will inevitably across problems many problems in your environ- ment. The goal of this guide is to assist you with locating the problem with your MapServer application.

Links to Related Information
• RFC 28: Redesign of LOG/DEBUG output mechanisms
• MapServer Errors

Steps to Enable MapServer Debugging
Starting with MapServer 5.0, you are able to control the levels of debugging/logging information returned to you by MapServer, and also control the location of the output log file.
In technical terms, there are msDebug() calls in various areas of the MapServer code that generate information that may be useful in tuning and troubleshooting applications.

Step 1: Set the MS_ERRORFILE Variable
The MS_ERRORFILE variable is used to specify the output of debug messages from MapServer. You can pass the following values to MS_ERRORFILE:
[filename]
Full path and filename of a log file, to contain MapServer's debug messages. Any file extension can be used, but
.log or .txt is recommended. The file will be created, if it does not already exist.
Starting with MapServer 6.0, a filename with relative path can be passed via the CONFIG MS_ERRORFILE directive, in which case the filename is relative to the mapfile location. Note that setting MS_ERRORFILE via an environment variable always requires an absolute path since there would be no mapfile to make the path relative to.
Note that on Linux, if your are using a path from the /tmp directory like /tmp/ms_error.txt, the log will actually output in (private directory provided by systemd) generated for the web server used (like Apache).
stderr
Use this to send MapServer's debug messages to the Web server's log file (i.e. "standard error"). If you are using Apache, your debug messages will be placed in the Apache error_log file. If you are using Microsoft IIS, your debug messages will be sent to stdout (i.e. the browser), so its use is discouraged. With IIS it is recommended to direct output to a file instead.
stdout
Use this to send MapServer's debug messages to the standard output (i.e. the browser), combined with the rest of MapServer's output.
windowsdebug
Use this to send MapServer's debug messages to the Windows OutputDebugString API, allowing the use of external programs like SysInternals debugview to display the debug output.

Through the Mapfile
The recommended way to set the MS_ERRORFILE variable is in your mapfile, within the MAP object, such as:





(continues on next page)



(continued from previous page)

Through an Environment Variable
You can also set the MS_ERRORFILE variable as an environment variable on your system. Apache users can set the environment variable in Apache's httpd.conf file, such as:

Windows users can alternatively set the environment variable through the Windows System Properties; but make sure to set a SYSTEM environment variable.


Step 2: Set the DEBUG Level
You can retrieve varying types of debug messages by setting the DEBUG parameter in the Mapfile. You can place the DEBUG parameter in any LAYER in the mapfile for layer-specific debug information, or instead, set it once in the MAP object to get general debug information. Use the value of the DEBUG parameter to set the type of information returned, as follows:

DEBUG Levels
Level 0
Errors only (DEBUG OFF, or DEBUG 0)
In level 0, only msSetError() calls are logged to MS_ERORFILE. No msDebug() output at all. This is the default and corresponds to the original behavior of MS_ERRORFILE in MapServer 4.x
Level 1
Errors and Notices (DEBUG ON, or DEBUG 1)
Level 1 includes all output from Level 0 plus msDebug() warnings about common pitfalls, failed assertions or non-fatal error situations (e.g. missing or invalid values for some parameters, missing shapefiles in tileindex, timeout error from remote WMS/WFS servers, etc.)
Level 2
Map Tuning (DEBUG 2)
Level 2 includes all output from Level 1 plus notices and timing information useful for tuning mapfiles and applications. this is the recommended minimal debugging level
Level 3
Verbose Debug (DEBUG 3)
All of Level 2 plus some debug output useful in troubleshooting problems such as WMS connection URLs being called, database connection calls, etc.



Level 4
Very Verbose Debug (DEBUG 4) Level 3 plus even more details. . .
Level 5
Very Very Verbose Debug (DEBUG 5)
Level 4 plus any msDebug() output that might be more useful to developers than to users.

Mapfile Example: Map-Level Debug
The following example is the recommended method to set the DEBUG parameter for the map-level:


Mapfile Example: Layer-Level Debug
The following example is the recommended method to set the DEBUG parameter for a layer:


The MS_DEBUGLEVEL Environment Variable
Instead of setting the DEBUG Debug level in each of your mapfiles, you can also be set the level globally by using the
MS_DEBUGLEVEL environment variable.


When set, this value is used as the default debug level value for all map and layer objects as they are loaded by the mapfile parser. This option also sets the debug level for any msDebug() call located outside of the context of a map or layer object, for instance for debug statements relating to initialization before a map is loaded. If a DEBUG value is also specified in the mapfile in some map or layer objects then the local value (in the mapfile) takes precedence over the value of the environment variable; debug info coming from outside of the context of a map or layer object cannot be turned off by having DEBUG OFF in the mapfile.



Setting this option (MS_DEBUGLEVEL) is mostly useful when tuning applications by enabling timing/debug output before the map is loaded, to capture the full process initialization and map loading time, for instance.
Apache users can set the environment variable in Apache's httpd.conf file, such as:

Windows users can alternatively set the environment variable through the Windows System Properties; but make sure to set a SYSTEM environment variable.

Step 3: Turn on CPL_DEBUG (optional)
MapServer relies on the GDAL library to access most data layers, so you may wish to turn on GDAL debugging, to hopefully get more information on how GDAL is accessing your data file. This could be very helpful for problems with accessing raster files and PostGIS tables. You can trigger this GDAL output by setting the CPL_DEBUG variable in your mapfile, within the MAP object, such as:

You can also add a timestamp (a date/time on each line) to that report with the CPL_TIMESTAMP variable, such as:

You can also add verbose output from the cURL library, which could be very useful for debugging network-hosted layer connections through GDAL such as /vsicurl with the CPL_CURL_VERBOSE variable, such as:










Step 4: Turn on PROJ_DEBUG (optional)
MapServer relies on the PROJ library to handle data projections, so you may wish to turn on PROJ debugging, to hope- fully get more information back from the PROJ library. You can trigger this PROJ output by setting the PROJ_DEBUG variable in your mapfile, within the MAP object, such as:

Since the PROJ 9.3.0 release, there are 4 levels that you can set to increase the information returned from
PROJ_DEBUG, such as:
Level 0
No message (PROJ_DEBUG 0)
Level 1
Error messages only (PROJ_DEBUG 1)
Level 2
Same as level 1, but with debug messages. Setting "PROJ_DEBUG" "ON" is an alias to this level 2. (PROJ_DEBUG 2)
Level 3
Same as level 2, with verbose messages (PROJ_DEBUG 3)
Level 4
Same as level 3, with very verbose messages (PROJ_DEBUG 4)







Step 5: Test your Mapfile
Once you have set the MS_ERRORFILE and DEBUG level in your mapfile, you should now test your mapfile and read your generated log file.

Using map2img
The recommended way to test your mapfile is to use the MapServer commandline utility map2img, to verify that your mapfile creates a valid map image. map2img should be included in your MapServer installation (MS4W users need to execute setenv.bat before using the utility).
You can set the DEBUG level by passing the map2img following parameters to your commandline call:




-all_debug
Use this setting to set the debug level for the MAP object and all layers. this is the recommended switch to use




















(continues on next page)



(continued from previous page)

-map_debug
Use this setting to set the debug level for the MAP object only.


-layer_debug
Use this setting to set the debug level for one layer object only.


Set CPL_DEBUG
At the commandline execute the following:














(continues on next page)



(continued from previous page)

Reading Errors Returned by map2img
If there is a problem with your mapfile, map2img should output the line number in your mapfile that is causing the trouble. The following tells us that there is a problem on line 85 of my mapfile:

If you are using mapfile INCLUDEs, it may be tricky to track down this line number, but most of the time the line number is useful.

Using mapserv CGI
Another handy way to test your mapfile is to call the mapserv CGI executable at the commandline, such as the following:


ON_MISSING_DATA
If you are using tile indexes to access your data, you should also be aware of the configuration settings added in MapServer 5.4 that allow you to tell MapServer how to handle missing data in tile indexes. Please see the CONFIG parameter's ON_MISSING_DATA setting in the MAP object for more information.


Step 6: Check your Web Server Logs
Once you have verified that there are no problems with you mapfile, next you should check your Web server log files, for any related information that may help you narrow down your problem.

Apache
Unix users will usually find Apache's error_log file in a path similar to:

Windows users will usually find Apache's log files in a path similar to:

MapServer for Windows (MS4W) users will find Apache's log files at:




Microsoft IIS
IIS log files can be located by:
1. Go to Start -> Control Panel -> Administrative Tools
2. Open the Internet Information Services (IIS) Manager.
3. Find your Web site under the tree on the left.
4. Right-click on it and choose Properties.
5. On the Web site tab, you will see an option near the bottom that says "Active Log Format." Click on the Properties button.

6. At the bottom of the General Properties tab, you will see a box that contains the log file directory and the log file name. The full log path is comprised of the log file directory plus the first part of the log file name, for example:

You may also want to check the Windows Event Viewer logs, which is located at:
1. Go to Start -> Control Panel -> Administrative Tools
2. Computer Management



3. Event Viewer



CGI Error - The specified CGI application misbehaved by not returning a complete set of HTTP head- ers
This error is often caused by missing DLL files. You should try to execute "mapserv -v at the commandline, to make sure that MapServer loads properly.

Step 7: Verify your Application Settings
If you have verified that MapServer creates a valid map image through map2img, you've checked your MapServer log files, and there are no problems noted in your Web server logs, then you should focus your attention on possible application configuration problems. "Application" here means how you are displaying your map images on the Web page, such as with OpenLayers.

Step 8: Use QGIS to test your OGC services
When configuring MapServer for OGC services (WMS, WFS, etc.) it sometimes happens that users of your services report map issues in a desktop GIS or online application, even though no errors, logs, or local map2img tests give any hints; this is where the QGIS Network Logger can really help to get the exact problem request. For steps on how to implement the network logger see here.







PHP MapScript
If you are using PHP MapScript in your application, here are some important notes for debugging:
1. Make sure your php.ini file is configured to show all errors, by setting:

2. To enable debugging in PHP MapScript, if you are using MapServer 5.6.0 or more recent, make sure to define
ZEND_DEBUG in the PHP source.
If you are using MapServer < 5.6.0, then:
• open the file /mapscript/php3/php_mapscript.c
• change the following:




Debugging MapServer using Compiler Debugging Tools Running MapServer in GDB (Linux/Unix)
Section author: Frank Warmerdam

Building with Symbolic Debug Info
It is not strictly necessary to build MapServer with debugging enabled in order to use GDB on linux, but it does ensure that more meaningful information is reported within GDB. To enable full symbolic information use the -enable-debug configure switch. Note that use of this switch disables optimization and so it should not normally be used for production builds where performance is important.


Running in the Debugger
To run either mapserv or map2img, give the name of the executable as an argument to the "gdb" command. If it is not in the path, you will need to provide the full path to the executable.

Once you are at the "(gdb)" prompt you can use the run command with the arguments you would normally have passed to the mapserv or map2img executable.

If the program is crashing, you will generally get a report like the above indicating the function the crash occurred in, and some minimal information on why. It is often useful to request a traceback to see what functions led to the function that crashed. For this use the "where" command.





It may also be helpful to examine variables used in the line where the crash occurred. Use the print command for this.

In this case we see that the program crashed because poOpenInfo was NULL (zero). Including a traceback like the above in bug report can help the developers narrow down a problem more quickly, especially if it is one that is difficult for the developers to reproduce themselves.

Debugging Older Versions of MapServer (before 5.0)
1. Make sure that MapServer is compiled in debug mode (on unix this is enabled through ./configure -enable- debug).
You can verify that your build was compiled in debug mode, by executing the following at the commandline (look for "DEBUG=MSDEBUG"):

2. Set the MS_ERRORFILE variable is in your mapfile, within the MAP object, such as:







(continues on next page)



(continued from previous page)
3. If you don't use the MS_ERRORFILE variable, you can use the LOG parameter in your WEB object of the mapfile, such as:

4. Specify DEBUG ON in your MAP object, or in your LAYER objects, such as:

5. Note that only errors will be written to the log file; all DEBUG output goes to stderr, in the case of Apache that is Apache's error_log file. If you are using Microsoft IIS, debug output is routed to stdout (i.e. the browser), so be sure to remove DEBUG ON statements if using IIS on a production server.
.

13.1.2 Environment Variables


Background
A number of environment variables can be used to control MapServer's behavior or specify the location of some resources.






List of all possible MapServer Environment Variables
CURL_CA_BUNDLE
Added in version 5.4.1.
Used to specify the location of the Certificate Authority (CA) bundle file to be used by Curl when using HTTPS connections in WMS/WFS client layers. Curl comes bundled with its own CA bundle by default, so this variable is not required unless you have an unusual installation:

MS_DEBUGLEVEL
Added in version 5.0.
A default DEBUG level value can be set using the MS_DEBUGLEVEL environment variable in combination with the MS_ERRORFILE variable.
When set, this value is used as the default debug level value for all map and layer objects as they are loaded by the mapfile parser. This option also sets the debug level for any msDebug() call located outside of the context of a map or layer object, for instance for debug statements relating to initialization before a map is loaded. If a DEBUG value is also specified in the mapfile in some map or layer objects then the local value (in the mapfile) takes precedence over the value of the environment variable.
This option is mostly useful when tuning applications by enabling timing/debug output before the map is loaded, to capture the full process initialization and map loading time, for instance.

See alsoDebugging MapServer
MS_ENCRYPTION_KEY
Added in version 4.10.

See alsomsencrypt
MS_ERRORFILE
The MS_ERRORFILE environment variable specifies the location of the logging/debug output, with possible values being either a file path on disk, or one of the following special values:
• "stderr" to send output to standard error. Under Apache stderr is the Apache error_log file. Under IIS stderr goes to stdout so its use is discouraged. With IIS it is recommended to do direct output to a file on disk instead.
• "stdout" to send output to standard output, combined with the rest of MapServer's output.
• "windowsdebug" to send output to the Windows OutputDebugString API, allowing the use of external programs like SysInternals debugview to display the debug output.



It is possible to specify MS_ERRORFILE either as an environment variable or via a CONFIG directive inside a mapfile:

or:

If both the MS_ERRORFILE environment variable is set and a CONFIG MS_ERRORFILE is set, then the CON- FIG directive takes precedence.
If MS_ERRORFILE is not set, then error/debug logging is disabled. During parsing of a mapfile, error/debug logging may become available only after the MS_ERRORFILE directive has been parsed.

See alsoDebugging MapServer
MS_INDEX_TEMPLATE_DIRECTORY
Added in version 8.6.0.
The MS_INDEX_TEMPLATE_DIRECTORY environment variable can be set to activate an index page that lists all mapfiles and related services. The value should point to the folder containing the HTML templates to use. This variable should be set in the MapServer CONFIG file.
If this variable is not set then the index page is not generated. Example CONFIG file contents:
and then calls the mapserv CGI should return the index page:



See alsoIndex Page & rfc140
MS_MAP_NO_PATH
Added in version 5.4.
The MS_MAP_NO_PATH environment variable can be set to any value to forbid the use of explicit paths in the map=. . . URL parameter. Setting MS_MAP_NO_PATH to any value forces the use of the map=<env_variable_name> mechanism in mapserv CGI URLs.
If this variable is not set then nothing changes and the mapserv CGI still accepts explicit file paths via the map=. . . URL parameter.
Example, set set MS_MAP_NOPATH and some mapfile paths in Apache's httpd.conf:





and then calls the mapserv CGI must use environment variables for the map=. . . parameter:



See alsoLimit Mapfile Access & rfc56
MS_MAPFILE
The mapfile to use if the map=. . . URL parameter is not provided.
It is also possible to use an environment variable name as the value of the map=. . . URL parameter. The value of this environment variable will be used as the mapfile path:

MS_MAPFILE_PATTERN
MS_MAPFILE_PATTERN can be used to override the default regular expression which is used to validate mapfile filename extensions.
The default value for this variable is:

MS_MAP_BAD_PATTERN
Added in version 7.6.3.
The MS_MAP_BAD_PATTERN environment variable can be used to specify a Regular Expression to catch & not allow problematic character sequences in any mapfile paths passed to the mapserv CGI in the map=. . . URL parameter. If the value matches then an error is generated. By default all MapServer installations (since 7.6.3) set a hardcoded value for MS_MAP_BAD_PATTERN of:

which will therefore not allow "/../" or "//" in the map value.
For Windows users, MS4W uses the PCRE regex library (which requires a slightly different regex syntax), so all future MS4W releases will contain the following default MS_MAP_BAD_PATTERN enabled (to not allow "/../" or "//" in the map value) :

For more Windows information see Securing your MS4W Installation

See alsoLimit Mapfile Access & Associated Pull Request for the 7.6.3 release
MS_CONTEXT_BAD_PATTERN
Added in version 8.0.1.



The MS_CONTEXT_BAD_PATTERN environment variable can be used to specify a Regular Expression to catch & not allow problematic character sequences in any map context paths passed to the mapserv CGI in the con- text=. . . URL parameter. If the value matches then an error is generated. By default all MapServer installations (since 8.0.1) set a hardcoded value for MS_CONTEXT_BAD_PATTERN of:

which will therefore not allow "/../" or "//" in the map context value.
For Windows users, MS4W uses the PCRE regex library (which requires a slightly different regex syntax), so all future MS4W releases will contain the following default MS_MAP_BAD_CONTEXT_PATTERN enabled (to not allow "/../" or "//" in the map context value) :

For more Windows information see Securing your MS4W Installation

See alsoLimit Mapfile Access
MS_CONTEXT_PATTERN
Added in version 8.0.1.
The MS_CONTEXT_PATTERN environment variable can be used to specify a Regular Expression that must be matched by all file paths passed to the mapserv CGI in the context=. . . URL parameter.
If MS_CONTEXT_PATTERN is not set then no map context can be loaded.
Apache's SetEnv directive can be used to restrict mapfiles to a specific directory and subdirectories.
• Unix users may set the following expression in Apache to restrict mapfiles to the /opt/mapserver directory and subdirectories:

• Windows Apache/MS4W users can set the following expression in the Apache conf file, to limit the possible MAP= paths to the common C:/ms4w/apps/ directory (where all MS4W mapfiles and applications live), allow encoded urls, allow "." or "_" or "-" in MAP= paths but disallow ".." directory traversing:




See alsoLimit Mapfile Access


MS_MAP_PATTERN
Added in version 5.4.
The MS_MAP_PATTERN environment variable can be used to specify a Regular Expression that must be matched by all mapfile paths passed to the mapserv CGI in the map=. . . URL parameter.
If MS_MAP_PATTERN is not set then any .map file can be loaded.
Apache's SetEnv directive can be used to restrict mapfiles to a specific directory and subdirectories.
• Unix users may set the following expression in Apache to restrict mapfiles to the /opt/mapserver directory and subdirectories:

• Windows Apache/MS4W users can set the following expression in the Apache conf file, to limit the possible MAP= paths to the common C:/ms4w/apps/ directory (where all MS4W mapfiles and applications live), allow encoded urls, allow "." or "_" or "-" in MAP= paths but disallow ".." directory traversing:




See alsoLimit Mapfile Access & rfc56
MS_MODE
Default value for the mode=. . . URL parameter. Setting mode=. . . in the URL takes precedence over the envi- ronment variable.
MS_OPENLAYERS_CSS_URL
The URL to the OpenLayers CSS file used for styling the MapServer OpenLayers Viewer. for instance:

MS_OPENLAYERS_JS_URL
The URL to the OpenLayers JavaScript library used by the MapServer OpenLayers Viewer (can be used when testing WMS services using imagetype application/openlayers), for instance:

MS_TEMPPATH
Set the WEB TEMPPATH.
Added in version 6.0.
MS_XMLMAPFILE_XSLT
Used to enable XML Mapfile support. Points to the location of the XSLT to use for the XML->text mapfile conversion.




See alsoXML Mapfile support
PROJ_DATA
The PROJ_DATA environment variable or CONFIG directive can be used to specify the directory where the PROJ data files are located (including the "proj.db" file, or "epsg" file for older PROJ versions), if they are not in the default directory where PROJ expects them.





See alsoSetting the location of PROJ files in PROJECTION .
13.1.3 FastCGI
Author
Frank Warmerdam
Contact
warmerdam at pobox.com
Author
Howard Butler
Contact
hobu.inc at gmail.com
Last Updated
2008-07-15






Introduction
FastCGI is a protocol for keeping cgi-bin style web applications running as a daemon to take advantage of preserving memory caches, and amortizing other high startup costs (like heavy database connections) over many requests.

Obtaining the necessary software
1. There are three pieces to the MapServer FastCGI puzzle. First, you need the actual FastCGI library. This can be downloaded from https://fastcgi-archives.github.io//. This library does the usual configure, make, make install dance. One added complication is that it installs by default in /usr/local, and you might give the configure command a -prefix=/usr to put it in a location that is already visible to ldconfig.
2. Assuming you are running Apache, the next piece you need is the fastcgi module. There are two fastcgi imple- mentations for apache:
• mod_fcgid: mod_fcgid is the newer and recommended way to run fastcgi programs under recent apache versions. It can be downloaded from the Apache fcgid homepage
• deprecated mod_fcgi: Mod_fcgi depends on the version of Apache you are running, so make sure to download the correct fork (Apache 1.3 vs. Apache 2).
3. The third and final piece is to compile MapServer with FastCGI support. This is pretty straightforward, and all you need to do is tell configure where the FastCGI library is installed. If you changed the prefix variable as described above, this would be:

With those pieces in place, the MapServer CGI (mapserv) should now be FastCGI-enabled. You can verify this by testing it on with the command line:


mod_fcgid Configuration
1. Modify http.conf to load the FastCGI module.

2. Add an Apache handler for FastCGI applications.

3. Set FastCGI processing information


(continues on next page)



(continued from previous page)

Deprecated mod_fcgi Configuration
This section is left for reference. The recommended way to run fastcgi programs under apache is to use mod_fcgid, as detailed above.
1. Modify http.conf to load the FastCGI module.

2. Add an Apache handler for FastCGI applications.

3. Set FastCGI processing information


Common mod_fcgid/mod_fcgi Configuration
1. Install a copy of the mapserv executable (originally mapserv or mapserv.exe) into the cgi-bin directory with the extension .fcgi (ie. mapserv.fcgi). Use this executable when you want to utilize fastcgi support.
For some platforms, the MapServer link would then have to changed from:

To:

For other platforms, the MapServer link would then have to changed from:

To:

2. In your mapfile, set a PROCESSING directive to tell FastCGI to cache the connections and layer information on all layers for which connection caching is desired - ie. all slow layers.




Common Problems File permissions
Fedora Core 3 doesn't allow FastCGI to write to the process logs (when you use RedHat's Apache 2 rather than your own). This is described here.
Also, FastCGI needs to write its socket information somewhere. This can be directed with the FastCgiIpcDir directive.

FastCGI on Win32 MS4W Users
MS4W (MapServer for Windows) >= version 2.2.2 contains MapServer compiled with FastCGI support. MS4W ver- sion >= 2.2.8 also contains the required Apache module (mod_fcgid), and users must follow the README instructions to setup FastCGI with their application.

Building fcgi-2.4.0
I used libfcgi-2.4.0 for use with Apache2 from https://fastcgi-archives.github.io/.

Binary IO Patch
It is critical that stdio be in binary mode when PNG and other binary images are written to it. To accomplish this for stdio handled through the FastCGI library, I had to do the following hack to libfcgi/fcgi_stdio.c within the fcgi-2.4.0 distribution.
In FCGI_Accept() made he following change

Also, add the following just before the FCGI_Accept() function

I'm sure there is a better way of accomplishing this. If you know how, please let me know!



Building libfcgi
The makefile.nt should be fine. Just ensure you have run VCVARS32.BAT (as is needed for building MapServer) and then issue the command:

Then the .lib and .dll will be in libfcgi/Debug?. Make sure you copy the DLL somewhere appropriate (such as your cgi-bin directory).

Other Issues
1) FastCGI's receive a very limited environment on win32, seemingly even more restricted than normal cgi's started by apache. Make sure that all DLLs required are either in the fastcgi directory or in windowssystem32. Any missing DLLs will result in very cryptic errors in the error_log, including stuff about Overlapping read requests failing or something like that.
2) Make sure you use a libfcgi.dll built against the same runtime library as your mapserv.exe (and possibly libmap_fcgi.dll) or you will suffer a world of pain! Different runtime libraries have different "environ" variables (as well as their own stdio and heaps). You can check that everything is using MSVCRT.DLL (or all using MSVCRTD.DLL) using the MS SDK Dependency Walker.

13.1.4 Limit Mapfile Access
Author
Stephen Lime
Contact
sdlime at gmail.com
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2022-08-16
The MapServer CGI, by default, will happily attempt to process any mapfile it is asked to. While this might be desireable in a development environment, it is not acceptable for public-facing installations. MapServer supports the use of specific environment variables, set at the web server tier, to limit access. Since the MapServer 7.6.3 release, you are required to use (a combination of) these environment variables to secure your installation; for earlier MapServer versions these environment variables are strongly recommended.






Key Environment Variables








MS_MAP_BAD_PATTERN
Added in version 7.6.3.
If set, this environment variable is interpreted as regular expression that is used to test the value of the CGI map pa- rameter, by specifying which problematic character sequences to avoid. If the value matches then an error is generated. By default all MapServer installations (since 7.6.3) set a hardcoded value for MS_MAP_BAD_PATTERN of:

which will therefore not allow "/../" or "//" in the map value.


MS_CONTEXT_BAD_PATTERN
Added in version 8.0.1.
Regular Expression to catch & not allow problematic character sequences in any map context paths passed to the mapserv CGI in the context=. . . URL parameter.
See MS_CONTEXT_BAD_PATTERN
MS_CONTEXT_PATTERN
Added in version 8.0.1.



Regular Expression that must be matched by all file paths passed to the mapserv CGI in the context=. . . URL parameter. See MS_CONTEXT_PATTERN
MS_MAP_NO_PATH
Added in version 5.4.0.
If set, this environment variable limits values for the CGI map parameter to a curated (prepared) set of mapfiles explicitly defined by additional environment variables. This is the recommended way to secure mapfile access if at all possible.


MS_MAP_PATTERN
Added in version 5.4.0.
If set, this environment variable is interpreted as regular expression that is used to test the value of the CGI map parameter. If the value does not match then an error is generated.
Care must be taken to craft regular expressions that limit access to specific, trusted directories and limit path traversal:. See the Environment Variables guide for examples.




Setting Environment Variables
Mechanisms to set environment variables vary from web server to web server, but all provide the capability. (regular expression feature sets can vary by operating system and version)
• Apache - https://httpd.apache.org/docs/current/env.html
Apache's SetEnv directive (available through the mod_env module) allows you to set environment variables in the Apache conf file with a single command:
- Unix users may set the following expression in Apache to restrict mapfiles to the /opt/mapserver directory and subdirectories:






- Windows Apache/MS4W users can set the following expression in the Apache conf file, to limit the possible MAP= paths to the common C:/ms4w/apps/ directory (where all MS4W mapfiles and applications live), allow encoded urls, allow "." or "_" or "-" in MAP= paths but disallow ".." directory traversing:

• Nginx - http://nginx.org/en/docs/ngx_core_module.html#env
• IIS	-	https://docs.microsoft.com/en-us/iis/configuration/system.applicationhost/applicationpools/add/ environmentvariables/

13.1.5 Mapfile Tuning & Management
Author
David Fawcett
Contact
david.fawcett at gmail.com
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2024-06-20






Introduction
The contents of a .map file ('mapfile') are used by MapServer for configuration, data access, projection, and more. Because the mapfile is parsed every time a map image is requested, it is important to think about what you include in the file in order to optimize performance. The optimal mapfile is one that doesn't include or reference anything that isn't needed. The following steps will help you both manage and optimize your mapfiles.


Steps to Possibly Review
1. Use a MapServer Syntax file for your Favorite Text Editor
Although it's maybe not be classed as an 'optimization', using a syntax file to add color-coding to MapServer mapfile parameters in your text editor, can help save you time and make your MapServer-mapfile-management-life much easier. You can find a helpful list of these syntax color-coding tools for MapServer listed on the page at editing.





2. Testing your Mapfile for Speed
If optimization and performance are important to you, then get to know and love the MapServer commandline utility map2img. map2img will verify that your mapfile creates a valid map image, but it can also display draw times (length of time it takes MapServer to process each layer and the final map image) with the -map_debug 3 setting:

The above example generates a map image in 0.772 seconds.
Hint: If you want maximum (verbose) messages, try the -all_debug 5 setting instead. You can also just get draw times for a single layer with the -l layername switch, such as:



(continues on next page)



(continued from previous page)


3. Use the various CONFIG settings for debugging
Review the Debugging MapServer document and try setting the CONFIG parameter at the MAP-level in your mapfile, to hopefully get more information from various sources such as from the PROJ library, GDAL library, etc.



4. Test the full Map Request through the mapserv Executable
There are times when your mapfile generates a valid map image with a local map2img command, but then the same mapfile will cause an error in a map request through the web server, such as Apache. It is these times when you should try the same request, that was sent through your web server, at the commandline with the actual mapserv (or on Windows, the mapserv.exe) utility.
The following request will take a full MAP=...&MODE=map request, and try to save the request to an image, or report an error:

You can use this to also test problematic WMS GetMap requests as well:




Note: Besides checking your web server logs, you can also use QGIS to get the exact request to your OWS (WMS/WFS etc.) service: see https://github.com/MapServer/MapServer/wiki/Get-the-Raw-WMS-Request-Generated-by-QGIS


5. Projections
There are two ways to define projections in a mapfile. You can either use inline projection parameters or specify an EPSG code for that projection. If you use the EPSG code method, PROJ looks up the projection parameters in the PROJ database using the EPSG code as an ID. This database lookup takes significantly more resources than when the projection parameters are defined inline. This lookup takes place for each projection definition using EPSG codes in a mapfile.


Projection defined using inline projection parameters

Projection defined using EPSG Code

Optimization Suggestions
• Use inline projection parameter definitions in place of EPSG codes.
• It should be stated that for optimal performance you could have MapServer not do any projections on-demand (in other words, have all of your source data in the same projection, and have MapServer output requests in that same projection) but obviously this is not always possible for all scenarios.
• If you want to use EPSG codes, remove all unneeded projection definition records from the PROJ EPSG database.






6. Use INCLUDEs
Implemented back in MapServer 4.10, the mapfile INCLUDE parameter is possibly one of the best ways to help manage your large mapfiles (you might argue that this is not 'optimization' for speed again, but for it is very important for managing large mapfiles with many layers).
Any part of the mapfile can be referenced through an INCLUDE, besides the obvious layers.


You could have something like:

Where metadata.include could contain:


7. Layers
For every layer in a mapfile that has a status of ON or DEFAULT, MapServer will load that layer and prepare it for display, even if that layer never gets displayed.
Optimization Suggestions
• Build lean mapfiles, only include layers that you plan to use.
• Turn off unnecessary layers; the more layers MapServer is displaying, the more time it takes. Have your opening map view show only the minimum necessary to orient the user, and allow them to turn on additional layers as needed. This is particularly true of remote WMS or very large rasters.



• Related to turning off layers, is turning them on but using MINSCALEDENOM and MAXSCALEDENOM to determine at what zoomlevels the layer is available. If a map's display is outside of the layer's MINSCALEDE- NOM and MAXSCALEDENOM range, then MapServer can skip processing that layer. It also makes for a really
cool effect, that the national boundaries magically change to state boundaries.
• If you have a complex application, consider using multiple simple and specific mapfiles in place of one large 'do everything' mapfile.
• In a similar vein, each class also supports MINSCALEDENOM and MAXSCALEDENOM. If your dataset has data that are relevant at different zoomlevels, then you may find this a very handy trick. For example, give a MIN-
SCALEDENOM of 1:1000000, county roads a MINSCALEDENOM of 1:100000, and streets a MAXSCALE- DENOM of 1:50000. You get the cool effect of new data magically appearing, but you don't have MapServer trying to draw the nation's roads when the entire nation is in view!
• Classes are processed in order, and a feature is assigned to the first class that matches. So try placing the most commonly-used classes at the top of the class list, so MapServer doesn't have to try as many classes before finding a match. For example, if you wanted to highlight the single state of Wyoming, you would probably do this:

But it would be a lot more efficient to do this, since 98% of cases will be matched on the first try:

• Use tile indexes instead of multiple layers.

8. Yes Data Formats Matter
This is often not written in documents, yet is often taught in hands-on workshops (as maybe readers or developers can be reading the document here and become offended if it differs in their thinking or the purpose of their software design, as some formats may be deemed 'uncool' by some crowds, but in reality, we don't care about coolness here, we care about making MapServer fast). So the following advice is by the authors of this document (disclaimer), and may offend some readers, therefore 'viewer discretion is advised'.
Although MapServer can read any GDAL supported vector or raster source (and the fact that not all users will be setting up tile caching beforehand), the following is still recommended for MapServer for optimal performance in terms of data



formats.
Optimization Suggestions
• The best/optimal data sources for MapServer in terms of speed-of-display is .shp (for vectors) and GeoTIFF (for rasters).
• For databases, MapServer displays PostGIS layers very fast, and some custom tricks are included in the MapServer source specifically for PostGIS + MapServer draw speed. PostGIS is therefore recommended.
• SpatiaLite is recommended for those who require a portable format, and works very well with MapServer.
• For whatever formats you choose, definitely review the associated GDAL format (driver) page for that specific format, and enable indexing (spatial or also attribute indexing).
• Rasters, and of course GeoTIFFs, should also have overviews included, through the gdaladdo utility.
• Raster layers can also include various PROCESSING directives, specific to raster display in MapServer (such as displaying specific bands, or choosing a resampling method, but for resampling do experiment with the fastest display option versus display quality).
• If you do use .shp files (and many still do) you must always enable fast quadtree index lookups in MapServer through the shptree utility.
• Wherever possible, making your source dataset as lightweight as possible, will assist MapServer in processing your data (for vectors, this could mean removing unused data fields).
• As mentioned earlier, if you must display various rasters or vectors as a 'mosaic' together, implement Tile Indexes, to implement the mosaic as a single layer in MapServer.
• GDAL's virtual format (VRT) is very powerful also for mosaicing or transforming data on-demand, and has specific VRT driver instructions for vector and raster .
• There are times when splitting .shp files (shapefiles) into smaller files, make it more efficient to display in MapServer; the shp2tile utility is a wonderful commandline tool for this.


9. Enable Caching through MapCache
If your mapfile serves any OGC-related service (such as WMS, WFS, etc.) you should consider enabling Map- Cache, an Apache module, for your services. Caching common map results (as an image file, or inside a SQLite db for example) for common map extents, will obviously drastically improve speed, and cancel-out any format discus- sions/benefits/arguments mentioned above.

10. Symbols
When the mapfile is loaded, each raster symbol listed in the symbols file is located on the filesystem and loaded.
Optimization Suggestions
• Only include raster symbols in your symbols file if you know that they will be used by your application.



11. Fonts
To load a font, MapServer opens up a lookup file (often named fonts.list or fonts.txt) FONTSET which contains an alias for the font and the path for that font file. If you have a fonts.list file with a long list of fonts, it will take more time for MapServer to locate and load the font that you need.
Optimization Suggestions
• Limit the entries in fonts.list to fonts that you actually use.

12. Use MapScript
MapScript, in your favorite language such as PHP or Python, can be used to manipulate mapfiles on-the-fly. Some common use cases are:
• adding a layer into an existing mapfile
• modifying an existing layer
• generating a new mapfile/service on-demand
The options here are limitless, for what you can do with MapScript. The full list of available parameters and functions (methods) are listed in the SWIG MapScript API Reference.

13. Don't expose your MAP path
This is more obvious if your mapfile serves OGC services, such as set in the wms_onlineresource metadata parameter in your WEB object, which by default must contain the MAP=path/to/your/mapfile, but exposing paths on your public server can open you to possible malicious attacks on your filesystem. You should take some time to review the possible steps in the document Limit Mapfile Access.
At the minimum, you should enable the MS_MAPFILE environment variable so that your CGI mapserv requests, and your onlineresource OGC requests, do not require a visible MAP= path. The WMS Server document has several examples of how to enable these environment variables.

13.1.6 Raster Management & Optimization
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Original Author
HostGIS
Last Updated
2022-01-25







Choose the right raster format for your needs
The best/optimal data sources for MapServer in terms of speed-of-display is GeoTIFF for rasters. Here are some other points to consider:
• The GeoTIFF image format is the fastest to "decipher", but once you get beyond a certain point, the disk reading may become slow enough to make it worthwhile to consider other image formats.
• For GeoTIFFs larger than 1 GB, ECW images tend to render faster than GeoTIFFs, since decompressing the data (CPU and RAM) is faster than reading the uncompressed data (disk). The downside is that ECW is not open-source, and the licensing is often prohibitive. MrSID is another compressed image format that can be used.
• JPEG2000 is a very slow image format, as is JPEG.

Spend time to review GDAL's associated driver page for your chosen format
This is a critical step, as MapServer relies on GDAL for raster data access. Each driver (GDAL format) has its own set of abilities and switches. Find your raster format and review its options here.

Connect to your data through GDAL
For data management in MapServer, this should always be one of your first steps. Sometimes desktop GIS programs will display a format in a certain way but your data might not display in MapServer; checking how GDAL reads your raster file, will help you manage and understand the data. Here is an example using gdalinfo to read and return various important metadata regarding a specific raster, in this case a MrSID raster:















(continues on next page)



(continued from previous page)
PRIMEM["Greenwich",0, AUTHORITY["EPSG","8901"]],
UNIT["degree",0.0174532925199433, AUTHORITY["EPSG","9122"]],
AUTHORITY["EPSG","4269"]],
PROJECTION["Transverse_Mercator"], PARAMETER["latitude_of_origin",0], PARAMETER["central_meridian",-93], PARAMETER["scale_factor",0.9996], PARAMETER["false_easting",500000], PARAMETER["false_northing",0], UNIT["metre",1,
     AUTHORITY["EPSG","9001"]], AXIS["Easting",EAST],
AXIS["Northing",NORTH], AUTHORITY["EPSG","26915"]]
Origin = (494792.400000000023283,5018068.799999999813735) Pixel Size = (0.600000000000000,-0.600000000000000)
Metadata:
GEOTIFF_CHAR GeogAngularUnitsGeoKey=Angular_Degree GEOTIFF_CHAR GTModelTypeGeoKey=ModelTypeProjected GEOTIFF_CHAR GTRasterTypeGeoKey=RasterPixelIsArea GEOTIFF_CHAR ProjectedCSTypeGeoKey=PCS_NAD83_UTM_zone_15N GEOTIFF_CHAR ProjLinearUnitsGeoKey=Linear_Meter GEOTIFF_NUM 1024	GTModelTypeGeoKey=1
GEOTIFF_NUM  1025	GTRasterTypeGeoKey=1
GEOTIFF_NUM 1026 GTCitationGeoKey=NAD83 / UTM zone 15N GEOTIFF_NUM 2049	GeogCitationGeoKey=NAD83
GEOTIFF_NUM 2054 GeogAngularUnitsGeoKey=9102
GEOTIFF_NUM 2062 GeogTOWGS84GeoKey=0.000000,0.000000,0.000000
GEOTIFF_NUM 3072 ProjectedCSTypeGeoKey=26915 GEOTIFF_NUM 3076 ProjLinearUnitsGeoKey=9001 IMAGE ENCODING_APPLICATION=GeoExpress 10.0.1.5035 IMAGE	FORMAT=MrSID/MG3
IMAGE INPUT_FILE_SIZE=30104685840.000000 IMAGE INPUT_FORMAT=GeoTIFF
IMAGE   LTI_ESDK_VERSION=9.5.4.5035.Bob_5011_br win64-vc15/Release_md
IMAGE  MODIFICATIONS=COMPRESSED CROPPED EMBEDDED REORDERED-BANDS MOSAICKED?
??REPROJECTED
IMAGE PRINT_DENSITY_UNIT=in IMAGE PRINT_X_DENSITY=200.000000 IMAGE PRINT_Y_DENSITY=200.000000 VERSION=MG3
Image Structure Metadata: INTERLEAVE=PIXEL
Corner Coordinates:
Upper Left ( 494792.400, 5018068.800) ( 93d 3'59.18"W, 45d18'57.98"N) Lower Left ( 494792.400, 4948000.200) ( 93d 3'56.57"W, 44d41' 7.27"N) Upper Right ( 524941.800, 5018068.800) ( 92d40'54.44"W, 45d18'56.45"N) Lower Right ( 524941.800, 4948000.200) ( 92d41' 6.94"W, 44d41' 5.78"N) Center   ( 509867.100, 4983034.500) ( 92d52'29.30"W, 45d 0' 2.48"N)
(continues on next page)



(continued from previous page)
Band 1 Block=1024x128 Type=Byte, ColorInterp=Red Min=0.000 Max=228.000
Minimum=0.000, Maximum=228.000, Mean=86.853, StdDev=53.485
Overviews: 25125x58391, 12563x29196, 6282x14598, 3141x7299, 1571x3650, 786x1825,?
??393x913, 197x457, 99x229, 50x115, 25x58, 13x29, 7x15, 4x8
Metadata: STATISTICS_APPROXIMATE=YES STATISTICS_MAXIMUM=228 STATISTICS_MEAN=86.853391304348 STATISTICS_MINIMUM=0 STATISTICS_STDDEV=53.485489960597 STATISTICS_VALID_PERCENT=100
Band 2 Block=1024x128 Type=Byte, ColorInterp=Green Min=0.000 Max=224.000
Minimum=0.000, Maximum=224.000, Mean=81.011, StdDev=45.552
Overviews: 25125x58391, 12563x29196, 6282x14598, 3141x7299, 1571x3650, 786x1825,?
??393x913, 197x457, 99x229, 50x115, 25x58, 13x29, 7x15, 4x8
Metadata: STATISTICS_APPROXIMATE=YES STATISTICS_MAXIMUM=224 STATISTICS_MEAN=81.010782608696 STATISTICS_MINIMUM=0 STATISTICS_STDDEV=45.552372785005 STATISTICS_VALID_PERCENT=100
Band 3 Block=1024x128 Type=Byte, ColorInterp=Blue Min=0.000 Max=211.000
Minimum=0.000, Maximum=211.000, Mean=90.109, StdDev=48.708
Overviews: 25125x58391, 12563x29196, 6282x14598, 3141x7299, 1571x3650, 786x1825,?
??393x913, 197x457, 99x229, 50x115, 25x58, 13x29, 7x15, 4x8
Metadata: STATISTICS_APPROXIMATE=YES STATISTICS_MAXIMUM=211 STATISTICS_MEAN=90.109217391304 STATISTICS_MINIMUM=0 STATISTICS_STDDEV=48.70795205406 STATISTICS_VALID_PERCENT=100






Overviews
GeoTIFF supports the creation of "overviews" within the file, which is basically a downsampled version of the raster data suitable for use at lower resolutions. Use the gdaladdo program to add overviews to a GeoTIFF, and MapServer (via GDAL) will automagically choose which downsampled layer to use. Note that overviews significantly increase the disk space required by a GeoTIFF, and in some cases the extra disk reading may offset the performance gained by MapServer not having to resample the image. You'll just have to try it for yourself and see how it works.

Tileindexes and Internal Tiling
Tiling is mostly effective for cases where one commonly requests only a very small area of the image.
A tileindex is how one creates an on-the-fly mosaic from many rasters. This is described in the Tile Indexes MapServer document. That document describes common cases where a tileindex makes sense. In particular, if you have a very large raster and most requests are for a very small spatial area within it, you may want to consider slicing it and tileindexing it.
As an alternative to slicing and mosaicing, TIFFs do support a concept of internal tiling. Like a tileindex, this is mostly effective when the requests are for a small portion of the raster. Internal tiling is done by adding "-co TILED=YES" to gdal_translate, e.g.:


Learn & Review the various GDAL utilities to manage your rasters
GDAL raster commandline utilities are very powerful, and the more processing that you can do offline, the faster and easier it will be for MapServer to display your raster. For example, you might need a colorful 'shaded relief' from a raw DEM raster, in which case you could use the gdaldem utility, and then point your MapServer layer to that shaded relief raster. Or you might want to reproject all of your rasters to the desired output/display projection beforehand, by using the gdalwarp utility. Review all of the available GDAL raster utilities here.

Handling your raster LAYERS in the mapfile
Please review the notes in the document Mapfile Tuning & Management.

Remote WMS
Some remote WMS/OGC services (as WMS actually returns an image from a request sent to a remote server) can be slow or unreliable. Optionally you can use a monitoring service, such as GeoHealthCheck, to keep track of the service's reliability for you.
You can also consider when the remote WMS layer or remote service should be used. For example, there may be a different WMS server (or a different set of imagery, or even vector outline maps) suitable for drawing the countries or states to orient the user. You could then have the WMS layer come on at a certain scale, or have the layer always available but turned off so the user can choose when to turn it on.

13.1.7 Tile Indexes
Author
Jeff McKenna



Contact
jmckenna at gatewaygeomatics.com
Original Author
HostGIS
Last Updated
2021-03-23


Introduction
Tileindexes are MapServer's method for doing on-the-fly mosaicing.

What is a tileindex and how do I make one?
A tileindex is a dataset (usually a shapefile) that ties together several datasets into a single layer. Therefore, you don't need to create separate layers for each piece of imagery or each county's road data; make a tileindex and let MapServer piece the mosaic together on the fly.
Making a tileindex is easy using gdaltindex for GDAL data sources (rasters) and ogrtindex for OGR data sources (vectors). You just run them, specifying the index file to create and the list of data sources to add to the index.


For example, to make a mosaic of several GeoTIFFs, creating an index file named tileindex-tif.shp:

And to make a mosaic of vectors, creating an index file named tileindex-tiger.shp:

If your data files are in different subfolders, you can use the -optfile switch for vectors or rasters to pass a file list to ogrtindex/gdaltindex, such as:







Using the tileindex in your mapfile
Using a tileindex as a layer is best explained by an example:

There are two items of note here: TILEINDEX and TILEITEM. TILEINDEX is simply the path to the index file, and TILEITEM specifies the field in the shapefile which contains the filenames referenced by the index. The TILEITEM will usually be "LOCATION" unless you specified the -tileindex option when running gdaltindex or ogrtindex.
Two important notes about the pathnames:
• The path to TILEINDEX follows the same conventions as for any other data source, e.g. using the SHAPEPATH or else being relative to the location of the mapfile.
• The filenames specified on the command line to gdaltindex or ogrtindex will be used with the same conventions as well, following the SHAPEPATH or else being relative to the mapfile's location. You might find it useful to change into the SHAPEPATH directory and then run ogrtindex/gdaltindex from there; this ensures correct
pathnames.

Tileindexes may make your map faster
A tileindex is often a performance boost for two reasons:
• It's more efficient than having several separate layers.
• MapServer will examine the tileindex to determine which datasets fall into the map's view, and will open only those datasets. This can result in a great savings for a large dataset, especially for use cases where most of the
time only a very small spatial region of the data is being used. (for example, citywide maps with nationwide street imagery)






A tileindex will not help in the case where all/most of the data sources will usually be opened anyway (e.g. street data by county, showing states or larger regions). In that case, it may even result in a decrease in performance, since it may be slower to open 100 files than to open one giant file.
The ideal case for a tileindex is when the most typically requested map areas fall into very few tiles. For example, if you're showing state and larger regions, try fitting your data into state-sized blocks instead of county-sized blocks; and if you're showing cities and counties, go for county-sized blocks.
You'll just have to experiment with it and see what works best for your use cases.

Tileindexes with tiles in different projections
Starting with MapServer 6.4 for raster layers, and MapServer 7.2 for vector layers, a tileindex can contain rasters/layers in different projections. Such tileindex can be generated with gdaltindex (GDAL 1.11 or later) and ogrtindex (GDAL 2.2 or later), with the -t_srs and -src_srs_name options. The -t_srs instructs gdaltindex/ogrtindex to write the envelope of each tile into a common target projection, so that the geometries written in the tile index are consistent. This common projection must be the projection of the raster/vector layer.

The corresponding LAYER definition will need to specify the TILESRS keyword with the value of the -src_srs_name option.
e.g:

MapServer will then be able to proceed to on-the-fly mosaicing and reprojection.

Note for WCS layers
For layers that must be exposed as WCS layers, a few metadata fields ("wcs_extent", "wcs_size", "wcs_resolution") must be specified in the LAYER definition, so as to define a "virtual dataset" coverage (see WCS Server). The GDAL wcs_virtds_params.py sample script can help generating those metadata fields.



Long ogrtindex example
This example uses TIGER Census data, where the data contains files divided up by county. In this example we will show how to display all lakes for the state of Minnesota. The TIGER Census data for Minnesota is made up of 85 different counties, each containing its own lakes file ('xxxx_areawater.shp').
Figure 1: County lake files displayed in QGIS

Our directory structure looks like the following ('tiger2020' contains the 85 shapefiles):

1. We need to generate the index file with ogrtindex. First we will change directory into the data folder, so that the index file is generated there, then execute ogrtindex:

2. We can now load that new index file lakes-ogrtindex.shp into QGIS to examine it.
Figure 2: Index file created by ogrtindex utility




Figure 3: Attributes of index file created by ogrtindex utility







3. A protip is to then run shptree on the ogrtindex file and all of the .shp files used, so MapServer can access them quickly.

You should now see associated .qix files created for each shapefile.
4. The final step is to use this in your mapfile.



• LAYER object's TILEINDEX - must point to the location of the index file
• LAYER object's TILEITEM - specify the name of the field in the index file containing the paths (default is 'location')
• do not need to use the LAYER's DATA parameter
   • the location path inside your tileindex file will be relative to the SHAPEPATH, as shown below: For example:

5. And of course use map2img to generate your map image.














When you view the layer in a MapServer application, you will notice that when you are zoomed into a small area of the state (such as a single county) only the necessary lake shapefiles are loaded, which speeds up the application.

Long gdaltindex example
This example uses NAIP ortho imagery, for counties in the state of Minnesota. The format is MrSID. Since the data is so large, for this exercise 6 counties were used (so 6 MrSID raster files). An example filename in this case is ortho_xxxx.sid
Figure 1: MrSID imagery displayed in QGIS




Our directory structure looks like the following ('naip2019' contains the 6 MrSID images):

1. We need to generate the index file with gdaltindex. First we will change directory into the data folder, so that the index file is generated there, then execute gdaltindex:

2. We can now load that new index file naip-imagery-gdaltindex.shp into QGIS to examine it.
Figure 2: Index file created by gdaltindex utility




Figure 3: Attributes of index file created by gdaltindex utility






3. A protip is to then run shptree on the gdaltindex file so MapServer can access it quickly.

You should now see a .qix file created.
4. The final step is to use this in your mapfile.
• LAYER object's TILEINDEX - must point to the location of the index file
• LAYER object's TILEITEM - specify the name of the field in the index file containing the paths (default is 'location')
• do not need to use the LAYER's DATA parameter
   • the location path inside your tileindex file will be relative to the SHAPEPATH, as shown below: For example:

5. And of course use map2img to generate your map image.














When you view the layer in a MapServer application, you will notice that when you are zoomed into a small area of the state (such as a single county) only the necessary MrSID images are loaded, which speeds up the application.

13.1.8 Vector Data Management & Optimization
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Original Author
HostGIS
Last Updated
2025-07-29






Choose the right vector format for your needs
• The best/optimal vector data source for MapServer in terms of speed-of-display is Shapefile.


• A recent format designed for vector performance, with similar map draw speed in MapServer as Shapefile, is
FlatGeobuf , and is recommended for cloud performance.
• For databases, MapServer displays PostGIS layers very fast, and some custom tricks are included in the MapServer source specifically for PostGIS + MapServer draw speed. PostGIS is therefore recommended.
• SpatiaLite is recommended for those who require a portable format, and works very well with MapServer.
• GeoPackage ("GPKG") is also very popular for portability, and works very well with MapServer.
Here are some rudimentary map draw speed results, with the MapServer 8.0 release code (running on Windows with MS4W):




Spend time to review GDAL's associated driver page for your chosen format
This is a critical step, as MapServer relies on GDAL (actually the OGR part of the project, which handles vectors) for vector data access. Each driver (OGR format) has its own set of abilities and switches. Find your vector format and review its options here.

Connect to your data through OGR/GDAL
For data management in MapServer, this should always be one of your first steps. Sometimes desktop GIS programs will display a format or its attributes in a certain way (such as in uppercase) but your data might not display in MapServer; checking how OGR/GDAL reads your data file or database table, will help you manage the data. The OGR Vector Layers Through MapServer document has excellent examples (for ogrinfo and other commands) to connect to your data. Here is an example connecting to a PostGIS database, and returning a list of spatial tables:

Then get a summary of the 'popplace' table through ogrinfo:
ogrinfo -ro PG:"host=127.0.0.1 user=postgres password=postgres port=5433 dbname=mydb"?
??popplace -summary

INFO: Open of 'PG:host=127.0.0.1 user=postgres password=postgres port=5433?
??dbname=mydb'
using driver 'PostgreSQL' successful.

Layer name: popplace Geometry: Point Feature Count: 497
Extent: (-2303861.750000, -681502.875000) - (2961766.250000, 3798856.750000)
Layer SRS WKT:
PROJCS["NAD83 / Canada Atlas Lambert", GEOGCS["NAD83",
DATUM["North_American_Datum_1983", SPHEROID["GRS 1980",6378137,298.257222101,
AUTHORITY["EPSG","7019"]],
TOWGS84[0,0,0,0,0,0,0],
AUTHORITY["EPSG","6269"]],
PRIMEM["Greenwich",0, AUTHORITY["EPSG","8901"]],
UNIT["degree",0.0174532925199433, AUTHORITY["EPSG","9122"]],
AUTHORITY["EPSG","4269"]],
PROJECTION["Lambert_Conformal_Conic_2SP"], PARAMETER["standard_parallel_1",49], PARAMETER["standard_parallel_2",77], PARAMETER["latitude_of_origin",49], PARAMETER["central_meridian",-95],
(continues on next page)



(continued from previous page)


Learn & Review the various OGR utilities to manage your vectors
OGR commandline utilities are very useful, making it easy to manipulate your source vector file or database, before display in MapServer. For example, you might want to import a spatial file into your existing PostGIS database, which you can do easily through ogr2ogr as the following (that takes a shapefile, imports it into an existing PostGIS database, and renames the new table to 'roadways') :







You might also import a spatial file, and reproject it to another EPSG projection, as the following (that takes a shapefile, reprojects it into the web mercator EPSG:3857, imports it into an existing PostGIS database, and renames the new table to 'roadways3857') :



Review all of the available OGR vector utilities here.

Index your data
This of course is an important step for any vector layer, for fast display in MapServer. There are several types of indexes that you can enable to speed up the display of your vector data with MapServer:

Tileindexing
See Tile Indexes for more detailed information about on-the-fly mosaicing with MapServer.

Add a Spatial Index to your data
Make sure that your geometry has a spatial index.
• Shapefile: see shptree
• See below for databases (and GPKG)

Add an Attribute Index to your data
If you will be querying or filtering by a specific column in your data, you should setup an attribute index on your vector data.
Shapefiles:

2 files should be created with extensions: .ind & .idm
GeoPackage:


Splitting your data
If you find yourself making several layers, all of them using the same dataset but filtering to only use some of the records, you could probably do it better. If the criteria are static, one approach is to pre-split the data.



The ogr2ogr utility can select on certain features from a datasource, and save them to a new data source. Thus, you can split your dataset into several smaller ones that are already effectively filtered, and remove the FILTER statement.
If you are using shapefiles, the shp2tile utility is a wonderful commandline tool for this.


Handling your vector LAYERS in the mapfile
Please review the notes in the document Mapfile Tuning & Management. You should also check for any specific MapServer notes for your format in the Vector Data document.

Shapefile Notes
Use shptree to generate a spatial index on your shapefile. This is quick and easy ("shptree foo.shp") and generates a
.qix file. MapServer will automagically detect an index and use it.


MapServer also comes with the sortshp utility. This reorganizes a shapefile, sorting it according to the values in one of its columns. If you're commonly filtering by criteria and it's almost always by a specific column, this can make the process slightly more efficient.
Although shapefiles are a very fast data format, PostGIS is pretty speedy as well, especially if you use indexes well and have memory to throw at caching.

PostGIS Notes


Indexing with PostGIS
The single biggest boost to performance is indexing. Make sure that there's a GIST index on the geometry column, and each record should also have an indexed primary key. If you used shp2pgsql, then these statements should create the necessary indexes:

PostgreSQL also supports reorganizing the data in a table, such that it's physically sorted by the index. This allows PostgreSQL to be much more efficient in reading the indexed data. Use the CLUSTER command, e.g.

Then there are numerous optimizations one can perform on the database server itself, aside from the geospatial com- ponent. The easiest is to increase shared_buffers in the postgresql.conf file, which allows PostgreSQL to use more



memory for caching. It is worth the time to investigate the various options in the Resource Consumption section of the PostgreSQL documentation.

Specifying a Unique ID column
To handle queries, MapServer requires a unique ID column, as part of your PostgreSQL table. MapServer will try to guess the unique ID column, but that is costly as several more database queries have to be made; instead, you should always specify a unique ID column in your DATA statement of the layer, with the using unique syntax, such as:

If your table does not have a unique ID column, you can add one such as:



Debugging speed issues with PostGIS
You may face a situation where your PostGIS table is drawing slowly in MapServer. The following steps will help you examine the issue (using a WFS case) :

• Always start by getting the draw time for your layer, with a map2img command:

• To diagnose if the problem is with your PostGIS table configuration, or with MapServer, execute the exact request sent by MapServer, at the psql.exe commandline, by doing the following steps:
- add into your MAP-level of your mapfile:

- add into your PostGIS LAYER of your mapfile:





- now use a WFS client such as QGIS and add your WFS PostGIS layer
- open "/ms4w/tmp/ms_error.txt" in Notepad++
- search for "msPostGISLayerWhichShapes query:"
- that line should list the long exact query sent from MapServer to the PostreSQL instance, it may look like:



- now connect to that database through psql.exe

- using that error file line, grab everything from "SELECT", and inside your database prompt, start the command with "EXPLAIN ANALYZE" and then paste your full query, such as:

- the response will tell you how long that query took, such as:

- if the query takes a long time to execute at the psql commandline, then you know to focus your efforts on improving the indexing/settings of your PostGIS table.



Databases in General (PostGIS, Oracle, SpatiaLite, GeoPackage, Microsoft SQL Server, MySQL) Enable Connection Pooling
By default, MapServer opens and closes a new database connection for each database-driven layer in the mapfile. If you have several layers reading from the same database, this doesn't make a lot of sense. And with some databases (such as Oracle) establishing connections takes enough time that it can become significant.
Try adding this line to your database layers:

This causes MapServer to not close the database connection for each layer until after it has finished processing the mapfile and this may shave a few seconds off of map generation times.

Set EXTENT at the LAYER level of mapfile
Also for performance, each of your LAYERs with a database connection should have EXTENT set at the layer level (as well as ows_extent metadata if you are serving through OGC services), such as:





Verify that your table has a Spatial Index PostgreSQL/PostGIS example
Once connected through psql commandline, describe the table and look for an "Indexes" section, mentioning geometry, such as:


GeoPackage example
You can use ogrinfo to verify that your GPKG table's geometry has a spatial index, which is very important for perfor- mance (look for HasSpatialIndex (Integer) = 1 to confirm that the spatial index exists) :

and then add a spatial index with ogrinfo :


For WFS services, prevent using default/full extent
For your database connections, MapServer may (by default) use the full extents of your data while performing a query (which can cause slow responses >30seconds). You should likely set the following layer METADATA to disable this:

Here is a fully enhanced layer example:












(continues on next page)



(continued from previous page)


CHAPTER
FOURTEEN



UTILITIES


14.1 Utilities
14.1.1 coshp
Purpose
Sorts an Esri shapefile and its associated qix spatial index (that was created with the shptree utility). Useful for 'Cloud Optimized Shapefiles', to enable fast bounding box spatial filtering.


Description
The idea here is that the contents of the shapefile will be sorted in the same order in the shp file and sorted for its qix
spatial index file as well.

Syntax


Example
This example uses a countries shapefile (countries.shp) :



Result

and the following filenames were generated:





Therefore a new shapefile named countries_sorted.shp is created with shapes sorted (and qix file sorted), as shown below.
Figure1: Attributes Before coshp

Figure2: Attributes After coshp





14.1.2 legend
Purpose
Creates a legend from a mapfile. Output format depends on the graphics library used for rendering.

Syntax


14.1.3 map2img
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Last Updated
2022-08-09






Purpose
map2img is a commandline utility that creates a map image from a mapfile. Output is by default PNG, but you can specify other output formats defined in the mapfile. This is a very useful utility to test your mapfile (and should always be your first test, before any tests through a web browser or OGC client). You can simply provide the path to your mapfile and the name of an output image, and an image should be returned. If an image cannot be created an error will be displayed at the commandline that should refer to a line number in the mapfile.


Syntax







Example #1 Generate a Map Image

Result
A file named 'test.png' is created, that you can drag into your browser to view.


Example #2 Generate a Map Image with Draw Speeds

Result
A file named 'test2.png' is created, and layer draw speeds are returned such as:


Example #3 Generate a Map Image with Debug Information for all Layers

Result
A file named 'test3.png' is created, layer draw speeds are returned, and some warnings that index qix files are not found, such as:










(continues on next page)



(continued from previous page)
msConnPoolClose(demo.sqlite,015672C8) msDrawMap(): Layer 0 (ocean), 0.030s msOGRFileOpen(demo.sqlite)...
OGROPen(D:\ms4w\apps\local-demo/.\./data/demo.sqlite) msConnPoolRegister(countries,demo.sqlite,03561F40) msOGRLayerClose(demo.sqlite).
msOGRFileClose(D:\ms4w\apps\local-demo/.\./data/demo.sqlite,0). msConnPoolRelease(countries,demo.sqlite,03561F40) msConnPoolClose(demo.sqlite,03561F40)
msDrawMap(): Layer 1 (countries), 0.020s msOGRFileOpen(demo.sqlite)...
OGROPen(D:\ms4w\apps\local-demo/.\./data/demo.sqlite) msConnPoolRegister(lakes,demo.sqlite,03517620) msOGRLayerClose(demo.sqlite).
msOGRFileClose(D:\ms4w\apps\local-demo/.\./data/demo.sqlite,2). msConnPoolRelease(lakes,demo.sqlite,03517620) msConnPoolClose(demo.sqlite,03517620)
msDrawMap(): Layer 2 (lakes), 0.009s msOGRFileOpen(demo.sqlite)...
OGROPen(D:\ms4w\apps\local-demo/.\./data/demo.sqlite) msConnPoolRegister(ocean-labels,demo.sqlite,03517620) msOGRLayerClose(demo.sqlite).
msOGRFileClose(D:\ms4w\apps\local-demo/.\./data/demo.sqlite,4). msConnPoolRelease(ocean-labels,demo.sqlite,03517620) msConnPoolClose(demo.sqlite,03517620)
msDrawMap(): Layer 3 (ocean-labels), 0.012s
msLayerIsVisible(): Skipping layer (places) because no CLASS in the layer is in-scale?
??for this MAP scale
msDrawMap(): Drawing Label Cache, 0.004s msDrawMap() total time: 0.075s msSaveImage(test3.png) total time: 0.013s map2img total time: 0.096s

Example #4 Generate a Map Image for a Specific Layer

Result
A file named 'test4.png' is created, and layer draw speeds are returned for 1 layer only, such as:




Example #5 Generate a Map Image for Specific (Multiple) Layers



Result
A file named 'test5.png' is created, and layer draw speeds are returned for only the 2 specified layers, such as:


14.1.4 msencrypt
Purpose
Used to create an encryption key or to encrypt portions of connection strings for use in mapfiles (added in v4.10). Typically you might want to encrypt portions of the CONNECTION parameter for a database connection. The following CONNECTIONTYPEs are supported for using this encryption method:
• OGR
• Oracle Spatial
• PostGIS
• Microsoft SQL Server
Note also passwords for accessing secured WFS services can also be encrypted.

Syntax
To create a new encryption key:

To encrypt a string:


Use in Mapfile
The location of the encryption key can be specified by two mechanisms, either by setting the variable MS_ENCRYPTION_KEY in the ENV section of the MapServer Configuration, or using a CONFIG directive in the MAP object of your mapfile. Prior to MapServer version 8.0 MS_ENCRYPTION_KEY could be set as an environment variable.
For example you can add the following to your mapfile:







Use the { and } characters as delimiters for encrypted strings inside the database CONNECTION in your mapfile. For example:


Example

Here are the steps to encrypt the password in the above connection:
1. Generate an encryption key (note that this key should not be stored anywhere within your web server's accessible directories):

And this generated key file might contain something like:

2. Encrypt the connection's password using that generated key:

Which returns the password encrypted, at the commandline (you'll use it in a second):

3. Edit the mapfile to make sure the 'mykey.txt' can be found, using the "MS_ENCRYPTION_KEY" environment variable. The CONFIG parameter inside the MAP object can be used to set an environment variable inside a mapfile:





4. Modify the layer's CONNECTION to use the generated password key, making sure to use the "{}" brackets around the key:

5. Done! Give your new encrypted Mapfile a try with the map2img utility!

14.1.5 scalebar


Purpose
Creates a scalebar image from a mapfile. Output format of the image (such as PNG, JPEG, etc.) depends on your defined IMAGETYPE in your mapfile.

Syntax


14.1.6 shptree
Purpose
Creates a quadtree-based spatial index for a shapefile. The default tree depth is calculated so that each tree node (quadtree cell) contains 8 shapes. Do not use the default with point files, a value between 6 and 10 seems to work ok. Your mileage may vary and you'll need to do some experimenting.
The shptree wiki page may also contain information on this utility.






Description
This utility is a must for any MapServer application that uses Esri shapefiles. Shptree creates a spatial index of your shapefile, using a quadtree method. This means that MapServer will use this index to quickly find the appropriate shapes to draw. It creates a file of the same name as your shapefile, with a .qix file extension. The quadtree method breaks the file into 4 quadrants, recursively until only a few shapes are contained in each quadrant. This minimum number can be set with the <depth> parameter of the command.

Syntax

Example

Result
A file named 'us_states.qix' is created in the same location. (note that you can use the shptreevis utility, described next, to view the actual quadtree quadrants that are used by MapServer in this qix file)

Mapfile Notes
Shapefiles are native to MapServer, and therefore do not require the .shp extension in the DATA path of the LAYER, but it is always recommended to specify the extension. For earlier versions of MapServer (before MapServer 5.2), in order for MapServer to use the .qix extension you were required to NOT specify the extension, for example:







14.1.7 shptreetst
Purpose
Executes a spatial query on an existing spatial index (.qix), that was created by the shptree utility. This utility is useful to understand how a search of a shapefile and its qix index works.

Syntax

Example




shapes6,node4,-13702.315770,3973784.599548,1127752.921471,4859616.714055shapes5,node3,-13702.315770,3973784.599548,614098.064712,4460992.262527shapes1,node1,-13702.315770,3973784.599548,331587.893495,4241748.814186shapes1,node0,141678.278400,3973784.599548,331587.893495,4121164.917599shapes1,node0,268807.855447,4193028.047889,614098.064712,4460992.262527shapes1,node0,268807.855447,3973784.599548,614098.064712,4241748.814186shapes7,node4,-13702.315770,4372409.051076,614098.064712,4859616.714055shapes1,node0,-13702.315770,4372409.051076,331587.893495,4640373.265714shapes3,node1,-13702.315770,4591652.499417,331587.893495,4859616.714055shapes1,node0,-13702.315770,4712236.396004,176207.299326,4859616.714055shapes2,node0,268807.855447,4372409.051076,614098.064712,4640373.265714shapes3,node2,268807.855447,4591652.499417,614098.064712,4859616.714055shapes2,node0,424188.449617,4712236.396004,614098.064712,4859616.714055shapes1,node0,424188.449617,4591652.499417,614098.064712,4739032.817468shapes2,node1,499952.540988,3973784.599548,1127752.921471,4460992.262527shapes2,node0,499952.540988,4193028.047889,845242.750254,4460992.262527shapes5,node3,499952.540988,4372409.051076,1127752.921471,4859616.714055shapes1,node1,499952.540988,4372409.051076,845242.750254,4640373.265714shapes1,node0,655333.135158,4372409.051076,845242.750254,4519789.369127shapes1,node0,499952.540988,4591652.499417,845242.750254,4859616.714055



Result
The above output from the shptreetst command tells us that the existing .qix index is for a shapefile that contains 48 shapes; indeed the shapefile used in this example, esp.shp, contains 48 polygons of Spain. The command also tells us that qix file has a quadtree depth of 4.
Most importantly, the resulting shape IDs (or feature IDs) that were contained in the bounding box that we passed in our example were returned at the bottom of the output: "8, 10, 36, 37, 38, 39, 42, 46". You can use a tool such as QGIS to view those feature IDs and check what shapes MapServer is querying when a user clicks within that bounding box.



. index::
pair: Utility; shptreevis

14.1.8 shptreevis
Purpose
This utility can be used to view the quadtree quadrants that are part of a .qix file (that was created with the shptree
utility).

Syntax


Example

Result
A shapefile named quad.shp is created. You can now view this shapefile in a desktop GIS (such as QGIS for example) to see the quadtrees that were created with the shptree command, as shown below.
Figure: shptreevis result displayed in QGIS



14.1.9 sortshp
Purpose
Sorts an Esri shapefile based on a single column in ascending or descending order. Supports INTEGER, DOUBLE and STRING column types. Useful for prioritizing shapes for rendering and/or labeling.

Description
The idea here is that if you know that you need to display a certain attribute classed by a certain value, it will be faster for MapServer to access that value if it is at the beginning of the attribute file.

Syntax


Example
This example uses a roads file (roads_ugl) that has a field with road classes in integer format (class1).


Result
A new shapefile named roads-sort.shp is created with shapes sorted in ascending order, according to the values in the
class1 field, as shown below.
Figure1: Attributes Before sortshp

Figure2: Attributes After sortshp





14.1.10 sym2img


Purpose
Creates a graphic dump of a symbol file. Output is either PNG or GIF depending on what version of the GD library used. (this utility is not currently included in pre-compiled packages, due to issues mentioned in bug#506)

Syntax


14.1.11 tile4ms
Purpose
Creates a tile index shapefile for use with MapServer's TILEINDEX feature. The program creates a shapefile of rect- angles from extents of all the shapefiles (.shp) listed in [metafile] (one shapefile name per line) and the associated DBF with the filename for each shape tile in a column called LOCATION as required by mapserv.






Description
This utility creates a shapefile containing the MBR (minimum bounding rectangle) of all shapes in the files (actually shapefiles) provided, which can then be used in the LAYER object's TILEINDEX parameter of the mapfile. The new filed created with this command is used by MapServer to only load the files associated with that extent (or tile).

Syntax


Short Example
Create tileindex.shp for all tiles under the /path/to/data directory:


Long Example
This example uses TIGER Census data, where the data contains files divided up by county (in fact there are over 3200 counties, a very large dataset indeed). In this example we will show how to display all lakes for the state of Minnesota. (note that here we have already converted the TIGER data into Shape format, but you could keep the data in TIGER format and use the ogrtindex utility instead) The TIGER Census data for Minnesota is made up of 87 different counties, each containing its own lakes file ('wp.shp').
1. We need to create the 'meta-file' for the tile4ms command. This is a text file of the paths to all 'wp.shp' files for the MN state. To create this file we can use a few simple commands:



(continues on next page)



(continued from previous page)
The newly created file might look like the following (after removing the full path):

2. Execute the tile4ms command with the newly created meta-file to create the index file:

3. A new file named 'index.shp' is created. This is the index file with the MBRs of all 'wp.shp' files for the entire state, as shown in Figure1. The attribute table of this file contains a field named 'LOCATION', that contains the path to each 'wp.shp file', as shown in Figure2.
Figure 1: Index file created by tile4ms utility




Figure 2: Attributes of index file created by tile4ms utility

4. The final step is to use this in your mapfile.
• LAYER object's TILEINDEX - must point to the location of the index file
• LAYER object's TILEITEM - specify the name of the field in the index file containing the paths (default is 'location')
   • do not need to use the LAYER's DATA parameter For example:

When you view the layer in a MapServer application, you will notice that when you are zoomed into a small area of the state (such as a single county) only those necessary lake shapefiles are loaded, which speeds up the application.


14.1.12 Batch Scripting
If you need to run the utilities on multiple files/folders, here are some commands that will help you:

Windows
type the following at the command prompt:

or to run recursively (throughout all subfolders):


Linux


14.1.13 File Management
File Placement
MapServer requires a number of different files to execute. Except for graphics that are referenced in output templates (i.e. web pages) none of the data or configuration files need be accessible via a web server. File naming for MapServer follows two rules:
1. Files may be given using their full system path. or
2. Files may be given using a relative path where the path is relative to the location of the file they are being referenced from.
So, for files referenced in the mapfile they can be given relative to the location of the mapfile. Same holds true for symbol sets and font sets.

Temporary Files
MapServer also can produce a number of files (i.e. maps, legends, scalebars, etc. . . ). These files must be accessible using a web server. To accomplish this MapServer creates these files in a scratch directory. The location of that directory is given using the IMAGEPATH and IMAGEURL parameters in the web section of a mapfile. The scratch directory must be writable by the user that the web server runs under, usually nobody. It is recommended for security reasons that the web user own the scratch directory rather than making it world writable. The scratch area will need to be cleaned periodically. On busy sites this may need to happen several times an hour. Here's an example shell script that could be run using cron:


Windows
The following .bat file can be used in 'Scheduled Tasks' to remove these temporary images daily:



(continues on next page)



(continued from previous page)


CHAPTER
FIFTEEN



CGI


15.1 CGI
Author
Daniel Morissette
Contact
dmorissette at mapgears.com
Author
Jeff McKenna
Contact
jmckenna at gatewaygeomatics.com
Author
Frank Koormann
Last Updated
2023-04-18

15.1.1 MapServer CGI Introduction
Notes
• Variable names are not case sensitive.
• In cases where multiple values are associated with a variable (eg. mapext), the values must be separated by spaces (or their escaped equivalents for GET requests).
• Variable contents are checked for appropriate data types and magnitude as they are loaded.
• Any CGI Variable not listed below is simply stored and can be referenced within a template file.

Changes
From MapServer version 4.x to version 5.x
• Modifying map parameters through a URL has changed to allow for chunks of a mapfile to be modified at once. The syntax has changed accordingly, so please see the Changing mapfile parameters via a form or a URL section.

From MapServer version 3.x to version 4.x
• New way to perform attribute queries: No longer do you set a layer filter, but rather you pass a query string (and optionally a query item) to the query function. To do this two new CGI parameters were added to MapServer: QSTRING and QITEM.



• SAVEMAP is switched off: The SAVEMAP functionality is considered insecure, since the saved files are acces- sible by everyone.
• TEMPLATE has been removed, since the map_web_template syntax can be used to alter a template file. Simpli- fies security maintenance by only having to deal with this option in a single place. Note that the TEMPLATEPAT- TERN of the mapfile has to be used to enable this feature.

15.1.2 mapserv
The CGI interface can be tested at the commandline by using the "QUERY_STRING" switch, such as:

To suppress the HTTP headers, you can use the "-nh" switch, such as:

To save the output into an image file, use the pipe command such as:


15.1.3 Map Context Files
Support for Local Map Context Files
There is a CGI parameter called CONTEXT that is used to specify a local context file. The user can then use MapServer to request a map using the following syntax:



Support for Context Files Accessed Through a URL
The syntax of using a web accessible context file would be similar to accessing a local context file:

Due to security concerns loading a file from a URL is disabled by default. To enable this functionality, the user needs to set a CONFIG parameter called CGI_CONTEXT_URL in the default map file that will allow this functionality. Here is an example of a map file with the CONFIG parameter:








(continues on next page)



(continued from previous page)

Default Map File
To smoothly run a MapServer CGI application with a Map Context, the application administrator needs to provide a default map file with at least the basic required parameters that will be used with the Context file. This default map file can contain as little information as the imagepath and imageurl or contain a list of layers. Information coming from the context (e.g.: layers, width, height, â€¦) would either be appended or will replace values found in the map file.
Here is an example of a default map file containing the minimum required parameters:


15.1.4 MapServer CGI Controls




Variables
Variable names are not case sensitive.
BUFFER [distance]
A distance, in the same coordinate system as the map file, used in conjunction with MAPXY to create an new map extent.
CLASSGROUP [name]
The name of a LAYER CLASSGROUP. Set the LAYER CLASSGROUP to name for all layers that have at least one CLASS that is using the given CLASSGROUP name.
CONTEXT [filename]
Path to a context file. Path is relative to the map file to be used, or can also be a URL path (See the section "Map Context Support Through CGI" below for more details).
ICON [layername],[classindex]
Used in MODE=legendicon to generate a legend icon for a layer. The class index value is optional and defaults to 0.
ID [id-string]
By default MapServer generates a unique session id based on system time and process id. This parameter over- writes the default.

IMG


The name associated with the inline map image used to record user clicks. What actually is passed are two variables, img.x and img.y.
For the CGI Applications this is an essential variable, see the examples for sample usage.

IMGBOX [x1] [y1] [x2] [y2]
Coordinates (in pixels) of a box drag in the image. Most often used in conjunction with Java based front ends to the MapServer.
IMGEXT [minx] [miny] [maxx] [maxy]
The spatial extent of the existing inline image, that is, the image the users can see in their browser.
IMGSHAPE [x1 y1 x2 y2 x3 y3 . . . ] | [WKT]
An arbitrary polygon shape (specified using image coordinates) to be used for query purposes.
The polygon is specified by listing its coordinates (multiple instances simply add parts to the shape so it is possible to construct a shape with holes) or by specifying the WKT (Well Known Text) representation.
Used with the NQUERY mode.
IMGSIZE [cols] [rows]
The size (in pixels) of the exiting inline image.
IMGXY [x] [y]
Coordinates (in pixels) of a single mouse click. Used most often in conjunction with Java based front ends to the MapServer.
LAYER [name]
The name of a layer as it appears in the map file. Sending mapserv a layer name sets that layer's STATUS to ON.
LAYERS [name name . . . ]
The names of the layers to be turned on. Layer names must be separated by spaces. Version 4.4 and above: passing 'LAYERS=all' will automatically turn on all layers.
MAP [filename]
Path, relative to the CGI directory, of the map file to be used.



MAPEXT [minx] [miny] [maxx] [maxy] , MAPEXT (shape)
The spatial extent of the map to be created.
Can be set to shape as an alternative option. In this case mapextent is set to the extent of a selected shape. Used with queries.
MAPSHAPE [x1 y1 x2 y2 x3 y3 . . . ] | [WKT]
An arbitrary polygon shape (specified using map coordinates) to be used for query purposes.
The polygon is specified by listing its coordinates (multiple instances simply add parts to the shape so it is possible to construct a shape with holes) or by specifying a WKT (Well Known Text) representation of the polygon.
Used with the NQUERY mode.
MAPSIZE [cols] [rows]
The size (in pixels) of the image to be created. Useful for allowing users to change the resolution of the output map dynamically.
MAPXY [x] [y] , MAPXY (shape)
A point, in the same coordinate system as the shapefiles, to be used in conjunction with a buffer or a scale to construct a map extent.
Can be set to shape as an alternative option. In this case mapextent is set to the extent of a selected shape. Used with queries.
MINX | MINY | MAXX | MAXY [number]
Minimum/Maximum x/y coordinate of the spatial extent for a new map/query. This set of parameters are the pieces of MAPEXT.
MODE [value]
Mode of operation. The following options are supported:
BROWSE
Fully interactive interface where maps (and interactive pages) are created. This is the default mode.
COORDINATE
Returns a string of map coordinates based on a user click on an image.

FEATURENQUERY
A spatial search that uses multiple features from SLAYER to query other layers.
FEATUREQUERY
A spatial search that uses one feature from SLAYER to query other layers.
INDEXQUERY
Looks up a feature based on the values of SHAPEINDEX and TILEINDEX parameters. SHAPEINDEX is required, TILEINDEX is optional and is only used with tiled shapefile layers.
ITEMFEATURENQUERY
A text search of attribute data is triggered using a QSTRING. Returns all matches. Layer to be searched is defined using slayer parameter. The results of this search are applied to other searchable layers (which can be limited using the QLAYER parameter).
ITEMFEATUREQUERY
A text search of attribute data is triggered using a QSTRING. Returns first match. Layer to be searched is defined using slayer parameter. The results of this search are applied to other searchable layers (which can be limited using the QLAYER parameter).



ITEMNQUERY
A text search of attribute data is triggered using a QSTRING. Returns all matches.
ITEMQUERY
A text search of attribute data is triggered using a layer QSTRING. Returns 1st match.
LEGEND
The created legend is returned. Used within an <img . . . > tag.
LEGENDICON
A legend icon is returned. The ICON parameter must also be used to specify the layername and a class index. Class index value is optional and defaults to 0. For example:

MAP
The created map is returned. Used within an <img . . . > tag.
NQUERY
A spatial search (finds all) is triggered by a click in a map or by user-define selection box.
QUERY
A spatial search (finds closest) is triggered by a click in a map.
REFERENCE
The created reference map is returned. Used within an <img . . . > tag.
SCALEBAR
The created scalebar is returned. Used within an <img . . . > tag.
TILE
Generate a map tile. See Tile Mode for details.
ZOOMIN
Switch to mode BROWSE with ZOOMDIR=1
ZOOMOUT
Switch to mode BROWSE with ZOOMDIR=-1


QFORMAT [outputformat | mime/type] (optional)
The OUTPUTFORMAT name or mime/type to be used to process a set of query results (corresponds to the WEB object's QUERYFORMAT parameter). The parameter is optional and used in conjunction with query MODEs. The default is text/html.
Example (map output):

QITEM [name] (optional)
The name of an attribute in a layer attribute table to query on. The parameter is optional and used in conjunction with the QSTRING for attribute queries.
QLAYER [name]
Query layer. The name of the layer to be queried as it appears in the map file.



QSTRING [expression]
Attribute queries: Query string passed to the query function. Since 5.0, qstring will have to be specified in the VALIDATION parameter of the LAYER for qstring queries to work (qstring_validation_pattern LAYER-level METADATA for MapServer versions prior to 5.4).
QUERYFILE [filename]
Used with BROWSE or NQUERY mode. This option identifies a query file to load before any regular processing. In BROWSE mode this result in a query map being produced instead of a regular map. This is useful when you want to hilite a feature while still in a pan/zoom mode. In NQUERY mode you'd gain access to any of the templates used in normally presenting the query, so you have access to query maps AND attribute information. See the SAVEQUERY option.

REF


The name associated with the inline reference map image used to record user clicks. What actually is passed are two variables, ref.x and ref.y.
For the CGI Applications this is an essential variable when reference maps are used, see the examples for sample usage.

REFXY [x] [y]
Coordinates (in pixels) of a single mouse click in the reference image. Used in conjunction with Java based front ends to the MapServer.
SAVEQUERY
When used with any of the query modes this tells the MapServer to save the query results to a temporary file for use in subsequent operations (see QUERYFILE). Useful for making queries persistent.
SCALEDENOM [number]
Scale to create a new map at. Used with mapxy. Scale is given as the denominator of the actual scale fraction, for example for a map at a scale of 1:24,000 use 24000. Implemented in MapServer 5.0, to replace the deprecated SCALE parameter.
SCALE [number] - deprecated
Since MapServer 5.0 the proper parameter to use is SCALEDENOM instead. The deprecated SCALE is the scale to create a new map at. Used with mapxy. Scale is given as the denominator of the actual scale fraction, for example for a map at a scale of 1:24,000 use 24000.
SEARCHMAP
It is possible to do pan/zoom interfaces using querymaps. In these cases you will likey want information about the contents of the new map rather than the previous map which is the normal way queries work. When searchmap is specified the new map is created and it's extent is used to query layers. Useful with NQUERY mode only.
SHAPEINDEX [index]
Used for index queries (in conjunction with INDEXQUERY).
SLAYER [name]
Select layer. The name of the layer to be used for any of the feature (i.e. staged) query modes. The select layer must be a polygon layer. The selection feature(s) are available for presentation to the user.
TILE [coord]
Used in MODE=TILE. Tile coordinates. See Tile Mode for details.
TILEINDEX [index]
Used for index queries (in conjunction with INDEXQUERY), used with tiled shapefile layers.
TILEMODE [mode]
Used in MODE=TILE. mode can be gmap (Google Maps) or ve (Bing Maps/Virtual Earth). See Tile Mode for details.
TILESIZE [width] [height]



Added in version 8.0.
Used in MODE=TILE. width and height are the tile dimension in in pixels. If not specified, defaults to 256x256. See Tile Mode for details.
ZOOM [number]
Zoom scaling to apply to the creation of the new map. Values greater than 0 resulting in zooming in, 0 is a pan, and values less than zero are for zooming out. A value of 2 means "zoom in twice".
ZOOM can be used as a shortcut for the combination ZOOMDIR/ZOOMSIZE. The zoom is limited by the MINZOOM/MAXZOOM settings compiled into the MapServer (-25/25) by default.
ZOOMDIR [1 | 0 | -1]
Direction to zoom. See above.
ZOOMSIZE [number]
Absolute magnitude of a zoom. Used with ZOOMDIR.
ZOOMDIR is limited to MAXZOOM compiled into the MapServer (25 by default).

Changing mapfile parameters via a form or a URL
Beginning with version 3.3 it is possible to change virtually any mapfile value from a form or a URL (see Run-time Substitution). The syntax for this is fairly straightforward, and depends on what version of MapServer you are using. One potentially very powerful use of this ability to change mapfile parameters through a URL involves changing class expressions on-the-fly. VALIDATION is used to control run-time substition. Try it out.


Using MapServer version < 8



Previous versions of the MapServer CGI program allowed certain parameters to be changed via a URL using a cum- bersome syntax such as map_layer_0_class_0_color=255+0+0 which changes the color in one classObj. So, in the past you had to change parameters one-at-a-time. Now you can pass chunks of mapfiles (with security restrictions) to the CGI interface. The map_object notation is still necessary to identify which object you want to modify but you can change multiple properties at one time. Note that you can use either a '_' or a '.' to separate identifiers.
Example 1, changing a scalebar object:

Example 2, changing a presentation style:

Example 3, creating a new feature:





Example 4, set multiple web object parameters:

Example 5, set the map size:

The variable identifies an object uniquely (by name or index in the case of layerObj's and classObj's). The value is a snippet of a mapfile. You cannot create new objects other than inline features at this point.

15.1.5 Run-time Substitution
Author
Steve Lime
Contact
sdlime at gmail.com
Last Updated
2023-04-19


Introduction
Run-time substitution for the MapServer CGI has been around since version 4.0 and it's use has continued to expand. In short, it allows you to alter portions of a mapfile based on data passed via a CGI request.





Case sensitivity
Since version 6.4, CGI parameter names are not case sensitive. CGI parameter values are case sensitive.

Basic Example
Let's say you'd like the user to dynamically set a portion of an expression so they could highlight a certain land cover class, and you have a form element (called ctype) that allows them to choose between: forest, water, wetland and developed.
A request should look like (assuming "marsh" is a valid land cover class):

You could then set up a layer like so:

Values for the ctype parameter are limited to lower-case characters a to z and the value can be from 5 to 10 characters long. The regex start (^) and end ($) anchors are important in limiting values - always use them.
When a request is processed, the value for ctype is substituted for the string %ctype% and the mapfile is processed as normal. If no ctype is passed in, the EXPRESSION will never be true so it doesn't really hurt anything except for a slight performance hit. Often you would set a default class to draw features that don't match, but that is not required.

Parameters Supported
Not every mapfile parameter supports run-time substitution and care has been taken to try and support those that make the most sense. All parameters must be validated. Remember, you also can do run-time configuration using the map_object_property type syntax detailed in Changing mapfile parameters via a form or a URL. Below is a list of properties that do allow run-time substitution:
• CLASS: EXPRESSION
• CLASS: TEXT
• CLASS: TITLE



• LAYER: BINDVALS
• LAYER: CONNECTION
• LAYER: DATA
• LAYER: FILTER
• LAYER: MASK
• LAYER: TILEINDEX
Added in version 7.0.
   • LAYER: METADATA (values only, not keys) Added in version 7.0.
• LAYER: PROCESSING
Added in version 6.2.
• OUTPUTFORMAT: all FORMATOPTIONs
Added in version 7.0.
• OUTPUTFORMAT: all FORMATOPTIONs
Added in version 7.0.
   • MAP->WEB: METADATA (values only, not keys) Added in version 8.0.1.
• MAP->WEB: TEMPLATE

FILTERs
You can use runtime substitutions to change values within a FILTER as you go. For example your FILTER could be written like so:

Then (assuming you're using the CGI interface) you could pass in variables named multimedia, nseats and sound with values defined by the user in an HTML form.
You should also define VALIDATION expressions on these variables to guard against unintentional SQL being submit- ted to postgis (since version 6.0, validation is mandatory). Within the layer you'd do the following:

The validation strings are regular expressions that are applied against the appropriate variable value before being added to the FILTER. The first two limit the value of multimedia and sound to yes or no. The third limits the value for nseats to a 2 digit integer.



Default values if not provided in the URL
The runtime substitution mechanism will usually create syntactically incorrect, and almost always semantically incor- rect mapfiles if the substitution parameter was not provided in the calling URL.
Since version 5.6, you can provide a default value for any substitution parameter, that will be applied if the parameter was not found in the url. You do this by providing special entries inside CLASS, LAYER or WEB validation blocks:

In this example, the mapfile will be created as if the url contained "&sound=yes&nseats=5&multimedia=yes".
Providing a default value for a substitution parameter in the WEB section of the MAP wasn't implemented until version 7.0.7.
If identical default keys appear in more than one validation block then keys in more specialised blocks override those in more generalised blocks. i.e. CLASS overrides LAYER which overrides WEB. The same functionality is available using METADATA blocks instead of VALIDATION but this is deprecated as of MapServer 5.4.0. This behavior is also accessible in the map2img utility, allowing you to test runtime substitution mapfiles without using a webserver.

VALIDATION
Because runtime substitution affects potentially sensitive areas of your mapfile, such as database columns and filenames, it is mandatory that you use pattern validation (since version 6.0)
Pattern validation uses regular expressions, which are strings that describe how to compare strings to patterns. The exact functionality of your systems' regular expressions may vary, but you can find a lot of general information by a Google search for "regular expression tutorial".
As of MapServer 5.4.0 the preferred mechanism is a VALIDATION block in the LAYER definition. This is only slightly different from the older METADATA mechanism. VALIDATION blocks can be used with CLASS, LAYER and WEB.

If identical keys appear in more than one validation block then keys in more specialised blocks override those in more generalised blocks. i.e. CLASS overrides LAYER which overrides WEB.

Magic values
Some runtime substitutions have special caveats.
ID
In addition to any defined METADATA or VALIDATION, the 'id' parameter will be subjected to a special check. It must be alphanumeric and cannot be longer than 63 characters.


15.1.6 A Simple CGI Wrapper Script
Author
Steven Monai
Last Updated
2006/01/26


Introduction
This document presents a simple shell script that can be used to "wrap" the MapServer CGI, in order to avoid having to specify the 'map' parameter (or any other chosen parameters) in your MapServer URLs.


Script Information
If you want to avoid having to specify the 'map' parameter in your MapServer URLs, one solution is to use a "wrapper". Basically, a wrapper is a CGI program that receives an incoming CGI request, modifies the request parameters in some way, and then hands off the actual processing to another CGI program (e.g. MapServer).
The following shell scripts are wrappers for CGI GET requests that should be generic enough to run on any OS with
/bin/sh.

Alternative 1

You should set the MAPSERV and MS_MAPFILE variables as appropriate for your configuration. MAPSERV points to your MapServer executable, and MS_MAPFILE points to the mapfile you want MapServer to use. Both variables should be absolute file paths that your webserver has permission to access, although they need not (and probably should not) be in web-accessible locations. Put the script in your web server's cgi-bin directory, and make it executable.
This solution should support both GET and POST requests.



Alternative 2

You should set the MAPSERV and MAPFILE variables as appropriate for your configuration. MAPSERV points to your MapServer executable, and MAPFILE points to the mapfile you want MapServer to use. Both variables should be absolute file paths that your webserver has permission to access, although they need not (and probably should not) be in web-accessible locations. Then put the script in your web server's cgi-bin directory, and make it executable.
Although this script only sets the 'map' parameter, it is easily modified to set any number of other MapServer parameters as well. For example, if you want to force your MapServer to 'map' mode, you can simply add 'mode=map' to the front of the QUERY_STRING variable. Just remember to separate your parameters with ampersands ('&').
Finally, note that the script only works for GET requests.

15.1.7 MapServer OpenLayers Viewer
MapServer (since the 6.0 release) provides a simple, built-in method for testing a mapfile using OpenLayers. This feature is for testing and development purposes only, and not for production or deploying full-featured sites. You can preview, test, and navigate a mapfile by accessing a special URL which will return a built-in OpenLayers template.


Up to the MapServer 8.4 release the OpenLayers Viewer was based on OpenLayers 2. As of MapServer 8.6 the Open- Layers viewer was updated to work with OpenLayers 10.5+. The MapServer CGI Layer, used by the viewer, can be see in the OpenLayers examples.

Using the OpenLayers viewer
Opening the OpenLayers viewer in your browser
Assuming you are running MapServer on your local machine, and you have the Itasca demo setup, a basic URL would be:

Here is a quick breakdown of that URL:



• Basic Parameters for activating the OpenLayers browser:

• Basic Map / Layer parameters:

When using the mode=browse MapServer will create an image on the server. By default this will be in the same folder as the mapfile. If this MapServer cannot write to this folder you will see an error similar to:

In this case you will need to set your IMAGEPATH to a folder MapServer can write to.
That's it!


Opening the OpenLayers viewer in the form of a WMS request
This feature is useful when debugging WMS requests. You can write one of these by hand, or copy the URL for a WMS tile. Running the following should give you a simple OpenLayers demo around the BBOX (split into several lines for readability):

Here is a quick breakdown of the interesting parts of that URL:
• Special Parameter for activating the OpenLayers viewer:

• Basic MapServer Parameters:

• Basic WMS parameters:






(continues on next page)



(continued from previous page)


Customizing settings
The viewer relies on two external files - a JavaScript file and a CSS file. By default these are loaded from https:// mapserver.org/lib/, however you can use your own copies of these files if external network access is restricted by setting the following two Environment Variables:
• MS_OPENLAYERS_JS_URL - the URL to the OpenLayers JavaScript library.
• MS_OPENLAYERS_CSS_URL - the URL to the OpenLayers CSS file used for styling.
These variables can also be set in a mapfile, for example to point to the full OpenLayers build on a CDN (Content Delivery Network):


Location of the embedded OpenLayers.js file
If you aren't providing your own OpenLayers library through MS_OPENLAYERS_JS_URL and MS_OPENLAYERS_CSS_URL, MapServer will point to hard-coded filepaths at mapserver.org/lib to find the OpenLayers library, referred to in maptemplate.c.
This version of OpenLayers is a cut-down version that only contains the classes needed for the MapServer viewer. The
ol-mapserver.js file is ~200 KB compared to the full library which is ~ 840 KB.
The contents of that lib folder is stored in the MapServer documentation repository, in the /extra folder. You are warmly encouraged to contribute to upgrading the OpenLayers library, at any time (maybe start with creating a new Pull Request there).


CHAPTER
SIXTEEN



GLOSSARY



16.1 Glossary
AGG



CGI

Anti-Grain Geometry A high quality graphics rendering engine that MapServer 5.0+ can use. It supports sub- pixel anti-aliasing, as well as many more features.

Wikipedia provides excellent coverage of CGI.

EPSG
EPSG codes are numeric codes associated with coordinate system definitions. For instance, EPSG:4326 is ge- ographic WGS84, and EPSG:32611 is "UTM zone 11 North, WGS84". The WMS protocol uses EPSG codes to describe coordinate systems. EPSG codes are published by the OGP Surveying and Positioning Commit- tee. A list of PROJ definitions corresponding to the EPSG codes can be found: for PROJ version >= 6, in the SpatiaLite database proj.db at /usr/local/share/proj/proj.db, or for PROJ version < 6, in the text file epsg at
/usr/local/share/proj/epsg. PROJECTION describes how to use these in your Mapfile.

See alsohttps://spatialreference.org for a listing of spatial references and an interface to search for EPSG codes (the site https://epsg.io/ might also be useful).
Filter Encoding
Filter Encoding is an OGC standard which defines an XML encoding for filter expressions to allow for spatial and attribute querying.

See alsoWFS Filter Encoding
FreeType
FreeType is a font engine that MapServer uses for accessing and rendering TrueType fonts.
GD
GD is a graphics library for dynamic generation of images. It was the first graphics renderer that was available for MapServer, and was required by MapServer to operate.




WarningGD support was removed in MapServer 7.0.
GDAL
GDAL (Geospatial Data Abstraction Library) is a multi-format raster reading and writing library. It is used as the primary mechanism for reading raster data in MapServer. It is hosted at https://gdal.org/
GEOS
Geometry Engine Open Source is a C/C++ port of the Java Topology Suite. It is used for geometric algebra operations like determining if a polygon is contained in another polygon or determining the resultant intersection of two or more polygons. MapServer optionally uses GEOS for geometric algebra operations.
GML
Geography Markup Language is an OGC standard which defines an abstract model for geographic features

See alsoWFS Server

GPX


GPS eXchange Format is an XML Schema for describing GPS data. OGR can be used to transform and render this data with MapServer.

Map Scale
A  treatise  of  mapping  scale  can  be  found  at https://www.thoughtco.com/ map-scale-measuring-distance-on-map-1433533 .
Mapfile
Mapfile is the declarative language that MapServer uses to define data connections, map styling, templating, and server directives. It must be named with the .map extension, and its format is XML-like and hierarchical, with closing END tags, but the format is not XML.
MapScript
MapScript is an alternative the the CGI application of mapserv that allows you to program the MapServer object API in many languages.
Mercator
Wikipedia provides excellent coverage of the Mercator projection.

OGC


The Open Geospatial Consortium is a standards organization body in the GIS domain. MapServer supports numerous OGC standards.


See alsoWMS Server and WMS Time and WMS Client and WFS Server and WFS Client and WCS Server and Map Context and SLD and WFS Filter Encoding and SOS Server
OGR OGR is the vector data access portion of the GDAL library. It provides access to a multitude of data formats.




See alsoOGR Vector Layers Through MapServer (Accessing OGR Layers through MapServer)
OM
Observations and Measurements is an OGC standard which defines an abstract model for sensor based data.

See alsoSOS Server
OpenLayers
OpenLayers is a JavaScript library for developing draggable, "slippy map" web applications.
PROJ
PROJ (formerly referred to as PROJ.4) is a library for projecting map data. It is used by MapServer and GDAL and a multitude of other Open Source GIS libraries.
Projection
A map projection is a mathematical transformation of the surface of a sphere (3D) onto a 2D plane. Due to the laws of the universe, each type of projection must make tradeoffs on how and what features it distorts.
Raster
A raster is a rectangular grid of pixels. Essentially an image. Rasters are supported in MapServer with a layer type of RASTER, and a variety of formats are supported including GeoTIFF, JPEG, and PNG.
Shapefile
Shapefiles are simple GIS vector files containing points, lines or areas. The format was designed and published by ESRI and is widely supported in the GIS world. It is effectively the native and highest performance format for MapServer.

See alsoWikipedia
SLD
SLD is an OGC standard which allows for custom symbolization for portrayal of data.

See alsoSLD

SOS


SOS is an OGC standard which provides an API for managing deployed sensors and retrieving sensor and ob- servation data.


See alsoSOS Server
Spherical Mercator
Spherical Mercator (or more commonly known as the Google Mercator, or Web Mercator) is a term used to





SVG






SWF


describe the default PROJECTION used by many commercial API providers for their resulting map tiles & services. The associated official EPSG code is EPSG:3857 (formerly "EPSG:900913").

Scalable Vector Graphics is an XML format that MapServer can output. It is frequently used in browser and mobile devices.

See alsoSVG
Shockwave Flash format that MapServer can generate for output.


See alsoFlash Output
SWIG
Simplified Wrapper Interface Generator is the library that MapServer uses for generating the language bindings for all languages other than C/C++ and PHP. MapScript describes these bindings.
Tileindex
A tileindex is a Shapefile or other Vector data source that contains footprints of Raster data coverage. MapServer can use a tileindex to render a directory of raster data. The tileindex allows MapServer to only read the data that intersects the requested map extent, rather than reading all of the data.

See alsoTile Indexes
Vector
Geographic features described by geometries (point, line, polygon) on a (typically) cartesian plane.

WCS






WFS


WCS is an OGC standard that describes how to systematically produce structured Raster cartographic data from a service and return them to a client

See alsoWCS Server and WCS Use Cases
WFS is an OGC standard that describes how to systematically produce structured Vector cartographic data from a service and return them to a client.




See alsoWFS Server and WFS Client
WMC
Web Map Context is an OGC standard which allows for sharing of map views of WMS layers in multiple appli- cations.

See alsoMap Context

WMS


WMS is an OGC standard that describes how to systematically produce rendered map images from a service and return them to a client.


See alsoWMS Server and WMS Client

CHAPTER
SEVENTEEN



ERRORS



17.1 Errors


• Errors
- drawEPP(): EPPL7 support is not available
- loadLayer(): Unknown identifier. Maximum number of classes reached
- loadMapInternal(): Given map extent is invalid
- msGetLabelSize(): Requested font not found
- msLoadFontset(): Error opening fontset
- msLoadMap(): Failed to open map file
- msProcessProjection(): no options found in 'init' file
- msProcessProjection(): No such file or directory
- msProcessProjection(): Projection library error. PROJ error "Cannot find proj.db" when instantiating "init=epsg:XXXX"
- msProcessProjection(): Projection library error.major axis or radius = 0 not given
- msQueryByPoint: search returned no results
- msReturnPage(): Web application error. Malformed template name
- msSaveImageGD(): Unable to access file
- msWMSLoadGetMapParams(): WMS server error. Image Size out of range, WIDTH and HEIGHT must be between 1 and 2048 pixels
- Unable to load dll (MapScript)


17.1.1 drawEPP(): EPPL7 support is not available
Error displayed when not using EPPL7 data.
This is a confusing error for users who are not even trying to view EPPL7 layers (EPPL7 is a raster format). The full error displayed may appear as follows:






Explanation
When MapServer tries to draw a layer, it will attempt to use all of the drivers it knows about, and the EPPL7 driver is the very last driver it will try. This means that if a layer fails to draw for any reason, you will see this error message.
There are other possible instances when this error can appear however, here are a few:
• the server is returning either a ServiceException (which MapServer does not yet detect and parse into a reasonable error message) or it is returning an image in an unrecognized format . . . for instance it is returning a GIF image and MapServer is not built to support GIF images.
• WMS servers often advertise multiple image formats but don't respect them in the getmap request.

17.1.2 loadLayer(): Unknown identifier. Maximum number of classes reached
Error displayed when attempting to draw a layer with a large number of classes.
This error states that MapServer has reached its limit for the maximum number of classes for the layer. This maximum can be modified in the MapServer source, and can then be re-compiled. map.h contains the default values, and below are the defaults for MapServer 4.10 and 4.8:



17.1.3 loadMapInternal(): Given map extent is invalid
When loading your mapfile or one of your layers, MapServer complains about an invalid extent.
Beginning in MapServer 4.6, MapServer got more strict about LAYER and MAP extents. If minx is greater than maxx, or miny is greater than maxy, this error will be generated. Check your MAP's EXTENT, LAYER's EXTENT, or wms_extent setting to make sure this is not the case. MapServer always takes in extents in the form of:


How to get a file's EXTENT values?
The easiest way to get a vector file's EXTENT is to use the ogrinfo utility, that is part of the GDAL/OGR library (for raster files you would use the gdalinfo utility). Windows users can download the MS4W package, which includes all of the GDAL and OGR commandline utilities (in /ms4w/tools/gdal-ogr/ ). Linux users will probably already have the GDAL libraries.
For example, here is the results of the ogrinfo command on a shapefile (notice the "Extent" line):


(continues on next page)



(continued from previous page)
Ogrinfo gives the file's extent in the form of (minx, miny),(maxx, maxy), therefore the EXTENT in a mapfile would be:



17.1.4 msGetLabelSize(): Requested font not found
Error displayed when attempting to display a specific font.
This message tells you that MapServer cannot find specified font.






17.1.5 msLoadFontset(): Error opening fontset
Error when attempting to display a label.
This message tells you that MapServer cannot find the FONTSET specified in the Mapfile.



17.1.6 msLoadMap(): Failed to open map file
Error displayed when trying to display map image.
The message tells you that MapServer cannot find map file or has problems with the map file. Verify that you have specified the correct path to the mapfile. Linux/Unix users should make sure that the web user has access permissions to the mapfile path as well. Verify that the map file using map2img to make sure that the syntax is correct.
The error message states where MapServer thinks the mapfile is:


17.1.7 msProcessProjection(): no options found in 'init' file
Error displayed when attempting to use a specific projection.
The message tells you that the projection you're trying to use isn't defined in the PROJ library's proj.db SQLite database file. (if you are using PROJ < 6, the projections are stored in an epsg file instead, that you can open a text editor and search for your projection to make sure that it exists)
On Windows, with MS4W versions >= 5 users will find the proj.db file in /ms4w/share/proj/.


17.1.8 msProcessProjection(): No such file or directory
Error displayed when trying to refer to an epsg file.
The message tells you that MapServer cannot find the epsg file (when using PROJ < 6).
On Windows, the default location of the epsg file is c:\proj\nad. MS4W (versions < 5) users will find the epsg file in
/ms4w/proj/nad.



Linux/Unix users should be careful to specify the correct case when referring to the epsg file, since filenames are case sensitive on Linux/Unix. "init=epsg:4326" refers to the epsg filename, and therefore "init=EPSG:4326" will not work because it will be looking for an EPSG file in uppercase.

17.1.9 msProcessProjection(): Projection library error. PROJ error "Cannot find proj.db" when instantiating "init=epsg:XXXX"
Error displayed when PROJ cannot find the proj.db SQLite file.
The message tells you that MapServer cannot find the proj.db file (when using PROJ >= 6). You can specify the location of the PROJ files by setting the PROJ_DATA variable, as described below.
On Windows, MS4W (versions >= 5) users will find the proj.db file in /ms4w/share/proj/.

Setting the location of PROJ files
There are a few options available if you need to set the proj.db location:

1. Use MapServer's global configuration file, available since the MapServer 8.0 release, to set the "PROJ_DATA" environment variable. The default name of the config file is mapserver.conf (for MS4W users, the file is
/ms4w/ms4w.conf ). Your config file could contain an ENV section such as:



See alsoCONFIG
2. Use the mapfile parameter CONFIG to force the location of the proj.db file. This parameter is specified at the MAP level

See alsoMapfile



3. Set a system variable ("environment variable" on windows) called "PROJ_DATA" and point it to your proj di- rectory.
4. Set an environment variable through your web server. Apache has a SetEnv directive that can set environment variables. Add something like the following to your Apache httpd.conf file:


17.1.10 msProcessProjection(): Projection library error.major axis or radius = 0 not given
Error displayed when attempting to specify projection parameters.
Since MapServer 4.0, you are required to specify the ellipsoid for the projection. Omitting this ellipsoid parameter in later MapServer versions will cause this error.

Valid Examples
4.0 and newer:

before MapServer 4.0:



17.1.11 msQueryByPoint: search returned no results
Why do I get the message "msQueryByPoint(): Search returned no results. No matching record(s) found" when I query a feature known to exists?
The query feature requires a TEMPLATE object in the CLASS object of your LAYER definition. The value points to a html fragment using MapServer template syntax.
Example MapFile fragment:










(continues on next page)



(continued from previous page)
Example Template:

The [lrn] is a special keyword that indicates the resulting line number which starts at 1. [PIN] is the name of a feature attribute.

17.1.12 msReturnPage(): Web application error. Malformed template name
This error may occur if you try to access a template file with a file extension that is not recognized by MapServer. Valid file extensions for templates are:

This error may also occur when you are attempting to use a URL template for a query. The issue is that URL templates are only allowed for query modes that return only one result (e.g. query or itemquery)
You can only use a URL template for a query in mode=query or mode=itemquery. If you try it with mode=nquery or mode=itemnquery, you will get the error:



17.1.13 msSaveImageGD(): Unable to access file
Error displayed when attempting to display map image.
This error is displayed if MapServer cannot display the map image. There are several things to check:
• IMAGEPATH and IMAGEURL parameters in mapfile are valid



• In CGI mode, any IMAGEPATH and IMAGEURL variables set in the init pages are valid
• Linux/Unix users should verify that the web user has permissions to write to the IMAGEPATH

17.1.14 msWMSLoadGetMapParams(): WMS server error. Image Size out of range, WIDTH and HEIGHT must be between 1 and 2048 pixels
Error that is returned / displayed when a user has requested a map image (via WMS) that exceeds the maximum width or height that the service allows.
To increase the maximum map width and height for the service, use the MAXSIZE parameter of the MAP object. Producing larger map images requires more processing power and more memory, so take care.

17.1.15 Unable to load dll (MapScript)
One of the dll-s could not be loaded that mapscript.dll depends on.
You can get this problem on Windows and in most cases it can be dedicated to a missing or an unloadable shared library. The error message talks about mapscript.dll but surely one or more of the dll-s are missing that libmap.dll depends on. So firstly you might want to check for the dependencies of your libmap.dll in your application directory. You can use the Visual Studio Dependency Walker to accomplish this task. You can also use a file monitoring tool (like SysInternal's filemon) to detect the dll-s that could not be loaded. I propose to store all of the dll-s required by your application in the application folder. If you can run the mapscript sample applications properly your compilation might be correct and all of the dlls are available.

C#-specific information
You may find that the mapscript C# interface behaves differently for the desktop and the ASP.NET applications. Al- though you can run the drawmap sample correctly you may encounter the dll loading problem with the ASP.NET applications. When creating an ASP.NET project your application folder will be 'Inetpubwwwroot[YourApp]bin' by default. The host process of the application will aspnet_wp.exe or w3wp.exe depending on your system. The appli- cation will run under a different security context than the interactive user (under the context of the ASPNET user by default). When placing the dll-s outside of your application directory you should consider that the PATH environment variable may differ between the interactive and the ASPNET user and/or you may not have enough permission to access a dll outside of your application folder.


CHAPTER
EIGHTEEN



FAQ


18.1 FAQ
18.1.1 Where is the MapServer log file?
See Debugging MapServer

18.1.2 What books are available about MapServer?
"Mapping Hacks" by Schuyler Erle, Rich Gibson, and Jo Walsh is available from O'Reilly.
"Web Mapping Illustrated" by Tyler Mitchell is available from O'Reilly. Introduces MapServer and many other related technologies including, GDAL/OGR, MapScript, PostGIS, map projections, etc.
"MapServer: Open Source GIS Development" by Bill Kropla.

18.1.3 How do I compile MapServer for Windows?
See Compiling on Win32. Also, you can use the development libraries in OSGeo4W as a starting point instead of building all of the dependent libraries yourself. Windows users wanting a full installer (including Apache, MapServer, mapscripts, GDAL) please see MS4W

18.1.4 What do MapServer version numbers mean?
MapServer's version numbering scheme is very similar to Linux's. For example, a MapServer version number of 4.2.5 can be decoded as such:
• 4: Major version number. MapServer releases a major version every two to three years.
• 2: Minor version number. Increments in minor version number almost always relate to additions in functionality.
• 5: Revision number. Revisions are bug fixes only. No new functionality is provided in revisions.
From a developer's standpoint, MapServer version numbering scheme is also like Linux. Even minor version numbers (0..2..4..6) relate to release versions, and odd minor versions (1..3..5..7) correspond to developmental versions.

18.1.5 Is MapServer Thread-safe?
Q: Is MapServer thread-safe?
A: Generally, no (but see the next question). Many components of MapServer use static or global data that could potentially be modified by another thread. Under heavy load these unlikely events become inevitable, and could result in sporadic errors.
Q: Is it possible to safely use any of MapServer in a multi-threaded application?



A: Some of it, yes, with care. Or with Python :) Programmers must either avoid using the unsafe components of MapServer or carefully place locks around them. Python's global interpreter lock immunizes against MapServer thread- ing problems; since no mapscript code ever releases the GIL all mapscript functions or methods are effectively atomic. Users of mapscript and Java, .NET, mod_perl, or mod_php do not have this extra layer of protection.
A: Which components are to be avoided?
Q: Below are lists of unsafe and unprotected components and unsafe but locked components. Unsafe:
• OGR layers: use unsafe CPL services
• Cartoline rendering: static data
• Imagemap output: static data
• SWF output: static data and use of unsafe msGetBasename()
• SVG output: static data
• WMS/WFS server: static data used for state of dispatcher
• Forcing a temporary file base (an obscure feature): static data
   • MyGIS: some static data Unsafe, but locked:
• Map config file loading: global parser
• Setting class and and layer filter expressions (global parser)
• Class expression evaluation (global parser)
• Setting map and layer projections (PROJ)
• Raster layer rendering and querying (GDAL)
• Database Connections (mappool.c)
• PostGIS support
• Oracle Spatial (use a single environment handle for connection)
• SDE support (global layer cache)
• Error handling (static repository of the error objects)
• WMS/WFS client connections: potential race condition in Curl initialization
• Plugin layers (static repository of the loaded dll-s)
Rather coarse locks are in place for the above. Only a single thread can use the global parser at a time, and only one thread can access GDAL raster data at a time. Performance is exchanged for safety.

18.1.6 What does STATUS mean in a LAYER?
STATUS ON and STATUS OFF set the default status of the layer. If a map is requested, those layers will be ON/OFF unless otherwise specified via the layers parameter. This is particularly the case when using MapScript and MapServer's built-in template mechanism, but is also useful as a hint when writing your own apps and setting up the initial map view.
STATUS DEFAULT means that the layer is always on, even if not specified in the layers parameter. A layer's status can be changed from DEFAULT to OFF in MapScript, but other than that, it's always on.
CGI turns everything off that is not "STATUS DEFAULT" off so all layers start from the same state (e.g. off) and must be explicitly requested to be drawn or query. That common state made (at least in my mind) implementations easier. I



mean, if a layer "lakes" started ON the doing layer=lakes would turn it OFF. So I wanted to remove the ambiguity of a starting state.

18.1.7 How can I make my maps run faster?
There are a lot of different approaches to improving the performance of your maps, aside from the obvious and expensive step of buying faster hardware. Here are links to some individual howtos for various optimizations.
• Tuning your mapfile for performance
• Optimizing the performance of vector data sources
• Optimizing the performance of raster data sources
• Tileindexes for mosaicing and performance
Some general tips for all cases:
• First and foremost is hardware. An extra GB of RAM will give your map performance increases beyond anything you're likely to achieve by tweaking your data. With the price of RAM these days, it's cheap and easy to speed up every map with one inexpensive upgrade.
• Use the scientific method. Change one thing at a time, and see what effect it had. Try disabling all layers and enabling them one at a time until you discover which layer is being problematic.
• Use map2img program to time your results. This runs from the command line and draws an image of your entire map. Since it's run from the command line, it is immune to net lag and will give more consistent measurements that your web browser.

18.1.8 What does Polyline mean in MapServer?
There's confusion over what POLYLINE means in MapServer and via ESRI. In MapServer POLYLINE simply means a linear representation of POLYGON data. With ESRI polyline means multi-line. Old versions of the Shapefile technical description don't even refer to polyline shapefiles, just line. So, ESRI polyline shapefiles are just linework and can only be drawn and labeled as LINE layers. Those shapefiles don't have feature closure enforced as polygon shapefiles do which is why the distinction is so important. I suppose there is a better choice than POLYLINE but I don't know what it would be.


18.1.9 What is MapScript?
MapScript is the scripting interface to MapServer, available through the SWIG API. MapScript allows you to program with MapServer's objects directly instead of interacting with MapServer through its CGI and Mapfile.






18.1.10 Does MapServer support reverse geocoding?
No.
Reverse geocoding is an activity where you take a list of street features that you already have and generate postal addresses from them. This kind of spatial functionality is provided by proprietary packages such as the ESRI suite of tools, as well as services such as those provided by GDT. MapServer is for map rendering, and it does not provide for advanced spatial operations such as this.

18.1.11 Does MapServer support geocoding?
No.
Geocoding is an activity where you take a list of addresses and generate lat/lon points for them. This kind of spatial functionality is provided by proprietary packages such as the ESRI suite of tools, as well other sites. MapServer is for map rendering, and it does not provide for advanced spatial operations such as this.
There are many free geocoders available, such as https://geolytica.com (geocoder.ca) for North America, or you can set up your own service using OpenStreetMap data, TIGER data, or other open data sources. Then you could hook your application up to use this service to provide lat/lon pairs for addresses, and then use MapServer to display those points (possibly through MapScript).

18.1.12 How do I set line width in my maps?
In the current MapServer version, line width is set using the STYLE parameter WIDTH. For a LINE layer, lines can be made red and 3 pixels wide by using the following style in a CLASS.

In earlier versions of MapServer , you could set the symbol for the LAYER to 'circle' and then you can set the symbol SIZE to be the width you want. A 'circle' symbol can be defined as


18.1.13 Which image format should I use?
Although MapScript can generate the map in any desired image format it is sufficient to only consider the most prevalent ones: JPEG and PNG.
JPEG is an image format that uses a lossy compression algorithm to reduce an image's file size and is mostly used when loss of detail through compression is either not noticeable or negligible, as in most photos. Maps on the other hand mainly consist of fine lines and areas solidly filled in one colour, which is something JPEG is not known for displaying



very well. In addition, maps, unless they include some aerial or satellite imagery, generally only use very few different colours. JPEG with its 24bit colour depth capable of displaying around 16.7 million colours is simple not suitable for this purpose. PNG8 however use an indexed colour palette which can be optimized for any number (up to 256) of colours which makes them the perfect solution for icons, logos, charts or maps. The following comparison (generated file sizes only; not file generation duration) will therefore only include these two file formats:

Table 1: PNG8 vs. PNG24 Generated Map File Sizes

PNG8PNG24Vector Data only	26kb69kbVector Data & Satellite Image coloured	182kb573kbVector Data & Satellite Image monochrome	134kb492kb
(results based on an average 630x396 map with various colours, symbols, labels/annotations etc.)
PNG8 is the clear quantitative winner in terms of generated file sizes for maps with or without additional monochrome imagery. If the mapping application however can also display fullcolour aerial or satellite imagery, the output file format can be changed dynamically to PNG24 to achieve the highest possible image quality.

18.1.14 How do I add a copyright notice on the corner of my map?
You can use an inline feature, with the FEATURE object, to make a point on your map. Use the TEXT parameter of the FEATURE object for the actual text of the notice, and a LABEL object to style the notice.

Example Layer





























(continues on next page)



(continued from previous page)

Result


18.1.15 How do I have a polygon that has both a fill and an outline with a width?
How do I have a polygon that has both a fill and an outline with a width? Whenever I put both a color (fill) and an outlinecolor with a width on a polygon within a single STYLE, the outline width isn't respected.
For historical reasons, width has two meanings within the context of filling polygons and stroke widths for the outline. If a polygon is filled, then the width defines the width of the symbol inside the filled polygon. In this event, the outline width is disregarded, and it is always set to 1. To achieve the effect of both a fill and an outline width, you need to use two styles in your class.



18.1.16 Which OGC Specifications does MapServer support?
See: MapServer OGC Specification support.

18.1.17 Why does my requested WMS layer not align correctly?
Requesting a layer from some ArcIMS WMS connectors results in a map with misaligned data (the aspect ratio of the pixels looks wrong).
Some ArcIMS sites are not set up to stretch the returned image to fit the requested envelope by default. This results in a map with data layers that overlay well in the center of the map, but not towards the edges. This can be solved by adding "reaspect=false" to the request (by tacking it on to the connection string).
For example, if your mapfile is in a projection other than EPSG:4326, the following layer will not render correctly:

Adding "reaspect=false" to the connection string solves the problem:



18.1.18 When I do a GetCapabilities, why does my browser want to download mapserv.exe/mapserv?
A beginner question here. . . I'm new to MS and to Apache. I've got MS4W up and running with the Itasca demo. Now I want to enable it as a WMS server. mapserv -v at the command line tells me it supports WMS_SERVER. When I point my browser to it, my browser just wants to download mapserv.exe!
What am I missing?
Here is the URL I'm using to issue a GetCapabilities WMS request: http://localhost/cgi-bin/mapserv.exe?map=..
/htdocs/itasca/demo.map&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities
The OGC:WMS 1.1.0 and 1.1.1 specifications (which are both supported by MapServer) state that, for GetCapabilities responses, the OGC:WMS server returns a specific MIME type (i.e. application/vnd.ogc.xml (see subclause 6.5.3 of OGC:WMS 1.1.1.
A MIME type is passed from the web server to the client (in your case, a web browser), from which a client can decide how to process it.
Example 1: if using a web browser, if a web server returns an HTTP Header of "Content-type:image/png", then the web browser will know that this is a PNG image and display it accordingly.
Example 2: if using a web browser, if a web server returns an HTTP Header of "Content-type:text/html", then the web browser will know that this is an HTML page and display it accordingly (i.e. tables, divs, etc.)
Basically, what is happening is that the OGC:WMS is returning, in the headers of the HTTP response, a MIME type which your web browser does not understand, which usually prompts a dialog box on whether to open or download the content (i.e. Content-type:application/vnd.ogc.wms_xml).
You could configure your web browser to handle the application/vnd.ogc.wms_xml MIME type a certain way (i.e. open in Notepad, etc.).

18.1.19 Why do my WMS GetMap requests return exception using MapServer 5.0?
Before upgrading to MapServer 5.0, I was able to do quick GetMap tests in the form of: http://wms.example.com/ wms?service=WMS&version=1.1.1&request=GetMap&layers=foo
Now when I try the same test, MapServer WMS returns an XML document saying something about missing required parameters. What's going on here?
This was a major change for WMS Server support in MapServer 5.0. MapServer WMS Server GetMap requests now require the following additional parameters:
• srs
• bbox
• width
• height
• format
• styles




The request below now constitutes a valid GetMap request:

Which is consistent with the WMS specification.
More information on these parameters can be found in the WMS Server and the OGC WMS 1.1.1 specification For more detailed information, see ticket 1088


18.1.20 Using MapServer 6.0, why don't my layers show up in GetCapabilities re- sponses or are not found anymore?
MapServer 6.0 introduces the option of hiding layers against OGC Web Service requests. OGC Web Services can provide powerful access to your geospatial data. It was decided to disable layer level request access as a default. See rfc67 provides a full explanation of the changes and implications.
To enable pre-6.0 behaviour, you can add the following to the WEB object's METADATA section in your mapfile:

This will enable access of all layers to all OGC Web Service requests.

18.1.21 Where do I find my EPSG code?
For PROJ version >= 6, there is a SQLite database proj.db in your PROJ installation (e.g. /usr/local/share/proj/proj.db) which contain the EPSG information used by PROJ. On Windows, MS4W version >= 5 users can find the proj.db file at /ms4w/share/proj/, or it can be generally found with an environment variable called PROJ_DATA.
For PROJ version < 6, there is a text file epsg in that same shared location. On Windows, MS4W version < 5 users can find the epsg file at C:\ms4w\proj\nad, or it can be generally found with an environment variable called PROJ_LIB.
https://spatialreference.org (recommended) and https://epsg.io/ allow you to search for EPSG codes.
More information on EPSG (which also now contains a text or map search for EPSG codes) : https://epsg.org/home. html
More information on PROJ: https://proj.org/

18.1.22 How can I reproject my data using ogr2ogr?
With ogr2ogr of course! ogr2ogr is a powerful utility that will transform the projections of your shapefiles when passed the appropriate parameters. In my case, I was using MapServer to serve data in RI State Plane Feet. In order to do so, the data had to first be converted to meters. Here is the command I used:

Since my data already had a projection defined, I did not need to explicitly state a source projection. This command uses the EPSG definition for NAD83 Rhode Island (32130) and performs the feet to meters conversion.
Now say my data wasn't already projected? Here's how we deal with that:





Let's examine what is going on here:
The -s_srs parameter explicitly defines a projection for the data. The parameters used here were taken out of the EPSG definition (in this case, 32130) in the epsg file (see the previous FAQ for more details on locating EPSG definitions). The entry for RI in the epsg file is as follows:

You can see how the definition in the initial command is formulated. Notice that the "+units=m" parameter has been changed to "+to_meter=0.3408". This is important for the conversion. Where did the value of 0.3408 come from you ask? From the EPSG file! It has many goodies buried in it so by simply running 'grep "to_meter" epsg' you can refresh your memory if you need to.
The next parameter in the command is "-t_srs EPSG:32130". This command tells ogr2ogr to transform the data to the EPSG code of 32130. After this is declared, all you need to do is declare a file name for your new shape file and to set which file is being used as the input (note: make sure you don't confuse the order of these two).
Hit enter, bombs away, and enjoy your new data in meters!

18.1.23 How can I help improve the documentation on this site?
New documentation material and corrections to existing documentation are definitely very welcome. These contribu- tions are handled through the same issue tracker used to track software bugs and enhancements.
Follow the directions for submitting bugs at: https://mapserver.org/development/bugs.html. When creating a ticket, in the Component field, select MapServer Documentation. If our ticket pertains to a specific web page, please include the URL to that page.
If you have tips or examples that don't really fit the definition of documentation, a good place to put them is the MapServer wiki at: https://github.com/MapServer/MapServer/wiki

18.1.24 What's with MapServer's logo?
The MapServer logo illustrates the confluence of the Minnesota and Mississippi rivers, quite near to the home of the St. Paul Campus of the University of Minnesota, which was the birthplace of MapServer.

18.1.25 Is MapServer free for commercial use?
Yes, MapServer is free for both commercial and non-commercial use. It is released under an MIT-style license, which allows for free use, modification, and distribution, including for commercial purposes. In general, The MIT license is a widely used, permissive Open Source license, known for its simplicity and flexibility.

18.1.26 What versions of MapServer will be patched for security vulnerabilities?
The MapServer team will provide security patches for the two most recent release series. Patches will be provided for a period of three years from the release date of the current series. Review the MapServer Security Policy for more details.


CHAPTER
NINETEEN



COPYRIGHT


19.1 MapServer Licensing
19.1.1 MapServer Documentation
If not stated otherwise, all content is licensed under the Creative Commons Attribution-ShareAlike 4.0 International Public License (CC BY-SA).

19.1.2 MapServer Source Code



INDEX






Symbols
.NET
Compilation, MapScript, 56
  init	() (mapscript.DBFInfo method), 313
  init  () (mapscript.OWSRequest method), 314
  init  () (mapscript.classObj method), 316
  init  () (mapscript.clusterObj method), 317
  init  () (mapscript.colorObj method), 318
  init  () (mapscript.errorObj method), 319
  init  () (mapscript.fontSetObj method), 319
  init  () (mapscript.hashTableObj method), 320
  init  () (mapscript.imageObj method), 320
 init ()	(mapscript.labelCacheMemberObj method), 322
  init  () (mapscript.labelCacheObj method), 322
  init  () (mapscript.labelCacheSlotObj method), 323
  init  () (mapscript.labelLeaderObj method), 323
  init  () (mapscript.labelObj method), 325
  init  () (mapscript.layerObj method), 328
  init  () (mapscript.legendObj method), 334
  init  () (mapscript.lineObj method), 334
  init  () (mapscript.mapObj method), 336
 init ()	(mapscript.markerCacheMemberObj method), 342
  init  () (mapscript.outputFormatObj method), 343
  init  () (mapscript.pointObj method), 344
  init  () (mapscript.projectionObj method), 345
  init  () (mapscript.queryMapObj method), 346
  init  () (mapscript.rectObj method), 346
  init  () (mapscript.referenceMapObj method), 348
  init  () (mapscript.reprojectionObj method), 348
  init  () (mapscript.resultCacheObj method), 348
  init  () (mapscript.resultObj method), 349
 init () (mapscript.scaleTokenEntryObj method), 349
  init  () (mapscript.scaleTokenObj method), 350
  init  () (mapscript.scalebarObj method), 351
  init  () (mapscript.shapeObj method), 351
  init  () (mapscript.shapefileObj method), 354
  init  () (mapscript.styleObj method), 356
  init  () (mapscript.symbolObj method), 358
  init  () (mapscript.symbolSetObj method), 359


  init	() (mapscript.webObj method), 360
24bit
Raster, 664
8bit
Raster, 671
A
add() (mapscript.lineObj method), 334 add() (mapscript.shapefileObj method), 354 add() (mapscript.shapeObj method), 351
addFeature() (mapscript.layerObj method), 328 addLabel() (mapscript.classObj method), 316 addParameter() (mapscript.OWSRequest method), 314 addPoint() (mapscript.shapefileObj method), 354 addProcessing() (mapscript.layerObj method), 328 AGG, 1069
Aggregate functions Cluster, 140
Alias
Mapserver, 777
ALIGN
LABEL, 206
SCALEBAR, 263
all
GEOMTRANSFORM smoothsia, 185
ANCHORPOINT
SYMBOL, 278
and
Expressions, 161
ANGLE
LABEL, 207
MAP, 246
STYLE, 265
angle
GEOMTRANSFORM smoothsia, 185
WMS Vendor specific parameters, 794
annotation
LAYER TYPE, 238
ANTIALIAS
LABEL, 207
STYLE, 266
SYMBOL, 279




Apache
MS_MAPFILE, 778
ReWriteRule, 778
SetEnvIf, 778
API
MapScript, 311
appendOutputFormat() (mapscript.mapObj method), 337
appendSymbol() (mapscript.symbolSetObj method), 359
applyConfigOptions() (mapscript.mapObj method), 337
applyDefaultSubstitutions()	(mapscript.mapObj method), 337
applySLD() (mapscript.layerObj method), 328 applySLD() (mapscript.mapObj method), 337 applySLDURL() (mapscript.layerObj method), 328 applySLDURL() (mapscript.mapObj method), 337 applySubstitutions() (mapscript.mapObj method),
337
ArcSDE options
LAYER PROCESSING, 228
area
Expressions, 165
Area symbols, 104
Arithmetic expressions Expressions, 162 Arithmetic operations Expressions, 164
ASP script
IIS, 779
Asymmetrical line styling, 104
attachDevice() (mapscript.outputFormatObj method), 343
attribute
LAYER STYLEITEM, 234
Attributes
Expressions, 157
AUTO
LAYER STYLEITEM, 235
Axis order
Map projections, 780
B
BACKGROUNDCOLOR CLASS, 134
SCALEBAR, 263
STYLE, 266
BANDS
LAYER PROCESSING, 665
Bar graph, 691
Batch scripting, 1050
bbox
GEOMTRANSFORM, 171


STYLE GEOMTRANSFORM, 267
bbox_pixel_is_point
WMS Vendor specific parameters, 794
bevel
STYLE LINEJOIN, 270
beyond
Expressions, 163
BINDVALS
LAYER, 215
bitmap
LABEL TYPE, 215
BLOCKXSIZE
OUTPUTFORMAT FORMATOPTION, 255
BLOCKYSIZE
OUTPUTFORMAT FORMATOPTION, 255
blue, 660
Raster query, 670
boundary() (mapscript.shapeObj method), 351
browse
CGI mode, 1057
BROWSEFORMAT
WEB, 305
BUFFER
CLUSTER, 138
LABEL, 208
buffer
CGI, 1056
Expressions, 165
GEOMTRANSFORM, 178
LAYER GEOMTRANSFORM, 220
STYLE GEOMTRANSFORM, 268
buffer() (mapscript.shapeObj method), 352
Build
MapScript PHP, 50
butt
STYLE LINECAP, 269
BYTE
OUTPUTFORMAT IMAGEMODE, 256
C
Cartographical symbols, 85
cartoline
SYMBOL TYPE, 280
Cascading requests WMS, 795
centerline
LAYER GEOMTRANSFORM, 180, 220
centroid
GEOMTRANSFORM, 171
STYLE GEOMTRANSFORM, 267
CGI, 1069
buffer, 1056
classgroup, 1056
context, 1056




icon, 1056
id, 1056
img, 1056
imgbox, 1056
imgext, 1056
imgshape, 1056
imgsize, 1056
imgxy, 1056
layer, 1056
layers, 1056
map, 1056
mapext, 1056
mapshape, 1057
mapsize, 1057
mapxy, 1057
maxx, 1057
maxy, 1057
minx, 1057
miny, 1057
mode, 1057
mode browse, 1057
mode coordinate, 1057
mode featurenquery, 1057
mode featurequery, 1057
mode indexquery, 1057
mode itemfeaturenquery, 1057
mode itemfeaturequery, 1057
mode itemnquery, 1057
mode itemquery, 1058
mode legend, 1058
mode legendicon, 1058
mode map, 1058
mode nquery, 1058
mode query, 1058
mode reference, 1058
mode scalebar, 1058
mode tile, 1058
mode zoomin, 1058
mode zoomout, 1058
qformat, 1058
qitem, 1058
qlayer, 1058
qstring, 1058
queryfile, 1059
ref, 1059
refxy, 1059
savequery, 1059
scaledenom, 1059
searchmap, 1059
shapeindex, 1059
slayer, 1059
tile, 1059
tileindex, 1059
tilemode, 1059


tilesize, 1059
zoom, 1060
zoomdir, 1060
zoomsize, 1060
CGI_CONTEXT_URL MAP CONFIG, 247
Change
URL, 777
Change map file parameters, 1060
CHARACTER
SYMBOL, 279
chart
LAYER TYPE, 238
CHART_BAR_MAXVAL
LAYER, PROCESSING, 691
CHART_BAR_MINVAL
LAYER, PROCESSING, 691
CHART_SIZE
LAYER, PROCESSING, 687
CHART_SIZE_RANGE
LAYER, PROCESSING, 687
CHART_TYPE
LAYER, PROCESSING, 688
circle
LAYER TYPE, 238
CLASS, 134
BACKGROUNDCOLOR, 134
COLOR, 134
DEBUG, 134
EXPRESSION, 135
FALLBACK, 135
GROUP, 135
KEYIMAGE, 136
LABEL, 136
LAYER, 216
LEADER, 136
MAXSCALEDENOM, 136
MAXSIZE, 136
METADATA, 136
MINFEATURESIZE, 136
MINSCALEDENOM, 136
MINSIZE, 137
NAME, 137
OUTLINECOLOR, 137
SIZE, 137
STATUS, 137
STYLE, 137
SYMBOL, 137
TEMPLATE, 137
TEXT, 137
TITLE, 137
VALIDATION, 138
class
Raster query, 669




CLASSAUTO
IDENTIFY, 197
Classes
MapScript PHP, 376
MapScript Python, 428
CLASSGROUP
IDENTIFY, 197
LAYER, 216
classgroup
CGI, 1056
CLASSIFY_SCALED
LAYER PROCESSING, 665
CLASSITEM
EXPRESSION, 157
LAYER, 216
classObj
MapScript PHP, 377
classObj (class in mapscript), 315
clear() (mapscript.hashTableObj method), 320 clearProcessing() (mapscript.layerObj method), 329 clone() (mapscript.classObj method), 316
clone() (mapscript.layerObj method), 329 clone() (mapscript.mapObj method), 337 clone() (mapscript.shapeObj method), 352 clone() (mapscript.styleObj method), 356 Cloning
MapScript Layer, 434
MapScript Mapfile, 433
close() (mapscript.layerObj method), 329
CLOSE_CONNECTION
LAYER PROCESSING, 229, 598
CLUSTER, 138
BUFFER, 138
FILTER, 139
GROUP, 138
LAYER, 216
MAXDISTANCE, 138
REGION, 138
Cluster, 138
Aggregate functions, 140
Feature attributes, 140, 241
FeatureCount, 140
Group, 140
cluster options
LAYER PROCESSING, 228
CLUSTER_GET_ALL_SHAPES LAYER PROCESSING, 139, 228
CLUSTER_KEEP_LOCATIONS LAYER PROCESSING, 139, 228
CLUSTER_USE_MAP_UNITS
LAYER PROCESSING, 139, 228
clusterObj
MapScript PHP, 379
clusterObj (class in mapscript), 317

Collections
OGCAPI, 805
COLOR
CLASS, 134
LABEL, 208
QUERYMAP, 261
REFERENCE, 261
SCALEBAR, 263
STYLE, 266
COLOR_MATCH_THRESHOLD LAYER PROCESSING, 665
colorObj
    MapScript PHP, 379 colorObj (class in mapscript), 318 COLORRANGE
STYLE, 267
Combining symbols, 93
Comments, 309
commify
Expressions, 164
COMPFILTER
COMPOSITE, 143
Compilation
MapScript .NET, 56
Win32, 41
COMPOP
COMPOSITE, 144
COMPOSITE, 143
COMPFILTER, 143
COMPOP, 144
LAYER, 216
OPACITY, 146
COMPRESS
OUTPUTFORMAT FORMATOPTION, 255
COMPRESSION
OUTPUTFORMAT FORMATOPTION, 254
CONFIG, 147
CGI_CONTEXT_URL, MAP, 247
ENV, 147
MAP, 246
MAPS, 148
MS_ENCRYPTION_KEY, MAP, 247
MS_ERRORFILE, MAP, 247
MS_NONSQUARE, MAP, 247
ON_MISSING_DATA, MAP, 247
PLUGINS, 148
PROJ_DATA, MAP, 247, 259
PROJ_DEBUG, MAP, 248
CONNECTION
JOIN, 200
LAYER, 216
Connection Pooling OGR, 613
CONNECTIONOPTIONS



LAYER, 217
CONNECTIONTYPE
contour, 552
contour, LAYER, 217
csv, JOIN, 200
idw, LAYER, 217
JOIN, 200
kerneldensity, LAYER, 217
LAYER, 217
local, LAYER, 217
mysql, JOIN, 200
ogr, LAYER, 217
oraclespatial, LAYER, 217
plugin, LAYER, 217
postgis, LAYER, 217
postgresql, JOIN, 200
rasterlabel, LAYER, 217
sde, LAYER, 217
union, LAYER, 217
uvraster, LAYER, 217
wfs, LAYER, 217
wms, LAYER, 217
Constants
MapScript PHP, 374
contains
Expressions, 163
contains() (mapscript.shapeObj method), 352
context
CGI, 1056
contour, 552
CONNECTIONTYPE, 552
LAYER CONNECTIONTYPE, 217
contour options
LAYER PROCESSING, 229
CONTOUR_INTERVAL
LAYER PROCESSING, 229
CONTOUR_ITEM
LAYER PROCESSING, 229
CONTOUR_LEVELS
LAYER PROCESSING, 229
convertToString() (mapscript.classObj method), 316
convertToString() (mapscript.clusterObj method), 317
convertToString() (mapscript.labelObj method), 325 convertToString() (mapscript.layerObj method), 329 convertToString()  (mapscript.legendObj  method),
334
convertToString() (mapscript.mapObj method), 337
convertToString()	(mapscript.queryMapObj method), 346
convertToString()	(mapscript.referenceMapObj method), 348
convertToString() (mapscript.scalebarObj method), 351

convertToString() (mapscript.styleObj method), 356 convertToString() (mapscript.webObj method), 360 convexHull() (mapscript.shapeObj method), 352 coordinate
CGI mode, 1057
copy() (mapscript.shapeObj method), 352
coshp
Utility,  1034
CP1252
ENCODING, 155
CPL_DEBUG
Debugging, 976
createLegendIcon() (mapscript.classObj method), 316
crosses
Expressions, 163
crosses() (mapscript.shapeObj method), 352
csv
JOIN CONNECTIONTYPE, 200
CURL_CA_BUNDLE
Environment variables, 987
D
DATA
LAYER, 218
Databases
Optimization, 1030
DATAPATTERN
MAP, 248
DATARANGE
STYLE, 267
DBFInfo (class in mapscript), 313
dd
LAYER UNITS, 239
MAP UNITS, 251
DEBUG
CLASS, 134
LAYER, 218
MAP, 248
Debug levels
Debugging, 974
Debugging, 972
CPL_DEBUG, 976
Debug levels, 974
GDB, 984
map2img, 978
MS_DEBUGLEVEL, 975
MS_ERRORFILE, 973
ON_MISSING_DATA, 980
PHP Mapscript, 983
PROJ_DEBUG, 977
Default value
Run-time substitution, 1063
DEFRESOLUTION



MAP, 249
densify
LAYER GEOMTRANSFORM, 181, 221
difference
Expressions, 165
difference() (mapscript.shapeObj method), 352
Dimension requests WMS Server, 831
disjoint
Expressions, 163
disjoint() (mapscript.shapeObj method), 352 distanceToPoint() (mapscript.pointObj method), 344 distanceToPoint() (mapscript.shapeObj method), 352 distanceToSegment() (mapscript.pointObj method),
344
distanceToShape() (mapscript.pointObj method), 344 distanceToShape() (mapscript.shapeObj method), 352 DITHER
LAYER PROCESSING, 665
Download
MapScript PHP, 50
draw() (mapscript.layerObj method), 329 draw() (mapscript.mapObj method), 337 draw() (mapscript.pointObj method), 344 draw() (mapscript.rectObj method), 346 draw() (mapscript.shapeObj method), 352
drawEPP():	EPPL7 support is not available Error, 1074
drawLabelCache() (mapscript.mapObj method), 337 drawLegend() (mapscript.mapObj method), 337 drawLegendIcon() (mapscript.classObj method), 316 drawQuery() (mapscript.layerObj method), 329 drawQuery() (mapscript.mapObj method), 337 drawReferenceMap() (mapscript.mapObj method), 337 drawScalebar() (mapscript.mapObj method), 337 DRIVER
OUTPUTFORMAT, 253
DUMP
LAYER, 219
DUPLICATES
OUTPUTFORMAT FORMATOPTION, 256
dwithin
Expressions, 163
Dynamic charting, 685
E
Element support SLD, 882
ellipse
SYMBOL TYPE, 280
Ellipse symbols, 86
embedLegend() (mapscript.mapObj method), 337 embedScalebar() (mapscript.mapObj method), 337 EMPTY

WEB, 305
ENCODING
CP1252, 155
EUC-JP, 155
ISO-8859-1, 155
ISO-8859-2, 155
LABEL, 208
LAYER, 151, 219
Shift-JIS, 155
TIS-620, 155
UTF-8, 155
Encrypting, 1040
Encryption key, 1040
end
GEOMTRANSFORM, 172
STYLE GEOMTRANSFORM, 267
ENV
CONFIG, 147
Environment variable MS_TEMPPATH, 308
Environment variables, 986
CURL_CA_BUNDLE, 987
MS_CONTEXT_BAD_PATTERN, 989
MS_CONTEXT_PATTERN, 990
MS_DEBUGLEVEL, 987
MS_ENCRYPTION_KEY, 987
MS_ERRORFILE, 987
MS_INDEX_TEMPLATE_DIRECTORY, 988
MS_MAP_BAD_PATTERN, 989
MS_MAP_NO_PATH, 988
MS_MAP_PATTERN, 990
MS_MAPFILE, 989
MS_MAPFILE_PATTERN, 989
MS_MODE, 991
MS_OPENLAYERS_JS_URL, 991
MS_TEMPPATH, 991
MS_XMLMAPFILE_XSLT, 991
PROJ_DATA, 992
EPSG, 1069
eq
Expressions, 161-163, 166
equals() (mapscript.shapeObj method), 352
ERROR
WEB, 305
Error
drawEPP():	EPPL7 support is not available, 1074
loadLayer():	Unknown identifier.
Maximum number of classes reached, 1075
loadMapInternal():	Given map extent is invalid, 1075
msGetLabelSize():	Requested font not found, 1076




msLoadFontset():	Error opening fontset, 1077
msLoadMap():	Failed to open map file, 1077
msProcessProjection():	no options found in 'init' file, 1077
msProcessProjection():	No such file or directory, 1077
msProcessProjection():	Projection library error.major axis or radius =
0 not given, 1079
msQueryByPoint:	search returned no results, 1079
msReturnPage():	Web application error.
Malformed template name, 1080
msSaveImageGD():	Unable to access file, 1080
msWMSLoadGetMapParams():	WMS server error, 1081
Unable to load dll, 1081
errorObj
    MapScript PHP, 380 errorObj (class in mapscript), 318 Errors, 1074
EUC-JP
ENCODING, 155
Exception handling MapScript Python, 430
executeWFSGetFeature()	(mapscript.layerObj
method), 329
EXPRESSION
CLASS, 135
CLASSITEM, 157
LABEL, 208
expression
LAYER GEOMTRANSFORM, 220
STYLE GEOMTRANSFORM, 267
Expression types, 157
Expressions, 155
and, 161
area, 165
Arithmetic expressions, 162
Arithmetic operations, 164
Attributes, 157
beyond, 163
buffer, 165
commify, 164
contains, 163
crosses, 163
difference, 165
disjoint, 163
dwithin, 163
eq, 161-163, 166
firstcap, 164


fromtext, 165
ge, 161, 167
gt, 161, 166
in, 162
initcap, 164
intersects, 163
le, 161, 166
length, 164
Logical expressions, 160
lower, 164
lt, 161, 166
MapServer expressions, 159
ne, 161, 166
not, 161
or, 161
overlaps, 163
Regular expression comparison, 158
round, 164
Spatial expressions, 163
Spatial functions, 165
String comparison, 157
String expressions, 161
String functions, 164
String operations, 163
Temporal expressions, 166
tostring, 164
touches, 163
upper, 164
within, 163
expressions
GEOMTRANSFORM, 177
EXTENSION
OUTPUTFORMAT, 253
EXTENT
LAYER, 219
MAP, 249
REFERENCE, 262
EXTENT_PRIORITY
LAYER PROCESSING, 665
External overviews Raster, 672
F
FALLBACK
CLASS, 135
FastCGI, 992
FEATURE, 167
ITEMS, 167
LAYER, 220
OUTPUTFORMAT IMAGEMODE, 256
POINTS, 167
TEXT, 167
WKT, 167
Feature attributes



Cluster, 140, 241
FeatureCount
Cluster, 140
featurenquery CGI mode, 1057
featurequery
CGI mode, 1057
feet
LAYER SIZEUNITS, 234
LAYER UNITS, 239
MAP UNITS, 251
SCALEBAR UNITS, 265
File format
FONTSET, 168
File management, 1051
File paths, 309, 1051
File placement, 1051
FILLED
SYMBOL, 279
FILTER
CLUSTER, 139
LAYER, 220
Run-time substitution, 1063
Filter Encoding, 1069
Filter encoding Limitations, WFS, 875
OGC conformance tests, WFS, 877 Supported features, WFS, 872 Units of measure, WFS, 872
WFS, 871
FILTERITEM
LAYER, 220
firstcap
Expressions, 164
fit() (mapscript.rectObj method), 346
FlatGeobuf, 565
FLOAT32
OUTPUTFORMAT IMAGEMODE, 256
FONT
LABEL, 208
SYMBOL, 279
Fonts
Optimization, 1006
FONTSET, 168
File format, 168
MAP, 249
fontSetObj (class in mapscript), 319
FOOTER
JOIN, 200
LAYER, 220
WEB, 305
FORCE
LABEL, 209
FORCE2D

LAYER PROCESSING, 231
FORMATOPTION
BLOCKXSIZE, OUTPUTFORMAT, 255
BLOCKYSIZE, OUTPUTFORMAT, 255
COMPRESS, OUTPUTFORMAT, 255
COMPRESSION, OUTPUTFORMAT, 254
DUPLICATES, OUTPUTFORMAT, 256
GAMMA, OUTPUTFORMAT, 254
GEO_ENCODING, OUTPUTFORMAT, 255
INTERLACE, OUTPUTFORMAT, 255
INTERLEAVE, OUTPUTFORMAT, 255
LABELS, OUTPUTFORMAT, 256
METADATA_ITEM, OUTPUTFORMAT, 255
NULLVALUE, OUTPUTFORMAT, 256
OPAQUE_FORMAT, OUTPUTFORMAT, 255
OUTPUTFORMAT, 253
PALETTE, OUTPUTFORMAT, 254
PALETTE_FORCE, OUTPUTFORMAT, 254
QUALITY, OUTPUTFORMAT, 254
QUANTIZE_COLORS, OUTPUTFORMAT, 254
QUANTIZE_FORCE, OUTPUTFORMAT, 254
TILED, OUTPUTFORMAT, 255
TRANSPARENT_FORMAT, OUTPUTFORMAT, 255
UTFRESOLUTION, OUTPUTFORMAT, 256
Formats
OGR, 606
freeCache() (mapscript.labelCacheObj method), 322 freeQuery() (mapscript.mapObj method), 337 FreeType, 1069
FriBidi, 35
FROM
JOIN, 200
fromtext
Expressions, 165
fromWKT() (mapscript.shapeObj static method), 352
FTDouble (in module mapscript), 363 FTInteger (in module mapscript), 363 FTInvalid (in module mapscript), 363 FTString (in module mapscript), 363 Functions
MapScript PHP, 376
G
GAMMA
LAYER PROCESSING, 231, 665
OUTPUTFORMAT FORMATOPTION, 254
GAP, 94
STYLE, 267
GD, 1069
GDAL, 1070
gdaltindex, 1012
GDB
Debugging, 984
ge



Expressions, 161, 167
generalize
GEOMTRANSFORM, 181
LAYER GEOMTRANSFORM, 221
STYLE GEOMTRANSFORM, 268
generateSLD() (mapscript.layerObj method), 329 generateSLD() (mapscript.mapObj method), 337 GEO_ENCODING
OUTPUTFORMAT FORMATOPTION, 255
Geographical reference systems, 257
GeoJSON, 573
Geometry transformations, 169
GEOMTRANSFORM
bbox, 171
bbox, STYLE, 267
buffer, 178
buffer, LAYER, 220
buffer, STYLE, 268
centerline, LAYER, 180, 220
centroid, 171
centroid, STYLE, 267
densify, LAYER, 181, 221
end, 172
end, STYLE, 267
expression, LAYER, 220
expression, STYLE, 267
expressions, 177
generalize, 181
generalize, LAYER, 221
generalize, STYLE, 268
inner, LAYER, 182, 222
Javascript, 189
Javascript, LAYER, 224
labelpnt, 176
labelpnt, STYLE, 267
labelpoly, 176
labelpoly, STYLE, 267
LAYER, 220
outer, LAYER, 187, 223
simpifypt, STYLE, 268
simplify, 182
simplify, LAYER, 222
simplify, STYLE, 268
simplifypt, 184
simplifypt, LAYER, 223
smoothsia, 185
smoothsia all, 185
smoothsia angle, 185
smoothsia, LAYER, 223
smoothsia, STYLE, 268
start, 172
start, STYLE, 267
STYLE, 267
vertices, 174

vertices, STYLE, 267
GeoPackage, 577 Georeferencing Raster, 673
GEOS, 1070
Geospatial
PDF, 254
get() (mapscript.hashTableObj method), 320 get() (mapscript.lineObj method), 334 get() (mapscript.shapefileObj method), 354 get() (mapscript.shapeObj method), 353
get_height() (mapscript.mapObj method), 338 get_width() (mapscript.mapObj method), 338 getArea() (mapscript.shapeObj method), 353 getBinding() (mapscript.labelObj method), 325 getBinding() (mapscript.styleObj method), 356 getBytes() (mapscript.imageObj method), 320 getCenter() (mapscript.rectObj method), 346 getCentroid() (mapscript.shapeObj method), 353 getClass() (mapscript.layerObj method), 329 getClassIndex() (mapscript.layerObj method), 329 getConfigOption() (mapscript.mapObj method), 338 getDBF() (mapscript.shapefileObj method), 354 getExpressionBinding()	(mapscript.labelObj
method), 325
getExpressionString() (mapscript.classObj method), 316
getExpressionString() (mapscript.labelObj method), 325
getExtent() (mapscript.layerObj method), 329 getExtent() (mapscript.shapefileObj method), 354 getFieldDecimals() (mapscript.DBFInfo method),
313
getFieldName() (mapscript.DBFInfo method), 313 getFieldType() (mapscript.DBFInfo method), 313 getFieldWidth() (mapscript.DBFInfo method), 314 getFilterString()  (mapscript.clusterObj  method),
317
getFilterString() (mapscript.layerObj method), 329
getGeomTransform() (mapscript.layerObj method), 329
getGeomTransform() (mapscript.styleObj method), 356 getGroupString() (mapscript.clusterObj method), 318 getImage() (mapscript.symbolObj method), 358 getItem() (mapscript.layerObj method), 329 getItemDefinitions() (mapscript.layerObj method),
330
getItemType() (mapscript.layerObj method), 330 getLabel() (mapscript.classObj method), 316 getLabelPoint() (mapscript.shapeObj method), 353 getLayer() (mapscript.mapObj method), 338 getLayerByName() (mapscript.mapObj method), 338 getLayerOrder() (mapscript.mapObj method), 338




getLayersDrawingOrder()	(mapscript.mapObj method), 338
GetLegendGraphic WMS, 776
getLength() (mapscript.shapeObj method), 353
GetMap
WMS, 774
getName() (mapscript.OWSRequest method), 314 getNumFeatures() (mapscript.layerObj method), 330 getNumProcessing() (mapscript.layerObj method),
330
getNumResults() (mapscript.layerObj method), 330 getNumSymbols() (mapscript.mapObj method), 338 getOpacity() (mapscript.layerObj method), 330 getOption() (mapscript.outputFormatObj method), 343 getOptionAt() (mapscript.outputFormatObj method),
343
getOutputFormat() (mapscript.mapObj method), 338
getOutputFormatByName()	(mapscript.mapObj method), 338
getPoint() (mapscript.shapefileObj method), 354 getPoints() (mapscript.symbolObj method), 358 getProcessing() (mapscript.layerObj method), 330 getProcessingKey() (mapscript.layerObj method),
330
getProjection() (mapscript.layerObj method), 330 getProjection() (mapscript.mapObj method), 338 getResult() (mapscript.layerObj method), 330 getResult() (mapscript.resultCacheObj method), 348 getResults() (mapscript.layerObj method), 330 getResultsBounds() (mapscript.layerObj method),
330
getRotation() (mapscript.mapObj method), 338 getShape() (mapscript.layerObj method), 330 getShape() (mapscript.shapefileObj method), 355 GETSHAPE_STYLE_ITEMS
LAYER PROCESSING, 231
getSize() (mapscript.imageObj method), 321 getSize() (mapscript.mapObj method), 338 getStyle() (mapscript.classObj method), 316 getStyle() (mapscript.labelObj method), 325 getSymbol() (mapscript.symbolSetObj method), 359 getSymbolByName() (mapscript.mapObj method), 338 getSymbolByName() (mapscript.symbolSetObj method),
359
getTextString() (mapscript.classObj method), 317 getTextString() (mapscript.labelObj method), 325 getTransformed() (mapscript.shapefileObj method),
355
getUnits() (mapscript.projectionObj method), 345 getValue() (mapscript.OWSRequest method), 314 getValue() (mapscript.shapeObj method), 353 getValueByName() (mapscript.OWSRequest method),
314


getWMSFeatureInfoURL()	(mapscript.layerObj method), 330
GML, 1070
WFS Server, 844
gml_constants
WFS METADATA, 856
gml_default_items WFS METADATA, 856
gml_exclude_items WFS METADATA, 856
WMS METADATA, 787
gml_featureid
WFS METADATA, 857
gml_geometries
WFS METADATA, 857
WMS METADATA, 787
gml_groups
WFS METADATA, 857
WMS METADATA, 787
gml_include_items WFS METADATA, 858
WMS METADATA, 787
gml_mandatory_items WFS METADATA, 858
gml_optional_items WFS METADATA, 858
gml_types
WFS METADATA, 859
gml_xml_items
WFS METADATA, 859
WMS METADATA, 788
gml_[geometry name]_occurances WFS METADATA, 857
gml_[geometry name]_type WFS METADATA, 857
WMS METADATA, 788
gml_[group name]_group WFS METADATA, 857
WMS METADATA, 787
gml_[item name]_alias WFS METADATA, 858
WMS METADATA, 788
gml_[item name]_precision WFS METADATA, 858
gml_[item name]_type WFS METADATA, 858
WMS METADATA, 788
gml_[item name]_value WFS METADATA, 858
gml_[item name]_width WFS METADATA, 858
GPX, 1070
green, 660
Raster query, 670




GRID, 192
LABELFORMAT, 192
LAYER, 224
MAXARCS, 192
MAXINTERVAL, 193
MAXSUBDIVIDE, 193
MINARCS, 192
MININTERVAL, 192
MINSUBDIVIDE, 193
gridObj
MapScript PHP, 380
GRIDSTEP
LEADER, 240
GROUP
CLASS, 135
CLUSTER, 138
LAYER, 224
Group
Cluster, 140
gt
Expressions, 161, 166
H
HarfBuzz, 35
hashTableObj
    MapScript PHP, 381 hashTableObj (class in mapscript), 319 hatch
SYMBOL TYPE, 280
Hatch polygon fill, 104
HEADER
JOIN, 200
LAYER, 224
WEB, 305
HTTP status error codes WMS, 794
https connections, 764
I
icon
CGI, 1056
id
CGI, 1056
IDENTIFY, 196
CLASSAUTO, 197
CLASSGROUP, 197
LAYER, 224
TOLERANCE, 196
TOLERANCEUNITS, 196
idw
LAYER CONNECTIONTYPE, 217
IDW_COMPUTE_BORDERS LAYER PROCESSING, 230
IDW_POWER


LAYER PROCESSING, 230
IDW_RADIUS
LAYER PROCESSING, 230
IIS, 61
ASP script, 779
IMAGE
REFERENCE, 262
SYMBOL, 279
Image formats Optimization, 1011
IMAGECOLOR
LEGEND, 244
MAP, 249
SCALEBAR, 263
IMAGEMODE
BYTE, OUTPUTFORMAT, 256
FEATURE, OUTPUTFORMAT, 256
FLOAT32, OUTPUTFORMAT, 256
INT16, OUTPUTFORMAT, 256
OUTPUTFORMAT, 256
RGB, OUTPUTFORMAT, 256
RGBA, OUTPUTFORMAT, 256
imageObj
MapScript PHP, 381
    MapScript Python, 428 imageObj (class in mapscript), 320 IMAGEPATH
WEB, 305
Imagery
MapScript, 430
IMAGETYPE
jpeg, MAP, 249
MAP, 249
pdf, MAP, 249
png, MAP, 249
svg, MAP, 249
IMAGEURL
WEB, 305
img
CGI, 1056
imgbox
CGI, 1056
imgext
CGI, 1056
imgshape
CGI, 1056
imgsize
CGI, 1056
imgxy
CGI, 1056
in
Expressions, 162
inches
LAYER SIZEUNITS, 234




LAYER UNITS, 239
MAP UNITS, 251
SCALEBAR UNITS, 265
INCLUDE
MAP, 198
Include, 198
INDEX, 760
index() (mapscript.symbolSetObj method), 359
indexquery
CGI mode, 1057
initcap
Expressions, 164
INITIALGAP
STYLE, 269
initValues() (mapscript.shapeObj method), 353
inner
LAYER GEOMTRANSFORM, 182, 222
insertClass() (mapscript.layerObj method), 331 insertLayer() (mapscript.mapObj method), 338 insertStyle() (mapscript.classObj method), 317 insertStyle() (mapscript.labelObj method), 325 INSPIRE, 810
INSPIRE Download Service, 861 INSPIRE View Service, 810 Installation, 33
MapScript PHP, 51
OGR, 607
Oracle, 73
Unix, 33
Win32, 41
INT16
OUTPUTFORMAT IMAGEMODE, 256
INTERLACE
OUTPUTFORMAT FORMATOPTION, 255
INTERLEAVE
OUTPUTFORMAT FORMATOPTION, 255
Internal overviews Raster, 672
International characters, 149 intersection() (mapscript.shapeObj method), 353 intersects
Expressions, 163
intersects() (mapscript.shapeObj method), 353
INTERVALS
SCALEBAR, 264
ISO-8859-1
ENCODING, 155
ISO-8859-2
ENCODING, 155
isVisible() (mapscript.layerObj method), 331
itemfeaturenquery CGI mode, 1057
itemfeaturequery CGI mode, 1057


itemnquery
CGI mode, 1057
itemquery
CGI mode, 1058
ITEMS
FEATURE, 167
LAYER PROCESSING, 139, 228
J
Javascript
GEOMTRANSFORM, 189
LAYER GEOMTRANSFORM, 224
LAYER STYLEITEM, 235
JOIN, 199
CONNECTION, 200
CONNECTIONTYPE, 200
CONNECTIONTYPE csv, 200
CONNECTIONTYPE mysql, 200
CONNECTIONTYPE postgresql, 200
FOOTER, 200
FROM, 200
HEADER, 200
LAYER, 199, 225
NAME, 200
Supported formats, 199
TABLE, 200
TEMPLATE, 200
TO, 200
TYPE, 200
jpeg
MAP IMAGETYPE, 249
K
kerneldensity
LAYER CONNECTIONTYPE, 217
KERNELDENSITY_COMPUTE_BORDERS LAYER PROCESSING, 229
KERNELDENSITY_NORMALIZATION LAYER PROCESSING, 229
KERNELDENSITY_RADIUS LAYER PROCESSING, 229
KEYIMAGE
CLASS, 136
keys() (mapscript.hashTableObj method), 320
KEYSIZE
LEGEND, 245
KEYSPACING
LEGEND, 245
kilometers
LAYER SIZEUNITS, 234
LAYER UNITS, 239
MAP UNITS, 251
SCALEBAR UNITS, 265



L
LABEL, 206
ALIGN, 206
ANGLE, 207
ANTIALIAS, 207
BUFFER, 208
CLASS, 136
COLOR, 208
ENCODING, 208
EXPRESSION, 208
FONT, 208
FORCE, 209
LEGEND, 245
MAXLENGTH, 209
MAXOVERLAPANGLE, 210
MAXSCALEDENOM, 210
MAXSIZE, 210
MINDISTANCE, 210
MINFEATURESIZE, 210
MINSCALEDENOM, 210
MINSIZE, 211
OFFSET, 211
OUTLINECOLOR, 211
OUTLINEWIDTH, 212
PARTIALS, 212
POSITION, 212
PRIORITY, 212
REPEATDISTANCE, 212
SCALEBAR, 264
SHADOWCOLOR, 212
SHADOWSIZE, 213
SIZE, 213
STYLE, 214
TEXT, 214
TYPE, 215
TYPE bitmap, 215
TYPE truetype, 215
WRAP, 215
LABEL_NO_CLIP
LAYER PROCESSING, 230
LABELCACHE
LAYER, 225
labelcache_map_edge_buffer WEB METADATA, 306
labelcacheMemberObj MapScript PHP, 382
labelCacheMemberObj (class in mapscript), 321
labelcacheObj MapScript PHP, 383
labelCacheObj (class in mapscript), 322 labelCacheSlotObj (class in mapscript), 322 LABELFORMAT
GRID, 192
LABELITEM

LAYER, 225
labelLeaderObj (class in mapscript), 323
LABELMAXSCALEDENOM LAYER, 225
LABELMINSCALEDENOM LAYER, 225
labelObj
    MapScript PHP, 383 labelObj (class in mapscript), 323 labelpnt
GEOMTRANSFORM, 176
STYLE GEOMTRANSFORM, 267
labelpoly
GEOMTRANSFORM, 176
STYLE GEOMTRANSFORM, 267
LABELREQUIRES LAYER, 225
LABELS
OUTPUTFORMAT FORMATOPTION, 256
LAYER, 215
BINDVALS, 215
CLASS, 216
CLASSGROUP, 216
CLASSITEM, 216
CLUSTER, 216
COMPOSITE, 216
CONNECTION, 216
CONNECTIONOPTIONS, 217
CONNECTIONTYPE, 217
CONNECTIONTYPE contour, 217
CONNECTIONTYPE idw, 217
CONNECTIONTYPE kerneldensity, 217
CONNECTIONTYPE local, 217
CONNECTIONTYPE ogr, 217
CONNECTIONTYPE oraclespatial, 217
CONNECTIONTYPE plugin, 217
CONNECTIONTYPE postgis, 217
CONNECTIONTYPE rasterlabel, 217
CONNECTIONTYPE sde, 217
CONNECTIONTYPE union, 217
CONNECTIONTYPE uvraster, 217
CONNECTIONTYPE wfs, 217
CONNECTIONTYPE wms, 217
DATA, 218
DEBUG, 218
DUMP, 219
ENCODING, 151, 219
EXTENT, 219
FEATURE, 220
FILTER, 220
FILTERITEM, 220
FOOTER, 220
GEOMTRANSFORM, 220
GEOMTRANSFORM buffer, 220




GEOMTRANSFORM centerline, 180, 220
GEOMTRANSFORM densify, 181, 221
GEOMTRANSFORM expression, 220
GEOMTRANSFORM generalize, 221
GEOMTRANSFORM inner, 182, 222
GEOMTRANSFORM Javascript, 224
GEOMTRANSFORM outer, 187, 223
GEOMTRANSFORM simplify, 222
GEOMTRANSFORM simplifypt, 223
GEOMTRANSFORM smoothsia, 223
GRID, 224
GROUP, 224
HEADER, 224
IDENTIFY, 224
JOIN, 199, 225
LABELCACHE, 225
LABELITEM, 225
LABELMAXSCALEDENOM, 225
LABELMINSCALEDENOM, 225
LABELREQUIRES, 225
MAP, 250
MASK, 225
MAXFEATURES, 226
MAXGEOWIDTH, 226
MAXSCALEDENOM, 226
METADATA, 226
METADATA, SOS, 931
METADATA, WCS, 910
METADATA, WFS, 856 METADATA, WFS Client, 867 METADATA, WMS, 787 METADATA, WMS Client, 820 MINFEATURESIZE, 227
MINGEOWIDTH, 227
MINSCALEDENOM, 227
NAME, 227
OFFSITE, 227
OPACITY, 228
PLUGIN, 228
POSTLABELCACHE, 228
PROCESSING, 228
PROCESSING ArcSDE options, 228
PROCESSING BANDS, 665
PROCESSING CHART_BAR_MAXVAL, 691
PROCESSING CHART_BAR_MINVAL, 691
PROCESSING CHART_SIZE, 687
PROCESSING CHART_SIZE_RANGE, 687
PROCESSING CHART_TYPE, 688
PROCESSING CLASSIFY_SCALED, 665
PROCESSING CLOSE_CONNECTION, 229, 598
PROCESSING cluster options, 228
PROCESSING CLUSTER_GET_ALL_SHAPES, 139, 228
PROCESSING CLUSTER_KEEP_LOCATIONS, 139, 228
PROCESSING CLUSTER_USE_MAP_UNITS, 139, 228


PROCESSING COLOR_MATCH_THRESHOLD, 665
PROCESSING contour options, 229
PROCESSING CONTOUR_INTERVAL, 229
PROCESSING CONTOUR_ITEM, 229
PROCESSING CONTOUR_LEVELS, 229
PROCESSING DITHER, 665
PROCESSING EXTENT_PRIORITY, 665
PROCESSING FORCE2D, 231
PROCESSING GAMMA, 231, 665
PROCESSING GETSHAPE_STYLE_ITEMS, 231
PROCESSING IDW_COMPUTE_BORDERS, 230
PROCESSING IDW_POWER, 230
PROCESSING IDW_RADIUS, 230
PROCESSING ITEMS, 139, 228
PROCESSING KERNELDENSITY_COMPUTE_BORDERS, 229
PROCESSING	KERNELDENSITY_NORMALIZATION, 229
PROCESSING KERNELDENSITY_RADIUS, 229
PROCESSING LABEL_NO_CLIP, 230
PROCESSING LOAD_FULL_RES_IMAGE, 666
PROCESSING LOAD_WHOLE_IMAGE, 666
PROCESSING LUT[_n], 666
PROCESSING MSSQL_READ_WKB, 231, 598
PROCESSING NATIVE_FILTER, 231
PROCESSING OVERSAMPLE_RATIO, 667
PROCESSING POLYLINE_NO_CLIP, 230
PROCESSING RANGE_COLORSPACE, 230
PROCESSING raster options, 231
PROCESSING RENDERMODE, 230
PROCESSING RESAMPLE, 667
PROCESSING SCALE, 667
PROCESSING union options, 231
PROCESSING UNION_SCALE_CHECK, 231
PROCESSING UNION_SRCLAYER_CLOSE_CONNECTION, 231
PROCESSING UNION_STATUS_CHECK, 231
PROCESSING UV_SIZE_SCALE, 231
PROCESSING UV_SPACING, 231
PROCESSING WORLDFILE, 667
PROJECTION, 232
REQUIRES, 232
SCALETOKEN, 233
SIZEUNITS, 234
SIZEUNITS feet, 234
SIZEUNITS inches, 234
SIZEUNITS kilometers, 234
SIZEUNITS meters, 234
SIZEUNITS miles, 234
SIZEUNITS nauticalmiles, 234
SIZEUNITS pixels, 234
STATUS, 234
STYLEITEM, 234
STYLEITEM attribute, 234




STYLEITEM AUTO, 235
STYLEITEM Javascript, 235
SYMBOLSCALEDENOM, 236
TEMPLATE, 237
TILEINDEX, 237
TILEITEM, 237
TILESRS, 237
TOLERANCE, 237
TOLERANCEUNITS, 238
TRANSFORM, 238
TYPE, 238
TYPE annotation, 238
TYPE chart, 238
TYPE circle, 238
TYPE line, 238
TYPE point, 238
TYPE polygon, 238
TYPE query, 238
TYPE raster, 238
UNITS, 239
UNITS dd, 239
UNITS feet, 239
UNITS inches, 239
UNITS kilometers, 239
UNITS meters, 239
UNITS miles, 239
UNITS nauticalmiles, 239
UNITS percentages, 239
UNITS pixels, 239
UTFDATA, 239
UTFITEM, 239
VALIDATION, 239
Layer
Cloning, MapScript, 434
layer
CGI, 1056
Layer Metadata API Metadata, 841
layerObj
    MapScript PHP, 385 layerObj (class in mapscript), 326 Layers
Optimization, 1004
layers
CGI, 1056
le
Expressions, 161, 166
LEADER, 239
CLASS, 136
GRIDSTEP, 240
MAXDISTANCE, 240
Leader, 240
LEGEND, 244
IMAGECOLOR, 244


KEYSIZE, 245
KEYSPACING, 245
LABEL, 245
MAP, 250
OUTLINECOLOR, 245
POSITION, 245
POSTLABELCACHE, 245
STATUS, 245
TEMPLATE, 245
TRANSPARENT, 246
legend
CGI mode, 1058
Utility,  1036
LEGENDFORMAT
WEB, 305
legendicon
CGI mode, 1058
legendObj
    MapScript PHP, 390 legendObj (class in mapscript), 333 length
Expressions, 164
libexslt, 308
libiconv, 151
libxslt, 308
Limit mapfile access, 996
Limitations
WFS Filter encoding, 875
line
LAYER TYPE, 238
Line symbol overlay, 94 Line symbols, 93 LINECAP
butt, STYLE, 269
round, STYLE, 269
square, STYLE, 269
STYLE, 102, 269
LINEJOIN
bevel, STYLE, 270
miter, STYLE, 270
round, STYLE, 270
STYLE, 102, 270
LINEJOINMAXSIZE STYLE, 102, 270
lineObj
    MapScript PHP, 391 lineObj (class in mapscript), 334 LOAD_FULL_RES_IMAGE
LAYER PROCESSING, 666
LOAD_WHOLE_IMAGE
LAYER PROCESSING, 666
loadLayer():	Unknown identifier.	Maximum number of classes reached
Error, 1075




loadMapContext() (mapscript.mapObj method), 339
loadMapInternal():	Given map extent is invalid
Error, 1075
loadOWSParameters() (mapscript.mapObj method), 339
loadParams() (mapscript.OWSRequest method), 314
loadParamsFromPost()	(mapscript.OWSRequest method), 314
loadParamsFromURL()	(mapscript.OWSRequest method), 314
loadQuery() (mapscript.mapObj method), 339
local
LAYER CONNECTIONTYPE, 217
LOG
WEB, 305
Logical expressions Expressions, 160
lower
Expressions, 164
lt
Expressions, 161, 166





















map


QUERYMAP, 250
REFERENCE, 250
RESOLUTION, 250
SCALEBAR, 250
SCALEDENOM, 250
SHAPEPATH, 250
SIZE, 251
STATUS, 251
SYMBOLSET, 251
TEMPLATEPATTERN, 251
UNITS, 251
UNITS dd, 251
UNITS feet, 251
UNITS inches, 251
UNITS kilometers, 251
UNITS meters, 251
UNITS miles, 251
UNITS nauticalmiles, 251
WEB, 251
CGI, 1056
CGI mode, 1058

LUT[_n]
LAYER PROCESSING, 666
M
MAP, 246
ANGLE, 246
CONFIG, 246
CONFIG CGI_CONTEXT_URL, 247
CONFIG MS_ENCRYPTION_KEY, 247
CONFIG MS_ERRORFILE, 247
CONFIG MS_NONSQUARE, 247
CONFIG ON_MISSING_DATA, 247
CONFIG PROJ_DATA, 247, 259
CONFIG PROJ_DEBUG, 248
DATAPATTERN, 248
DEBUG, 248
DEFRESOLUTION, 249
EXTENT, 249
FONTSET, 249
IMAGECOLOR, 249
IMAGETYPE, 249
IMAGETYPE jpeg, 249
IMAGETYPE pdf, 249
IMAGETYPE png, 249
IMAGETYPE svg, 249
INCLUDE, 198
LAYER, 250
LEGEND, 250
MAXSIZE, 250
NAME, 250
OUTPUTFORMAT, 250
PROJECTION, 250

Map projections, 257
Axis order, 780
Map Scale, 1070
map2img
Debugging, 978
Utility,  1036
map_resolution
WMS Vendor specific parameters, 794
mapext
CGI, 1056
Mapfile, 79, 1070
Cloning, MapScript, 433
MapScript, 432
Saving, MapScript, 433
SOS Server, 924
WCS Server, 893
WFS Client, 867
WFS Server, 844
WMS Client, 818
WMS Server, 771, 801
Mapfile tuning, 999
mapObj
MapScript, 433
    MapScript PHP, 392 mapObj (class in mapscript), 335 MAPS
CONFIG, 148
MapScript, 1070
.NET Compilation, 56
API, 311
Imagery, 430
Layer Cloning, 434




Mapfile, 432
Mapfile Cloning, 433
Mapfile Saving, 433
mapObj, 433
PHP, 49, 370
PHP Build, 50
PHP Classes, 376
PHP classObj, 377
PHP clusterObj, 379
PHP colorObj, 379
PHP Constants, 374
PHP Download, 50
PHP errorObj, 380
PHP Functions, 376
PHP gridObj, 380
PHP hashTableObj, 381
PHP imageObj, 381
PHP Installation, 51
PHP labelcacheMemberObj, 382
PHP labelcacheObj, 383
PHP labelObj, 383
PHP layerObj, 385
PHP legendObj, 390
PHP lineObj, 391
PHP mapObj, 392
PHP outputformatObj, 399
PHP OwsrequestObj, 400
PHP pointObj, 401
PHP projectionObj, 402
PHP querymapObj, 403
PHP rectObj, 403
PHP referenceMapObj, 404
PHP resultObj, 405
PHP scalebarObj, 406
PHP Setup, 50
PHP shapefileObj, 406
PHP shapeObj, 407
PHP styleObj, 410
PHP symbolObj, 412
PHP webObj, 413
Python, 428
Python Classes, 428
Python Exception handling, 430
Python imageObj, 428
Python pointObj, 429
Python rectObj, 429
Querying, 435
V8, 77
Mapscript
Wrapper, 779
Mapscript wrappers WxS Services, 935
Mapserver
Alias, 777


MapServer expressions Expressions, 159
mapshape
CGI, 1057
mapsize
CGI, 1057
mapxy
CGI, 1057
MARKER
REFERENCE, 262
markerCacheMemberObj (class in mapscript), 342
MARKERSIZE
REFERENCE, 262
MASK
LAYER, 225
MAXARCS
GRID, 192
MAXBOXSIZE
REFERENCE, 262
MAXCLASSES, 309
MAXDISTANCE
CLUSTER, 138
LEADER, 240
MAXFEATURES
LAYER, 226
MAXGEOWIDTH
LAYER, 226
MAXINTERVAL
GRID, 193
MAXLENGTH
  LABEL, 209 MAXOVERLAPANGLE LABEL, 210
MAXSCALEDENOM CLASS, 136
LABEL, 210
LAYER, 226
STYLE, 270
WEB, 305
MAXSIZE
CLASS, 136
LABEL, 210
MAP, 250
STYLE, 270
MAXSTYLES, 309
MAXSUBDIVIDE
GRID, 193
MAXSYMBOLS, 309
MAXTEMPLATE
WEB, 306
MAXWIDTH
STYLE, 270
maxx
CGI, 1057




maxy
CGI, 1057
Mercator, 1070
MESSAGELENGTH (in module mapscript), 361
METADATA
CLASS, 136
gml_constants, WFS, 856
gml_default_items, WFS, 856
gml_exclude_items, WFS, 856
gml_exclude_items, WMS, 787
gml_featureid, WFS, 857
gml_geometries, WFS, 857
gml_geometries, WMS, 787
gml_groups, WFS, 857
gml_groups, WMS, 787
gml_include_items, WFS, 858
gml_include_items, WMS, 787
gml_mandatory_items, WFS, 858
gml_optional_items, WFS, 858
gml_types, WFS, 859
gml_xml_items, WFS, 859
gml_xml_items, WMS, 788
gml_[geometry name]_occurances, WFS, 857 gml_[geometry name]_type, WFS, 857 gml_[geometry name]_type, WMS, 788 gml_[group name]_group, WFS, 857 gml_[group name]_group, WMS, 787 gml_[item name]_alias, WFS, 858 gml_[item name]_alias, WMS, 788 gml_[item name]_precision, WFS, 858 gml_[item name]_type, WFS, 858
gml_[item name]_type, WMS, 788 gml_[item name]_value, WFS, 858 gml_[item name]_width, WFS, 858 labelcache_map_edge_buffer, WEB, 306
LAYER, 226
ms_enable_modes, WEB, 306
OGCAPI, 802
ows_allowed_ip_list, SOS, 929, 931
ows_allowed_ip_list, WCS, 907, 910
ows_allowed_ip_list, WFS, 853, 859
ows_allowed_ip_list, WMS, 782, 788
ows_compliance_mode, WMS, 782
ows_denied_ip_list, SOS, 929, 931
ows_denied_ip_list, WCS, 908, 910
ows_denied_ip_list, WFS, 853, 859
ows_denied_ip_list, WMS, 782, 788
ows_extra_params, OGCAPI, 809
ows_http_max_age, WMS, 782
ows_language, SOS, 929
ows_schemas_location, OGCAPI, 810
ows_schemas_location, SOS, 929
ows_schemas_location, WFS, 853
ows_schemas_location, WMS, 782


ows_sld_enabled, WMS, 782
ows_updatesequence, SOS, 929
ows_updatesequence, WFS, 854
ows_updatesequence, WMS, 782
SOS LAYER, 931
SOS WEB, 929
sos_abstract, SOS, 929
sos_accessconstraints, SOS, 929
sos_address, SOS, 930
sos_addresstype, SOS, 930
sos_allowed_ip_list, SOS, 929
sos_city, SOS, 930
sos_contactelectronicmailaddress, SOS, 930
sos_contactfacsimiletelephone, SOS, 930
sos_contactinstructions, SOS, 930
sos_contactorganization, SOS, 930
sos_contactperson, SOS, 930
sos_contactposition, SOS, 930
sos_contactvoicetelephone, SOS, 930
sos_country, SOS, 930
sos_denied_ip_list, SOS, 929
sos_describesensor_url, SOS, 931
sos_enable_request, SOS, 930, 931
sos_encoding_blockSeparator, SOS, 930
sos_encoding_tokenSeparator, SOS, 930
sos_fees, SOS, 930
sos_hoursofservice, SOS, 930
sos_keywordlist, SOS, 930
sos_maxfeatures, SOS, 930
sos_observedproperty_authority, SOS, 932
sos_observedproperty_id, SOS, 932
sos_observedproperty_name, SOS, 932
sos_observedproperty_version, SOS, 932
sos_offering_description, SOS, 932
sos_offering_extent, SOS, 932
sos_offering_id, SOS, 932
sos_offering_intendedapplication, SOS, 933
sos_offering_name, SOS, 933
sos_offering_timeextent, SOS, 933
sos_onlineresource, SOS, 931
sos_postcode, SOS, 930
sos_procedure, SOS, 933
sos_procedure_item, SOS, 933
sos_role, SOS, 931
sos_service_onlineresource, SOS, 931
sos_srs, SOS, 931
sos_stateorprovince, SOS, 930
sos_timeitem, SOS, 933
sos_title, SOS, 931
sos_[item name]_alias, SOS, 932 sos_[item name]_definition, SOS, 932 sos_[item name]_uom, SOS, 932
WCS LAYER, 910
WCS WEB, 907




wcs_abstract, WCS, 908, 910
wcs_accessconstraints, WCS, 908
wcs_address, WCS, 908
wcs_allowed_ip_list, WCS, 907
wcs_band_names, WCS, 908
wcs_city, WCS, 908
wcs_contactelectronicmailaddress, WCS, 908
wcs_contactfacimiletelephone, WCS, 908
wcs_contactorganization, WCS, 908
wcs_contactperson, WCS, 908
wcs_contactposition, WCS, 908
wcs_contactvoicetelephone, WCS, 908
wcs_country, WCS, 908
wcs_denied_ip_list, WCS, 908
wcs_description, WCS, 908, 910
wcs_enable_request, WCS, 908, 910
wcs_extent, WCS, 910
wcs_fees, WCS, 908
wcs_formats, WCS, 910
wcs_keywords, WCS, 908, 910
wcs_label, WCS, 908, 910
wcs_languages, WFS, 910
wcs_metadatalink_format, WCS, 909, 910
wcs_metadatalink_href, WCS, 909, 911
wcs_metadatalink_type, WCS, 909, 911
wcs_name, WCS, 909, 911
wcs_native_format, WCS, 911
wcs_nativeformat, WCS, 911
wcs_outputformat_creationoption, WCS, 911
wcs_outputformat_mdi, WCS, 911
wcs_postcode, WCS, 908
wcs_rangeset_axes, WCS, 912
wcs_rangeset_description, WCS, 913
wcs_rangeset_label, WCS, 913
wcs_rangeset_name, WCS, 913
wcs_rangeset_nullvalue, WCS, 913


wcs_responsibleparty_phone_facsimile,
WCS, 909
wcs_responsibleparty_phone_voice, WCS, 909
wcs_responsibleparty_postionname, WCS, 909
wcs_service_onlineresource, WCS, 909
wcs_srs, WCS, 913
wcs_stateorprovince, WCS, 908
wcs_timeitem, WCS, 913
wcs_timeposition, WCS, 913
WEB, 306
WFS Client LAYER, 867
WFS LAYER, 856
WFS WEB, 853
wfs_abstract, WFS, 854, 859
wfs_accessconstraints, WFS, 854
wfs_allowed_ip_list, WFS, 853
wfs_anable_request, WFS, 854, 859
wfs_compute_number_matched, WFS, 854
wfs_denied_ip_list, WFS, 853
wfs_extent, WFS, 859
wfs_feature_collection, WFS, 854
wfs_featureid, WFS, 859
wfs_features_cache_count, WFS, 854
wfs_features_cache_size, WFS, 854
wfs_fees, WFS, 854
wfs_geometry_precision, WFS, 855, 859
wfs_getcapabilities_version, WFS, 855
wfs_getfeature_formatlist, WFS, 860
wfs_keywordlist, WFS, 855, 860
wfs_languages, WFS, 855
wfs_maxfeatures, WFS, 855
wfs_maxfeatures_ignore_for_resulttype_hits,
WFS, 855
wfs_metadataurl_about, WFS, 860
wfs_metadataurl_format, WFS, 860
wfs_metadataurl_href, WFS, 860

wcs_responsibleparty_address_administrativearewaf, s_metadataurl_list, WMS, 860

WCS, 909
wcs_responsibleparty_address_city,	WCS, 909
wcs_responsibleparty_address_country,
WCS, 909
wcs_responsibleparty_address_deliverypoint, WCS, 909

wfs_metadataurl_type, WFS, 861
wfs_namespace_prefix, WFS, 855
wfs_namespace_uri, WFS, 855
wfs_onlineresource, WFS, 855
wfs_return_srs_as_urn, WFS, 856
wfs_service_onlineresource, WFS, 856
wfs_srs, WFS, 856, 861

wcs_responsibleparty_address_electronicmailaddwrfess_ss, toredqueries, WFS, 856

WCS, 909
wcs_responsibleparty_address_postalcode,
WCS, 909
wcs_responsibleparty_individualname, WCS, 909
wcs_responsibleparty_onlineresource, WCS, 909
wcs_responsibleparty_organizationname, WCS, 909

wfs_title, WFS, 856, 861
wfs_use_default_extent_for_getfeature,
WFS, 861
wfs_[storedqueryid]_filedef, WFS, 856
wfs_[storedqueryid]_inlinedef, WFS, 856
WMS Client LAYER, 820
WMS LAYER, 787
WMS WEB, 782
wms_abstract, WMS, 783, 788




wms_accessconstraints, WMS, 783
wms_address, WMS, 783
wms_addresstype, WMS, 783
wms_allow_getmap_without_styles, WMS, 783
wms_allowed_ip_list, WMS, 782
wms_attribution_logourl_format,  WMS,  783,
789
wms_attribution_logourl_height, WMS, 783,
789
wms_attribution_logourl_href, WMS, 783, 789
wms_attribution_logourl_width,	WMS, 783,
789
wms_attribution_onlineresource,  WMS,  783,
789
wms_attribution_title, WMS, 784, 789
wms_authorityurl_href, WMS, 789
wms_authorityurl_name, WMS, 789
wms_bbox_extended, WMS, 784, 789
wms_city, WMS, 783
wms_compliance_mode, WMS, 782
wms_contactelectronicmailaddress, WMS, 784
wms_contactfacsimiletelephone, WMS, 784
wms_contactorganization, WMS, 784
wms_contactperson, WMS, 784
wms_contactposition, WMS, 784
wms_contactvoicetelephone, WMS, 784
wms_country, WMS, 783
wms_dataurl_format, WMS, 789
wms_dataurl_href, WMS, 789
wms_denied_ip_list, WMS, 782
wms_enable_request, WMS, 784, 790
wms_encoding, WMS, 784
wms_exclude_items, WMS, 790
wms_extent, WMS, 790
wms_feature_info_mime_type, WMS, 784
wms_fees, WMS, 785
wms_getcapabilities_version, WMS, 785
wms_getfeatureinfo_formatlist, WMS, 790
wms_getlegendgraphic_formatlist, WMS, 785,
790
wms_getmap_formatlist, WMS, 785, 790
wms_group_abstract, WMS, 791
wms_group_title, WMS, 791
wms_identifier_authority, WMS, 791
wms_identifier_value, WMS, 791
wms_include_items, WMS, 791
wms_keywordlist, WMS, 785, 791
wms_keywordlist_vocabulary, WMS, 785, 791
wms_keywordlist_[vocabulary's name]_items, WMS, 785, 791
wms_languages, WMS, 785
wms_layer_group, WMS, 791
wms_layerlimit, WMS, 785
wms_metadataurl_format, WMS, 792


wms_metadataurl_href, WMS, 792
wms_metadataurl_list, WMS, 792, 909
wms_metadataurl_type, WMS, 792
wms_onlineresource, WMS, 785
wms_opaque, WMS, 792
wms_postcode, WMS, 783
wms_remote_sld_max_bytes, WMS, 786
wms_resx, WMS, 786
wms_resy, WMS, 786
wms_rootlayer_abstract, WMS, 786
wms_rootlayer_keywordlist, WMS, 786
wms_rootlayer_name, WMS, 786
wms_rootlayer_title, WMS, 786
wms_service_onlineresource, WMS, 786
wms_srs, WMS, 786, 793
wms_stateorprovince, WMS, 783
wms_style, WMS, 793
wms_style_[style's_name]_legendurl_format,
WMS, 793
wms_style_[style's_name]_legendurl_height,
WMS, 793
wms_style_[style's_name]_legendurl_href,
WMS, 793
wms_style_[style's_name]_legendurl_width,
WMS, 793
wms_timeextent, WMS, 793
wms_timeformat, WMS, 787, 793
wms_timeitem, WMS, 793
wms_title, WMS, 787, 793
Metadata
Layer Metadata API, 841
SOS, 928
WCS, 907
WFS, 850
WMS, 781
METADATA_ITEM
OUTPUTFORMAT FORMATOPTION, 255
meters
LAYER SIZEUNITS, 234
LAYER UNITS, 239
MAP UNITS, 251
SCALEBAR UNITS, 265
Microsoft SQL Server 2008, 593
miles
LAYER SIZEUNITS, 234
LAYER UNITS, 239
MAP UNITS, 251
SCALEBAR UNITS, 265
MIMETYPE
OUTPUTFORMAT, 256
MINARCS
GRID, 192
MINBOXSIZE
REFERENCE, 262




MINDISTANCE
LABEL, 210
MINFEATURESIZE CLASS, 136
LABEL, 210
LAYER, 227
MINGEOWIDTH
LAYER, 227
MININTERVAL
GRID, 192
MINSCALEDENOM CLASS, 136
LABEL, 210
LAYER, 227
STYLE, 270
WEB, 307
MINSIZE
CLASS, 137
LABEL, 211
STYLE, 270
MINSUBDIVIDE
GRID, 193
MINTEMPLATE
WEB, 308
MINWIDTH
STYLE, 270
minx
CGI, 1057
miny
CGI, 1057
miter
STYLE LINEJOIN, 270
mode
browse, CGI, 1057
CGI, 1057
coordinate, CGI, 1057
featurenquery, CGI, 1057
featurequery, CGI, 1057
indexquery, CGI, 1057
itemfeaturenquery, CGI, 1057
itemfeaturequery, CGI, 1057
itemnquery, CGI, 1057
itemquery, CGI, 1058
legend, CGI, 1058
legendicon, CGI, 1058
map, CGI, 1058
nquery, CGI, 1058
query, CGI, 1058
reference, CGI, 1058
scalebar, CGI, 1058
tile, CGI, 1058
zoomin, CGI, 1058
zoomout, CGI, 1058
moveClassDown() (mapscript.layerObj method), 331


moveClassUp() (mapscript.layerObj method), 331 moveLayerDown() (mapscript.mapObj method), 339 moveLayerUp() (mapscript.mapObj method), 339 moveStyleDown() (mapscript.classObj method), 317 moveStyleDown() (mapscript.labelObj method), 325 moveStyleUp() (mapscript.classObj method), 317 moveStyleUp() (mapscript.labelObj method), 325 MS_AGGERR (in module mapscript), 363 MS_ALIGN_CENTER (in module mapscript), 361 MS_ALIGN_DEFAULT (in module mapscript), 361 MS_ALIGN_LEFT (in module mapscript), 361 MS_ALIGN_RIGHT (in module mapscript), 361 MS_ALL_MATCHING_CLASSES (in module mapscript), 368 MS_AUTO (in module mapscript), 367
MS_AUTO2 (in module mapscript), 367 MS_BITMAP (in module mapscript), 364 MS_CC (in module mapscript), 367 MS_CGIERR (in module mapscript), 363 MS_CHILDERR (in module mapscript), 363 MS_CJC_BEVEL (in module mapscript), 366 MS_CJC_BUTT (in module mapscript), 366
MS_CJC_DEFAULT_JOIN_MAXSIZE (in module map-
script), 366
MS_CJC_MITER (in module mapscript), 366 MS_CJC_NONE (in module mapscript), 366 MS_CJC_ROUND (in module mapscript), 366 MS_CJC_SQUARE (in module mapscript), 366 MS_CJC_TRIANGLE (in module mapscript), 366 MS_CL (in module mapscript), 367 MS_CLASS_ALLOCSIZE (in module mapscript), 361 MS_COMPOP_CLEAR (in module mapscript), 362 MS_COMPOP_COLOR_BURN (in module mapscript), 362
MS_COMPOP_COLOR_DODGE (in module mapscript), 362 MS_COMPOP_CONTRAST (in module mapscript), 362 MS_COMPOP_DARKEN (in module mapscript), 362 MS_COMPOP_DIFFERENCE (in module mapscript), 362 MS_COMPOP_DST (in module mapscript), 362 MS_COMPOP_DST_ATOP (in module mapscript), 362 MS_COMPOP_DST_IN (in module mapscript), 362 MS_COMPOP_DST_OUT (in module mapscript), 362 MS_COMPOP_DST_OVER (in module mapscript), 362 MS_COMPOP_EXCLUSION (in module mapscript), 362 MS_COMPOP_HARD_LIGHT (in module mapscript), 362 MS_COMPOP_HSL_COLOR (in module mapscript), 362 MS_COMPOP_HSL_HUE (in module mapscript), 362 MS_COMPOP_HSL_LUMINOSITY (in module mapscript),
362
MS_COMPOP_HSL_SATURATION (in module mapscript), 362
MS_COMPOP_INVERT (in module mapscript), 362 MS_COMPOP_INVERT_RGB (in module mapscript), 362 MS_COMPOP_LIGHTEN (in module mapscript), 362 MS_COMPOP_MINUS (in module mapscript), 362 MS_COMPOP_MULTIPLY (in module mapscript), 362




MS_COMPOP_OVERLAY (in module mapscript), 362 MS_COMPOP_PLUS (in module mapscript), 362 MS_COMPOP_SCREEN (in module mapscript), 362 MS_COMPOP_SOFT_LIGHT (in module mapscript), 362 MS_COMPOP_SRC (in module mapscript), 362 MS_COMPOP_SRC_ATOP (in module mapscript), 362 MS_COMPOP_SRC_IN (in module mapscript), 362 MS_COMPOP_SRC_OUT (in module mapscript), 362 MS_COMPOP_SRC_OVER (in module mapscript), 362 MS_COMPOP_XOR (in module mapscript), 362 MS_CONFIG_SECTION (in module mapscript), 362 MS_CONFIG_SECTION_ENV (in module mapscript), 362 MS_CONFIG_SECTION_MAPS (in module mapscript), 362 MS_CONFIG_SECTION_PLUGINS (in module mapscript),
362
MS_CONTEXT_BAD_PATTERN
Environment variables, 989
MS_CONTEXT_PATTERN
    Environment variables, 990 MS_CONTOUR (in module mapscript), 363 MS_CR (in module mapscript), 367 MS_DB_CSV (in module mapscript), 363 MS_DB_MYSQL (in module mapscript), 363 MS_DB_ORACLE (in module mapscript), 363 MS_DB_POSTGRES (in module mapscript), 363 MS_DB_XBASE (in module mapscript), 363 MS_DBFERR (in module mapscript), 363 MS_DD (in module mapscript), 370 MS_DEBUGLEVEL
Debugging, 975
    Environment variables, 987 MS_DEBUGLEVEL_DEBUG (in module mapscript), 363 MS_DEBUGLEVEL_DEVDEBUG (in module mapscript), 363 MS_DEBUGLEVEL_ERRORSONLY (in module mapscript),
363
MS_DEBUGLEVEL_TUNING (in module mapscript), 363 MS_DEBUGLEVEL_V (in module mapscript), 363 MS_DEBUGLEVEL_VV (in module mapscript), 363 MS_DEBUGLEVEL_VVV (in module mapscript), 363 MS_DEFAULT (in module mapscript), 366 MS_DEFAULT_CGI_PARAMS (in module mapscript), 361 MS_DEFAULT_LABEL_PRIORITY (in module mapscript),
361
MS_DELETE (in module mapscript), 366 MS_DONE (in module mapscript), 368 MS_EMBED (in module mapscript), 366 ms_enable_modes
WEB METADATA, 306
MS_ENCRYPTION_KEY
Environment variables, 987
MAP CONFIG, 247
MS_EOFERR (in module mapscript), 363
MS_ERRORFILE
Debugging, 973


Environment variables, 987
MAP CONFIG, 247
MS_FAILURE (in module mapscript), 368 MS_FALSE (in module mapscript), 366 MS_FEET (in module mapscript), 370 MS_FGBERR (in module mapscript), 364 MS_FILE_MAP (in module mapscript), 364 MS_FILE_SYMBOL (in module mapscript), 364
MS_FIRST_MATCHING_CLASS (in module mapscript), 368
MS_FLATGEOBUF (in module mapscript), 363 MS_FOLLOW (in module mapscript), 367 MS_GEOS_BEYOND (in module mapscript), 364 MS_GEOS_CONTAINS (in module mapscript), 364 MS_GEOS_CROSSES (in module mapscript), 364 MS_GEOS_DISJOINT (in module mapscript), 364 MS_GEOS_DWITHIN (in module mapscript), 364 MS_GEOS_EQUALS (in module mapscript), 364 MS_GEOS_INTERSECTS (in module mapscript), 364 MS_GEOS_OVERLAPS (in module mapscript), 364 MS_GEOS_TOUCHES (in module mapscript), 364 MS_GEOS_WITHIN (in module mapscript), 364 MS_GEOSERR (in module mapscript), 363 MS_GET_REQUEST (in module mapscript), 368 MS_GIANT (in module mapscript), 365
MS_GMLERR (in module mapscript), 363 MS_GRATICULE (in module mapscript), 362 MS_HASHERR (in module mapscript), 363 MS_HASHSIZE (in module mapscript), 361 MS_HILITE (in module mapscript), 367 MS_HTTPERR (in module mapscript), 363 MS_IDENTERR (in module mapscript), 363 MS_IDW (in module mapscript), 363 MS_IMAGECACHESIZE (in module mapscript), 366 MS_IMAGEMODE_BYTE (in module mapscript), 365
MS_IMAGEMODE_FEATURE (in module mapscript), 365 MS_IMAGEMODE_FLOAT32 (in module mapscript), 365 MS_IMAGEMODE_INT16 (in module mapscript), 365 MS_IMAGEMODE_NULL (in module mapscript), 365 MS_IMAGEMODE_PC256 (in module mapscript), 365 MS_IMAGEMODE_RGB (in module mapscript), 365 MS_IMAGEMODE_RGBA (in module mapscript), 365 MS_IMGERR (in module mapscript), 363
MS_INCHES (in module mapscript), 370
MS_INDEX_TEMPLATE_DIRECTORY
    Environment variables, 988 MS_INHERIT (in module mapscript), 370 MS_INLINE (in module mapscript), 362 MS_IOERR (in module mapscript), 363
MS_JOIN_ONE_TO_MANY (in module mapscript), 365 MS_JOIN_ONE_TO_ONE (in module mapscript), 365 MS_JOINERR (in module mapscript), 363 MS_KERNELDENSITY (in module mapscript), 363 MS_KILOMETERS (in module mapscript), 370 MS_LABEL_ALLOCSIZE (in module mapscript), 361




MS_LABEL_BINDING_ALIGN (in module mapscript), 365 MS_LABEL_BINDING_ANGLE (in module mapscript), 365 MS_LABEL_BINDING_COLOR (in module mapscript), 365 MS_LABEL_BINDING_FONT (in module mapscript), 365 MS_LABEL_BINDING_LENGTH (in module mapscript), 365 MS_LABEL_BINDING_OFFSET_X (in module mapscript),
365
MS_LABEL_BINDING_OFFSET_Y (in module mapscript), 365
MS_LABEL_BINDING_OUTLINECOLOR (in module map- script), 365
MS_LABEL_BINDING_POSITION (in module mapscript), 365
MS_LABEL_BINDING_PRIORITY (in module mapscript), 365
MS_LABEL_BINDING_SHADOWSIZEX (in module map- script), 365
MS_LABEL_BINDING_SHADOWSIZEY (in module map- script), 365
MS_LABEL_BINDING_SIZE (in module mapscript), 365 MS_LABEL_FORCE_GROUP (in module mapscript), 361 MS_LABEL_PERPENDICULAR_OFFSET (in module map-
script), 365
MS_LABEL_PERPENDICULAR_TOP_OFFSET (in module
mapscript), 365
MS_LARGE (in module mapscript), 365 MS_LAYER_ALLOCSIZE (in module mapscript), 366 MS_LAYER_ANNOTATION (in module mapscript), 365 MS_LAYER_CHART (in module mapscript), 366 MS_LAYER_CIRCLE (in module mapscript), 366 MS_LAYER_LINE (in module mapscript), 365 MS_LAYER_POINT (in module mapscript), 365 MS_LAYER_POLYGON (in module mapscript), 365 MS_LAYER_QUERY (in module mapscript), 366 MS_LAYER_RASTER (in module mapscript), 365 MS_LAYER_TILEINDEX (in module mapscript), 366 MS_LC (in module mapscript), 367 MS_LEGEND_KEYSIZE_MAX (in module mapscript), 366 MS_LEGEND_KEYSIZE_MIN (in module mapscript), 366 MS_LEGEND_KEYSPACING_MAX (in module mapscript),
366
MS_LEGEND_KEYSPACING_MIN (in module mapscript), 366
MS_LL (in module mapscript), 367 MS_LR (in module mapscript), 367 MS_MAP_BAD_PATTERN
Environment variables, 989
MS_MAP_NO_PATH
Environment variables, 988
MS_MAP_PATTERN
    Environment variables, 990 MS_MAPCONTEXTERR (in module mapscript), 363 MS_MAPFILE
Apache, 778


Environment variables, 989
MS_MAPFILE_PATTERN
    Environment variables, 989 MS_MAX_LABEL_FONTS (in module mapscript), 361 MS_MAX_LABEL_PRIORITY (in module mapscript), 361 MS_MAXPATTERNLENGTH (in module mapscript), 361 MS_MAXVECTORPOINTS (in module mapscript), 366 MS_MEDIUM (in module mapscript), 365
MS_MEMERR (in module mapscript), 363 MS_METERS (in module mapscript), 370 MS_MILES (in module mapscript), 370 MS_MISCERR (in module mapscript), 363 MS_MODE
    Environment variables, 991 MS_MULTIPLE (in module mapscript), 367 MS_MYSQL (in module mapscript), 363 MS_NAUTICALMILES (in module mapscript), 370 MS_NO (in module mapscript), 366
MS_NOERR (in module mapscript), 363 MS_NONE (in module mapscript), 367 MS_NONSQUARE
MAP CONFIG, 247
MS_NORMAL (in module mapscript), 367 MS_NOTFOUND (in module mapscript), 363 MS_NULLPARENTERR (in module mapscript), 363 MS_NUM_CHECK_GT (in module mapscript), 367 MS_NUM_CHECK_GTE (in module mapscript), 367 MS_NUM_CHECK_NONE (in module mapscript), 367 MS_NUM_CHECK_RANGE (in module mapscript), 367 MS_NUMERRORCODES (in module mapscript), 364 MS_OFF (in module mapscript), 366 MS_OGCAPIERR (in module mapscript), 364 MS_OGLERR (in module mapscript), 364
MS_OGR (in module mapscript), 362 MS_OGRERR (in module mapscript), 363 MS_ON (in module mapscript), 366 MS_OPENLAYERS_JS_URL
    Environment variables, 991 MS_ORACLESPATIAL (in module mapscript), 362 MS_ORACLESPATIALERR (in module mapscript), 363 MS_OWSERR (in module mapscript), 364 MS_PARSE_TYPE_BOOLEAN (in module mapscript), 367 MS_PARSE_TYPE_SHAPE (in module mapscript), 367 MS_PARSE_TYPE_SLD (in module mapscript), 367 MS_PARSE_TYPE_STRING (in module mapscript), 367 MS_PARSEERR (in module mapscript), 363 MS_PERCENTAGES (in module mapscript), 370 MS_PIXELS (in module mapscript), 370
MS_PLUGIN (in module mapscript), 363 MS_POSITIONS_LENGTH (in module mapscript), 361 MS_POST_REQUEST (in module mapscript), 368 MS_POSTGIS (in module mapscript), 362 MS_PROJERR (in module mapscript), 363
MS_QUERY_BY_ATTRIBUTE (in module mapscript), 367




MS_QUERY_BY_FILTER (in module mapscript), 367 MS_QUERY_BY_INDEX (in module mapscript), 367 MS_QUERY_BY_POINT (in module mapscript), 367 MS_QUERY_BY_RECT (in module mapscript), 367 MS_QUERY_BY_SHAPE (in module mapscript), 367 MS_QUERY_IS_NULL (in module mapscript), 367 MS_QUERY_MULTIPLE (in module mapscript), 367 MS_QUERY_SINGLE (in module mapscript), 367 MS_QUERYERR (in module mapscript), 363 MS_RASTER (in module mapscript), 363 MS_RECTERR (in module mapscript), 363 MS_REGEXERR (in module mapscript), 363 MS_RENDER_WITH_AGG (in module mapscript), 368
MS_RENDER_WITH_CAIRO_PDF (in module mapscript),
368
MS_RENDER_WITH_CAIRO_RASTER (in module map- script), 368
MS_RENDER_WITH_CAIRO_SVG (in module mapscript), 368
MS_RENDER_WITH_IMAGEMAP (in module mapscript), 367 MS_RENDER_WITH_KML (in module mapscript), 368 MS_RENDER_WITH_MVT (in module mapscript), 368 MS_RENDER_WITH_OGL (in module mapscript), 368 MS_RENDER_WITH_OGR (in module mapscript), 367 MS_RENDER_WITH_PLUGIN (in module mapscript), 368 MS_RENDER_WITH_RAWDATA (in module mapscript), 367 MS_RENDER_WITH_SWF (in module mapscript), 367 MS_RENDER_WITH_TEMPLATE (in module mapscript), 367 MS_RENDER_WITH_UTFGRID (in module mapscript), 368 MS_RENDERERERR (in module mapscript), 364 MS_RESOLUTION_MAX (in module mapscript), 367 MS_RESOLUTION_MIN (in module mapscript), 367 MS_SCALEBAR_HEIGHT_MAX (in module mapscript), 368 MS_SCALEBAR_HEIGHT_MIN (in module mapscript), 368 MS_SCALEBAR_INTERVALS_MAX (in module mapscript),
368
MS_SCALEBAR_INTERVALS_MIN (in module mapscript), 368
MS_SCALEBAR_OFFSET_MAX (in module mapscript), 368 MS_SCALEBAR_OFFSET_MIN (in module mapscript), 368 MS_SCALEBAR_WIDTH_MAX (in module mapscript), 368 MS_SCALEBAR_WIDTH_MIN (in module mapscript), 368 MS_SELECTED (in module mapscript), 367 MS_SHAPE_LINE (in module mapscript), 369 MS_SHAPE_NULL (in module mapscript), 369 MS_SHAPE_POINT (in module mapscript), 369 MS_SHAPE_POLYGON (in module mapscript), 369 MS_SHAPEFILE (in module mapscript), 368 MS_SHAPEFILE_ARC (in module mapscript), 368 MS_SHAPEFILE_MULTIPOINT (in module mapscript), 368 MS_SHAPEFILE_POINT (in module mapscript), 368 MS_SHAPEFILE_POLYGON (in module mapscript), 368 MS_SHP_ARCM (in module mapscript), 366
MS_SHP_ARCZ (in module mapscript), 366


MS_SHP_MULTIPOINTM (in module mapscript), 366 MS_SHP_MULTIPOINTZ (in module mapscript), 366 MS_SHP_POINTM (in module mapscript), 366 MS_SHP_POINTZ (in module mapscript), 366 MS_SHP_POLYGONM (in module mapscript), 366 MS_SHP_POLYGONZ (in module mapscript), 366 MS_SHPERR (in module mapscript), 366 MS_SINGLE (in module mapscript), 367
MS_SMALL (in module mapscript), 365
MS_SOSERR (in module mapscript), 363 MS_STYLE_ALLOCSIZE (in module mapscript), 361 MS_STYLE_BINDING_ANGLE (in module mapscript), 369 MS_STYLE_BINDING_COLOR (in module mapscript), 369 MS_STYLE_BINDING_LENGTH (in module mapscript), 369 MS_STYLE_BINDING_OFFSET_X (in module mapscript),
369
MS_STYLE_BINDING_OFFSET_Y (in module mapscript), 369
MS_STYLE_BINDING_OPACITY (in module mapscript), 369
MS_STYLE_BINDING_OUTLINECOLOR (in module map- script), 369
MS_STYLE_BINDING_OUTLINEWIDTH (in module map- script), 369
MS_STYLE_BINDING_POLAROFFSET_ANGLE (in  module
mapscript), 369
MS_STYLE_BINDING_POLAROFFSET_PIXEL (in module
mapscript), 369
MS_STYLE_BINDING_SIZE (in module mapscript), 369 MS_STYLE_BINDING_SYMBOL (in module mapscript), 369 MS_STYLE_BINDING_WIDTH (in module mapscript), 369 MS_STYLE_DOUBLE_SIDED_OFFSET (in module map-
script), 369
MS_STYLE_SINGLE_SIDED_OFFSET (in module map- script), 369
MS_SUCCESS (in module mapscript), 368 MS_SYMBOL_ALLOCSIZE (in module mapscript), 369 MS_SYMBOL_ELLIPSE (in module mapscript), 369 MS_SYMBOL_HATCH (in module mapscript), 369 MS_SYMBOL_PIXMAP (in module mapscript), 369 MS_SYMBOL_SIMPLE (in module mapscript), 369 MS_SYMBOL_SVG (in module mapscript), 369 MS_SYMBOL_TRUETYPE (in module mapscript), 369 MS_SYMBOL_VECTOR (in module mapscript), 369 MS_SYMERR (in module mapscript), 363 MS_TEMPPATH
Environment variable, 308
    Environment variables, 991 MS_TILED_SHAPEFILE (in module mapscript), 362 MS_TIMEERR (in module mapscript), 363
MS_TINY (in module mapscript), 365
MS_TOKEN_BINDING_DATA_CELLSIZE (in module map- script), 369
MS_TOKEN_BINDING_DOUBLE (in module mapscript), 369




MS_TOKEN_BINDING_INTEGER (in module mapscript), 369
MS_TOKEN_BINDING_MAP_CELLSIZE (in module map- script), 369
MS_TOKEN_BINDING_SHAPE (in module mapscript), 369 MS_TOKEN_BINDING_STRING (in module mapscript), 369 MS_TOKEN_BINDING_TIME (in module mapscript), 369 MS_TOKEN_COMPARISON_BEYOND (in module mapscript),
362
MS_TOKEN_COMPARISON_CONTAINS (in module map- script), 362
MS_TOKEN_COMPARISON_CROSSES (in module map- script), 362
MS_TOKEN_COMPARISON_DISJOINT (in module map- script), 361
MS_TOKEN_COMPARISON_DWITHIN (in module map- script), 362
MS_TOKEN_COMPARISON_EQ (in module mapscript), 361
MS_TOKEN_COMPARISON_EQUALS (in module mapscript), 362
MS_TOKEN_COMPARISON_GE (in module mapscript), 361 MS_TOKEN_COMPARISON_GT (in module mapscript), 361 MS_TOKEN_COMPARISON_IEQ (in module mapscript), 361 MS_TOKEN_COMPARISON_IN (in module mapscript), 361 MS_TOKEN_COMPARISON_INTERSECTS (in module map-
script), 361
MS_TOKEN_COMPARISON_IRE (in module mapscript), 361 MS_TOKEN_COMPARISON_LE (in module mapscript), 361 MS_TOKEN_COMPARISON_LIKE (in module mapscript),
361
MS_TOKEN_COMPARISON_LT (in module mapscript), 361 MS_TOKEN_COMPARISON_NE (in module mapscript), 361 MS_TOKEN_COMPARISON_OVERLAPS (in module map-
script), 361
MS_TOKEN_COMPARISON_RE (in module mapscript), 361
MS_TOKEN_COMPARISON_TOUCHES (in module map- script), 361
MS_TOKEN_COMPARISON_WITHIN (in module mapscript), 362
MS_TOKEN_FUNCTION_AREA (in module mapscript), 364
MS_TOKEN_FUNCTION_BUFFER (in module mapscript), 364
MS_TOKEN_FUNCTION_CENTERLINE (in module map- script), 364
MS_TOKEN_FUNCTION_COMMIFY (in module mapscript), 364
MS_TOKEN_FUNCTION_DENSIFY (in module mapscript), 364
MS_TOKEN_FUNCTION_DIFFERENCE (in module map- script), 364
MS_TOKEN_FUNCTION_FIRSTCAP (in module mapscript), 364
MS_TOKEN_FUNCTION_FROMTEXT (in module mapscript), 364


MS_TOKEN_FUNCTION_GENERALIZE (in module map- script), 364
MS_TOKEN_FUNCTION_INITCAP (in module mapscript), 364
MS_TOKEN_FUNCTION_INNER (in module mapscript), 364
MS_TOKEN_FUNCTION_JAVASCRIPT (in module map- script), 364
MS_TOKEN_FUNCTION_LENGTH (in module mapscript), 364
MS_TOKEN_FUNCTION_LOWER (in module mapscript), 364 MS_TOKEN_FUNCTION_OUTER (in module mapscript), 364 MS_TOKEN_FUNCTION_ROUND (in module mapscript), 364 MS_TOKEN_FUNCTION_SIMPLIFY (in module mapscript),
364
MS_TOKEN_FUNCTION_SIMPLIFYPT (in module map- script), 364
MS_TOKEN_FUNCTION_SMOOTHSIA (in module map- script), 364
MS_TOKEN_FUNCTION_TOSTRING (in module mapscript), 364
MS_TOKEN_FUNCTION_UPPER (in module mapscript), 364
MS_TOKEN_LITERAL_BOOLEAN (in module mapscript), 370
MS_TOKEN_LITERAL_NUMBER (in module mapscript), 370 MS_TOKEN_LITERAL_SHAPE (in module mapscript), 370 MS_TOKEN_LITERAL_STRING (in module mapscript), 370 MS_TOKEN_LITERAL_TIME (in module mapscript), 370 MS_TOKEN_LOGICAL_AND (in module mapscript), 370 MS_TOKEN_LOGICAL_NOT (in module mapscript), 370 MS_TOKEN_LOGICAL_OR (in module mapscript), 370 MS_TRANSFORM_FULLRESOLUTION (in module map-
script), 370
MS_TRANSFORM_NONE (in module mapscript), 370 MS_TRANSFORM_ROUND (in module mapscript), 370 MS_TRANSFORM_SIMPLIFY (in module mapscript), 370 MS_TRANSFORM_SNAPTOGRID (in module mapscript), 370 MS_TRUE (in module mapscript), 366
MS_TRUETYPE (in module mapscript), 364 MS_TTFERR (in module mapscript), 363 MS_TYPEERR (in module mapscript), 363 MS_UC (in module mapscript), 367
MS_UL (in module mapscript), 367 MS_UNION (in module mapscript), 363 MS_UNKNOWN (in module mapscript), 366 MS_UNUSED_1 (in module mapscript), 362 MS_UNUSED_2 (in module mapscript), 362 MS_UNUSEDERR (in module mapscript), 363 MS_UR (in module mapscript), 367 MS_UVRASTER (in module mapscript), 363 MS_V8ERR (in module mapscript), 364
MS_VERSION_MAJOR (in module mapscript), 370 MS_VERSION_MINOR (in module mapscript), 370 MS_VERSION_NUM (in module mapscript), 370 MS_VERSION_REV (in module mapscript), 370




MS_WCSERR (in module mapscript), 363 MS_WEBERR (in module mapscript), 363 MS_WFS (in module mapscript), 362 MS_WFSCONNERR (in module mapscript), 363 MS_WFSERR (in module mapscript), 363 MS_WMS (in module mapscript), 362 MS_WMSCONNERR (in module mapscript), 363 MS_WMSERR (in module mapscript), 363 MS_XMLMAPFILE_XSLT, 309
    Environment variables, 991 MS_XY (in module mapscript), 367 MS_YES (in module mapscript), 366 msencrypt
Utility,  1040
msGetLabelSize():	Requested font not found Error, 1076
msLoadFontset():	Error opening fontset Error, 1077
msLoadMap():	Failed to open map file Error, 1077
msProcessProjection():	no options found in
   'init' file Error, 1077
msProcessProjection():	No such file or directory
Error, 1077
msProcessProjection(): Projection library error.major axis or radius = 0 not given
Error, 1079
msQueryByPoint:	search returned no results Error, 1079
msReturnPage():	Web application error.
    Malformed template name Error, 1080
msSaveImageGD():	Unable to access file Error, 1080
MSSQL_READ_WKB
LAYER PROCESSING, 231, 598
msWMSLoadGetMapParams():	WMS server error Error, 1081
mysql
JOIN CONNECTIONTYPE, 200
N
NAME
CLASS, 137
JOIN, 200
LAYER, 227
MAP, 250
OUTPUTFORMAT, 256
SYMBOL, 279
NATIVE_FILTER
LAYER PROCESSING, 231


nauticalmiles
LAYER SIZEUNITS, 234
LAYER UNITS, 239
MAP UNITS, 251
SCALEBAR UNITS, 265
ne
Expressions, 161, 166
next() (mapscript.errorObj method), 319 nextKey() (mapscript.hashTableObj method), 320 nextShape() (mapscript.layerObj method), 331 not
Expressions, 161
nquery
CGI mode, 1058
NULLVALUE
OUTPUTFORMAT FORMATOPTION, 256
O
OFFSET
LABEL, 211
SCALEBAR, 264
STYLE, 102, 270
offsetExtent() (mapscript.mapObj method), 339
OFFSITE
LAYER, 227
OGC, 1070
OGC conformance tests
WFS Filter encoding, 877
OGC Support, 764
OGCAPI, 798
Collections, 805
METADATA, 802
METADATA ows_extra_params, 809
METADATA ows_schemas_location, 810
OGR, 604, 1070
Connection Pooling, 613
Formats, 606
Installation,  607
Style parameters, 616
STYLEITEM "AUTO", 614
TILEINDEX, 613
Virtual File Support, 674
ogr
LAYER CONNECTIONTYPE, 217
OGRINFO, 610
ogrtindex, 1012
OM, 1071
ON_MISSING_DATA
Debugging, 980
MAP CONFIG, 247
OPACITY
COMPOSITE, 146
LAYER, 228
STYLE, 271




OPAQUE_FORMAT
OUTPUTFORMAT FORMATOPTION, 255
open() (mapscript.layerObj method), 331
OpenLayers, 1071
Optimization, 972
Databases, 1030
Fonts, 1006
Image formats, 1011
Layers, 1004
PostGIS, 1028
Projections, 1000
Raster, 1007
Raster Tiling, 1011
Shapefiles, 1028
Symbols, 1005
Tile indexes, 1011
TILEINDEX, 1013
Vector, 1023
or
Expressions, 161
Oracle, 621
Installation, 73
oraclespatial
LAYER CONNECTIONTYPE, 217
outer
LAYER GEOMTRANSFORM, 187, 223
OUTLINECOLOR
CLASS, 137
LABEL, 211
LEGEND, 245
REFERENCE, 262
SCALEBAR, 264
STYLE, 271
OUTLINEWIDTH
LABEL, 212
STYLE, 271
Output formats
WCS Server, 895
OUTPUTFORMAT, 251
DRIVER, 253
EXTENSION, 253
FORMATOPTION, 253
FORMATOPTION BLOCKXSIZE, 255
FORMATOPTION BLOCKYSIZE, 255
FORMATOPTION COMPRESS, 255
FORMATOPTION COMPRESSION, 254
FORMATOPTION DUPLICATES, 256
FORMATOPTION GAMMA, 254
FORMATOPTION GEO_ENCODING, 255
FORMATOPTION INTERLACE, 255
FORMATOPTION INTERLEAVE, 255
FORMATOPTION LABELS, 256
FORMATOPTION METADATA_ITEM, 255
FORMATOPTION NULLVALUE, 256


FORMATOPTION OPAQUE_FORMAT, 255
FORMATOPTION PALETTE, 254
FORMATOPTION PALETTE_FORCE, 254
FORMATOPTION QUALITY, 254
FORMATOPTION QUANTIZE_COLORS, 254
FORMATOPTION QUANTIZE_FORCE, 254
FORMATOPTION TILED, 255
FORMATOPTION TRANSPARENT_FORMAT, 255
FORMATOPTION UTFRESOLUTION, 256
IMAGEMODE, 256
IMAGEMODE BYTE, 256
IMAGEMODE FEATURE, 256
IMAGEMODE FLOAT32, 256
IMAGEMODE INT16, 256
IMAGEMODE RGB, 256
IMAGEMODE RGBA, 256
MAP, 250
MIMETYPE, 256
NAME, 256
Template-driven output, 746
TRANSPARENT, 256
UTFGRID, 256
WFS Server, 850
outputformatObj MapScript PHP, 399
outputFormatObj (class in mapscript), 342
overlaps
Expressions, 163
overlaps() (mapscript.shapeObj method), 353
OVERSAMPLE_RATIO
LAYER PROCESSING, 667
ows_allowed_ip_list
SOS METADATA, 929, 931
WCS METADATA, 907, 910
WFS METADATA, 853, 859
WMS METADATA, 782, 788
ows_compliance_mode WMS METADATA, 782
ows_denied_ip_list
SOS METADATA, 929, 931
WCS METADATA, 908, 910
WFS METADATA, 853, 859
WMS METADATA, 782, 788
ows_extra_params OGCAPI METADATA, 809
ows_http_max_age WMS METADATA, 782
ows_language
SOS METADATA, 929
ows_schemas_location OGCAPI METADATA, 810
SOS METADATA, 929
WFS METADATA, 853
WMS METADATA, 782




ows_sld_enabled
WMS METADATA, 782
ows_updatesequence SOS METADATA, 929
WFS METADATA, 854
WMS METADATA, 782
OWSDispatch() (mapscript.mapObj method), 336 OWSRequest (class in mapscript), 314 OwsrequestObj
MapScript PHP, 400
P
PALETTE
OUTPUTFORMAT FORMATOPTION, 254
PALETTE_FORCE
OUTPUTFORMAT FORMATOPTION, 254
PARTIALS
LABEL, 212
pasteImage() (mapscript.imageObj method), 321
PATTERN, 94
STYLE, 271
pattern_get() (mapscript.styleObj method), 356 pattern_set() (mapscript.styleObj method), 357 PDF
Geospatial, 254
pdf
MAP IMAGETYPE, 249
percentages
LAYER UNITS, 239
Performance tips Raster, 671
PHP
Build, MapScript, 50
Classes, MapScript, 376
classObj, MapScript, 377
clusterObj, MapScript, 379
colorObj, MapScript, 379
Constants, MapScript, 374
Download, MapScript, 50
errorObj, MapScript, 380
Functions, MapScript, 376
gridObj, MapScript, 380
hashTableObj, MapScript, 381
imageObj, MapScript, 381
Installation, MapScript, 51
labelcacheMemberObj, MapScript, 382
labelcacheObj, MapScript, 383
labelObj, MapScript, 383
layerObj, MapScript, 385
legendObj, MapScript, 390
lineObj, MapScript, 391
mapObj, MapScript, 392
MapScript, 49, 370
outputformatObj, MapScript, 399


OwsrequestObj, MapScript, 400
pointObj, MapScript, 401
projectionObj, MapScript, 402
querymapObj, MapScript, 403
rectObj, MapScript, 403
referenceMapObj, MapScript, 404
resultObj, MapScript, 405
scalebarObj, MapScript, 406
Setup, MapScript, 50
shapefileObj, MapScript, 406
shapeObj, MapScript, 407
styleObj, MapScript, 410
Support, 49
symbolObj, MapScript, 412
webObj, MapScript, 413
PHP Mapscript Debugging, 983
Pie chart, 689
pixel, 660
pixels
LAYER SIZEUNITS, 234
LAYER UNITS, 239
pixelToGeoref() (mapscript.mapObj method), 339
pixmap
SYMBOL TYPE, 280
Pixmap polygon fill, 106 Pixmap symbols, 88 PLUGIN
LAYER, 228
plugin
LAYER CONNECTIONTYPE, 217
PLUGINS
CONFIG, 148
png
MAP IMAGETYPE, 249
point
LAYER TYPE, 238
Point symbols, 86
pointObj
MapScript PHP, 401
    MapScript Python, 429 pointObj (class in mapscript), 343 POINTS
FEATURE, 167
SYMBOL, 279
POLAROFFSET
STYLE, 272
polygon
LAYER TYPE, 238
Polygon outlines, 121
POLYLINE_NO_CLIP
LAYER PROCESSING, 230
POSITION
LABEL, 212




LEGEND, 245
SCALEBAR, 264
PostGIS
Optimization, 1028
postgis
LAYER CONNECTIONTYPE, 217
postgresql
JOIN CONNECTIONTYPE, 200
POSTLABELCACHE LAYER, 228
LEGEND, 245
SCALEBAR, 264
prepareImage() (mapscript.mapObj method), 339 prepareQuery() (mapscript.mapObj method), 339 Preprocessing
Raster, 671
PRIORITY
LABEL, 212
PROCESSING, 228
ArcSDE options, LAYER, 228
BANDS, LAYER, 665
CHART_BAR_MAXVAL LAYER, 691
CHART_BAR_MINVAL LAYER, 691
CHART_SIZE LAYER, 687
CHART_SIZE_RANGE LAYER, 687
CHART_TYPE LAYER, 688
CLASSIFY_SCALED, LAYER, 665
CLOSE_CONNECTION, LAYER, 229, 598
cluster options, LAYER, 228
CLUSTER_GET_ALL_SHAPES, LAYER, 139, 228
CLUSTER_KEEP_LOCATIONS, LAYER, 139, 228
CLUSTER_USE_MAP_UNITS, LAYER, 139, 228
COLOR_MATCH_THRESHOLD, LAYER, 665
contour options, LAYER, 229
CONTOUR_INTERVAL, LAYER, 229
CONTOUR_ITEM, LAYER, 229
CONTOUR_LEVELS, LAYER, 229
DITHER, LAYER, 665
EXTENT_PRIORITY, LAYER, 665
FORCE2D, LAYER, 231
GAMMA, LAYER, 231, 665
GETSHAPE_STYLE_ITEMS, LAYER, 231
IDW_COMPUTE_BORDERS, LAYER, 230
IDW_POWER, LAYER, 230
IDW_RADIUS, LAYER, 230
ITEMS, LAYER, 139, 228
KERNELDENSITY_COMPUTE_BORDERS, LAYER, 229
KERNELDENSITY_NORMALIZATION, LAYER, 229
KERNELDENSITY_RADIUS, LAYER, 229
LABEL_NO_CLIP, LAYER, 230
LAYER, 228
LOAD_FULL_RES_IMAGE, LAYER, 666
LOAD_WHOLE_IMAGE, LAYER, 666
LUT[_n], LAYER, 666


MSSQL_READ_WKB, LAYER, 231, 598
NATIVE_FILTER, LAYER, 231
OVERSAMPLE_RATIO, LAYER, 667
POLYLINE_NO_CLIP, LAYER, 230
RANGE_COLORSPACE, LAYER, 230
raster options, LAYER, 231
RENDERMODE, LAYER, 230
RESAMPLE, LAYER, 667
SCALE, LAYER, 667
union options, LAYER, 231 UNION_SCALE_CHECK, LAYER, 231 UNION_SRCLAYER_CLOSE_CONNECTION,	LAYER,
231
UNION_STATUS_CHECK, LAYER, 231
UV_SIZE_SCALE, LAYER, 231
UV_SPACING, LAYER, 231
WORLDFILE, LAYER, 667
Processing directives Raster, 664
processLegendTemplate()	(mapscript.mapObj
method), 339
processQueryTemplate()	(mapscript.mapObj method), 339
processTemplate() (mapscript.mapObj method), 339
PROJ, 1071
PROJ_DATA
Environment variables, 992
MAP CONFIG, 247, 259
PROJ_DEBUG
Debugging, 977
MAP CONFIG, 248
project() (mapscript.lineObj method), 334 project() (mapscript.pointObj method), 344 project() (mapscript.rectObj method), 346 project() (mapscript.shapeObj method), 353 PROJECTION, 256
LAYER, 232
MAP, 250
Projection, 1071
projectionObj MapScript PHP, 402
projectionObj (class in mapscript), 345
Projections
Optimization, 1000
Python
Classes, MapScript, 428
Exception handling, MapScript, 430
imageObj, MapScript, 428
MapScript, 428
pointObj, MapScript, 429
rectObj, MapScript, 429
Q
qformat



CGI, 1058
qitem
CGI, 1058
qlayer
CGI, 1058
qstring
CGI, 1058
QUALITY
OUTPUTFORMAT FORMATOPTION, 254
QUANTIZE_COLORS
OUTPUTFORMAT FORMATOPTION, 254
QUANTIZE_FORCE
OUTPUTFORMAT FORMATOPTION, 254
Query
Raster, 667
query
CGI mode, 1058
LAYER TYPE, 238
queryByAttributes() (mapscript.layerObj method), 331
queryByFeatures() (mapscript.layerObj method), 331 queryByFeatures() (mapscript.mapObj method), 339 queryByFilter() (mapscript.layerObj method), 331 queryByFilter() (mapscript.mapObj method), 339 queryByIndex() (mapscript.layerObj method), 332 queryByPoint() (mapscript.layerObj method), 332 queryByPoint() (mapscript.mapObj method), 339 queryByRect() (mapscript.layerObj method), 332 queryByRect() (mapscript.mapObj method), 340 queryByShape() (mapscript.layerObj method), 332 queryByShape() (mapscript.mapObj method), 340 queryfile
CGI, 1059
QUERYFORMAT
WEB, 308
Querying
MapScript, 435
QUERYMAP, 260
COLOR, 261
MAP, 250
SIZE, 261
STATUS, 261
STYLE, 261
querymapObj
    MapScript PHP, 403 queryMapObj (class in mapscript), 345 Quotes escaping, 156
R
radius
WMS Vendor specific parameters, 794
RANGE_COLORSPACE
LAYER PROCESSING, 230
RANGEITEM

STYLE, 273
Raster, 1071
24bit, 664
8bit, 671
External overviews, 672
Georeferencing, 673
Internal overviews, 672
Optimization, 1007
Performance tips, 671
Preprocessing, 671
Processing  directives, 664
Query, 667
Tile indexing, 663
Tiled datasets, 671
Tiling, Optimization, 1011
Warping, 664
World files, 673
raster
LAYER TYPE, 238
Raster  classification, 660
Raster data, 659
Raster formats, 662
Raster options, 228
raster options
LAYER PROCESSING, 231
Raster query
blue, 670
class, 669
green, 670
red, 670
value_list,  669
value_n, 669
x, 669
y, 669
rasterlabel
LAYER CONNECTIONTYPE, 217
rectObj
MapScript PHP, 403
    MapScript Python, 429 rectObj (class in mapscript), 346 red, 660
Raster query, 670
ref
CGI, 1059
REFERENCE, 261
COLOR, 261
EXTENT, 262
IMAGE, 262
MAP, 250
MARKER, 262
MARKERSIZE, 262
MAXBOXSIZE, 262
MINBOXSIZE, 262
OUTLINECOLOR, 262




SIZE, 262
STATUS, 262
reference
CGI mode, 1058
referenceMapObj MapScript PHP, 404
referenceMapObj (class in mapscript), 347
refxy
CGI, 1059
REGION
CLUSTER, 138
Regular expression comparison Expressions, 158
Regular expressions, 158, 310
remove() (mapscript.hashTableObj method), 320 removeBinding() (mapscript.labelObj method), 325 removeBinding() (mapscript.styleObj method), 357 removeClass() (mapscript.layerObj method), 332 removeExpressionBinding()	(mapscript.labelObj
method), 325
removeLabel() (mapscript.classObj method), 317 removeLayer() (mapscript.mapObj method), 340 removeOutputFormat() (mapscript.mapObj method),
340
removeStyle() (mapscript.classObj method), 317 removeStyle() (mapscript.labelObj method), 325 removeSymbol() (mapscript.symbolSetObj method),
359
RENDERMODE
LAYER PROCESSING, 230
REPEATDISTANCE LABEL, 212
reprojectionObj (class in mapscript), 348
REQUIRES
LAYER, 232
RESAMPLE
LAYER PROCESSING, 667
RESOLUTION
MAP, 250
resultCacheObj (class in mapscript), 348
resultObj
    MapScript PHP, 405 resultObj (class in mapscript), 349 ReWriteRule
Apache, 778
RGB
OUTPUTFORMAT IMAGEMODE, 256
RGBA
OUTPUTFORMAT IMAGEMODE, 256
round
Expressions, 164
STYLE LINECAP, 269
STYLE LINEJOIN, 270
ROUTINELENGTH (in module mapscript), 361


Run-time substitution, 1061
Default value, 1063
FILTER, 1063
Supported parameters, 1062
VALIDATION, 1064
S
save() (mapscript.imageObj method), 321 save() (mapscript.mapObj method), 340 save() (mapscript.symbolSetObj method), 359
saveMapContext() (mapscript.mapObj method), 340
savequery
CGI, 1059
saveQuery() (mapscript.mapObj method), 340 saveQueryAsGML() (mapscript.mapObj method), 340 saveWebImage() (mapscript.imageObj method), 321 Saving
MapScript Mapfile, 433
SCALE
LAYER PROCESSING, 667
SCALEBAR, 262
ALIGN, 263
BACKGROUNDCOLOR, 263
COLOR, 263
IMAGECOLOR, 263
INTERVALS, 264
LABEL, 264
MAP, 250
OFFSET, 264
OUTLINECOLOR, 264
POSITION, 264
POSTLABELCACHE, 264
SIZE, 264
STATUS, 264
STYLE, 265
TRANSPARENT, 265
UNITS, 265
UNITS feet, 265
UNITS inches, 265
UNITS kilometers, 265
UNITS meters, 265
UNITS miles, 265
UNITS nauticalmiles, 265
scalebar
CGI mode, 1058
Utility,  1042
scalebarObj
    MapScript PHP, 406 scalebarObj (class in mapscript), 350 SCALEDENOM
MAP, 250
scaledenom
CGI, 1059
scaleExtent() (mapscript.mapObj method), 340




SCALETOKEN
LAYER, 233
scaleTokenEntryObj (class in mapscript), 349 scaleTokenObj (class in mapscript), 349 Scaling of symbols, 86
sde
LAYER CONNECTIONTYPE, 217
searchmap
CGI, 1059
selectOutputFormat() (mapscript.mapObj method), 340
set() (mapscript.hashTableObj method), 320 set() (mapscript.lineObj method), 335 set_height() (mapscript.mapObj method), 341 set_width() (mapscript.mapObj method), 341 setBinding() (mapscript.labelObj method), 325 setBinding() (mapscript.styleObj method), 357 setBounds() (mapscript.shapeObj method), 353 setCenter() (mapscript.mapObj method), 340
setConfigOption() (mapscript.mapObj method), 340
setConnectionType() (mapscript.layerObj method), 332
SetEnvIf
Apache, 778
setExpression() (mapscript.classObj method), 317 setExpression() (mapscript.labelObj method), 325 setExpressionBinding()	(mapscript.labelObj
method), 325
setExtension() (mapscript.outputFormatObj method), 343
setExtent() (mapscript.layerObj method), 332 setExtent() (mapscript.mapObj method), 340 setFilter() (mapscript.clusterObj method), 318 setFilter() (mapscript.layerObj method), 332 setFontSet() (mapscript.mapObj method), 340 setGeomTransform() (mapscript.layerObj method),
332
setGeomTransform() (mapscript.styleObj method), 357 setGroup() (mapscript.clusterObj method), 318 setHex() (mapscript.colorObj method), 318 setImage() (mapscript.symbolObj method), 358 setImagepath() (mapscript.symbolObj method), 358 setImageType() (mapscript.mapObj method), 340 setItems() (mapscript.layerObj method), 332 setLayerOrder() (mapscript.mapObj method), 341 setLayersDrawingOrder()	(mapscript.mapObj
method), 341
setMimetype() (mapscript.outputFormatObj method), 343
setOpacity() (mapscript.layerObj method), 332 setOption() (mapscript.outputFormatObj method), 343 setOutputFormat() (mapscript.mapObj method), 341 setParameter() (mapscript.OWSRequest method), 314 setPoints() (mapscript.symbolObj method), 358


setProcessingKey() (mapscript.layerObj method), 332
setProjection() (mapscript.layerObj method), 332 setProjection() (mapscript.mapObj method), 341 setRGB() (mapscript.colorObj method), 318 setRotation() (mapscript.mapObj method), 341 setSize() (mapscript.mapObj method), 341 setSymbolByName() (mapscript.styleObj method), 357 setSymbolSet() (mapscript.mapObj method), 341 setText() (mapscript.classObj method), 317 setText() (mapscript.labelObj method), 326
Setup
MapScript PHP, 50
WMS Server, 770
setValue() (mapscript.shapeObj method), 353
setWKTProjection() (mapscript.layerObj method), 333
setWKTProjection() (mapscript.mapObj method), 341
setWKTProjection()	(mapscript.projectionObj method), 345
setXY() (mapscript.pointObj method), 344 setXYZ() (mapscript.pointObj method), 344 setXYZM() (mapscript.pointObj method), 344 SHADOWCOLOR
LABEL, 212
SHADOWSIZE
LABEL, 213
Shapefile, 1071
shapefileObj
    MapScript PHP, 406 shapefileObj (class in mapscript), 354 Shapefiles
Optimization, 1028
shapeindex
CGI, 1059
shapeObj
    MapScript PHP, 407 shapeObj (class in mapscript), 351 SHAPEPATH
MAP, 250
Shift-JIS
ENCODING, 155
shptree
Utility,  1042
shptreetst
Utility,  1044
SHX_BUFFER_PAGE (in module mapscript), 361
simpifypt
STYLE GEOMTRANSFORM, 268
simple:	CGI controls, 1055 simple:	OpenLayers viewer, 1066 simplify
GEOMTRANSFORM, 182
LAYER GEOMTRANSFORM, 222




STYLE GEOMTRANSFORM, 268
simplify() (mapscript.shapeObj method), 353
simplifypt
GEOMTRANSFORM, 184
LAYER GEOMTRANSFORM, 223
SIZE
CLASS, 137
LABEL, 213
MAP, 251
QUERYMAP, 261
REFERENCE, 262
SCALEBAR, 264
STYLE, 273
SIZEUNITS
feet, LAYER, 234
inches, LAYER, 234
kilometers, LAYER, 234
LAYER, 234
meters, LAYER, 234
miles, LAYER, 234
nauticalmiles, LAYER, 234
pixels, LAYER, 234
slayer
CGI, 1059
SLD, 879, 1071
Element support, 882
smoothsia
all, GEOMTRANSFORM, 185
angle, GEOMTRANSFORM, 185
GEOMTRANSFORM, 185
LAYER GEOMTRANSFORM, 223
STYLE GEOMTRANSFORM, 268
sortshp
Utility,  1045
SOS, 1071
LAYER METADATA, 931
Metadata, 928
METADATA ows_allowed_ip_list, 929, 931
METADATA ows_denied_ip_list, 929, 931
METADATA ows_language, 929
METADATA ows_schemas_location, 929
METADATA ows_updatesequence, 929
METADATA sos_abstract, 929
METADATA sos_accessconstraints, 929
METADATA sos_address, 930
METADATA sos_addresstype, 930
METADATA sos_allowed_ip_list, 929
METADATA sos_city, 930
METADATA sos_contactelectronicmailaddress, 930
METADATA	sos_contactfacsimiletelephone, 930
METADATA sos_contactinstructions, 930
METADATA sos_contactorganization, 930


METADATA sos_contactperson, 930
METADATA sos_contactposition, 930
METADATA sos_contactvoicetelephone, 930
METADATA sos_country, 930
METADATA sos_denied_ip_list, 929
METADATA sos_describesensor_url, 931
METADATA sos_enable_request, 930, 931
METADATA sos_encoding_blockSeparator, 930
METADATA sos_encoding_tokenSeparator, 930
METADATA sos_fees, 930
METADATA sos_hoursofservice, 930
METADATA sos_keywordlist, 930
METADATA sos_maxfeatures, 930
METADATA sos_observedproperty_authority, 932
METADATA sos_observedproperty_id, 932
METADATA sos_observedproperty_name, 932
METADATA	sos_observedproperty_version, 932
METADATA sos_offering_description, 932
METADATA sos_offering_extent, 932
METADATA sos_offering_id, 932
METADATA sos_offering_intendedapplication, 933
METADATA sos_offering_name, 933
METADATA sos_offering_timeextent, 933
METADATA sos_onlineresource, 931
METADATA sos_postcode, 930
METADATA sos_procedure, 933
METADATA sos_procedure_item, 933
METADATA sos_role, 931
METADATA sos_service_onlineresource, 931
METADATA sos_srs, 931
METADATA sos_stateorprovince, 930
METADATA sos_timeitem, 933
METADATA sos_title, 931
METADATA sos_[item name]_alias, 932 METADATA sos_[item name]_definition, 932 METADATA sos_[item name]_uom, 932
WEB METADATA, 929
SOS Server, 922
Mapfile, 924
sos_abstract
SOS METADATA, 929
sos_accessconstraints SOS METADATA, 929
sos_address
SOS METADATA, 930
sos_addresstype
SOS METADATA, 930
sos_allowed_ip_list SOS METADATA, 929
sos_city
SOS METADATA, 930




sos_contactelectronicmailaddress SOS METADATA, 930
sos_contactfacsimiletelephone SOS METADATA, 930
sos_contactinstructions SOS METADATA, 930
sos_contactorganization SOS METADATA, 930
sos_contactperson SOS METADATA, 930
sos_contactposition SOS METADATA, 930
sos_contactvoicetelephone SOS METADATA, 930
sos_country
SOS METADATA, 930
sos_denied_ip_list SOS METADATA, 929
sos_describesensor_url SOS METADATA, 931
sos_enable_request
SOS METADATA, 930, 931
sos_encoding_blockSeparator SOS METADATA, 930
sos_encoding_tokenSeparator SOS METADATA, 930
sos_fees
SOS METADATA, 930
sos_hoursofservice SOS METADATA, 930
sos_keywordlist
SOS METADATA, 930
sos_maxfeatures
SOS METADATA, 930
sos_observedproperty_authority SOS METADATA, 932
sos_observedproperty_id SOS METADATA, 932
sos_observedproperty_name SOS METADATA, 932
sos_observedproperty_version SOS METADATA, 932
sos_offering_description SOS METADATA, 932
sos_offering_extent SOS METADATA, 932
sos_offering_id
SOS METADATA, 932
sos_offering_intendedapplication SOS METADATA, 933
sos_offering_name SOS METADATA, 933
sos_offering_timeextent SOS METADATA, 933

sos_onlineresource SOS METADATA, 931
sos_postcode
SOS METADATA, 930
sos_procedure
SOS METADATA, 933
sos_procedure_item SOS METADATA, 933
sos_role
SOS METADATA, 931
sos_service_onlineresource SOS METADATA, 931
sos_srs
SOS METADATA, 931
sos_stateorprovince SOS METADATA, 930
sos_timeitem
SOS METADATA, 933
sos_title
SOS METADATA, 931
sos_[item name]_alias SOS METADATA, 932
sos_[item name]_definition SOS METADATA, 932
sos_[item name]_uom SOS METADATA, 932
Spatial expressions Expressions, 163
Spatial functions Expressions, 165
SpatialLite,  643
Special options, 228
Spherical Mercator, 1071
square
STYLE LINECAP, 269
SRS
    WFS Server, 846 Stacked bar graph, 692 start
GEOMTRANSFORM, 172
STYLE GEOMTRANSFORM, 267
STARTINDEX
WFS Server, 850
STATUS
CLASS, 137
LAYER, 234
LEGEND, 245
MAP, 251
QUERYMAP, 261
REFERENCE, 262
SCALEBAR, 264
Stored queries
WFS Server, 850
String comparison



    Expressions, 157 String expressions Expressions, 161
String functions Expressions, 164
String operations Expressions, 163
String quotation, 156
STYLE, 265
ANGLE, 265
ANTIALIAS, 266
BACKGROUNDCOLOR, 266
CLASS, 137
COLOR, 266
COLORRANGE, 267
DATARANGE, 267
GAP, 267
GEOMTRANSFORM, 267
GEOMTRANSFORM bbox, 267
GEOMTRANSFORM buffer, 268
GEOMTRANSFORM centroid, 267
GEOMTRANSFORM end, 267
GEOMTRANSFORM expression, 267
GEOMTRANSFORM generalize, 268
GEOMTRANSFORM labelpnt, 267
GEOMTRANSFORM labelpoly, 267
GEOMTRANSFORM simpifypt, 268
GEOMTRANSFORM simplify, 268
GEOMTRANSFORM smoothsia, 268
GEOMTRANSFORM start, 267
GEOMTRANSFORM vertices, 267
INITIALGAP, 269
LABEL, 214
LINECAP, 102, 269
LINECAP butt, 269
LINECAP round, 269
LINECAP square, 269
LINEJOIN, 102, 270
LINEJOIN bevel, 270
LINEJOIN miter, 270
LINEJOIN round, 270
LINEJOINMAXSIZE, 102, 270
MAXSCALEDENOM, 270
MAXSIZE, 270
MAXWIDTH, 270
MINSCALEDENOM, 270
MINSIZE, 270
MINWIDTH, 270
OFFSET, 102, 270
OPACITY, 271
OUTLINECOLOR, 271
OUTLINEWIDTH, 271
PATTERN, 271
POLAROFFSET, 272

QUERYMAP, 261
RANGEITEM, 273
SCALEBAR, 265
SIZE, 273
SYMBOL, 274
WIDTH, 274
Style parameters OGR, 616
STYLEITEM
attribute, LAYER, 234
AUTO, LAYER, 235
Javascript, LAYER, 235
LAYER, 234
STYLEITEM "AUTO" OGR, 614
STYLEITEM Javascript, 275
styleObj
    MapScript PHP, 410 styleObj (class in mapscript), 355 Support
PHP, 49
Supported features
WFS Filter encoding, 872
Supported formats JOIN, 199
Supported parameters
Run-time substitution, 1062
SVG, 1072
svg
MAP IMAGETYPE, 249
SYMBOL TYPE, 280
SWF, 1072
SWIG, 1072
sym2img
Utility,  1047
SYMBOL, 278
ANCHORPOINT, 278
ANTIALIAS, 279
CHARACTER, 279
CLASS, 137
FILLED, 279
FONT, 279
IMAGE, 279
NAME, 279
POINTS, 279
STYLE, 274
TRANSPARENT, 280
TYPE, 280
TYPE cartoline, 280
TYPE ellipse, 280
TYPE hatch, 280
TYPE pixmap, 280
TYPE svg, 280
TYPE truetype, 280




TYPE vector, 280
Symbol center, 128
Symbol construction, 79
Symbol scaling, 83
Symbol specification, 83
symbolObj
    MapScript PHP, 412 symbolObj (class in mapscript), 357 Symbology examples, 280 Symbols
Optimization, 1005
SYMBOLSCALEDENOM LAYER, 236
SYMBOLSET
MAP, 251
symbolSetObj (class in mapscript), 358
symDifference() (mapscript.shapeObj method), 353
T
TABLE
JOIN, 200
TEMPLATE
CLASS, 137
JOIN, 200
LAYER, 237
LEGEND, 245
WEB, 308
Template substitution tags Template-driven output, 746
Template-driven output, 744
OUTPUTFORMAT, 746
Template substitution tags, 746
TEMPLATEPATTERN MAP, 251
Templating, 284
Temporal expressions Expressions, 166
Temporary directory, 308
Temporary files, 308, 1051
TEMPPATH
WEB, 308
TEXT
CLASS, 137
FEATURE, 167
LABEL, 214
tile
CGI, 1059
CGI mode, 1058
Tile indexes
Optimization, 1011
Tile indexing Raster, 663
tile4ms
Utility,  1047


TILED
OUTPUTFORMAT FORMATOPTION, 255
Tiled datasets Raster, 671
TILEINDEX
LAYER, 237
OGR, 613
Optimization, 1013
Tileindex, 1072
tileindex
CGI, 1059
TILEITEM
LAYER, 237
tilemode
CGI, 1059
tilesize
CGI, 1059
TILESRS
LAYER, 237
Tiling
Optimization Raster, 1011
Time requests
WMS Server, 826
TIS-620
ENCODING, 155
TITLE
CLASS, 137
TO
JOIN, 200
toHex() (mapscript.colorObj method), 318
TOLERANCE
IDENTIFY, 196
LAYER, 237
TOLERANCEUNITS IDENTIFY, 196
LAYER, 238
topologyPreservingSimplify()	(map- script.shapeObj method), 354
toPolygon() (mapscript.rectObj method), 347 toShape() (mapscript.pointObj method), 344 tostring
Expressions, 164
toString() (mapscript.pointObj method), 344 toString() (mapscript.rectObj method), 347 touches
Expressions, 163
touches() (mapscript.shapeObj method), 354 toWKT() (mapscript.shapeObj method), 354 TRANSFORM
LAYER, 238
TRANSPARENT
LEGEND, 246
OUTPUTFORMAT, 256
SCALEBAR, 265




SYMBOL, 280
TRANSPARENT_FORMAT
OUTPUTFORMAT FORMATOPTION, 255
truetype
LABEL TYPE, 215
SYMBOL TYPE, 280
Truetype symbols, 87
Tutorial, 28
TYPE
annotation, LAYER, 238
bitmap, LABEL, 215
cartoline, SYMBOL, 280
chart, LAYER, 238
circle, LAYER, 238
ellipse, SYMBOL, 280
hatch, SYMBOL, 280
JOIN, 200
LABEL, 215
LAYER, 238
line, LAYER, 238
pixmap, SYMBOL, 280
point, LAYER, 238
polygon, LAYER, 238
query, LAYER, 238
raster, LAYER, 238
svg, SYMBOL, 280
SYMBOL, 280
truetype, LABEL, 215
truetype, SYMBOL, 280
vector, SYMBOL, 280
U
Unable to load dll Error, 1081
union
LAYER CONNECTIONTYPE, 217
Union layer, 300
union options
LAYER PROCESSING, 231
Union() (mapscript.shapeObj method), 351
UNION_SCALE_CHECK
LAYER PROCESSING, 231
UNION_SRCLAYER_CLOSE_CONNECTION LAYER PROCESSING, 231
UNION_STATUS_CHECK LAYER PROCESSING, 231
UNITS
dd, LAYER, 239
dd, MAP, 251
feet, LAYER, 239
feet, MAP, 251
feet, SCALEBAR, 265
inches, LAYER, 239
inches, MAP, 251


inches, SCALEBAR, 265
kilometers, LAYER, 239
kilometers, MAP, 251
kilometers, SCALEBAR, 265
LAYER, 239
MAP, 251
meters, LAYER, 239
meters, MAP, 251
meters, SCALEBAR, 265
miles, LAYER, 239
miles, MAP, 251
miles, SCALEBAR, 265
nauticalmiles, LAYER, 239
nauticalmiles, MAP, 251
nauticalmiles, SCALEBAR, 265
percentages, LAYER, 239
pixels, LAYER, 239
SCALEBAR, 265
Units of measure
WFS Filter encoding, 872
Unix
Installation, 33
Wrapper script, 780
updateFromString() (mapscript.classObj method), 317
updateFromString() (mapscript.clusterObj method), 318
updateFromString() (mapscript.labelObj method), 326
updateFromString() (mapscript.layerObj method), 333
updateFromString() (mapscript.legendObj method), 334
updateFromString()	(mapscript.queryMapObj method), 346
updateFromString()	(mapscript.referenceMapObj method), 348
updateFromString() (mapscript.scalebarObj method), 351
updateFromString() (mapscript.styleObj method), 357 updateFromString() (mapscript.webObj method), 360 upper
Expressions, 164
URL
Change, 777
Use cases
WCS, 915
UTF-8
ENCODING, 155
UTFDATA
LAYER, 239
UTFGRID, 758
OUTPUTFORMAT, 256
UTFITEM



LAYER, 239
UTFRESOLUTION
OUTPUTFORMAT FORMATOPTION, 256
Utility
coshp, 1034
legend, 1036
map2img, 1036
msencrypt, 1040
scalebar, 1042
shptree, 1042
shptreetst, 1044
sortshp, 1045
sym2img, 1047
tile4ms, 1047
UV_SIZE_SCALE
LAYER PROCESSING, 231
UV_SPACING
LAYER PROCESSING, 231
uvraster, 649
LAYER CONNECTIONTYPE, 217
V
V8
MapScript, 77
validate() (mapscript.outputFormatObj method), 343
VALIDATION, 296, 1064
CLASS, 138
LAYER, 239
Run-time substitution, 1064
WEB, 308
value_list
Raster query, 669
value_n
Raster query, 669
Vector, 1072
Optimization, 1023
vector
SYMBOL TYPE, 280
Vector field, 649
Vector polygon fill, 109
Vector symbols, 86
Vendor specific parameters angle, WMS, 794
bbox_pixel_is_point, WMS, 794
map_resolution, WMS, 794
radius, WMS, 794
WMS, 794
vertices
GEOMTRANSFORM, 174
STYLE GEOMTRANSFORM, 267
Virtual File Support OGR, 674
Virtual file system, 673

W
Warping
Raster, 664
WCS, 1072
LAYER METADATA, 910
Metadata, 907
METADATA ows_allowed_ip_list, 907, 910
METADATA ows_denied_ip_list, 908, 910
METADATA wcs_abstract, 908, 910
METADATA wcs_accessconstraints, 908
METADATA wcs_address, 908
METADATA wcs_allowed_ip_list, 907
METADATA wcs_band_names, 908
METADATA wcs_city, 908
METADATA wcs_contactelectronicmailaddress, 908
METADATA	wcs_contactfacimiletelephone, 908
METADATA wcs_contactorganization, 908
METADATA wcs_contactperson, 908
METADATA wcs_contactposition, 908
METADATA wcs_contactvoicetelephone, 908
METADATA wcs_country, 908
METADATA wcs_denied_ip_list, 908
METADATA wcs_description, 908, 910
METADATA wcs_enable_request, 908, 910
METADATA wcs_extent, 910
METADATA wcs_fees, 908
METADATA wcs_formats, 910
METADATA wcs_keywords, 908, 910
METADATA wcs_label, 908, 910
METADATA wcs_metadatalink_format, 909, 910
METADATA wcs_metadatalink_href, 909, 911
METADATA wcs_metadatalink_type, 909, 911
METADATA wcs_name, 909, 911
METADATA wcs_native_format, 911
METADATA wcs_nativeformat, 911
METADATA wcs_outputformat_creationoption, 911
METADATA wcs_outputformat_mdi, 911
METADATA wcs_postcode, 908
METADATA wcs_rangeset_axes, 912
METADATA wcs_rangeset_description, 913
METADATA wcs_rangeset_label, 913
METADATA wcs_rangeset_name, 913
METADATA wcs_rangeset_nullvalue, 913
METADATA wcs_responsibleparty_address_administrativear
909
METADATA wcs_responsibleparty_address_city, 909
METADATA wcs_responsibleparty_address_country, 909
METADATA wcs_responsibleparty_address_deliverypoint, 909



METADATA wcs_responsibleparty_address_electwrcosn_idcemnaiielda_didpr_elsiss,t
909	WCS METADATA, 908
METADATA wcs_responsibleparty_address_postawlccso_ddee,scription
909	WCS METADATA, 908, 910
METADATA wcs_responsibleparty_individualnamwec,s_enable_request
909	WCS METADATA, 908, 910
METADATA wcs_responsibleparty_onlineresourcwec,s_extent
909	WCS METADATA, 910
METADATA wcs_responsibleparty_organizationnwacmse_,fees
909	WCS METADATA, 908
METADATA wcs_responsibleparty_phone_facsimiwlces,_formats

909
METADATA wcs_responsibleparty_phone_voice, 909
METADATA wcs_responsibleparty_postionname, 909
METADATA wcs_service_onlineresource, 909
METADATA wcs_srs, 913
METADATA wcs_stateorprovince, 908
METADATA wcs_timeitem, 913
METADATA wcs_timeposition, 913
Use cases, 915
WEB METADATA, 907
WCS 1.1.0, 897
WCS 2.0, 899
WCS Server, 891
Mapfile, 893
Output formats, 895
wcs_abstract
WCS METADATA, 908, 910
wcs_accessconstraints WCS METADATA, 908
wcs_address
WCS METADATA, 908
wcs_allowed_ip_list WCS METADATA, 907
wcs_band_names
WCS METADATA, 908
wcs_city
WCS METADATA, 908
wcs_contactelectronicmailaddress WCS METADATA, 908
wcs_contactfacimiletelephone WCS METADATA, 908
wcs_contactorganization WCS METADATA, 908
wcs_contactperson WCS METADATA, 908
wcs_contactposition WCS METADATA, 908
wcs_contactvoicetelephone WCS METADATA, 908
wcs_country
WCS METADATA, 908

WCS METADATA, 910
wcs_keywords
WCS METADATA, 908, 910
wcs_label
WCS METADATA, 908, 910
wcs_languages
WFS METADATA, 910
wcs_metadatalink_format WCS METADATA, 909, 910
wcs_metadatalink_href WCS METADATA, 909, 911
wcs_metadatalink_type WCS METADATA, 909, 911
wcs_name
WCS METADATA, 909, 911
wcs_native_format WCS METADATA, 911
wcs_nativeformat WCS METADATA, 911
wcs_outputformat_creationoption WCS METADATA, 911
wcs_outputformat_mdi WCS METADATA, 911
wcs_postcode
WCS METADATA, 908
wcs_rangeset_axes WCS METADATA, 912
wcs_rangeset_description WCS METADATA, 913
wcs_rangeset_label WCS METADATA, 913
wcs_rangeset_name WCS METADATA, 913
wcs_rangeset_nullvalue WCS METADATA, 913
wcs_responsibleparty_address_administrativearea WCS METADATA, 909
wcs_responsibleparty_address_city WCS METADATA, 909
wcs_responsibleparty_address_country WCS METADATA, 909
wcs_responsibleparty_address_deliverypoint WCS METADATA, 909



wcs_responsibleparty_address_electronicmailaddwreebsOsbj

WCS METADATA, 909
wcs_responsibleparty_address_postalcode WCS METADATA, 909
wcs_responsibleparty_individualname WCS METADATA, 909
wcs_responsibleparty_onlineresource WCS METADATA, 909
wcs_responsibleparty_organizationname WCS METADATA, 909
wcs_responsibleparty_phone_facsimile WCS METADATA, 909
wcs_responsibleparty_phone_voice WCS METADATA, 909
wcs_responsibleparty_postionname WCS METADATA, 909
wcs_service_onlineresource WCS METADATA, 909
wcs_srs
WCS METADATA, 913
wcs_stateorprovince WCS METADATA, 908
wcs_timeitem
WCS METADATA, 913
wcs_timeposition WCS METADATA, 913
WEB, 305
BROWSEFORMAT, 305
EMPTY, 305
ERROR, 305
FOOTER, 305
HEADER, 305
IMAGEPATH, 305
IMAGEURL, 305
LEGENDFORMAT, 305
LOG, 305
MAP, 251
MAXSCALEDENOM, 305
MAXTEMPLATE, 306
METADATA, 306
METADATA labelcache_map_edge_buffer, 306
METADATA ms_enable_modes, 306
METADATA, SOS, 929
METADATA, WCS, 907
METADATA, WFS, 853
METADATA, WMS, 782
MINSCALEDENOM, 307
MINTEMPLATE, 308
QUERYFORMAT, 308
TEMPLATE, 308
TEMPPATH, 308
VALIDATION, 308
Web map context WMS, 833
    
MapScript PHP, 413 webObj (class in mapscript), 359 WFS, 1072
Filter encoding, 871
Filter encoding Limitations, 875
Filter encoding	OGC conformance tests, 877
Filter encoding Supported features, 872 Filter encoding Units of measure, 872 LAYER METADATA, 856
Metadata, 850
METADATA gml_constants, 856
METADATA gml_default_items, 856
METADATA gml_exclude_items, 856
METADATA gml_featureid, 857
METADATA gml_geometries, 857
METADATA gml_groups, 857
METADATA gml_include_items, 858
METADATA gml_mandatory_items, 858
METADATA gml_optional_items, 858
METADATA gml_types, 859
METADATA gml_xml_items, 859
METADATA gml_[geometry name]_occurances, 857
METADATA gml_[geometry name]_type, 857 METADATA gml_[group name]_group, 857 METADATA gml_[item name]_alias, 858 METADATA gml_[item name]_precision, 858 METADATA gml_[item name]_type, 858 METADATA gml_[item name]_value, 858 METADATA gml_[item name]_width, 858 METADATA ows_allowed_ip_list, 853, 859
METADATA ows_denied_ip_list, 853, 859
METADATA ows_schemas_location, 853
METADATA ows_updatesequence, 854
METADATA wcs_languages, 910
METADATA wfs_abstract, 854, 859
METADATA wfs_accessconstraints, 854
METADATA wfs_allowed_ip_list, 853
METADATA wfs_anable_request, 854, 859
METADATA wfs_compute_number_matched, 854
METADATA wfs_denied_ip_list, 853
METADATA wfs_extent, 859
METADATA wfs_feature_collection, 854
METADATA wfs_featureid, 859
METADATA wfs_features_cache_count, 854
METADATA wfs_features_cache_size, 854
METADATA wfs_fees, 854
METADATA wfs_geometry_precision, 855, 859
METADATA wfs_getcapabilities_version, 855
METADATA wfs_getfeature_formatlist, 860
METADATA wfs_keywordlist, 855, 860
METADATA wfs_languages, 855




METADATA wfs_maxfeatures, 855
METADATA wfs_maxfeatures_ignore_for_resulttwyfpse
855


WFS METADATA, 854
fheietss,
WFS METADATA, 854

METADATA wfs_metadataurl_about, 860
METADATA wfs_metadataurl_format, 860
METADATA wfs_metadataurl_href, 860
METADATA wfs_metadataurl_type, 861
METADATA wfs_namespace_prefix, 855
METADATA wfs_namespace_uri, 855
METADATA wfs_onlineresource, 855
METADATA wfs_return_srs_as_urn, 856
METADATA wfs_service_onlineresource, 856
METADATA wfs_srs, 856, 861
METADATA wfs_storedqueries, 856
METADATA wfs_title, 856, 861

wfs_geometry_precision WFS METADATA, 855, 859
wfs_getcapabilities_version WFS METADATA, 855
wfs_getfeature_formatlist WFS METADATA, 860
wfs_keywordlist
WFS METADATA, 855, 860
wfs_languages
WFS METADATA, 855
wfs_maxfeatures
WFS METADATA, 855

METADATA wfs_use_default_extent_for_getfeatwufrse_,maxfeatures_ignore_for_resulttype_hits





wfs

861
METADATA wfs_[storedqueryid]_filedef, 856
METADATA	wfs_[storedqueryid]_inlinedef, 856
WEB METADATA, 853
LAYER CONNECTIONTYPE, 217

WFS METADATA, 855
wfs_metadataurl_about WFS METADATA, 860
wfs_metadataurl_format WFS METADATA, 860
wfs_metadataurl_href WFS METADATA, 860

WFS Client, 865
LAYER METADATA, 867
Mapfile, 867
WFS Server, 842
GML, 844
Mapfile, 844
OUTPUTFORMAT, 850
SRS, 846
STARTINDEX, 850
Stored queries, 850
wfs_abstract
WFS METADATA, 854, 859
wfs_accessconstraints WFS METADATA, 854
wfs_allowed_ip_list WFS METADATA, 853
wfs_anable_request
WFS METADATA, 854, 859
wfs_compute_number_matched WFS METADATA, 854
wfs_denied_ip_list WFS METADATA, 853
wfs_extent
WFS METADATA, 859
wfs_feature_collection WFS METADATA, 854
wfs_featureid
WFS METADATA, 859
wfs_features_cache_count WFS METADATA, 854
wfs_features_cache_size

wfs_metadataurl_list WMS METADATA, 860
wfs_metadataurl_type WFS METADATA, 861
wfs_namespace_prefix WFS METADATA, 855
wfs_namespace_uri WFS METADATA, 855
wfs_onlineresource WFS METADATA, 855
wfs_return_srs_as_urn WFS METADATA, 856
wfs_service_onlineresource WFS METADATA, 856
wfs_srs
WFS METADATA, 856, 861
wfs_storedqueries WFS METADATA, 856
wfs_title
WFS METADATA, 856, 861
wfs_use_default_extent_for_getfeature WFS METADATA, 861
wfs_[storedqueryid]_filedef WFS METADATA, 856
wfs_[storedqueryid]_inlinedef WFS METADATA, 856
whichShapes() (mapscript.layerObj method), 333
WIDTH
STYLE, 274
Win32
Compilation, 41




Installation, 41
within
Expressions, 163
within() (mapscript.shapeObj method), 354 wkp_gmerc (in module mapscript), 367 wkp_lonlat (in module mapscript), 367 wkp_none (in module mapscript), 367
WKT
FEATURE, 167
WMC, 1073
WMS, 1073
Cascading requests, 795
GetLegendGraphic, 776
GetMap, 774
HTTP status error codes, 794
LAYER METADATA, 787
Metadata, 781
METADATA gml_exclude_items, 787
METADATA gml_geometries, 787
METADATA gml_groups, 787
METADATA gml_include_items, 787
METADATA gml_xml_items, 788
METADATA gml_[geometry name]_type, 788 METADATA gml_[group name]_group, 787 METADATA gml_[item name]_alias, 788 METADATA gml_[item name]_type, 788 METADATA ows_allowed_ip_list, 782, 788
METADATA ows_compliance_mode, 782
METADATA ows_denied_ip_list, 782, 788
METADATA ows_http_max_age, 782
METADATA ows_schemas_location, 782
METADATA ows_sld_enabled, 782
METADATA ows_updatesequence, 782
METADATA wfs_metadataurl_list, 860
METADATA wms_abstract, 783, 788
METADATA wms_accessconstraints, 783
METADATA wms_address, 783
METADATA wms_addresstype, 783
METADATA wms_allow_getmap_without_styles, 783
METADATA wms_allowed_ip_list, 782
METADATA wms_attribution_logourl_format, 783, 789
METADATA wms_attribution_logourl_height, 783, 789
METADATA	wms_attribution_logourl_href, 783, 789
METADATA	wms_attribution_logourl_width, 783, 789
METADATA wms_attribution_onlineresource, 783, 789
METADATA wms_attribution_title, 784, 789
METADATA wms_authorityurl_href, 789
METADATA wms_authorityurl_name, 789


METADATA wms_bbox_extended, 784, 789
METADATA wms_city, 783
METADATA wms_compliance_mode, 782
METADATA wms_contactelectronicmailaddress, 784
METADATA	wms_contactfacsimiletelephone, 784
METADATA wms_contactorganization, 784
METADATA wms_contactperson, 784
METADATA wms_contactposition, 784
METADATA wms_contactvoicetelephone, 784
METADATA wms_country, 783
METADATA wms_dataurl_format, 789
METADATA wms_dataurl_href, 789
METADATA wms_denied_ip_list, 782
METADATA wms_enable_request, 784, 790
METADATA wms_encoding, 784
METADATA wms_exclude_items, 790
METADATA wms_extent, 790
METADATA wms_feature_info_mime_type, 784
METADATA wms_fees, 785
METADATA wms_getcapabilities_version, 785
METADATA	wms_getfeatureinfo_formatlist, 790
METADATA wms_getlegendgraphic_formatlist, 785, 790
METADATA wms_getmap_formatlist, 785, 790
METADATA wms_group_abstract, 791
METADATA wms_group_title, 791
METADATA wms_identifier_authority, 791
METADATA wms_identifier_value, 791
METADATA wms_include_items, 791
METADATA wms_keywordlist, 785, 791
METADATA wms_keywordlist_vocabulary,  785,
791
METADATA	wms_keywordlist_[vocabulary's name]_items, 785, 791
METADATA wms_languages, 785
METADATA wms_layer_group, 791
METADATA wms_layerlimit, 785
METADATA wms_metadataurl_format, 792
METADATA wms_metadataurl_href, 792
METADATA wms_metadataurl_list, 792, 909
METADATA wms_metadataurl_type, 792
METADATA wms_onlineresource, 785
METADATA wms_opaque, 792
METADATA wms_postcode, 783
METADATA wms_remote_sld_max_bytes, 786
METADATA wms_resx, 786
METADATA wms_resy, 786
METADATA wms_rootlayer_abstract, 786
METADATA wms_rootlayer_keywordlist, 786
METADATA wms_rootlayer_name, 786
METADATA wms_rootlayer_title, 786




METADATA wms_service_onlineresource, 786
METADATA wms_srs, 786, 793
METADATA wms_stateorprovince, 783
METADATA wms_style, 793


wms_attribution_logourl_width WMS METADATA, 783, 789
wms_attribution_onlineresource WMS METADATA, 783, 789

METADATA wms_style_[style's_name]_legendurlw_mfso_ramtattr,ibution_title
793	WMS METADATA, 784, 789
METADATA wms_style_[style's_name]_legendurlw_mhse_iaguhtth,orityurl_href
793	WMS METADATA, 789
METADATA wms_style_[style's_name]_legendurlw_mhsr_eafu,thorityurl_name
793	WMS METADATA, 789
METADATA wms_style_[style's_name]_legendurlw_mwsi_dbtbho,x_extended












wms

793
METADATA wms_timeextent, 793
METADATA wms_timeformat, 787, 793
METADATA wms_timeitem, 793
METADATA wms_title, 787, 793
Vendor specific parameters, 794 Vendor specific parameters angle, 794 Vendor specific parameters
bbox_pixel_is_point, 794
Vendor specific parameters map_resolution, 794
Vendor specific parameters radius, 794
Web map context, 833
WEB METADATA, 782
LAYER CONNECTIONTYPE, 217

WMS METADATA, 784, 789
wms_city
WMS METADATA, 783
wms_compliance_mode WMS METADATA, 782
wms_contactelectronicmailaddress WMS METADATA, 784
wms_contactfacsimiletelephone WMS METADATA, 784
wms_contactorganization WMS METADATA, 784
wms_contactperson WMS METADATA, 784
wms_contactposition WMS METADATA, 784
wms_contactvoicetelephone

WMS 1.3.0, 780
WMS Client, 816
LAYER METADATA, 820
Mapfile, 818
WMS Server, 768
Dimension requests, 831
Mapfile, 771, 801
Setup, 770
Time requests, 826
wms_abstract
WMS METADATA, 783, 788
wms_accessconstraints WMS METADATA, 783
wms_address
WMS METADATA, 783
wms_addresstype
WMS METADATA, 783
wms_allow_getmap_without_styles WMS METADATA, 783
wms_allowed_ip_list WMS METADATA, 782
wms_attribution_logourl_format WMS METADATA, 783, 789
wms_attribution_logourl_height WMS METADATA, 783, 789
wms_attribution_logourl_href WMS METADATA, 783, 789

WMS METADATA, 784
wms_country
WMS METADATA, 783
wms_dataurl_format WMS METADATA, 789
wms_dataurl_href WMS METADATA, 789
wms_denied_ip_list WMS METADATA, 782
wms_enable_request
WMS METADATA, 784, 790
wms_encoding
WMS METADATA, 784
wms_exclude_items WMS METADATA, 790
wms_extent
WMS METADATA, 790
wms_feature_info_mime_type WMS METADATA, 784
wms_fees
WMS METADATA, 785
wms_getcapabilities_version WMS METADATA, 785
wms_getfeatureinfo_formatlist WMS METADATA, 790
wms_getlegendgraphic_formatlist WMS METADATA, 785, 790




wms_getmap_formatlist WMS METADATA, 785, 790
wms_group_abstract WMS METADATA, 791
wms_group_title
WMS METADATA, 791
wms_identifier_authority WMS METADATA, 791
wms_identifier_value WMS METADATA, 791
wms_include_items WMS METADATA, 791
wms_keywordlist
WMS METADATA, 785, 791
wms_keywordlist_vocabulary WMS METADATA, 785, 791
wms_keywordlist_[vocabulary's name]_items WMS METADATA, 785, 791
wms_languages
WMS METADATA, 785
wms_layer_group
WMS METADATA, 791
wms_layerlimit
WMS METADATA, 785
wms_metadataurl_format WMS METADATA, 792
wms_metadataurl_href WMS METADATA, 792
wms_metadataurl_list WMS METADATA, 792, 909
wms_metadataurl_type WMS METADATA, 792
wms_onlineresource WMS METADATA, 785
wms_opaque
WMS METADATA, 792
wms_postcode
WMS METADATA, 783
wms_remote_sld_max_bytes WMS METADATA, 786
wms_resx
WMS METADATA, 786
wms_resy
WMS METADATA, 786
wms_rootlayer_abstract WMS METADATA, 786
wms_rootlayer_keywordlist WMS METADATA, 786
wms_rootlayer_name WMS METADATA, 786
wms_rootlayer_title WMS METADATA, 786
wms_service_onlineresource WMS METADATA, 786

wms_srs
WMS METADATA, 786, 793
wms_stateorprovince WMS METADATA, 783
wms_style
WMS METADATA, 793
wms_style_[style's_name]_legendurl_format WMS METADATA, 793
wms_style_[style's_name]_legendurl_height WMS METADATA, 793
wms_style_[style's_name]_legendurl_href WMS METADATA, 793
wms_style_[style's_name]_legendurl_width WMS METADATA, 793
wms_timeextent
WMS METADATA, 793
wms_timeformat
WMS METADATA, 787, 793
wms_timeitem
WMS METADATA, 793
wms_title
WMS METADATA, 787, 793
World files
Raster, 673
WORLDFILE
LAYER PROCESSING, 667
WRAP
LABEL, 215
Wrapper
Mapscript, 779
Wrapper script Unix, 780
write() (mapscript.imageObj method), 321
WxS Services
Mapscript wrappers, 935
X
x
Raster query, 669
XML Mapfile support, 308
Y
y
Raster query, 669
Z
zoom
CGI, 1060
zoomdir
CGI, 1060
zoomin
CGI mode, 1058
zoomout
CGI mode, 1058



zoomPoint() (mapscript.mapObj method), 341 zoomRectangle() (mapscript.mapObj method), 341 zoomScale() (mapscript.mapObj method), 341 zoomsize
CGI, 1060


















































































































































































































































































































































